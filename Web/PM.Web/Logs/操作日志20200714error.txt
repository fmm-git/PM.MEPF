2020-07-14 09:37:54
Text:	 SELECT   TOP 1 * FROM [TbUser]  WHERE ([TbUser].[UserCode] = @UserCode1) AND ([TbUser].[UserPwd] = @UserPwd2) 	
Parameters:
@UserCode1[String] = 500000
@UserPwd2[String] = c4ca4238a0b923820dcc509a6f75849b


-----------------------------------------------------------------------------
2020-07-14 09:37:54
Text:	SELECT UserClosed FROM TbUser WHERE UserCode=@UserName	
Parameters:
@UserName[String] = 500000


-----------------------------------------------------------------------------
2020-07-14 09:37:54
Text:	select top 1 ur.ProjectId,pro.ProjectName,ur.OrgId,cm.CompanyFullName,cm.ParentCompanyCode,ur.OrgType,ur.UserCode as UserId,u.UserCode,u.UserName from TbUserRole ur 
left join TbCompany cm on ur.OrgId=cm.CompanyCode
left join TbProjectInfo pro on ur.ProjectId=pro.ProjectId
left join TbUser u on ur.UserCode=u.UserId
where u.UserCode=@UserCode and ur.Flag=0 group by ur.ProjectId,pro.ProjectName,ur.OrgId,cm.CompanyFullName,cm.ParentCompanyCode,ur.OrgType,ur.UserCode,u.UserCode,u.UserName order by OrgId asc	
Parameters:
@UserCode[String] = 500000


-----------------------------------------------------------------------------
2020-07-14 09:37:54
Text:	select distinct ur.RoleCode as RoleId,r.RoleCode,r.RoleName from TbUserRole ur
left join TbUser u on ur.UserCode=u.UserId
left join TbRole r on ur.RoleCode=r.RoleId
where u.UserCode=@UserCode and ProjectId=@ProjectId and OrgId=@OrgId and ur.Flag=0	
Parameters:
@UserCode[String] = 500000
@ProjectId[String] = 6372912251695766465
@OrgId[String] = 6372921375874657752


-----------------------------------------------------------------------------
2020-07-14 09:37:54
Text:	 SELECT   TOP 1 [TbCarInfoDetail].[ID] FROM [TbCarInfoDetail]  WHERE [TbCarInfoDetail].[UserCode] = @UserCode3 	
Parameters:
@UserCode3[String] = 500000


-----------------------------------------------------------------------------
2020-07-14 09:37:54
Text:	INSERT INTO [TbSysLog] ([ActionMenu],[ActionType],[HostName],[LogDate],[UserCode],[UserIP]) VALUES (@ActionMenu4,@ActionType5,@HostName6,@LogDate7,@UserCode8,@UserIP9);select scope_identity()	
Parameters:
@ActionMenu4[String] = 0
@ActionType5[String] = 登录系统
@HostName6[String] = 
@LogDate7[DateTime] = 2020/7/14 9:37:54
@UserCode8[String] = 500000
@UserIP9[String] = 192.168.3.222


-----------------------------------------------------------------------------
2020-07-14 09:37:56
Text:	select tsm.* from TbRoleMenu tum
                           left join TbSysMenu tsm on tum.MenuCode=tsm.MenuCode
                           where tsm.IsShow=0 and tsm.MenuType='PC' and tum.RoleCode in('6372919444627396738','6372919451594895243') order by tsm.Sort asc	


-----------------------------------------------------------------------------
2020-07-14 09:37:56
Text:	select 
                        	tsm.*
                        from TbUserMenu tum
                        left join TbSysMenu tsm on tum.MenuCode=tsm.MenuCode
                        where tsm.IsShow=0 and tsm.MenuType='PC' and tum.UserCode=@userCode order by tsm.Sort asc	
Parameters:
@userCode[String] = 6372930471544160074


-----------------------------------------------------------------------------
2020-07-14 09:37:56
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 09:37:56
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 09:37:56
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 09:37:56
Text:	select isnull(sum(TbCF.Capacity),0) as Capacity,isnull(sum(TbCF.WeightSmallPlan),0) as WeightSmallPlan,isnull(cast(sum(TbCF.WeightSmallPlan)/sum(TbCF.Capacity)*100 as decimal(18,2)),0) as ActualLoadNew from (select cf.Capacity,Tb1.WeightSmallPlan,cf.ProcessFactoryCode from TbCapacityFilling cf  
left join(
select SUM(Tb.WeightSmallPlan) as WeightSmallPlan,Tb.ProcessFactoryCode from (
                            select isnull(SUM(wod.WeightSmallPlan),0) as WeightSmallPlan,wo.ProcessFactoryCode from TbWorkOrder wo
                            left join TbWorkOrderDetail wod on wo.OrderCode=wod.OrderCode
                            where (ISNULL(@ProcessFactoryCode,'')='' or wo.ProcessFactoryCode=@ProcessFactoryCode)
                            and CONVERT(varchar(7), wo.DistributionTime, 120)=@month
                            and wod.RevokeStart='正常' and wo.ProcessingState!='ConfirmWork' and wo.ProcessingState!='Finishing'  group by wo.ProcessFactoryCode
                            union all
                            select isnull(sum(opd.NoCompleted),0) as NoCompleted,op.ProcessFactoryCode from TbOrderProgress op
                            left join TbOrderProgressDetail opd on op.OrderCode=opd.OrderCode 
                            where (ISNULL(@ProcessFactoryCode,'')='' or op.ProcessFactoryCode=@ProcessFactoryCode)
                            and CONVERT(varchar(7), op.DistributionTime, 120)=CONVERT(varchar(4),YEAR(DATEADD(MONTH,-1,@month+'-01')))+'-'+Right(100+Month(DATEADD(MONTH,-1,@month+'-01')),2)
                            and opd.RevokeStart='正常'  group by op.ProcessFactoryCode)Tb  group by Tb.ProcessFactoryCode
) Tb1 on cf.ProcessFactoryCode=Tb1.ProcessFactoryCode 
where cf.CapacityMonth=@month
and (ISNULL(@ProcessFactoryCode,'')='' or cf.ProcessFactoryCode=@ProcessFactoryCode)) TbCF where (ISNULL(@ProcessFactoryCode,'')='' or TbCF.ProcessFactoryCode=@ProcessFactoryCode)	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@month[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-14 09:37:57
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 09:37:57
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode10) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode11,@WorkAreaCode12))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus13) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth14))) 	
Parameters:
@ProcessFactoryCode10[String] = 6386683729561128960
@WorkAreaCode11[String] = 6372921396045311451
@WorkAreaCode12[String] = 6372921398380745033
@Examinestatus13[String] = 审核完成
@DemandMonth14[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-14 09:37:57
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 09:37:57
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 09:37:58
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 09:37:58
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 09:37:58
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode17) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode18))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState19)) 	
Parameters:
@ProcessFactoryCode17[String] = 6386683729561128960
@SiteCode18[String] = 6372921375874657752
@ProcessingState19[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-14 09:37:58
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-14 09:37:58
Text:	 SELECT   [TbOrderProgress].[ProcessingState],[TbOrderProgress].[OrderCode],[TbOrderProgress].[FinishProcessingDateTime],[TbOrderProgress].[DistributionTime],[TbOrderProgress].[SiteCode] FROM [TbOrderProgress]  WHERE ((([TbOrderProgress].[SiteCode] IN (@SiteCode15)) AND ([TbOrderProgress].[ProcessFactoryCode] = @ProcessFactoryCode16)) AND ((YEAR(DistributionTime)=2020 and MONTH(DistributionTime)=7) or (DistributionTime<'2020/7/1 0:00:00' and (ProcessingState!='Finishing')))) 	
Parameters:
@SiteCode15[String] = 6372921375874657752
@ProcessFactoryCode16[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 09:37:58
Text:	 SELECT   * FROM [TbWorkOrderDetail]  WHERE (1=2) AND ([TbWorkOrderDetail].[DaetailWorkStrat] = @DaetailWorkStrat20) 	
Parameters:
@DaetailWorkStrat20[String] = 未加工


-----------------------------------------------------------------------------
2020-07-14 09:37:58
Text:	 SELECT   [TbOrderProgress].[WeightTotal] AS [TotalWeight],[TbCompany].[ParentCompanyCode] FROM [TbOrderProgress] LEFT OUTER JOIN [TbCompany] ON ([TbOrderProgress].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((1=2) AND ([TbOrderProgress].[ProcessingState] <> @ProcessingState21)) AND ((([TbOrderProgress].[FinishProcessingDateTime] is not null ) AND ([TbOrderProgress].[DistributionTime] < [TbOrderProgress].[FinishProcessingDateTime])) OR (([TbOrderProgress].[FinishProcessingDateTime] is null ) AND ([TbOrderProgress].[DistributionTime] < @DistributionTime22)))) 	
Parameters:
@ProcessingState21[String] = Finishing
@DistributionTime22[DateTime] = 2020/7/14 0:00:00


-----------------------------------------------------------------------------
2020-07-14 09:37:58
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 09:37:58
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode23) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode24))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState25)) 	
Parameters:
@ProcessFactoryCode23[String] = 6386683729561128960
@SiteCode24[String] = 6372921375874657752
@ProcessingState25[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-14 09:37:58
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-14 09:37:58
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 09:37:58
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode27) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode28,@WorkAreaCode29))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus30) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth31))) 	
Parameters:
@ProcessFactoryCode27[String] = 6386683729561128960
@WorkAreaCode28[String] = 6372921396045311451
@WorkAreaCode29[String] = 6372921398380745033
@Examinestatus30[String] = 审核完成
@DemandMonth31[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-14 09:37:58
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 09:37:58
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 09:37:58
Text:	 SELECT   [TbRawMaterialStockRecord].[MaterialCode],sum([TbRawMaterialStockRecord].[UseCount]) AS [UseCount],sum([TbRawMaterialStockRecord].[LockCount]) AS [LockCount] FROM [TbRawMaterialStockRecord] LEFT OUTER JOIN [TbStorage] ON ([TbRawMaterialStockRecord].[StorageCode] = [TbStorage].[StorageCode]) LEFT OUTER JOIN [TbRawMaterialArchives] ON ([TbRawMaterialStockRecord].[MaterialCode] = [TbRawMaterialArchives].[MaterialCode])  WHERE ((([TbStorage].[ProcessFactoryCode] = @ProcessFactoryCode34) AND ([TbRawMaterialStockRecord].[WorkAreaCode] IN (@WorkAreaCode36,@WorkAreaCode37))) AND ([TbRawMaterialArchives].[RebarType] = @RebarType39)) GROUP BY [TbRawMaterialStockRecord].[MaterialCode] 	
Parameters:
@ProcessFactoryCode34[String] = 6386683729561128960
@WorkAreaCode36[String] = 6372921396045311451
@WorkAreaCode37[String] = 6372921398380745033
@RebarType39[String] = BuildingSteel


-----------------------------------------------------------------------------
2020-07-14 09:37:58
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 09:37:58
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 09:37:58
Text:	 SELECT   [TbRawMaterialStockRecord].[MaterialCode],sum([TbRawMaterialStockRecord].[UseCount]) AS [UseCount],sum([TbRawMaterialStockRecord].[LockCount]) AS [LockCount] FROM [TbRawMaterialStockRecord] LEFT OUTER JOIN [TbStorage] ON ([TbRawMaterialStockRecord].[StorageCode] = [TbStorage].[StorageCode]) LEFT OUTER JOIN [TbRawMaterialArchives] ON ([TbRawMaterialStockRecord].[MaterialCode] = [TbRawMaterialArchives].[MaterialCode])  WHERE ((([TbStorage].[ProcessFactoryCode] = @ProcessFactoryCode43) AND ([TbRawMaterialStockRecord].[WorkAreaCode] IN (@WorkAreaCode45,@WorkAreaCode46))) AND ([TbRawMaterialArchives].[RebarType] = @RebarType48)) GROUP BY [TbRawMaterialStockRecord].[MaterialCode] 	
Parameters:
@ProcessFactoryCode43[String] = 6386683729561128960
@WorkAreaCode45[String] = 6372921396045311451
@WorkAreaCode46[String] = 6372921398380745033
@RebarType48[String] = SectionSteel


-----------------------------------------------------------------------------
2020-07-14 09:37:58
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 09:37:58
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode50) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode51,@WorkAreaCode52))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus53) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth54))) 	
Parameters:
@ProcessFactoryCode50[String] = 6386683729561128960
@WorkAreaCode51[String] = 6372921396045311451
@WorkAreaCode52[String] = 6372921398380745033
@Examinestatus53[String] = 审核完成
@DemandMonth54[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-14 09:37:58
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 09:37:58
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 09:37:59
Text:	
                        select fewoi.DataCode as OddNumbers,
                         fewoi.EarlyWarningContent,
                         fewoi.EWFormDataCode,
                         CONVERT(varchar(100), fewoi.EarlyWarningTime, 120) as EarlyWarningTime,
                         EWFormCode,sm.MenuName,fn.FlowNodeName,cp1.CompanyFullName as BranchName,
                         cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,
                         u1.UserName as FlowSpUserName,u2.UserName as FlowYjUserName 
                        FROM (
                        select*
                           FROM ( 
                        		SELECT a.*, row_number()over(partition BY a.FlowCode ORDER BY a.FlowNodeCode,a.EarlyWarningTime desc) as group_idx 
                        		FROM TbFlowEarlyWarningOtherInfo  a
                        		INNER JOIN  TbFlowEarlyWarningInfo b ON a.FlowCode=b.FlowCode 
                        		AND a.EWFormDataCode=b.EWFormDataCode AND a.FlowNodeCode=b.FlowNodeCode 
                        		WHERE YEAR(a.EarlyWarningTime)= @Year and MONTH(a.EarlyWarningTime)= @Month AND b.EarlyWarningStart=0
                           ) ret
                        WHERE ret.group_idx =1
                        ) fewoi
                        left join TbFlowNode fn on fewoi.FlowCode=fn.FlowCode and fewoi.FlowNodeCode=fn.FlowNodeCode
                        left join TbSysMenu sm on fewoi.EWFormCode=sm.MenuCode
                        left join TbCompany cp1 on fewoi.BranchCode=cp1.CompanyCode
                        left join TbCompany cp2 on fewoi.WorkAreaCode=cp2.CompanyCode
                        left join TbCompany cp3 on fewoi.SiteCode=cp3.CompanyCode
                        left join TbCompany cp4 on fewoi.ProcessFactoryCode=cp4.CompanyCode
                        left join TbUser u1 on fewoi.FlowSpUserCode=u1.UserId
                        left join TbUser u2 on fewoi.FlowYjUserCode=u2.UserId where 1=1 and fewoi.ProjectId='6372912251695766465' and fewoi.ProcessFactoryCode='6386683729561128960' and (fewoi.SiteCode in('6372921375874657752') or fewoi.WorkAreaCode in('6372921396045311451','6372921398380745033')) ORDER BY fewoi.EarlyWarningTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 09:37:59
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 09:37:59
Text:	--加急订单个数
                           select wo.OrderCode,wo.DistributionTime,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName from TbWorkOrder wo
                           left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on wo.ProcessFactoryCode=cp2.CompanyCode
                           where UrgentDegree='Urgent'
                           and YEAR(wo.DistributionTime)= @Year and MONTH(wo.DistributionTime)= @Month  and wo.ProjectId='6372912251695766465' and wo.ProcessFactoryCode='6386683729561128960' and wo.SiteCode in('6372921375874657752')  ORDER BY wo.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 09:37:59
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 09:37:59
Text:	--加工进度滞后
                           select op.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,op.DistributionTime,op.FinishProcessingDateTime from TbOrderProgress op 
                           left join TbCompany cp1 on op.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on op.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(op.DistributionTime)= @Year and MONTH(op.DistributionTime)= @Month
                           and (op.FinishProcessingDateTime>op.DistributionTime or (GETDATE()>op.DistributionTime and op.FinishProcessingDateTime is null))  and op.ProjectId='6372912251695766465' and op.ProcessFactoryCode='6386683729561128960' and op.SiteCode in('6372921375874657752') ORDER BY op.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 09:37:59
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 09:37:59
Text:	--配送超期
                           select dpi.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,dpi.DistributionTime,dpi.DeliveryCompleteTime,dpi.Remark from TbDistributionPlanInfo dpi
                           left join TbCompany cp1 on dpi.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on dpi.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(dpi.DistributionTime)= @Year and MONTH(dpi.DistributionTime)= @Month
                           and (dpi.DeliveryCompleteTime>dpi.DistributionTime or (GETDATE()>dpi.DistributionTime and dpi.DeliveryCompleteTime is null))  and dpi.ProjectId='6372912251695766465' and dpi.ProcessFactoryCode='6386683729561128960' and dpi.SiteCode in('6372921375874657752') ORDER BY dpi.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 09:37:59
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 09:37:59
Text:	select TbYj.*,cp1.CompanyFullName as SiteName,tcr.EnterSpaceTime,tcr.StartDischargeTime,tcr.EndDischargeTime,disEnt.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SiteDischargeCargo' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbTransportCarReport tcr on TbYj.EWFormDataCode=tcr.DisEntOrderId
                           left join TbDistributionEnt disEnt on tcr.DistributionCode=disEnt.DistributionCode
                           left join TbCompany cp on disEnt.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and disEnt.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ORDER BY tcr.EnterSpaceTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 09:37:59
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 09:37:59
Text:	select TbYj.*,cp1.CompanyFullName as SiteName,sfs.DistributionCode,sdc.DistributionTime,sfs.SigninTime,sfs.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SemiFinishedSign' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbSemiFinishedSign sfs on TbYj.EWFormDataCode=sfs.ID
                           left join TbSiteDischargeCargo sdc on sfs.DistributionCode=sdc.DistributionCode and sfs.DischargeCargoCode=sdc.DischargeCargoCode
                           left join TbCompany cp on sfs.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month and TbYj.ProjectId='6372912251695766465' and sfs.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752')	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 09:37:59
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 09:37:59
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 09:37:59
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 09:37:59
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 09:37:59
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 09:37:59
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 09:37:59
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 09:37:59
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 09:37:59
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 09:37:59
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 09:37:59
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 09:37:59
Text:	SELECT 
                            '审批超时' as YjTypeName,COUNT(1) as YjNum
                            FROM (
									SELECT a.*, row_number()over(partition BY a.FlowCode ORDER BY a.FlowNodeCode,a.EarlyWarningTime desc) as group_idx 
									FROM TbFlowEarlyWarningOtherInfo  a
									INNER JOIN  TbFlowEarlyWarningInfo b ON a.FlowCode=b.FlowCode 
									AND a.EWFormDataCode=b.EWFormDataCode AND a.FlowNodeCode=b.FlowNodeCode 
									WHERE  b.EarlyWarningStart=0 AND YEAR(a.EarlyWarningTime)= @Year and MONTH(a.EarlyWarningTime)= @Month  and a.ProjectId='6372912251695766465' and a.ProcessFactoryCode='6386683729561128960' and (a.SiteCode in('6372921375874657752') or a.WorkAreaCode in('6372921396045311451','6372921398380745033'))
							   ) Tb1
                            WHERE Tb1.group_idx =1
                           union all
                            select '未报月度需求计划' as YjTypeName,COUNT(1)as YjNum
                             FROM ( 
                                  SELECT *, row_number()over(partition BY EarlyWarningCode,EWFormDataCode ORDER BY EWNodeCode,EWTime desc) as group_idx 
                                  FROM TbFormEarlyWarningNodeInfo fwqi
                                  WHERE fwqi.MenuCode='RawMonthDemandPlan' AND fwqi.EWStart=0 AND YEAR(fwqi.EWTime)= @Year and MONTH(fwqi.EWTime)= @Month  and fwqi.ProjectId='6372912251695766465' and (fwqi.SiteCode in('6372921375874657752') or fwqi.WorkArea in('6372921396045311451','6372921398380745033'))  
                             ) Tb2
                             WHERE Tb2.group_idx =1
                           union all
                           select '原材料供货超时' as YjTypeName,COUNT(1) as YjNum from (
                           select BatchPlanNum,cp1.CompanyFullName as BranchName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,sup.SupplyDate,sup.SupplyCompleteTime,sup.ProjectId from TbSupplyList sup
                           left join TbCompany cp1 on cp1.CompanyCode=sup.BranchCode
                           left join TbCompany cp2 on cp2.CompanyCode=sup.WorkAreaCode
                           left join TbCompany cp3 on cp3.CompanyCode=sup.SiteCode
                           left join TbCompany cp4 on cp4.CompanyCode=sup.ProcessFactoryCode
                           where (sup.SupplyCompleteTime>sup.SupplyDate or (GETDATE()>sup.SupplyDate and sup.SupplyCompleteTime is null))
						   and YEAR(sup.SupplyDate)= @Year and MONTH(sup.SupplyDate)= @Month  and sup.ProjectId='6372912251695766465' and sup.ProcessFactoryCode='6386683729561128960' and (sup.SiteCode in('6372921375874657752') or sup.WorkAreaCode in('6372921396045311451','6372921398380745033'))) Tb3
                           union all
                           select '加急订单' as YjTypeName,COUNT(1) as YjNum from (--加急订单个数
                           select wo.OrderCode,wo.DistributionTime,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName from TbWorkOrder wo
                           left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on wo.ProcessFactoryCode=cp2.CompanyCode
                           where UrgentDegree='Urgent' 
						   and YEAR(wo.DistributionTime)= @Year and MONTH(wo.DistributionTime)= @Month  and wo.ProjectId='6372912251695766465' and wo.ProcessFactoryCode='6386683729561128960' and wo.SiteCode in('6372921375874657752') ) Tb4
                           union all
                           select '加工进度滞后' as YjTypeName,COUNT(1) as YjNum from (--加工进度滞后
                           select op.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,op.DistributionTime,op.FinishProcessingDateTime from TbOrderProgress op 
                           left join TbCompany cp1 on op.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on op.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(op.DistributionTime)= @Year and MONTH(op.DistributionTime)= @Month
                           and (op.FinishProcessingDateTime>op.DistributionTime or (GETDATE()>op.DistributionTime and op.FinishProcessingDateTime is null))  and op.ProjectId='6372912251695766465' and op.ProcessFactoryCode='6386683729561128960' and op.SiteCode in('6372921375874657752') ) Tb5
                           union all
                           select '接收配送超期' as YjTypeName,COUNT(1) as YjNum from (--配送超期
                           select dpi.OrderCode,cp1.CompanyFullName as SIteName,cp2.CompanyFullName as ProcessFactoryName,dpi.DistributionTime,dpi.DeliveryCompleteTime from TbDistributionPlanInfo dpi
                           left join TbCompany cp1 on dpi.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on dpi.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(dpi.DistributionTime)= @Year and MONTH(dpi.DistributionTime)= @Month
                           and (dpi.DeliveryCompleteTime>dpi.DistributionTime or (GETDATE()>dpi.DistributionTime and dpi.DeliveryCompleteTime is null))  and dpi.ProjectId='6372912251695766465' and dpi.ProcessFactoryCode='6386683729561128960' and dpi.SiteCode in('6372921375874657752') ) Tb6 
                           union all
                           select '卸货超时' as YjTypeName,COUNT(1) as YjNum from(--卸货超时
                           select TbYj.*,cp1.CompanyFullName as SiteName,tcr.EnterSpaceTime,tcr.StartDischargeTime,tcr.EndDischargeTime,disEnt.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SiteDischargeCargo' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbTransportCarReport tcr on TbYj.EWFormDataCode=tcr.DisEntOrderId
                           left join TbDistributionEnt disEnt on tcr.DistributionCode=disEnt.DistributionCode
                           left join TbCompany cp on disEnt.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and disEnt.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ) Tb7
                           union all
                           select '签收超时' as YjTypeName,COUNT(1) as YjNum from (select TbYj.*,cp1.CompanyFullName as SiteName,sfs.DistributionCode,sdc.DistributionTime,sfs.SigninTime,sfs.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SemiFinishedSign' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbSemiFinishedSign sfs on TbYj.EWFormDataCode=sfs.ID
                           left join TbSiteDischargeCargo sdc on sfs.DistributionCode=sdc.DistributionCode and sfs.DischargeCargoCode=sdc.DischargeCargoCode
                           left join TbCompany cp on sfs.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and sfs.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ) Tb8	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 09:37:59
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 09:37:59
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 09:37:59
Text:	--原材料供货超时
                           select BatchPlanNum,cp1.CompanyFullName as BranchName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,sup.SupplyDate,sup.SupplyCompleteTime,sup.ProjectId,sup.Remarks from TbSupplyList sup
                           left join TbCompany cp1 on cp1.CompanyCode=sup.BranchCode
                           left join TbCompany cp2 on cp2.CompanyCode=sup.WorkAreaCode
                           left join TbCompany cp3 on cp3.CompanyCode=sup.SiteCode
                           left join TbCompany cp4 on cp4.CompanyCode=sup.ProcessFactoryCode
                           where YEAR(sup.SupplyDate)= @Year and MONTH(sup.SupplyDate)= @Month
                           and (sup.SupplyCompleteTime>sup.SupplyDate or (GETDATE()>sup.SupplyDate and sup.SupplyCompleteTime is null))  and sup.ProjectId='6372912251695766465' and sup.ProcessFactoryCode='6386683729561128960' and (sup.SiteCode in('6372921375874657752') or sup.WorkAreaCode in('6372921396045311451','6372921398380745033'))	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 09:37:59
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 09:37:59
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 09:37:59
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode57) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode58))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState59)) 	
Parameters:
@ProcessFactoryCode57[String] = 6386683729561128960
@SiteCode58[String] = 6372921375874657752
@ProcessingState59[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-14 09:37:59
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-14 09:37:59
Text:	 SELECT   [TbOrderProgress].[ProcessingState],[TbOrderProgress].[OrderCode],[TbOrderProgress].[FinishProcessingDateTime],[TbOrderProgress].[DistributionTime],[TbOrderProgress].[SiteCode] FROM [TbOrderProgress]  WHERE ((([TbOrderProgress].[SiteCode] IN (@SiteCode55)) AND ([TbOrderProgress].[ProcessFactoryCode] = @ProcessFactoryCode56)) AND ((YEAR(DistributionTime)=2020 and MONTH(DistributionTime)=7) or (DistributionTime<'2020/7/1 0:00:00' and (ProcessingState!='Finishing')))) 	
Parameters:
@SiteCode55[String] = 6372921375874657752
@ProcessFactoryCode56[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 09:38:00
Text:	 SELECT   * FROM [TbWorkOrderDetail]  WHERE (1=2) AND ([TbWorkOrderDetail].[DaetailWorkStrat] = @DaetailWorkStrat60) 	
Parameters:
@DaetailWorkStrat60[String] = 未加工


-----------------------------------------------------------------------------
2020-07-14 09:38:00
Text:	 SELECT   [TbOrderProgress].[WeightTotal] AS [TotalWeight],[TbCompany].[ParentCompanyCode] FROM [TbOrderProgress] LEFT OUTER JOIN [TbCompany] ON ([TbOrderProgress].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((1=2) AND ([TbOrderProgress].[ProcessingState] <> @ProcessingState61)) AND ((([TbOrderProgress].[FinishProcessingDateTime] is not null ) AND ([TbOrderProgress].[DistributionTime] < [TbOrderProgress].[FinishProcessingDateTime])) OR (([TbOrderProgress].[FinishProcessingDateTime] is null ) AND ([TbOrderProgress].[DistributionTime] < @DistributionTime62)))) 	
Parameters:
@ProcessingState61[String] = Finishing
@DistributionTime62[DateTime] = 2020/7/14 0:00:00


-----------------------------------------------------------------------------
2020-07-14 09:38:00
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 09:38:00
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode63) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode64,@WorkAreaCode65))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus66) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth67))) 	
Parameters:
@ProcessFactoryCode63[String] = 6386683729561128960
@WorkAreaCode64[String] = 6372921396045311451
@WorkAreaCode65[String] = 6372921398380745033
@Examinestatus66[String] = 审核完成
@DemandMonth67[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-14 09:38:00
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 09:38:00
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 09:38:00
Text:	SELECT sm.MenuName,fwqi.EWContent,fwqi.EWUserCode,u.UserName,fwqi.EWFormDataCode,cp1.CompanyFullName as  FbName,cp2.CompanyFullName as GqName,fwqi.EWTime,sdd.DictionaryText as RebarType  
                   FROM (  
                    select ret.*
                    FROM ( 
                         SELECT *, row_number()over(partition BY EarlyWarningCode,EWFormDataCode ORDER BY EWNodeCode,EWTime desc) as group_idx 
                         FROM TbFormEarlyWarningNodeInfo fwqi
                         WHERE YEAR(fwqi.EWTime)= @Year and MONTH(fwqi.EWTime)= @Month AND fwqi.MenuCode='RawMonthDemandPlan' AND fwqi.EWStart=0
                    ) ret
                    WHERE ret.group_idx = 1
                   ) fwqi
                    left join TbSysMenu sm on fwqi.MenuCode=sm.MenuCode
                            left join TbCompany cp1 on fwqi.CompanyCode=cp1.CompanyCode
                            left join TbCompany cp2 on fwqi.WorkArea=cp2.CompanyCode
                            left join TbCompany cp3 on fwqi.SiteCode=cp3.CompanyCode
                            left join TbUser u on fwqi.EWUserCode=u.UserId
                            left join TbRawMaterialMonthDemandPlan rmp on fwqi.EWFormDataCode=rmp.ID
                            left join TbSysDictionaryData sdd on sdd.DictionaryCode=rmp.RebarType
                    where 1=1 and fwqi.ProjectId='6372912251695766465' and (fwqi.SiteCode in('6372921375874657752') or fwqi.WorkArea in('6372921396045311451','6372921398380745033')) ORDER BY fwqi.EWTime DESC	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 09:38:05
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 09:38:05
Text:	select a.ID,a.UserCode,a.UserName,a.UserPwd,a.UserId,a.UserClosed,a.UserSex,a.IDNumber,a.MobilePhone,a.Email,a.UserType,b.DeptOrOrRle,a.RecruitmentSource from TbUser a
left join (SELECT  UserCode ,
        DeptOrOrRle = ( STUFF(( SELECT    ',' + DeptOrOrRle FROM (select a.UserCode,b.DepartmentName+'('+c.RoleName+')' as DeptOrOrRle from TbUserRole a
left join TbDepartment b on a.DeptId=b.DepartmentId
left join TbRole c on a.RoleCode=c.RoleId) as A WHERE A.UserCode = Test.UserCode
                        FOR
                          XML PATH('')
                        ), 1, 1, '') )
FROM  (select a.UserCode,b.DepartmentName+'('+c.RoleName+')' as DeptOrOrRle from TbUserRole a
left join TbDepartment b on a.DeptId=b.DepartmentId
left join TbRole c on a.RoleCode=c.RoleId) AS Test
GROUP BY UserCode) b on a.UserId=b.UserCode where 1=1	


-----------------------------------------------------------------------------
2020-07-14 09:38:05
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID asc)AS Row, * from (select a.ID,a.UserCode,a.UserName,a.UserPwd,a.UserId,a.UserClosed,a.UserSex,a.IDNumber,a.MobilePhone,a.Email,a.UserType,b.DeptOrOrRle,a.RecruitmentSource from TbUser a
left join (SELECT  UserCode ,
        DeptOrOrRle = ( STUFF(( SELECT    ',' + DeptOrOrRle FROM (select a.UserCode,b.DepartmentName+'('+c.RoleName+')' as DeptOrOrRle from TbUserRole a
left join TbDepartment b on a.DeptId=b.DepartmentId
left join TbRole c on a.RoleCode=c.RoleId) as A WHERE A.UserCode = Test.UserCode
                        FOR
                          XML PATH('')
                        ), 1, 1, '') )
FROM  (select a.UserCode,b.DepartmentName+'('+c.RoleName+')' as DeptOrOrRle from TbUserRole a
left join TbDepartment b on a.DeptId=b.DepartmentId
left join TbRole c on a.RoleCode=c.RoleId) AS Test
GROUP BY UserCode) b on a.UserId=b.UserCode where 1=1) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 09:38:06
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 09:38:06
Text:	select distinct u.ID,u.UserId,u.UserCode,u.UserName,u.UserClosed,u.UserSex,u.IDNumber,u.MobilePhone,b.DeptOrOrRle,u.RecruitmentSource from TbUser u
left join TbUserRole ur on ur.UserCode=u.UserId
left join (SELECT  UserCode ,
        DeptOrOrRle = ( STUFF(( SELECT    ',' + DeptOrOrRle FROM (select a.UserCode,a.OrgId,b.DepartmentName+'('+c.RoleName+')' as DeptOrOrRle from TbUserRole a
left join TbDepartment b on a.DeptId=b.DepartmentId
left join TbRole c on a.RoleCode=c.RoleId) as A WHERE A.UserCode = Test.UserCode
                        FOR
                          XML PATH('')
                        ), 1, 1, '') )
FROM  (select a.UserCode,b.DepartmentName+'('+c.RoleName+')' as DeptOrOrRle from TbUserRole a
left join TbDepartment b on a.DeptId=b.DepartmentId
left join TbRole c on a.RoleCode=c.RoleId) AS Test
GROUP BY UserCode) b on u.UserId=b.UserCode  where 1=1 and ur.OrgId=@OrgId and ur.ProjectId=@ProjectId and ur.Flag=0 	
Parameters:
@OrgId[String] = 
@ProjectId[String] = 


-----------------------------------------------------------------------------
2020-07-14 09:38:06
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID asc)AS Row, * from (select distinct u.ID,u.UserId,u.UserCode,u.UserName,u.UserClosed,u.UserSex,u.IDNumber,u.MobilePhone,b.DeptOrOrRle,u.RecruitmentSource from TbUser u
left join TbUserRole ur on ur.UserCode=u.UserId
left join (SELECT  UserCode ,
        DeptOrOrRle = ( STUFF(( SELECT    ',' + DeptOrOrRle FROM (select a.UserCode,a.OrgId,b.DepartmentName+'('+c.RoleName+')' as DeptOrOrRle from TbUserRole a
left join TbDepartment b on a.DeptId=b.DepartmentId
left join TbRole c on a.RoleCode=c.RoleId) as A WHERE A.UserCode = Test.UserCode
                        FOR
                          XML PATH('')
                        ), 1, 1, '') )
FROM  (select a.UserCode,b.DepartmentName+'('+c.RoleName+')' as DeptOrOrRle from TbUserRole a
left join TbDepartment b on a.DeptId=b.DepartmentId
left join TbRole c on a.RoleCode=c.RoleId) AS Test
GROUP BY UserCode) b on u.UserId=b.UserCode  where 1=1 and ur.OrgId=@OrgId and ur.ProjectId=@ProjectId and ur.Flag=0 ) as a)  SELECT * FROM temptbl where Row between 1 and 50	
Parameters:
@OrgId[String] = 
@ProjectId[String] = 


-----------------------------------------------------------------------------
2020-07-14 09:38:07
Text:	select a.*,a.FullCode as ProjectId,b.CompanyFullName as ParentCompanyName from TbCompany a
left join TbCompany b on a.ParentCompanyCode=b.CompanyCode 
where 1=1  order by a.id asc	


-----------------------------------------------------------------------------
2020-07-14 09:38:07
Text:	select FullCode,CompanyCode,CompanyFullName,Address,OrgType,ParentCompanyCode_F from TbCompany where OrgType=2;	


-----------------------------------------------------------------------------
2020-07-14 09:38:07
Text:	select FullCode,CompanyCode,CompanyFullName,Address,OrgType,ParentCompanyCode_F from TbCompany where OrgType=1 order by CompanyCode asc;	


-----------------------------------------------------------------------------
2020-07-14 09:38:07
Text:	select distinct u.ID,u.UserId,u.UserCode,u.UserName,u.UserClosed,u.UserSex,u.IDNumber,u.MobilePhone,b.DeptOrOrRle,u.RecruitmentSource from TbUser u
left join TbUserRole ur on ur.UserCode=u.UserId
left join (SELECT  UserCode ,
        DeptOrOrRle = ( STUFF(( SELECT    ',' + DeptOrOrRle FROM (select a.UserCode,a.OrgId,b.DepartmentName+'('+c.RoleName+')' as DeptOrOrRle from TbUserRole a
left join TbDepartment b on a.DeptId=b.DepartmentId
left join TbRole c on a.RoleCode=c.RoleId) as A WHERE A.UserCode = Test.UserCode
                        FOR
                          XML PATH('')
                        ), 1, 1, '') )
FROM  (select a.UserCode,b.DepartmentName+'('+c.RoleName+')' as DeptOrOrRle from TbUserRole a
left join TbDepartment b on a.DeptId=b.DepartmentId
left join TbRole c on a.RoleCode=c.RoleId) AS Test
GROUP BY UserCode) b on u.UserId=b.UserCode  where 1=1 and ur.OrgId=@OrgId and ur.ProjectId=@ProjectId and ur.Flag=0 	
Parameters:
@OrgId[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 09:38:07
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID asc)AS Row, * from (select distinct u.ID,u.UserId,u.UserCode,u.UserName,u.UserClosed,u.UserSex,u.IDNumber,u.MobilePhone,b.DeptOrOrRle,u.RecruitmentSource from TbUser u
left join TbUserRole ur on ur.UserCode=u.UserId
left join (SELECT  UserCode ,
        DeptOrOrRle = ( STUFF(( SELECT    ',' + DeptOrOrRle FROM (select a.UserCode,a.OrgId,b.DepartmentName+'('+c.RoleName+')' as DeptOrOrRle from TbUserRole a
left join TbDepartment b on a.DeptId=b.DepartmentId
left join TbRole c on a.RoleCode=c.RoleId) as A WHERE A.UserCode = Test.UserCode
                        FOR
                          XML PATH('')
                        ), 1, 1, '') )
FROM  (select a.UserCode,b.DepartmentName+'('+c.RoleName+')' as DeptOrOrRle from TbUserRole a
left join TbDepartment b on a.DeptId=b.DepartmentId
left join TbRole c on a.RoleCode=c.RoleId) AS Test
GROUP BY UserCode) b on u.UserId=b.UserCode  where 1=1 and ur.OrgId=@OrgId and ur.ProjectId=@ProjectId and ur.Flag=0 ) as a)  SELECT * FROM temptbl where Row between 1 and 50	
Parameters:
@OrgId[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 09:38:10
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 09:38:10
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /SystemManage/User/RoleAuthority


-----------------------------------------------------------------------------
2020-07-14 09:38:10
Text:	 SELECT   * FROM [TbSysMenu]  WHERE ([TbSysMenu].[IsShow] = @IsShow68) ORDER BY [TbSysMenu].[Sort] ASC 	
Parameters:
@IsShow68[String] = 0


-----------------------------------------------------------------------------
2020-07-14 09:38:10
Text:	 SELECT   * FROM [TbUserMenu]  WHERE ([TbUserMenu].[UserCode] = @UserCode69) ORDER BY [TbUserMenu].[ID] ASC 	
Parameters:
@UserCode69[String] = 6372938724886632227


-----------------------------------------------------------------------------
2020-07-14 09:38:16
Text:	select distinct u.ID,u.UserId,u.UserCode,u.UserName,u.UserClosed,u.UserSex,u.IDNumber,u.MobilePhone,b.DeptOrOrRle,u.RecruitmentSource from TbUser u
left join TbUserRole ur on ur.UserCode=u.UserId
left join (SELECT  UserCode ,
        DeptOrOrRle = ( STUFF(( SELECT    ',' + DeptOrOrRle FROM (select a.UserCode,a.OrgId,b.DepartmentName+'('+c.RoleName+')' as DeptOrOrRle from TbUserRole a
left join TbDepartment b on a.DeptId=b.DepartmentId
left join TbRole c on a.RoleCode=c.RoleId) as A WHERE A.UserCode = Test.UserCode
                        FOR
                          XML PATH('')
                        ), 1, 1, '') )
FROM  (select a.UserCode,b.DepartmentName+'('+c.RoleName+')' as DeptOrOrRle from TbUserRole a
left join TbDepartment b on a.DeptId=b.DepartmentId
left join TbRole c on a.RoleCode=c.RoleId) AS Test
GROUP BY UserCode) b on u.UserId=b.UserCode  where 1=1 and ur.OrgId=@OrgId and ur.ProjectId=@ProjectId and ur.Flag=0 	
Parameters:
@OrgId[String] = 6372921378678418123
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 09:38:16
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID asc)AS Row, * from (select distinct u.ID,u.UserId,u.UserCode,u.UserName,u.UserClosed,u.UserSex,u.IDNumber,u.MobilePhone,b.DeptOrOrRle,u.RecruitmentSource from TbUser u
left join TbUserRole ur on ur.UserCode=u.UserId
left join (SELECT  UserCode ,
        DeptOrOrRle = ( STUFF(( SELECT    ',' + DeptOrOrRle FROM (select a.UserCode,a.OrgId,b.DepartmentName+'('+c.RoleName+')' as DeptOrOrRle from TbUserRole a
left join TbDepartment b on a.DeptId=b.DepartmentId
left join TbRole c on a.RoleCode=c.RoleId) as A WHERE A.UserCode = Test.UserCode
                        FOR
                          XML PATH('')
                        ), 1, 1, '') )
FROM  (select a.UserCode,b.DepartmentName+'('+c.RoleName+')' as DeptOrOrRle from TbUserRole a
left join TbDepartment b on a.DeptId=b.DepartmentId
left join TbRole c on a.RoleCode=c.RoleId) AS Test
GROUP BY UserCode) b on u.UserId=b.UserCode  where 1=1 and ur.OrgId=@OrgId and ur.ProjectId=@ProjectId and ur.Flag=0 ) as a)  SELECT * FROM temptbl where Row between 1 and 50	
Parameters:
@OrgId[String] = 6372921378678418123
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 09:38:22
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 09:38:22
Text:	select * from TbProjectInfo  order by ID asc	


-----------------------------------------------------------------------------
2020-07-14 09:38:22
Text:	 SELECT count(*) as r_cnt FROM [TbRole] WHERE ([TbRole].[DepartmentId] is null )	


-----------------------------------------------------------------------------
2020-07-14 09:38:22
Text:	 SELECT   TOP 50 [TbRole].* FROM [TbRole]  WHERE ([TbRole].[DepartmentId] is null ) ORDER BY [TbRole].[RoleId] DESC 	


-----------------------------------------------------------------------------
2020-07-14 09:38:23
Text:	select TbDepartment.id,DepartmentCode,DepartmentId,DepartmentName,DepartmentType,DepartmentProjectId,TbProjectInfo.ProjectName from TbDepartment
left join TbProjectInfo on TbDepartment.DepartmentProjectId=TbProjectInfo.ProjectId
where 1=1   and DepartmentType='2' and DepartmentProjectId in(select top 1 ProjectId from TbProjectInfo order by ID asc)	


-----------------------------------------------------------------------------
2020-07-14 09:38:23
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by id asc)AS Row, * from (select TbDepartment.id,DepartmentCode,DepartmentId,DepartmentName,DepartmentType,DepartmentProjectId,TbProjectInfo.ProjectName from TbDepartment
left join TbProjectInfo on TbDepartment.DepartmentProjectId=TbProjectInfo.ProjectId
where 1=1   and DepartmentType='2' and DepartmentProjectId in(select top 1 ProjectId from TbProjectInfo order by ID asc)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 09:38:23
Text:	 SELECT count(*) as r_cnt FROM [TbRole] WHERE ([TbRole].[DepartmentId] = @DepartmentId70)	
Parameters:
@DepartmentId70[String] = 6372912311304275877


-----------------------------------------------------------------------------
2020-07-14 09:38:23
Text:	 SELECT   TOP 50 [TbRole].* FROM [TbRole]  WHERE ([TbRole].[DepartmentId] = @DepartmentId70) ORDER BY [TbRole].[RoleId] DESC 	
Parameters:
@DepartmentId70[String] = 6372912311304275877


-----------------------------------------------------------------------------
2020-07-14 09:38:32
Text:	select id,DepartmentCode,DepartmentName,DepartmentId,DepartmentType,DepartmentProjectId from TbDepartment where 1=1 and DepartmentId='6372912311304275877'	


-----------------------------------------------------------------------------
2020-07-14 09:38:33
Text:	 SELECT count(*) as r_cnt FROM [TbRole] WHERE ([TbRole].[DepartmentId] = @DepartmentId71)	
Parameters:
@DepartmentId71[String] = 6372912311304275877


-----------------------------------------------------------------------------
2020-07-14 09:38:33
Text:	 SELECT   TOP 50 [TbRole].* FROM [TbRole]  WHERE ([TbRole].[DepartmentId] = @DepartmentId71) ORDER BY [TbRole].[RoleId] DESC 	
Parameters:
@DepartmentId71[String] = 6372912311304275877


-----------------------------------------------------------------------------
2020-07-14 09:38:36
Text:	 SELECT count(*) as r_cnt FROM [TbRole] WHERE ([TbRole].[DepartmentId] = @DepartmentId72)	
Parameters:
@DepartmentId72[String] = 6372912317487329525


-----------------------------------------------------------------------------
2020-07-14 09:38:36
Text:	 SELECT   TOP 50 [TbRole].* FROM [TbRole]  WHERE ([TbRole].[DepartmentId] = @DepartmentId72) ORDER BY [TbRole].[RoleId] DESC 	
Parameters:
@DepartmentId72[String] = 6372912317487329525


-----------------------------------------------------------------------------
2020-07-14 09:38:37
Text:	 SELECT count(*) as r_cnt FROM [TbRole] WHERE ([TbRole].[DepartmentId] = @DepartmentId73)	
Parameters:
@DepartmentId73[String] = 6372912315411410794


-----------------------------------------------------------------------------
2020-07-14 09:38:37
Text:	 SELECT   TOP 50 [TbRole].* FROM [TbRole]  WHERE ([TbRole].[DepartmentId] = @DepartmentId73) ORDER BY [TbRole].[RoleId] DESC 	
Parameters:
@DepartmentId73[String] = 6372912315411410794


-----------------------------------------------------------------------------
2020-07-14 09:38:37
Text:	 SELECT count(*) as r_cnt FROM [TbRole] WHERE ([TbRole].[DepartmentId] = @DepartmentId74)	
Parameters:
@DepartmentId74[String] = 6372912311304275877


-----------------------------------------------------------------------------
2020-07-14 09:38:37
Text:	 SELECT   TOP 50 [TbRole].* FROM [TbRole]  WHERE ([TbRole].[DepartmentId] = @DepartmentId74) ORDER BY [TbRole].[RoleId] DESC 	
Parameters:
@DepartmentId74[String] = 6372912311304275877


-----------------------------------------------------------------------------
2020-07-14 09:38:39
Text:	 SELECT count(*) as r_cnt FROM [TbRole] WHERE ([TbRole].[DepartmentId] = @DepartmentId75)	
Parameters:
@DepartmentId75[String] = 6372912315411410794


-----------------------------------------------------------------------------
2020-07-14 09:38:39
Text:	 SELECT   TOP 50 [TbRole].* FROM [TbRole]  WHERE ([TbRole].[DepartmentId] = @DepartmentId75) ORDER BY [TbRole].[RoleId] DESC 	
Parameters:
@DepartmentId75[String] = 6372912315411410794


-----------------------------------------------------------------------------
2020-07-14 09:38:39
Text:	 SELECT count(*) as r_cnt FROM [TbRole] WHERE ([TbRole].[DepartmentId] = @DepartmentId76)	
Parameters:
@DepartmentId76[String] = 6372912319135623800


-----------------------------------------------------------------------------
2020-07-14 09:38:39
Text:	 SELECT   TOP 50 [TbRole].* FROM [TbRole]  WHERE ([TbRole].[DepartmentId] = @DepartmentId76) ORDER BY [TbRole].[RoleId] DESC 	
Parameters:
@DepartmentId76[String] = 6372912319135623800


-----------------------------------------------------------------------------
2020-07-14 09:38:40
Text:	 SELECT count(*) as r_cnt FROM [TbRole] WHERE ([TbRole].[DepartmentId] = @DepartmentId77)	
Parameters:
@DepartmentId77[String] = 6372912321099336120


-----------------------------------------------------------------------------
2020-07-14 09:38:40
Text:	 SELECT   TOP 50 [TbRole].* FROM [TbRole]  WHERE ([TbRole].[DepartmentId] = @DepartmentId77) ORDER BY [TbRole].[RoleId] DESC 	
Parameters:
@DepartmentId77[String] = 6372912321099336120


-----------------------------------------------------------------------------
2020-07-14 09:38:45
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 09:38:45
Text:	select ur.*,u.UserName,r.RoleName,cp.CompanyFullName,dp.DepartmentName,case when ur.OrgType=1 then '' else pro.ProjectName end as ProjectName from TbUserRole ur
left join TbUser u on ur.UserCode=u.UserId
left join TbRole r on ur.RoleCode=r.RoleId
left join TbCompany cp on ur.OrgId=cp.CompanyCode
left join TbDepartment dp on ur.DeptId=dp.DepartmentId
left join TbProjectInfo pro on pro.ProjectId=ur.ProjectId  where 1=1 and u.UserName is not null  and ur.ProjectId=@ProjectId and ur.DeptId=@DeptId and ur.RoleCode=@RoleCode and ur.OrgType=@OrgType	
Parameters:
@ProjectId[String] = 6372912251695766465
@DeptId[String] = 6372912321099336120
@RoleCode[String] = 6372919451594895243
@OrgType[String] = 2


-----------------------------------------------------------------------------
2020-07-14 09:38:45
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID asc)AS Row, * from (select ur.*,u.UserName,r.RoleName,cp.CompanyFullName,dp.DepartmentName,case when ur.OrgType=1 then '' else pro.ProjectName end as ProjectName from TbUserRole ur
left join TbUser u on ur.UserCode=u.UserId
left join TbRole r on ur.RoleCode=r.RoleId
left join TbCompany cp on ur.OrgId=cp.CompanyCode
left join TbDepartment dp on ur.DeptId=dp.DepartmentId
left join TbProjectInfo pro on pro.ProjectId=ur.ProjectId  where 1=1 and u.UserName is not null  and ur.ProjectId=@ProjectId and ur.DeptId=@DeptId and ur.RoleCode=@RoleCode and ur.OrgType=@OrgType) as a)  SELECT * FROM temptbl where Row between 1 and 50	
Parameters:
@ProjectId[String] = 6372912251695766465
@DeptId[String] = 6372912321099336120
@RoleCode[String] = 6372919451594895243
@OrgType[String] = 2


-----------------------------------------------------------------------------
2020-07-14 09:38:50
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 09:38:50
Text:	 SELECT   * FROM [TbSysMenu]  WHERE ([TbSysMenu].[IsShow] = @IsShow78) ORDER BY [TbSysMenu].[Sort] ASC 	
Parameters:
@IsShow78[String] = 0


-----------------------------------------------------------------------------
2020-07-14 09:38:50
Text:	 SELECT   * FROM [TbRoleMenu]  WHERE ([TbRoleMenu].[RoleCode] = @RoleCode79) ORDER BY [TbRoleMenu].[ID] ASC 	
Parameters:
@RoleCode79[String] = 6372919448011790302


-----------------------------------------------------------------------------
2020-07-14 09:38:55
Text:	 SELECT   TOP 1 * FROM [TbRole]  WHERE [TbRole].[RoleCode] = @RoleCode80 	
Parameters:
@RoleCode80[String] = 6372919451594895243


-----------------------------------------------------------------------------
2020-07-14 09:39:01
Text:	select TbDepartment.id,DepartmentCode,DepartmentId,DepartmentName,DepartmentType,DepartmentProjectId,TbProjectInfo.ProjectName from TbDepartment
left join TbProjectInfo on TbDepartment.DepartmentProjectId=TbProjectInfo.ProjectId
where 1=1   and DepartmentType='3' and DepartmentProjectId='6372912251695766465'	


-----------------------------------------------------------------------------
2020-07-14 09:39:01
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by id asc)AS Row, * from (select TbDepartment.id,DepartmentCode,DepartmentId,DepartmentName,DepartmentType,DepartmentProjectId,TbProjectInfo.ProjectName from TbDepartment
left join TbProjectInfo on TbDepartment.DepartmentProjectId=TbProjectInfo.ProjectId
where 1=1   and DepartmentType='3' and DepartmentProjectId='6372912251695766465') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 09:39:01
Text:	 SELECT count(*) as r_cnt FROM [TbRole] WHERE ([TbRole].[DepartmentId] = @DepartmentId81)	
Parameters:
@DepartmentId81[String] = 6372912404653815166


-----------------------------------------------------------------------------
2020-07-14 09:39:01
Text:	 SELECT   TOP 50 [TbRole].* FROM [TbRole]  WHERE ([TbRole].[DepartmentId] = @DepartmentId81) ORDER BY [TbRole].[RoleId] DESC 	
Parameters:
@DepartmentId81[String] = 6372912404653815166


-----------------------------------------------------------------------------
2020-07-14 09:39:02
Text:	select TbDepartment.id,DepartmentCode,DepartmentId,DepartmentName,DepartmentType,DepartmentProjectId,TbProjectInfo.ProjectName from TbDepartment
left join TbProjectInfo on TbDepartment.DepartmentProjectId=TbProjectInfo.ProjectId
where 1=1   and DepartmentType='4' and DepartmentProjectId='6372912251695766465'	


-----------------------------------------------------------------------------
2020-07-14 09:39:02
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by id asc)AS Row, * from (select TbDepartment.id,DepartmentCode,DepartmentId,DepartmentName,DepartmentType,DepartmentProjectId,TbProjectInfo.ProjectName from TbDepartment
left join TbProjectInfo on TbDepartment.DepartmentProjectId=TbProjectInfo.ProjectId
where 1=1   and DepartmentType='4' and DepartmentProjectId='6372912251695766465') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 09:39:02
Text:	 SELECT count(*) as r_cnt FROM [TbRole] WHERE ([TbRole].[DepartmentId] is null )	


-----------------------------------------------------------------------------
2020-07-14 09:39:02
Text:	 SELECT   TOP 50 [TbRole].* FROM [TbRole]  WHERE ([TbRole].[DepartmentId] is null ) ORDER BY [TbRole].[RoleId] DESC 	


-----------------------------------------------------------------------------
2020-07-14 09:39:02
Text:	select TbDepartment.id,DepartmentCode,DepartmentId,DepartmentName,DepartmentType,DepartmentProjectId,TbProjectInfo.ProjectName from TbDepartment
left join TbProjectInfo on TbDepartment.DepartmentProjectId=TbProjectInfo.ProjectId
where 1=1   and DepartmentType='5' and DepartmentProjectId='6372912251695766465'	


-----------------------------------------------------------------------------
2020-07-14 09:39:02
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by id asc)AS Row, * from (select TbDepartment.id,DepartmentCode,DepartmentId,DepartmentName,DepartmentType,DepartmentProjectId,TbProjectInfo.ProjectName from TbDepartment
left join TbProjectInfo on TbDepartment.DepartmentProjectId=TbProjectInfo.ProjectId
where 1=1   and DepartmentType='5' and DepartmentProjectId='6372912251695766465') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 09:39:02
Text:	 SELECT count(*) as r_cnt FROM [TbRole] WHERE ([TbRole].[DepartmentId] is null )	


-----------------------------------------------------------------------------
2020-07-14 09:39:02
Text:	 SELECT   TOP 50 [TbRole].* FROM [TbRole]  WHERE ([TbRole].[DepartmentId] is null ) ORDER BY [TbRole].[RoleId] DESC 	


-----------------------------------------------------------------------------
2020-07-14 09:39:03
Text:	select TbDepartment.id,DepartmentCode,DepartmentId,DepartmentName,DepartmentType,DepartmentProjectId,TbProjectInfo.ProjectName from TbDepartment
left join TbProjectInfo on TbDepartment.DepartmentProjectId=TbProjectInfo.ProjectId
where 1=1   and DepartmentType='1' and DepartmentProjectId='6372912251695766465'	


-----------------------------------------------------------------------------
2020-07-14 09:39:03
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by id asc)AS Row, * from (select TbDepartment.id,DepartmentCode,DepartmentId,DepartmentName,DepartmentType,DepartmentProjectId,TbProjectInfo.ProjectName from TbDepartment
left join TbProjectInfo on TbDepartment.DepartmentProjectId=TbProjectInfo.ProjectId
where 1=1   and DepartmentType='1' and DepartmentProjectId='6372912251695766465') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 09:39:03
Text:	 SELECT count(*) as r_cnt FROM [TbRole] WHERE ([TbRole].[DepartmentId] = @DepartmentId82)	
Parameters:
@DepartmentId82[String] = 6372982176543087516


-----------------------------------------------------------------------------
2020-07-14 09:39:03
Text:	 SELECT   TOP 50 [TbRole].* FROM [TbRole]  WHERE ([TbRole].[DepartmentId] = @DepartmentId82) ORDER BY [TbRole].[RoleId] DESC 	
Parameters:
@DepartmentId82[String] = 6372982176543087516


-----------------------------------------------------------------------------
2020-07-14 09:39:04
Text:	select TbDepartment.id,DepartmentCode,DepartmentId,DepartmentName,DepartmentType,DepartmentProjectId,TbProjectInfo.ProjectName from TbDepartment
left join TbProjectInfo on TbDepartment.DepartmentProjectId=TbProjectInfo.ProjectId
where 1=1   and DepartmentType='5' and DepartmentProjectId='6372912251695766465'	


-----------------------------------------------------------------------------
2020-07-14 09:39:04
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by id asc)AS Row, * from (select TbDepartment.id,DepartmentCode,DepartmentId,DepartmentName,DepartmentType,DepartmentProjectId,TbProjectInfo.ProjectName from TbDepartment
left join TbProjectInfo on TbDepartment.DepartmentProjectId=TbProjectInfo.ProjectId
where 1=1   and DepartmentType='5' and DepartmentProjectId='6372912251695766465') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 09:39:04
Text:	 SELECT count(*) as r_cnt FROM [TbRole] WHERE ([TbRole].[DepartmentId] is null )	


-----------------------------------------------------------------------------
2020-07-14 09:39:04
Text:	 SELECT   TOP 50 [TbRole].* FROM [TbRole]  WHERE ([TbRole].[DepartmentId] is null ) ORDER BY [TbRole].[RoleId] DESC 	


-----------------------------------------------------------------------------
2020-07-14 09:39:05
Text:	select TbDepartment.id,DepartmentCode,DepartmentId,DepartmentName,DepartmentType,DepartmentProjectId,TbProjectInfo.ProjectName from TbDepartment
left join TbProjectInfo on TbDepartment.DepartmentProjectId=TbProjectInfo.ProjectId
where 1=1   and DepartmentType='2' and DepartmentProjectId='6372912251695766465'	


-----------------------------------------------------------------------------
2020-07-14 09:39:05
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by id asc)AS Row, * from (select TbDepartment.id,DepartmentCode,DepartmentId,DepartmentName,DepartmentType,DepartmentProjectId,TbProjectInfo.ProjectName from TbDepartment
left join TbProjectInfo on TbDepartment.DepartmentProjectId=TbProjectInfo.ProjectId
where 1=1   and DepartmentType='2' and DepartmentProjectId='6372912251695766465') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 09:39:05
Text:	 SELECT count(*) as r_cnt FROM [TbRole] WHERE ([TbRole].[DepartmentId] = @DepartmentId83)	
Parameters:
@DepartmentId83[String] = 6372912311304275877


-----------------------------------------------------------------------------
2020-07-14 09:39:05
Text:	 SELECT   TOP 50 [TbRole].* FROM [TbRole]  WHERE ([TbRole].[DepartmentId] = @DepartmentId83) ORDER BY [TbRole].[RoleId] DESC 	
Parameters:
@DepartmentId83[String] = 6372912311304275877


-----------------------------------------------------------------------------
2020-07-14 09:39:06
Text:	select TbDepartment.id,DepartmentCode,DepartmentId,DepartmentName,DepartmentType,DepartmentProjectId,TbProjectInfo.ProjectName from TbDepartment
left join TbProjectInfo on TbDepartment.DepartmentProjectId=TbProjectInfo.ProjectId
where 1=1   and DepartmentType='3' and DepartmentProjectId='6372912251695766465'	


-----------------------------------------------------------------------------
2020-07-14 09:39:06
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by id asc)AS Row, * from (select TbDepartment.id,DepartmentCode,DepartmentId,DepartmentName,DepartmentType,DepartmentProjectId,TbProjectInfo.ProjectName from TbDepartment
left join TbProjectInfo on TbDepartment.DepartmentProjectId=TbProjectInfo.ProjectId
where 1=1   and DepartmentType='3' and DepartmentProjectId='6372912251695766465') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 09:39:06
Text:	 SELECT count(*) as r_cnt FROM [TbRole] WHERE ([TbRole].[DepartmentId] = @DepartmentId84)	
Parameters:
@DepartmentId84[String] = 6372912404653815166


-----------------------------------------------------------------------------
2020-07-14 09:39:06
Text:	 SELECT   TOP 50 [TbRole].* FROM [TbRole]  WHERE ([TbRole].[DepartmentId] = @DepartmentId84) ORDER BY [TbRole].[RoleId] DESC 	
Parameters:
@DepartmentId84[String] = 6372912404653815166


-----------------------------------------------------------------------------
2020-07-14 09:39:07
Text:	select TbDepartment.id,DepartmentCode,DepartmentId,DepartmentName,DepartmentType,DepartmentProjectId,TbProjectInfo.ProjectName from TbDepartment
left join TbProjectInfo on TbDepartment.DepartmentProjectId=TbProjectInfo.ProjectId
where 1=1   and DepartmentType='4' and DepartmentProjectId='6372912251695766465'	


-----------------------------------------------------------------------------
2020-07-14 09:39:07
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by id asc)AS Row, * from (select TbDepartment.id,DepartmentCode,DepartmentId,DepartmentName,DepartmentType,DepartmentProjectId,TbProjectInfo.ProjectName from TbDepartment
left join TbProjectInfo on TbDepartment.DepartmentProjectId=TbProjectInfo.ProjectId
where 1=1   and DepartmentType='4' and DepartmentProjectId='6372912251695766465') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 09:39:07
Text:	 SELECT count(*) as r_cnt FROM [TbRole] WHERE ([TbRole].[DepartmentId] is null )	


-----------------------------------------------------------------------------
2020-07-14 09:39:07
Text:	 SELECT   TOP 50 [TbRole].* FROM [TbRole]  WHERE ([TbRole].[DepartmentId] is null ) ORDER BY [TbRole].[RoleId] DESC 	


-----------------------------------------------------------------------------
2020-07-14 09:39:08
Text:	select TbDepartment.id,DepartmentCode,DepartmentId,DepartmentName,DepartmentType,DepartmentProjectId,TbProjectInfo.ProjectName from TbDepartment
left join TbProjectInfo on TbDepartment.DepartmentProjectId=TbProjectInfo.ProjectId
where 1=1   and DepartmentType='5' and DepartmentProjectId='6372912251695766465'	


-----------------------------------------------------------------------------
2020-07-14 09:39:08
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by id asc)AS Row, * from (select TbDepartment.id,DepartmentCode,DepartmentId,DepartmentName,DepartmentType,DepartmentProjectId,TbProjectInfo.ProjectName from TbDepartment
left join TbProjectInfo on TbDepartment.DepartmentProjectId=TbProjectInfo.ProjectId
where 1=1   and DepartmentType='5' and DepartmentProjectId='6372912251695766465') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 09:39:08
Text:	 SELECT count(*) as r_cnt FROM [TbRole] WHERE ([TbRole].[DepartmentId] is null )	


-----------------------------------------------------------------------------
2020-07-14 09:39:08
Text:	 SELECT   TOP 50 [TbRole].* FROM [TbRole]  WHERE ([TbRole].[DepartmentId] is null ) ORDER BY [TbRole].[RoleId] DESC 	


-----------------------------------------------------------------------------
2020-07-14 09:39:08
Text:	select TbDepartment.id,DepartmentCode,DepartmentId,DepartmentName,DepartmentType,DepartmentProjectId,TbProjectInfo.ProjectName from TbDepartment
left join TbProjectInfo on TbDepartment.DepartmentProjectId=TbProjectInfo.ProjectId
where 1=1   and DepartmentType='1' and DepartmentProjectId='6372912251695766465'	


-----------------------------------------------------------------------------
2020-07-14 09:39:08
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by id asc)AS Row, * from (select TbDepartment.id,DepartmentCode,DepartmentId,DepartmentName,DepartmentType,DepartmentProjectId,TbProjectInfo.ProjectName from TbDepartment
left join TbProjectInfo on TbDepartment.DepartmentProjectId=TbProjectInfo.ProjectId
where 1=1   and DepartmentType='1' and DepartmentProjectId='6372912251695766465') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 09:39:08
Text:	 SELECT count(*) as r_cnt FROM [TbRole] WHERE ([TbRole].[DepartmentId] = @DepartmentId85)	
Parameters:
@DepartmentId85[String] = 6372982176543087516


-----------------------------------------------------------------------------
2020-07-14 09:39:08
Text:	 SELECT   TOP 50 [TbRole].* FROM [TbRole]  WHERE ([TbRole].[DepartmentId] = @DepartmentId85) ORDER BY [TbRole].[RoleId] DESC 	
Parameters:
@DepartmentId85[String] = 6372982176543087516


-----------------------------------------------------------------------------
2020-07-14 09:39:18
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 09:39:18
Text:	select a.*,a.FullCode as ProjectId,b.CompanyFullName as ParentCompanyName from TbCompany a
left join TbCompany b on a.ParentCompanyCode=b.CompanyCode 
where 1=1  order by a.id asc	


-----------------------------------------------------------------------------
2020-07-14 09:39:18
Text:	select FullCode,CompanyCode,CompanyFullName,Address,OrgType,ParentCompanyCode_F from TbCompany where OrgType=2;	


-----------------------------------------------------------------------------
2020-07-14 09:39:18
Text:	select FullCode,CompanyCode,CompanyFullName,Address,OrgType,ParentCompanyCode_F from TbCompany where OrgType=1 order by CompanyCode asc;	


-----------------------------------------------------------------------------
2020-07-14 09:39:27
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 09:39:27
Text:	select distinct u.ID,u.UserId,u.UserCode,u.UserName,u.UserClosed,u.UserSex,u.IDNumber,u.MobilePhone,b.DeptOrOrRle,u.RecruitmentSource from TbUser u
left join TbUserRole ur on ur.UserCode=u.UserId
left join (SELECT  UserCode ,
        DeptOrOrRle = ( STUFF(( SELECT    ',' + DeptOrOrRle FROM (select a.UserCode,a.OrgId,b.DepartmentName+'('+c.RoleName+')' as DeptOrOrRle from TbUserRole a
left join TbDepartment b on a.DeptId=b.DepartmentId
left join TbRole c on a.RoleCode=c.RoleId) as A WHERE A.UserCode = Test.UserCode
                        FOR
                          XML PATH('')
                        ), 1, 1, '') )
FROM  (select a.UserCode,b.DepartmentName+'('+c.RoleName+')' as DeptOrOrRle from TbUserRole a
left join TbDepartment b on a.DeptId=b.DepartmentId
left join TbRole c on a.RoleCode=c.RoleId) AS Test
GROUP BY UserCode) b on u.UserId=b.UserCode  where 1=1 and ur.OrgId=@OrgId and ur.ProjectId=@ProjectId and ur.Flag=0 	
Parameters:
@OrgId[String] = 
@ProjectId[String] = 


-----------------------------------------------------------------------------
2020-07-14 09:39:27
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID asc)AS Row, * from (select distinct u.ID,u.UserId,u.UserCode,u.UserName,u.UserClosed,u.UserSex,u.IDNumber,u.MobilePhone,b.DeptOrOrRle,u.RecruitmentSource from TbUser u
left join TbUserRole ur on ur.UserCode=u.UserId
left join (SELECT  UserCode ,
        DeptOrOrRle = ( STUFF(( SELECT    ',' + DeptOrOrRle FROM (select a.UserCode,a.OrgId,b.DepartmentName+'('+c.RoleName+')' as DeptOrOrRle from TbUserRole a
left join TbDepartment b on a.DeptId=b.DepartmentId
left join TbRole c on a.RoleCode=c.RoleId) as A WHERE A.UserCode = Test.UserCode
                        FOR
                          XML PATH('')
                        ), 1, 1, '') )
FROM  (select a.UserCode,b.DepartmentName+'('+c.RoleName+')' as DeptOrOrRle from TbUserRole a
left join TbDepartment b on a.DeptId=b.DepartmentId
left join TbRole c on a.RoleCode=c.RoleId) AS Test
GROUP BY UserCode) b on u.UserId=b.UserCode  where 1=1 and ur.OrgId=@OrgId and ur.ProjectId=@ProjectId and ur.Flag=0 ) as a)  SELECT * FROM temptbl where Row between 1 and 50	
Parameters:
@OrgId[String] = 
@ProjectId[String] = 


-----------------------------------------------------------------------------
2020-07-14 09:39:28
Text:	select a.*,a.FullCode as ProjectId,b.CompanyFullName as ParentCompanyName from TbCompany a
left join TbCompany b on a.ParentCompanyCode=b.CompanyCode 
where 1=1  order by a.id asc	


-----------------------------------------------------------------------------
2020-07-14 09:39:28
Text:	select FullCode,CompanyCode,CompanyFullName,Address,OrgType,ParentCompanyCode_F from TbCompany where OrgType=2;	


-----------------------------------------------------------------------------
2020-07-14 09:39:28
Text:	select FullCode,CompanyCode,CompanyFullName,Address,OrgType,ParentCompanyCode_F from TbCompany where OrgType=1 order by CompanyCode asc;	


-----------------------------------------------------------------------------
2020-07-14 09:39:28
Text:	select distinct u.ID,u.UserId,u.UserCode,u.UserName,u.UserClosed,u.UserSex,u.IDNumber,u.MobilePhone,b.DeptOrOrRle,u.RecruitmentSource from TbUser u
left join TbUserRole ur on ur.UserCode=u.UserId
left join (SELECT  UserCode ,
        DeptOrOrRle = ( STUFF(( SELECT    ',' + DeptOrOrRle FROM (select a.UserCode,a.OrgId,b.DepartmentName+'('+c.RoleName+')' as DeptOrOrRle from TbUserRole a
left join TbDepartment b on a.DeptId=b.DepartmentId
left join TbRole c on a.RoleCode=c.RoleId) as A WHERE A.UserCode = Test.UserCode
                        FOR
                          XML PATH('')
                        ), 1, 1, '') )
FROM  (select a.UserCode,b.DepartmentName+'('+c.RoleName+')' as DeptOrOrRle from TbUserRole a
left join TbDepartment b on a.DeptId=b.DepartmentId
left join TbRole c on a.RoleCode=c.RoleId) AS Test
GROUP BY UserCode) b on u.UserId=b.UserCode  where 1=1 and ur.OrgId=@OrgId and ur.ProjectId=@ProjectId and ur.Flag=0 	
Parameters:
@OrgId[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 09:39:28
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID asc)AS Row, * from (select distinct u.ID,u.UserId,u.UserCode,u.UserName,u.UserClosed,u.UserSex,u.IDNumber,u.MobilePhone,b.DeptOrOrRle,u.RecruitmentSource from TbUser u
left join TbUserRole ur on ur.UserCode=u.UserId
left join (SELECT  UserCode ,
        DeptOrOrRle = ( STUFF(( SELECT    ',' + DeptOrOrRle FROM (select a.UserCode,a.OrgId,b.DepartmentName+'('+c.RoleName+')' as DeptOrOrRle from TbUserRole a
left join TbDepartment b on a.DeptId=b.DepartmentId
left join TbRole c on a.RoleCode=c.RoleId) as A WHERE A.UserCode = Test.UserCode
                        FOR
                          XML PATH('')
                        ), 1, 1, '') )
FROM  (select a.UserCode,b.DepartmentName+'('+c.RoleName+')' as DeptOrOrRle from TbUserRole a
left join TbDepartment b on a.DeptId=b.DepartmentId
left join TbRole c on a.RoleCode=c.RoleId) AS Test
GROUP BY UserCode) b on u.UserId=b.UserCode  where 1=1 and ur.OrgId=@OrgId and ur.ProjectId=@ProjectId and ur.Flag=0 ) as a)  SELECT * FROM temptbl where Row between 1 and 50	
Parameters:
@OrgId[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 09:39:41
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 09:39:41
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /Production/WorkOrder/Index


-----------------------------------------------------------------------------
2020-07-14 09:39:41
Text:	select * from TbSysDictionaryData where 1=1 and FDictionaryCode=@name order by DictionaryOrder asc	
Parameters:
@name[String] = ProcessingState


-----------------------------------------------------------------------------
2020-07-14 09:39:41
Text:	select * from TbSysDictionaryData where 1=1 and FDictionaryCode=@name order by DictionaryOrder asc	
Parameters:
@name[String] = UrgentDegree


-----------------------------------------------------------------------------
2020-07-14 09:39:41
Text:	select * from TbSysDictionaryData where 1=1 and FDictionaryCode=@name order by DictionaryOrder asc	
Parameters:
@name[String] = DistributionTimeJg


-----------------------------------------------------------------------------
2020-07-14 09:39:41
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 09:39:41
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 09:39:41
Text:	select a.SiteCode from TbWorkOrder a
where a.Examinestatus='审核完成' 
and (CONVERT(varchar(7), a.DistributionTime, 120)='2020-07' or (CONVERT(varchar(7), a.DistributionTime, 120)<='2020-07' and a.ProcessingState!='Finishing')) 
and a.ProcessFactoryCode='6386683729561128960' 
and (ISNULL(@ProjectId,'')='' or a.ProjectId=@ProjectId)
group by a.SiteCode	
Parameters:
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 09:39:41
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 09:39:41
Text:	 SELECT count(*) as r_cnt FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON (([TbWorkOrder].[ProcessingState] = [TbSysDictionaryData].[DictionaryCode]) AND ([TbSysDictionaryData].[FDictionaryCode] = @FDictionaryCode90)) LEFT OUTER JOIN [TbUser] ON ([TbWorkOrder].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbDistributionPlanInfo] ON ([TbWorkOrder].[OrderCode] = [TbDistributionPlanInfo].[OrderCode]) LEFT OUTER JOIN [TbSemiFinishedSign] ON ([TbWorkOrder].[OrderCode] = [TbSemiFinishedSign].[OrderCodeH]) LEFT OUTER JOIN [TbOrderProgress] ON ([TbWorkOrder].[OrderCode] = [TbOrderProgress].[OrderCode]) WHERE ((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode86) AND ([TbWorkOrder].[ProjectId] = @ProjectId87)) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode88)))	
Parameters:
@ProcessFactoryCode86[String] = 6386683729561128960
@ProjectId87[String] = 6372912251695766465
@SiteCode88[String] = 6372921375874657752
@FDictionaryCode89[String] = UrgentDegree
@FDictionaryCode90[String] = ProcessingState


-----------------------------------------------------------------------------
2020-07-14 09:39:41
Text:	 SELECT   TOP 50 [TbWorkOrder].*,[TbCompany].[CompanyFullName] AS [SiteName],[TbSysDictionaryData].[DictionaryText] AS [ProcessingStateNew],[TbUser].[UserName],isnull([TbDistributionPlanInfo].[DistributionStart],N'') AS [DistributionStart],[TbDistributionPlanInfo].[DeliveryCompleteTime],[TbWorkOrder].[Examinestatus] AS [ExaminestatusNew],[TbSemiFinishedSign].[ID] AS [SemiFinishedSignId],[TbSemiFinishedSign].[Enclosure] AS [EnclosureSF],[TbOrderProgress].[FinishProcessingDateTime],( SELECT   [TbCompany].[CompanyFullName] FROM [TbCompany]  WHERE [TbCompany].[CompanyCode] = [TbWorkOrder].[ProcessFactoryCode] ) AS [ProcessFactoryName],( SELECT   [TbSysDictionaryData].[DictionaryText] FROM [TbSysDictionaryData]  WHERE ([TbSysDictionaryData].[DictionaryCode] = [TbWorkOrder].[UrgentDegree]) AND ([TbSysDictionaryData].[FDictionaryCode] = @FDictionaryCode89) ) AS [UrgentDegreeNew] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON (([TbWorkOrder].[ProcessingState] = [TbSysDictionaryData].[DictionaryCode]) AND ([TbSysDictionaryData].[FDictionaryCode] = @FDictionaryCode90)) LEFT OUTER JOIN [TbUser] ON ([TbWorkOrder].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbDistributionPlanInfo] ON ([TbWorkOrder].[OrderCode] = [TbDistributionPlanInfo].[OrderCode]) LEFT OUTER JOIN [TbSemiFinishedSign] ON ([TbWorkOrder].[OrderCode] = [TbSemiFinishedSign].[OrderCodeH]) LEFT OUTER JOIN [TbOrderProgress] ON ([TbWorkOrder].[OrderCode] = [TbOrderProgress].[OrderCode])  WHERE ((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode86) AND ([TbWorkOrder].[ProjectId] = @ProjectId87)) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode88))) ORDER BY [TbWorkOrder].[ID] DESC 	
Parameters:
@ProcessFactoryCode86[String] = 6386683729561128960
@ProjectId87[String] = 6372912251695766465
@SiteCode88[String] = 6372921375874657752
@FDictionaryCode89[String] = UrgentDegree
@FDictionaryCode90[String] = ProcessingState


-----------------------------------------------------------------------------
2020-07-14 09:39:41
Text:	select isnull(sum(TbCF.Capacity),0) as Capacity,isnull(sum(TbCF.WeightSmallPlan),0) as WeightSmallPlan,isnull(cast(sum(TbCF.WeightSmallPlan)/sum(TbCF.Capacity)*100 as decimal(18,2)),0) as ActualLoadNew from (select cf.Capacity,Tb1.WeightSmallPlan,cf.ProcessFactoryCode from TbCapacityFilling cf  
left join(
select SUM(Tb.WeightSmallPlan) as WeightSmallPlan,Tb.ProcessFactoryCode from (
                            select isnull(SUM(wod.WeightSmallPlan),0) as WeightSmallPlan,wo.ProcessFactoryCode from TbWorkOrder wo
                            left join TbWorkOrderDetail wod on wo.OrderCode=wod.OrderCode
                            where (ISNULL(@ProcessFactoryCode,'')='' or wo.ProcessFactoryCode=@ProcessFactoryCode)
                            and CONVERT(varchar(7), wo.DistributionTime, 120)=@month
                            and wod.RevokeStart='正常' and wo.ProcessingState!='ConfirmWork' and wo.ProcessingState!='Finishing'  group by wo.ProcessFactoryCode
                            union all
                            select isnull(sum(opd.NoCompleted),0) as NoCompleted,op.ProcessFactoryCode from TbOrderProgress op
                            left join TbOrderProgressDetail opd on op.OrderCode=opd.OrderCode 
                            where (ISNULL(@ProcessFactoryCode,'')='' or op.ProcessFactoryCode=@ProcessFactoryCode)
                            and CONVERT(varchar(7), op.DistributionTime, 120)=CONVERT(varchar(4),YEAR(DATEADD(MONTH,-1,@month+'-01')))+'-'+Right(100+Month(DATEADD(MONTH,-1,@month+'-01')),2)
                            and opd.RevokeStart='正常'  group by op.ProcessFactoryCode)Tb  group by Tb.ProcessFactoryCode
) Tb1 on cf.ProcessFactoryCode=Tb1.ProcessFactoryCode 
where cf.CapacityMonth=@month
and (ISNULL(@ProcessFactoryCode,'')='' or cf.ProcessFactoryCode=@ProcessFactoryCode)) TbCF where (ISNULL(@ProcessFactoryCode,'')='' or TbCF.ProcessFactoryCode=@ProcessFactoryCode)	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@month[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-14 09:39:42
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 09:39:42
Text:	select isnull(SUM(Tb.AlreadyCompleted),0) as AlreadyCompleted, cast(round(isnull(SUM(Tb.AlreadyCompleted),0)/(isnull(SUM(Tb.AlreadyCompleted),0)+isnull(SUM(Tb.NoCompleted),0))*100,0) as int) as AlreadyCompletedBfb,isnull(SUM(Tb.NoCompleted),0) as NoCompleted, cast(round(isnull(SUM(Tb.NoCompleted),0)/(isnull(SUM(Tb.AlreadyCompleted),0)+isnull(SUM(Tb.NoCompleted),0))*100,0) as int) as NoCompletedBfb from (
                              select case when c.ID is null then b.WeightSmallPlan else c.NoCompleted end as NoCompleted,c.AlreadyCompleted from TbWorkOrder a 
                              left join TbWorkOrderDetail b on a.OrderCode=b.OrderCode
                              left join TbOrderProgressDetail c on c.WorkorderdetailId=b.ID where 1=1  and a.ProjectId='6372912251695766465' and a.ProcessFactoryCode='6386683729561128960' and a.SiteCode in('6372921375874657752') and (CONVERT(varchar(7),a.DistributionTime, 120)='2020-07' or (CONVERT(varchar(7),a.DistributionTime, 120)<'2020-07' and a.ProcessingState!='Finishing')) and a.Examinestatus='审核完成') Tb 	


-----------------------------------------------------------------------------
2020-07-14 09:39:42
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 09:39:42
Text:	select TbProgressType.ProgressType,isnull(TbProgress.WeightTotal,0) as WeightTotal from (select '进度正常' as ProgressType
union all
select '进度超前' as ProgressType
union all
select '已完成（滞后）' as ProgressType
union all
select '未完成（滞后）' as ProgressType
) TbProgressType
left join(
select sum(a.WeightTotal) as WeightTotal,'进度正常' as  ProgressType from  TbWorkOrder a
left join TbOrderProgress b on a.OrderCode=b.OrderCode 
where 1=1  and a.ProjectId='6372912251695766465' and a.ProcessFactoryCode='6386683729561128960' and a.SiteCode in('6372921375874657752') and (CONVERT(varchar(7),a.DistributionTime, 120)='2020-07' or (CONVERT(varchar(7),a.DistributionTime, 120)<'2020-07' and a.ProcessingState!='Finishing')) and a.Examinestatus='审核完成' and ((CONVERT(varchar(100),b.FinishProcessingDateTime,23)=CONVERT(varchar(100),a.DistributionTime,23) or (b.FinishProcessingDateTime is null and a.Examinestatus='审核完成' and CONVERT(varchar(100),a.DistributionTime,23)>=CONVERT(varchar(100),GETDATE(),23))))
union all
select sum(a.WeightTotal) as WeightTotal,'进度超前' as  ProgressType from  TbWorkOrder a
left join TbOrderProgress b on a.OrderCode=b.OrderCode 
where 1=1  and a.ProjectId='6372912251695766465' and a.ProcessFactoryCode='6386683729561128960' and a.SiteCode in('6372921375874657752') and (CONVERT(varchar(7),a.DistributionTime, 120)='2020-07' or (CONVERT(varchar(7),a.DistributionTime, 120)<'2020-07' and a.ProcessingState!='Finishing')) and a.Examinestatus='审核完成' and CONVERT(varchar(100),b.FinishProcessingDateTime,23)<CONVERT(varchar(100),a.DistributionTime,23) and a.Examinestatus='审核完成'
union all
select sum(a.WeightTotal) as WeightTotal,'已完成（滞后）' as  ProgressType from  TbWorkOrder a
left join TbOrderProgress b on a.OrderCode=b.OrderCode 
where 1=1  and a.ProjectId='6372912251695766465' and a.ProcessFactoryCode='6386683729561128960' and a.SiteCode in('6372921375874657752') and (CONVERT(varchar(7),a.DistributionTime, 120)='2020-07' or (CONVERT(varchar(7),a.DistributionTime, 120)<'2020-07' and a.ProcessingState!='Finishing')) and a.Examinestatus='审核完成' and CONVERT(varchar(100),b.FinishProcessingDateTime,23)>CONVERT(varchar(100),a.DistributionTime,23) and a.Examinestatus='审核完成'
union all
select sum(a.WeightTotal) as WeightTotal,'未完成（滞后）' as  ProgressType from  TbWorkOrder a
left join TbOrderProgress b on a.OrderCode=b.OrderCode 
where 1=1  and a.ProjectId='6372912251695766465' and a.ProcessFactoryCode='6386683729561128960' and a.SiteCode in('6372921375874657752') and (CONVERT(varchar(7),a.DistributionTime, 120)='2020-07' or (CONVERT(varchar(7),a.DistributionTime, 120)<'2020-07' and a.ProcessingState!='Finishing')) and a.Examinestatus='审核完成' and CONVERT(varchar(100),a.DistributionTime,23)<CONVERT(varchar(100),GETDATE(),23) and b.FinishProcessingDateTime is null and a.Examinestatus='审核完成') TbProgress on TbProgressType.ProgressType=TbProgress.ProgressType	


-----------------------------------------------------------------------------
2020-07-14 09:39:42
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 09:39:42
Text:	select TbOrderStart.*,isnull(TbOrderCount.WeightTotal,0) as WeightTotal,isnull(TbOrderCount.OrderCount,0) as OrderCount from(select '正常订单' as OrderStart
                               union all
                               select '加急订单' as OrderStart
                               union all
                               select '变更订单' as OrderStart
                               union all
                               select '退回订单' as OrderStart) TbOrderStart
                               left join(select count(1) as OrderCount,isnull(sum(a.WeightTotal),0) as WeightTotal,'正常订单' as OrderStart from TbWorkOrder a where 1=1  and a.ProjectId='6372912251695766465' and a.ProcessFactoryCode='6386683729561128960' and a.SiteCode in('6372921375874657752') and a.Examinestatus='审核完成' and (CONVERT(varchar(7),a.DistributionTime, 120)='2020-07' or (CONVERT(varchar(7),a.DistributionTime, 120)<'2020-07' and a.ProcessingState!='Finishing' and a.Examinestatus='审核完成')) and a.UrgentDegree='Commonly' 
                               union all
                               select count(1) as OrderCount,isnull(sum(a.WeightTotal),0) as WeightTotal,'加急订单' as OrderStart from TbWorkOrder a where 1=1  and a.ProjectId='6372912251695766465' and a.ProcessFactoryCode='6386683729561128960' and a.SiteCode in('6372921375874657752') and a.Examinestatus='审核完成' and (CONVERT(varchar(7),a.DistributionTime, 120)='2020-07' or (CONVERT(varchar(7),a.DistributionTime, 120)<'2020-07' and a.ProcessingState!='Finishing' and a.Examinestatus='审核完成')) and a.UrgentDegree='Urgent'
                               union all
                               select count(1) as OrderCount,isnull(sum(a.WeightTotal),0) as WeightTotal,'变更订单' as OrderStart from TbWorkOrder a where 1=1  and a.ProjectId='6372912251695766465' and a.ProcessFactoryCode='6386683729561128960' and a.SiteCode in('6372921375874657752')and (CONVERT(varchar(7),a.DistributionTime, 120)='2020-07')  and (a.OrderStart='部分变更' or a.OrderStart='全部变更')
                               union all
                               select count(1) as OrderCount,isnull(sum(a.WeightTotal),0) as WeightTotal,'退回订单' as OrderStart from TbWorkOrder a where 1=1  and a.ProjectId='6372912251695766465' and a.ProcessFactoryCode='6386683729561128960' and a.SiteCode in('6372921375874657752')and (CONVERT(varchar(7),a.DistributionTime, 120)='2020-07')  and a.Examinestatus='已退回') TbOrderCount on TbOrderStart.OrderStart=TbOrderCount.OrderStart 	


-----------------------------------------------------------------------------
2020-07-14 09:39:47
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 09:39:47
Text:	 SELECT count(*) as r_cnt FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON (([TbWorkOrder].[ProcessingState] = [TbSysDictionaryData].[DictionaryCode]) AND ([TbSysDictionaryData].[FDictionaryCode] = @FDictionaryCode95)) LEFT OUTER JOIN [TbUser] ON ([TbWorkOrder].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbDistributionPlanInfo] ON ([TbWorkOrder].[OrderCode] = [TbDistributionPlanInfo].[OrderCode]) LEFT OUTER JOIN [TbSemiFinishedSign] ON ([TbWorkOrder].[OrderCode] = [TbSemiFinishedSign].[OrderCodeH]) LEFT OUTER JOIN [TbOrderProgress] ON ([TbWorkOrder].[OrderCode] = [TbOrderProgress].[OrderCode]) WHERE ((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode91) AND ([TbWorkOrder].[ProjectId] = @ProjectId92)) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode93)))	
Parameters:
@ProcessFactoryCode91[String] = 6386683729561128960
@ProjectId92[String] = 6372912251695766465
@SiteCode93[String] = 6372921375874657752
@FDictionaryCode94[String] = UrgentDegree
@FDictionaryCode95[String] = ProcessingState


-----------------------------------------------------------------------------
2020-07-14 09:39:47
Text:	 SELECT   TOP 50 [TbWorkOrder].*,[TbCompany].[CompanyFullName] AS [SiteName],[TbSysDictionaryData].[DictionaryText] AS [ProcessingStateNew],[TbUser].[UserName],isnull([TbDistributionPlanInfo].[DistributionStart],N'') AS [DistributionStart],[TbDistributionPlanInfo].[DeliveryCompleteTime],[TbWorkOrder].[Examinestatus] AS [ExaminestatusNew],[TbSemiFinishedSign].[ID] AS [SemiFinishedSignId],[TbSemiFinishedSign].[Enclosure] AS [EnclosureSF],[TbOrderProgress].[FinishProcessingDateTime],( SELECT   [TbCompany].[CompanyFullName] FROM [TbCompany]  WHERE [TbCompany].[CompanyCode] = [TbWorkOrder].[ProcessFactoryCode] ) AS [ProcessFactoryName],( SELECT   [TbSysDictionaryData].[DictionaryText] FROM [TbSysDictionaryData]  WHERE ([TbSysDictionaryData].[DictionaryCode] = [TbWorkOrder].[UrgentDegree]) AND ([TbSysDictionaryData].[FDictionaryCode] = @FDictionaryCode94) ) AS [UrgentDegreeNew] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON (([TbWorkOrder].[ProcessingState] = [TbSysDictionaryData].[DictionaryCode]) AND ([TbSysDictionaryData].[FDictionaryCode] = @FDictionaryCode95)) LEFT OUTER JOIN [TbUser] ON ([TbWorkOrder].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbDistributionPlanInfo] ON ([TbWorkOrder].[OrderCode] = [TbDistributionPlanInfo].[OrderCode]) LEFT OUTER JOIN [TbSemiFinishedSign] ON ([TbWorkOrder].[OrderCode] = [TbSemiFinishedSign].[OrderCodeH]) LEFT OUTER JOIN [TbOrderProgress] ON ([TbWorkOrder].[OrderCode] = [TbOrderProgress].[OrderCode])  WHERE ((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode91) AND ([TbWorkOrder].[ProjectId] = @ProjectId92)) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode93))) ORDER BY [TbWorkOrder].[ID] DESC 	
Parameters:
@ProcessFactoryCode91[String] = 6386683729561128960
@ProjectId92[String] = 6372912251695766465
@SiteCode93[String] = 6372921375874657752
@FDictionaryCode94[String] = UrgentDegree
@FDictionaryCode95[String] = ProcessingState


-----------------------------------------------------------------------------
2020-07-14 09:39:47
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 09:39:47
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 09:39:47
Text:	select a.SiteCode from TbWorkOrder a
where a.Examinestatus='审核完成' 
and (CONVERT(varchar(7), a.DistributionTime, 120)='2020-07' or (CONVERT(varchar(7), a.DistributionTime, 120)<='2020-07' and a.ProcessingState!='Finishing')) 
and a.ProcessFactoryCode='6386683729561128960' 
and (ISNULL(@ProjectId,'')='' or a.ProjectId=@ProjectId)
group by a.SiteCode	
Parameters:
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 09:39:52
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 09:39:52
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-14 09:39:52
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 09:39:52
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 09:39:53
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 09:39:53
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-14 09:39:53
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 09:39:53
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 09:39:53
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 09:39:53
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-14 09:39:53
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 09:39:53
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 09:39:53
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 09:39:53
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 09:39:53
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 09:39:54
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 09:39:54
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 09:39:59
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 09:39:59
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 09:39:59
Text:	select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-14 09:39:59
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 09:39:59
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='BuildingSteel'	


-----------------------------------------------------------------------------
2020-07-14 09:39:59
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='SectionSteel'	


-----------------------------------------------------------------------------
2020-07-14 09:39:59
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)	


-----------------------------------------------------------------------------
2020-07-14 09:39:59
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 09:40:00
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)	


-----------------------------------------------------------------------------
2020-07-14 09:40:00
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 09:40:55
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 09:43:55
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 09:46:56
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 09:49:56
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 09:52:56
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 09:55:56
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 09:58:56
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 09:59:04
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 09:59:04
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialArchives/Index


-----------------------------------------------------------------------------
2020-07-14 09:59:04
Text:	select * from TbSysDictionaryData where 1=1 and FDictionaryCode=@name order by DictionaryOrder asc	
Parameters:
@name[String] = RebarType


-----------------------------------------------------------------------------
2020-07-14 09:59:04
Text:	 SELECT count(*) as r_cnt FROM [TbRawMaterialArchives] LEFT OUTER JOIN [TbSysDictionaryData] ON (([TbRawMaterialArchives].[MeasurementUnit] = [TbSysDictionaryData].[DictionaryCode]) AND ([TbSysDictionaryData].[FDictionaryCode] = @FDictionaryCode96))	
Parameters:
@FDictionaryCode96[String] = Unit
@FDictionaryCode97[String] = RebarType


-----------------------------------------------------------------------------
2020-07-14 09:59:04
Text:	 SELECT   TOP 50 [TbRawMaterialArchives].*,[TbSysDictionaryData].[DictionaryText] AS [MeasurementUnitNew],( SELECT   [TbSysDictionaryData].[DictionaryText] FROM [TbSysDictionaryData]  WHERE ([TbSysDictionaryData].[DictionaryCode] = [TbRawMaterialArchives].[RebarType]) AND ([TbSysDictionaryData].[FDictionaryCode] = @FDictionaryCode97) ) AS [RebarTypeNew] FROM [TbRawMaterialArchives] LEFT OUTER JOIN [TbSysDictionaryData] ON (([TbRawMaterialArchives].[MeasurementUnit] = [TbSysDictionaryData].[DictionaryCode]) AND ([TbSysDictionaryData].[FDictionaryCode] = @FDictionaryCode96))  ORDER BY [TbRawMaterialArchives].[ID] ASC 	
Parameters:
@FDictionaryCode96[String] = Unit
@FDictionaryCode97[String] = RebarType


-----------------------------------------------------------------------------
2020-07-14 09:59:10
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 09:59:10
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /Production/ProblemOrder/Index


-----------------------------------------------------------------------------
2020-07-14 09:59:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 09:59:10
Text:	 SELECT count(*) as r_cnt FROM [TbProblemOrder] LEFT OUTER JOIN [TbUser] ON ([TbProblemOrder].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbCompany] ON ([TbProblemOrder].[SiteCode] = [TbCompany].[CompanyCode]) LEFT OUTER JOIN [TbWorkOrder] ON ([TbProblemOrder].[OrderCode] = [TbWorkOrder].[OrderCode]) WHERE ((([TbProblemOrder].[SiteCode] IN (@SiteCode98)) AND ([TbProblemOrder].[ProcessFactoryCode] = @ProcessFactoryCode99)) AND ([TbProblemOrder].[ProjectId] = @ProjectId100))	
Parameters:
@SiteCode98[String] = 6372921375874657752
@ProcessFactoryCode99[String] = 6386683729561128960
@ProjectId100[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 09:59:10
Text:	 SELECT   TOP 50 [TbProblemOrder].[ID],[TbProblemOrder].[Examinestatus],[TbProblemOrder].[Examinestatus] AS [ExaminestatusNew],[TbProblemOrder].[ProblemOrderCode],[TbProblemOrder].[OrderCode],[TbProblemOrder].[TypeCode],[TbProblemOrder].[TypeName],[TbProblemOrder].[UsePart],[TbProblemOrder].[RevokeStatus],[TbProblemOrder].[DistributionTime],[TbProblemOrder].[DistributionAddress],[TbProblemOrder].[Total],[TbProblemOrder].[OldTotal],[TbProblemOrder].[InsertUserCode],[TbProblemOrder].[InsertTime],[TbProblemOrder].[ProjectId],[TbUser].[UserName],[TbCompany].[CompanyFullName] AS [SiteName],[TbWorkOrder].[ProcessingState] AS [OldProcessingState] FROM [TbProblemOrder] LEFT OUTER JOIN [TbUser] ON ([TbProblemOrder].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbCompany] ON ([TbProblemOrder].[SiteCode] = [TbCompany].[CompanyCode]) LEFT OUTER JOIN [TbWorkOrder] ON ([TbProblemOrder].[OrderCode] = [TbWorkOrder].[OrderCode])  WHERE ((([TbProblemOrder].[SiteCode] IN (@SiteCode98)) AND ([TbProblemOrder].[ProcessFactoryCode] = @ProcessFactoryCode99)) AND ([TbProblemOrder].[ProjectId] = @ProjectId100)) ORDER BY [TbProblemOrder].[ID] DESC 	
Parameters:
@SiteCode98[String] = 6372921375874657752
@ProcessFactoryCode99[String] = 6386683729561128960
@ProjectId100[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 09:59:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 09:59:12
Text:	 SELECT count(*) as r_cnt FROM [TbProblemOrder] LEFT OUTER JOIN [TbUser] ON ([TbProblemOrder].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbCompany] ON ([TbProblemOrder].[SiteCode] = [TbCompany].[CompanyCode]) LEFT OUTER JOIN [TbWorkOrder] ON ([TbProblemOrder].[OrderCode] = [TbWorkOrder].[OrderCode]) WHERE ((([TbProblemOrder].[SiteCode] IN (@SiteCode101)) AND ([TbProblemOrder].[ProcessFactoryCode] = @ProcessFactoryCode102)) AND ([TbProblemOrder].[ProjectId] = @ProjectId103))	
Parameters:
@SiteCode101[String] = 6372921375874657752
@ProcessFactoryCode102[String] = 6386683729561128960
@ProjectId103[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 09:59:12
Text:	 SELECT   TOP 50 [TbProblemOrder].[ID],[TbProblemOrder].[Examinestatus],[TbProblemOrder].[Examinestatus] AS [ExaminestatusNew],[TbProblemOrder].[ProblemOrderCode],[TbProblemOrder].[OrderCode],[TbProblemOrder].[TypeCode],[TbProblemOrder].[TypeName],[TbProblemOrder].[UsePart],[TbProblemOrder].[RevokeStatus],[TbProblemOrder].[DistributionTime],[TbProblemOrder].[DistributionAddress],[TbProblemOrder].[Total],[TbProblemOrder].[OldTotal],[TbProblemOrder].[InsertUserCode],[TbProblemOrder].[InsertTime],[TbProblemOrder].[ProjectId],[TbUser].[UserName],[TbCompany].[CompanyFullName] AS [SiteName],[TbWorkOrder].[ProcessingState] AS [OldProcessingState] FROM [TbProblemOrder] LEFT OUTER JOIN [TbUser] ON ([TbProblemOrder].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbCompany] ON ([TbProblemOrder].[SiteCode] = [TbCompany].[CompanyCode]) LEFT OUTER JOIN [TbWorkOrder] ON ([TbProblemOrder].[OrderCode] = [TbWorkOrder].[OrderCode])  WHERE ((([TbProblemOrder].[SiteCode] IN (@SiteCode101)) AND ([TbProblemOrder].[ProcessFactoryCode] = @ProcessFactoryCode102)) AND ([TbProblemOrder].[ProjectId] = @ProjectId103)) ORDER BY [TbProblemOrder].[ID] DESC 	
Parameters:
@SiteCode101[String] = 6372921375874657752
@ProcessFactoryCode102[String] = 6386683729561128960
@ProjectId103[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 10:01:56
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 10:04:56
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 10:07:56
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 10:10:56
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 10:13:56
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 10:16:56
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 10:19:56
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 10:22:55
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 10:25:56
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 10:28:56
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 10:31:56
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 10:34:56
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 10:37:56
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 10:40:56
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 10:43:56
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 10:46:56
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 10:49:56
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 10:52:56
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 10:55:56
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 10:56:01
Text:	select tsm.* from TbRoleMenu tum
                           left join TbSysMenu tsm on tum.MenuCode=tsm.MenuCode
                           where tsm.IsShow=0 and tsm.MenuType='PC' and tum.RoleCode in('6372919444627396738','6372919451594895243') order by tsm.Sort asc	


-----------------------------------------------------------------------------
2020-07-14 10:56:01
Text:	select 
                        	tsm.*
                        from TbUserMenu tum
                        left join TbSysMenu tsm on tum.MenuCode=tsm.MenuCode
                        where tsm.IsShow=0 and tsm.MenuType='PC' and tum.UserCode=@userCode order by tsm.Sort asc	
Parameters:
@userCode[String] = 6372930471544160074


-----------------------------------------------------------------------------
2020-07-14 10:56:01
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 10:56:01
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 10:56:01
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 10:56:01
Text:	select isnull(sum(TbCF.Capacity),0) as Capacity,isnull(sum(TbCF.WeightSmallPlan),0) as WeightSmallPlan,isnull(cast(sum(TbCF.WeightSmallPlan)/sum(TbCF.Capacity)*100 as decimal(18,2)),0) as ActualLoadNew from (select cf.Capacity,Tb1.WeightSmallPlan,cf.ProcessFactoryCode from TbCapacityFilling cf  
left join(
select SUM(Tb.WeightSmallPlan) as WeightSmallPlan,Tb.ProcessFactoryCode from (
                            select isnull(SUM(wod.WeightSmallPlan),0) as WeightSmallPlan,wo.ProcessFactoryCode from TbWorkOrder wo
                            left join TbWorkOrderDetail wod on wo.OrderCode=wod.OrderCode
                            where (ISNULL(@ProcessFactoryCode,'')='' or wo.ProcessFactoryCode=@ProcessFactoryCode)
                            and CONVERT(varchar(7), wo.DistributionTime, 120)=@month
                            and wod.RevokeStart='正常' and wo.ProcessingState!='ConfirmWork' and wo.ProcessingState!='Finishing'  group by wo.ProcessFactoryCode
                            union all
                            select isnull(sum(opd.NoCompleted),0) as NoCompleted,op.ProcessFactoryCode from TbOrderProgress op
                            left join TbOrderProgressDetail opd on op.OrderCode=opd.OrderCode 
                            where (ISNULL(@ProcessFactoryCode,'')='' or op.ProcessFactoryCode=@ProcessFactoryCode)
                            and CONVERT(varchar(7), op.DistributionTime, 120)=CONVERT(varchar(4),YEAR(DATEADD(MONTH,-1,@month+'-01')))+'-'+Right(100+Month(DATEADD(MONTH,-1,@month+'-01')),2)
                            and opd.RevokeStart='正常'  group by op.ProcessFactoryCode)Tb  group by Tb.ProcessFactoryCode
) Tb1 on cf.ProcessFactoryCode=Tb1.ProcessFactoryCode 
where cf.CapacityMonth=@month
and (ISNULL(@ProcessFactoryCode,'')='' or cf.ProcessFactoryCode=@ProcessFactoryCode)) TbCF where (ISNULL(@ProcessFactoryCode,'')='' or TbCF.ProcessFactoryCode=@ProcessFactoryCode)	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@month[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-14 10:56:02
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 10:56:02
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode104) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode105,@WorkAreaCode106))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus107) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth108))) 	
Parameters:
@ProcessFactoryCode104[String] = 6386683729561128960
@WorkAreaCode105[String] = 6372921396045311451
@WorkAreaCode106[String] = 6372921398380745033
@Examinestatus107[String] = 审核完成
@DemandMonth108[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-14 10:56:02
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 10:56:02
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 10:56:02
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:56:02
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:56:02
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode111) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode112))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState113)) 	
Parameters:
@ProcessFactoryCode111[String] = 6386683729561128960
@SiteCode112[String] = 6372921375874657752
@ProcessingState113[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-14 10:56:02
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-14 10:56:02
Text:	 SELECT   [TbOrderProgress].[ProcessingState],[TbOrderProgress].[OrderCode],[TbOrderProgress].[FinishProcessingDateTime],[TbOrderProgress].[DistributionTime],[TbOrderProgress].[SiteCode] FROM [TbOrderProgress]  WHERE ((([TbOrderProgress].[SiteCode] IN (@SiteCode109)) AND ([TbOrderProgress].[ProcessFactoryCode] = @ProcessFactoryCode110)) AND ((YEAR(DistributionTime)=2020 and MONTH(DistributionTime)=7) or (DistributionTime<'2020/7/1 0:00:00' and (ProcessingState!='Finishing')))) 	
Parameters:
@SiteCode109[String] = 6372921375874657752
@ProcessFactoryCode110[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 10:56:02
Text:	 SELECT   * FROM [TbWorkOrderDetail]  WHERE (1=2) AND ([TbWorkOrderDetail].[DaetailWorkStrat] = @DaetailWorkStrat114) 	
Parameters:
@DaetailWorkStrat114[String] = 未加工


-----------------------------------------------------------------------------
2020-07-14 10:56:02
Text:	 SELECT   [TbOrderProgress].[WeightTotal] AS [TotalWeight],[TbCompany].[ParentCompanyCode] FROM [TbOrderProgress] LEFT OUTER JOIN [TbCompany] ON ([TbOrderProgress].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((1=2) AND ([TbOrderProgress].[ProcessingState] <> @ProcessingState115)) AND ((([TbOrderProgress].[FinishProcessingDateTime] is not null ) AND ([TbOrderProgress].[DistributionTime] < [TbOrderProgress].[FinishProcessingDateTime])) OR (([TbOrderProgress].[FinishProcessingDateTime] is null ) AND ([TbOrderProgress].[DistributionTime] < @DistributionTime116)))) 	
Parameters:
@ProcessingState115[String] = Finishing
@DistributionTime116[DateTime] = 2020/7/14 0:00:00


-----------------------------------------------------------------------------
2020-07-14 10:56:02
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:56:02
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode117) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode118))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState119)) 	
Parameters:
@ProcessFactoryCode117[String] = 6386683729561128960
@SiteCode118[String] = 6372921375874657752
@ProcessingState119[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-14 10:56:02
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-14 10:56:03
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 10:56:03
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode121) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode122,@WorkAreaCode123))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus124) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth125))) 	
Parameters:
@ProcessFactoryCode121[String] = 6386683729561128960
@WorkAreaCode122[String] = 6372921396045311451
@WorkAreaCode123[String] = 6372921398380745033
@Examinestatus124[String] = 审核完成
@DemandMonth125[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-14 10:56:03
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 10:56:03
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:56:03
Text:	 SELECT   [TbRawMaterialStockRecord].[MaterialCode],sum([TbRawMaterialStockRecord].[UseCount]) AS [UseCount],sum([TbRawMaterialStockRecord].[LockCount]) AS [LockCount] FROM [TbRawMaterialStockRecord] LEFT OUTER JOIN [TbStorage] ON ([TbRawMaterialStockRecord].[StorageCode] = [TbStorage].[StorageCode]) LEFT OUTER JOIN [TbRawMaterialArchives] ON ([TbRawMaterialStockRecord].[MaterialCode] = [TbRawMaterialArchives].[MaterialCode])  WHERE ((([TbStorage].[ProcessFactoryCode] = @ProcessFactoryCode128) AND ([TbRawMaterialStockRecord].[WorkAreaCode] IN (@WorkAreaCode130,@WorkAreaCode131))) AND ([TbRawMaterialArchives].[RebarType] = @RebarType133)) GROUP BY [TbRawMaterialStockRecord].[MaterialCode] 	
Parameters:
@ProcessFactoryCode128[String] = 6386683729561128960
@WorkAreaCode130[String] = 6372921396045311451
@WorkAreaCode131[String] = 6372921398380745033
@RebarType133[String] = BuildingSteel


-----------------------------------------------------------------------------
2020-07-14 10:56:03
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 10:56:03
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:56:03
Text:	 SELECT   [TbRawMaterialStockRecord].[MaterialCode],sum([TbRawMaterialStockRecord].[UseCount]) AS [UseCount],sum([TbRawMaterialStockRecord].[LockCount]) AS [LockCount] FROM [TbRawMaterialStockRecord] LEFT OUTER JOIN [TbStorage] ON ([TbRawMaterialStockRecord].[StorageCode] = [TbStorage].[StorageCode]) LEFT OUTER JOIN [TbRawMaterialArchives] ON ([TbRawMaterialStockRecord].[MaterialCode] = [TbRawMaterialArchives].[MaterialCode])  WHERE ((([TbStorage].[ProcessFactoryCode] = @ProcessFactoryCode137) AND ([TbRawMaterialStockRecord].[WorkAreaCode] IN (@WorkAreaCode139,@WorkAreaCode140))) AND ([TbRawMaterialArchives].[RebarType] = @RebarType142)) GROUP BY [TbRawMaterialStockRecord].[MaterialCode] 	
Parameters:
@ProcessFactoryCode137[String] = 6386683729561128960
@WorkAreaCode139[String] = 6372921396045311451
@WorkAreaCode140[String] = 6372921398380745033
@RebarType142[String] = SectionSteel


-----------------------------------------------------------------------------
2020-07-14 10:56:03
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:56:03
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:56:03
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode146) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode147))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState148)) 	
Parameters:
@ProcessFactoryCode146[String] = 6386683729561128960
@SiteCode147[String] = 6372921375874657752
@ProcessingState148[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-14 10:56:03
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-14 10:56:03
Text:	 SELECT   [TbOrderProgress].[ProcessingState],[TbOrderProgress].[OrderCode],[TbOrderProgress].[FinishProcessingDateTime],[TbOrderProgress].[DistributionTime],[TbOrderProgress].[SiteCode] FROM [TbOrderProgress]  WHERE ((([TbOrderProgress].[SiteCode] IN (@SiteCode144)) AND ([TbOrderProgress].[ProcessFactoryCode] = @ProcessFactoryCode145)) AND ((YEAR(DistributionTime)=2020 and MONTH(DistributionTime)=7) or (DistributionTime<'2020/7/1 0:00:00' and (ProcessingState!='Finishing')))) 	
Parameters:
@SiteCode144[String] = 6372921375874657752
@ProcessFactoryCode145[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 10:56:03
Text:	 SELECT   * FROM [TbWorkOrderDetail]  WHERE (1=2) AND ([TbWorkOrderDetail].[DaetailWorkStrat] = @DaetailWorkStrat149) 	
Parameters:
@DaetailWorkStrat149[String] = 未加工


-----------------------------------------------------------------------------
2020-07-14 10:56:03
Text:	 SELECT   [TbOrderProgress].[WeightTotal] AS [TotalWeight],[TbCompany].[ParentCompanyCode] FROM [TbOrderProgress] LEFT OUTER JOIN [TbCompany] ON ([TbOrderProgress].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((1=2) AND ([TbOrderProgress].[ProcessingState] <> @ProcessingState150)) AND ((([TbOrderProgress].[FinishProcessingDateTime] is not null ) AND ([TbOrderProgress].[DistributionTime] < [TbOrderProgress].[FinishProcessingDateTime])) OR (([TbOrderProgress].[FinishProcessingDateTime] is null ) AND ([TbOrderProgress].[DistributionTime] < @DistributionTime151)))) 	
Parameters:
@ProcessingState150[String] = Finishing
@DistributionTime151[DateTime] = 2020/7/14 0:00:00


-----------------------------------------------------------------------------
2020-07-14 10:56:03
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:56:03
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 10:56:03
Text:	--原材料供货超时
                           select BatchPlanNum,cp1.CompanyFullName as BranchName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,sup.SupplyDate,sup.SupplyCompleteTime,sup.ProjectId,sup.Remarks from TbSupplyList sup
                           left join TbCompany cp1 on cp1.CompanyCode=sup.BranchCode
                           left join TbCompany cp2 on cp2.CompanyCode=sup.WorkAreaCode
                           left join TbCompany cp3 on cp3.CompanyCode=sup.SiteCode
                           left join TbCompany cp4 on cp4.CompanyCode=sup.ProcessFactoryCode
                           where YEAR(sup.SupplyDate)= @Year and MONTH(sup.SupplyDate)= @Month
                           and (sup.SupplyCompleteTime>sup.SupplyDate or (GETDATE()>sup.SupplyDate and sup.SupplyCompleteTime is null))  and sup.ProjectId='6372912251695766465' and sup.ProcessFactoryCode='6386683729561128960' and (sup.SiteCode in('6372921375874657752') or sup.WorkAreaCode in('6372921396045311451','6372921398380745033'))	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 10:56:03
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:56:03
Text:	--加急订单个数
                           select wo.OrderCode,wo.DistributionTime,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName from TbWorkOrder wo
                           left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on wo.ProcessFactoryCode=cp2.CompanyCode
                           where UrgentDegree='Urgent'
                           and YEAR(wo.DistributionTime)= @Year and MONTH(wo.DistributionTime)= @Month  and wo.ProjectId='6372912251695766465' and wo.ProcessFactoryCode='6386683729561128960' and wo.SiteCode in('6372921375874657752')  ORDER BY wo.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 10:56:03
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:56:03
Text:	--加工进度滞后
                           select op.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,op.DistributionTime,op.FinishProcessingDateTime from TbOrderProgress op 
                           left join TbCompany cp1 on op.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on op.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(op.DistributionTime)= @Year and MONTH(op.DistributionTime)= @Month
                           and (op.FinishProcessingDateTime>op.DistributionTime or (GETDATE()>op.DistributionTime and op.FinishProcessingDateTime is null))  and op.ProjectId='6372912251695766465' and op.ProcessFactoryCode='6386683729561128960' and op.SiteCode in('6372921375874657752') ORDER BY op.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 10:56:03
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:56:03
Text:	--配送超期
                           select dpi.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,dpi.DistributionTime,dpi.DeliveryCompleteTime,dpi.Remark from TbDistributionPlanInfo dpi
                           left join TbCompany cp1 on dpi.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on dpi.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(dpi.DistributionTime)= @Year and MONTH(dpi.DistributionTime)= @Month
                           and (dpi.DeliveryCompleteTime>dpi.DistributionTime or (GETDATE()>dpi.DistributionTime and dpi.DeliveryCompleteTime is null))  and dpi.ProjectId='6372912251695766465' and dpi.ProcessFactoryCode='6386683729561128960' and dpi.SiteCode in('6372921375874657752') ORDER BY dpi.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 10:56:03
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:56:03
Text:	select TbYj.*,cp1.CompanyFullName as SiteName,tcr.EnterSpaceTime,tcr.StartDischargeTime,tcr.EndDischargeTime,disEnt.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SiteDischargeCargo' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbTransportCarReport tcr on TbYj.EWFormDataCode=tcr.DisEntOrderId
                           left join TbDistributionEnt disEnt on tcr.DistributionCode=disEnt.DistributionCode
                           left join TbCompany cp on disEnt.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and disEnt.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ORDER BY tcr.EnterSpaceTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 10:56:03
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:56:03
Text:	select TbYj.*,cp1.CompanyFullName as SiteName,sfs.DistributionCode,sdc.DistributionTime,sfs.SigninTime,sfs.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SemiFinishedSign' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbSemiFinishedSign sfs on TbYj.EWFormDataCode=sfs.ID
                           left join TbSiteDischargeCargo sdc on sfs.DistributionCode=sdc.DistributionCode and sfs.DischargeCargoCode=sdc.DischargeCargoCode
                           left join TbCompany cp on sfs.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month and TbYj.ProjectId='6372912251695766465' and sfs.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752')	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 10:56:03
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 10:56:03
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode152) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode153,@WorkAreaCode154))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus155) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth156))) 	
Parameters:
@ProcessFactoryCode152[String] = 6386683729561128960
@WorkAreaCode153[String] = 6372921396045311451
@WorkAreaCode154[String] = 6372921398380745033
@Examinestatus155[String] = 审核完成
@DemandMonth156[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-14 10:56:03
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:56:03
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 10:56:03
Text:	SELECT sm.MenuName,fwqi.EWContent,fwqi.EWUserCode,u.UserName,fwqi.EWFormDataCode,cp1.CompanyFullName as  FbName,cp2.CompanyFullName as GqName,fwqi.EWTime,sdd.DictionaryText as RebarType  
                   FROM (  
                    select ret.*
                    FROM ( 
                         SELECT *, row_number()over(partition BY EarlyWarningCode,EWFormDataCode ORDER BY EWNodeCode,EWTime desc) as group_idx 
                         FROM TbFormEarlyWarningNodeInfo fwqi
                         WHERE YEAR(fwqi.EWTime)= @Year and MONTH(fwqi.EWTime)= @Month AND fwqi.MenuCode='RawMonthDemandPlan' AND fwqi.EWStart=0
                    ) ret
                    WHERE ret.group_idx = 1
                   ) fwqi
                    left join TbSysMenu sm on fwqi.MenuCode=sm.MenuCode
                            left join TbCompany cp1 on fwqi.CompanyCode=cp1.CompanyCode
                            left join TbCompany cp2 on fwqi.WorkArea=cp2.CompanyCode
                            left join TbCompany cp3 on fwqi.SiteCode=cp3.CompanyCode
                            left join TbUser u on fwqi.EWUserCode=u.UserId
                            left join TbRawMaterialMonthDemandPlan rmp on fwqi.EWFormDataCode=rmp.ID
                            left join TbSysDictionaryData sdd on sdd.DictionaryCode=rmp.RebarType
                    where 1=1 and fwqi.ProjectId='6372912251695766465' and (fwqi.SiteCode in('6372921375874657752') or fwqi.WorkArea in('6372921396045311451','6372921398380745033')) ORDER BY fwqi.EWTime DESC	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 10:56:04
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:56:04
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 10:56:04
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:56:04
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 10:56:04
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:56:04
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 10:56:04
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:56:04
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:56:04
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:56:04
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:56:04
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:56:04
Text:	SELECT 
                            '审批超时' as YjTypeName,COUNT(1) as YjNum
                            FROM (
									SELECT a.*, row_number()over(partition BY a.FlowCode ORDER BY a.FlowNodeCode,a.EarlyWarningTime desc) as group_idx 
									FROM TbFlowEarlyWarningOtherInfo  a
									INNER JOIN  TbFlowEarlyWarningInfo b ON a.FlowCode=b.FlowCode 
									AND a.EWFormDataCode=b.EWFormDataCode AND a.FlowNodeCode=b.FlowNodeCode 
									WHERE  b.EarlyWarningStart=0 AND YEAR(a.EarlyWarningTime)= @Year and MONTH(a.EarlyWarningTime)= @Month  and a.ProjectId='6372912251695766465' and a.ProcessFactoryCode='6386683729561128960' and (a.SiteCode in('6372921375874657752') or a.WorkAreaCode in('6372921396045311451','6372921398380745033'))
							   ) Tb1
                            WHERE Tb1.group_idx =1
                           union all
                            select '未报月度需求计划' as YjTypeName,COUNT(1)as YjNum
                             FROM ( 
                                  SELECT *, row_number()over(partition BY EarlyWarningCode,EWFormDataCode ORDER BY EWNodeCode,EWTime desc) as group_idx 
                                  FROM TbFormEarlyWarningNodeInfo fwqi
                                  WHERE fwqi.MenuCode='RawMonthDemandPlan' AND fwqi.EWStart=0 AND YEAR(fwqi.EWTime)= @Year and MONTH(fwqi.EWTime)= @Month  and fwqi.ProjectId='6372912251695766465' and (fwqi.SiteCode in('6372921375874657752') or fwqi.WorkArea in('6372921396045311451','6372921398380745033'))  
                             ) Tb2
                             WHERE Tb2.group_idx =1
                           union all
                           select '原材料供货超时' as YjTypeName,COUNT(1) as YjNum from (
                           select BatchPlanNum,cp1.CompanyFullName as BranchName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,sup.SupplyDate,sup.SupplyCompleteTime,sup.ProjectId from TbSupplyList sup
                           left join TbCompany cp1 on cp1.CompanyCode=sup.BranchCode
                           left join TbCompany cp2 on cp2.CompanyCode=sup.WorkAreaCode
                           left join TbCompany cp3 on cp3.CompanyCode=sup.SiteCode
                           left join TbCompany cp4 on cp4.CompanyCode=sup.ProcessFactoryCode
                           where (sup.SupplyCompleteTime>sup.SupplyDate or (GETDATE()>sup.SupplyDate and sup.SupplyCompleteTime is null))
						   and YEAR(sup.SupplyDate)= @Year and MONTH(sup.SupplyDate)= @Month  and sup.ProjectId='6372912251695766465' and sup.ProcessFactoryCode='6386683729561128960' and (sup.SiteCode in('6372921375874657752') or sup.WorkAreaCode in('6372921396045311451','6372921398380745033'))) Tb3
                           union all
                           select '加急订单' as YjTypeName,COUNT(1) as YjNum from (--加急订单个数
                           select wo.OrderCode,wo.DistributionTime,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName from TbWorkOrder wo
                           left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on wo.ProcessFactoryCode=cp2.CompanyCode
                           where UrgentDegree='Urgent' 
						   and YEAR(wo.DistributionTime)= @Year and MONTH(wo.DistributionTime)= @Month  and wo.ProjectId='6372912251695766465' and wo.ProcessFactoryCode='6386683729561128960' and wo.SiteCode in('6372921375874657752') ) Tb4
                           union all
                           select '加工进度滞后' as YjTypeName,COUNT(1) as YjNum from (--加工进度滞后
                           select op.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,op.DistributionTime,op.FinishProcessingDateTime from TbOrderProgress op 
                           left join TbCompany cp1 on op.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on op.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(op.DistributionTime)= @Year and MONTH(op.DistributionTime)= @Month
                           and (op.FinishProcessingDateTime>op.DistributionTime or (GETDATE()>op.DistributionTime and op.FinishProcessingDateTime is null))  and op.ProjectId='6372912251695766465' and op.ProcessFactoryCode='6386683729561128960' and op.SiteCode in('6372921375874657752') ) Tb5
                           union all
                           select '接收配送超期' as YjTypeName,COUNT(1) as YjNum from (--配送超期
                           select dpi.OrderCode,cp1.CompanyFullName as SIteName,cp2.CompanyFullName as ProcessFactoryName,dpi.DistributionTime,dpi.DeliveryCompleteTime from TbDistributionPlanInfo dpi
                           left join TbCompany cp1 on dpi.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on dpi.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(dpi.DistributionTime)= @Year and MONTH(dpi.DistributionTime)= @Month
                           and (dpi.DeliveryCompleteTime>dpi.DistributionTime or (GETDATE()>dpi.DistributionTime and dpi.DeliveryCompleteTime is null))  and dpi.ProjectId='6372912251695766465' and dpi.ProcessFactoryCode='6386683729561128960' and dpi.SiteCode in('6372921375874657752') ) Tb6 
                           union all
                           select '卸货超时' as YjTypeName,COUNT(1) as YjNum from(--卸货超时
                           select TbYj.*,cp1.CompanyFullName as SiteName,tcr.EnterSpaceTime,tcr.StartDischargeTime,tcr.EndDischargeTime,disEnt.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SiteDischargeCargo' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbTransportCarReport tcr on TbYj.EWFormDataCode=tcr.DisEntOrderId
                           left join TbDistributionEnt disEnt on tcr.DistributionCode=disEnt.DistributionCode
                           left join TbCompany cp on disEnt.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and disEnt.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ) Tb7
                           union all
                           select '签收超时' as YjTypeName,COUNT(1) as YjNum from (select TbYj.*,cp1.CompanyFullName as SiteName,sfs.DistributionCode,sdc.DistributionTime,sfs.SigninTime,sfs.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SemiFinishedSign' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbSemiFinishedSign sfs on TbYj.EWFormDataCode=sfs.ID
                           left join TbSiteDischargeCargo sdc on sfs.DistributionCode=sdc.DistributionCode and sfs.DischargeCargoCode=sdc.DischargeCargoCode
                           left join TbCompany cp on sfs.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and sfs.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ) Tb8	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 10:56:04
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 10:56:04
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode157) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode158,@WorkAreaCode159))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus160) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth161))) 	
Parameters:
@ProcessFactoryCode157[String] = 6386683729561128960
@WorkAreaCode158[String] = 6372921396045311451
@WorkAreaCode159[String] = 6372921398380745033
@Examinestatus160[String] = 审核完成
@DemandMonth161[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-14 10:56:05
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:56:05
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 10:56:05
Text:	
                        select fewoi.DataCode as OddNumbers,
                         fewoi.EarlyWarningContent,
                         fewoi.EWFormDataCode,
                         CONVERT(varchar(100), fewoi.EarlyWarningTime, 120) as EarlyWarningTime,
                         EWFormCode,sm.MenuName,fn.FlowNodeName,cp1.CompanyFullName as BranchName,
                         cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,
                         u1.UserName as FlowSpUserName,u2.UserName as FlowYjUserName 
                        FROM (
                        select*
                           FROM ( 
                        		SELECT a.*, row_number()over(partition BY a.FlowCode ORDER BY a.FlowNodeCode,a.EarlyWarningTime desc) as group_idx 
                        		FROM TbFlowEarlyWarningOtherInfo  a
                        		INNER JOIN  TbFlowEarlyWarningInfo b ON a.FlowCode=b.FlowCode 
                        		AND a.EWFormDataCode=b.EWFormDataCode AND a.FlowNodeCode=b.FlowNodeCode 
                        		WHERE YEAR(a.EarlyWarningTime)= @Year and MONTH(a.EarlyWarningTime)= @Month AND b.EarlyWarningStart=0
                           ) ret
                        WHERE ret.group_idx =1
                        ) fewoi
                        left join TbFlowNode fn on fewoi.FlowCode=fn.FlowCode and fewoi.FlowNodeCode=fn.FlowNodeCode
                        left join TbSysMenu sm on fewoi.EWFormCode=sm.MenuCode
                        left join TbCompany cp1 on fewoi.BranchCode=cp1.CompanyCode
                        left join TbCompany cp2 on fewoi.WorkAreaCode=cp2.CompanyCode
                        left join TbCompany cp3 on fewoi.SiteCode=cp3.CompanyCode
                        left join TbCompany cp4 on fewoi.ProcessFactoryCode=cp4.CompanyCode
                        left join TbUser u1 on fewoi.FlowSpUserCode=u1.UserId
                        left join TbUser u2 on fewoi.FlowYjUserCode=u2.UserId where 1=1 and fewoi.ProjectId='6372912251695766465' and fewoi.ProcessFactoryCode='6386683729561128960' and (fewoi.SiteCode in('6372921375874657752') or fewoi.WorkAreaCode in('6372921396045311451','6372921398380745033')) ORDER BY fewoi.EarlyWarningTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 10:59:02
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 10:59:28
Text:	select tsm.* from TbRoleMenu tum
                           left join TbSysMenu tsm on tum.MenuCode=tsm.MenuCode
                           where tsm.IsShow=0 and tsm.MenuType='PC' and tum.RoleCode in('6372919444627396738','6372919451594895243') order by tsm.Sort asc	


-----------------------------------------------------------------------------
2020-07-14 10:59:28
Text:	select 
                        	tsm.*
                        from TbUserMenu tum
                        left join TbSysMenu tsm on tum.MenuCode=tsm.MenuCode
                        where tsm.IsShow=0 and tsm.MenuType='PC' and tum.UserCode=@userCode order by tsm.Sort asc	
Parameters:
@userCode[String] = 6372930471544160074


-----------------------------------------------------------------------------
2020-07-14 10:59:28
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 10:59:28
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 10:59:28
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 10:59:28
Text:	select isnull(sum(TbCF.Capacity),0) as Capacity,isnull(sum(TbCF.WeightSmallPlan),0) as WeightSmallPlan,isnull(cast(sum(TbCF.WeightSmallPlan)/sum(TbCF.Capacity)*100 as decimal(18,2)),0) as ActualLoadNew from (select cf.Capacity,Tb1.WeightSmallPlan,cf.ProcessFactoryCode from TbCapacityFilling cf  
left join(
select SUM(Tb.WeightSmallPlan) as WeightSmallPlan,Tb.ProcessFactoryCode from (
                            select isnull(SUM(wod.WeightSmallPlan),0) as WeightSmallPlan,wo.ProcessFactoryCode from TbWorkOrder wo
                            left join TbWorkOrderDetail wod on wo.OrderCode=wod.OrderCode
                            where (ISNULL(@ProcessFactoryCode,'')='' or wo.ProcessFactoryCode=@ProcessFactoryCode)
                            and CONVERT(varchar(7), wo.DistributionTime, 120)=@month
                            and wod.RevokeStart='正常' and wo.ProcessingState!='ConfirmWork' and wo.ProcessingState!='Finishing'  group by wo.ProcessFactoryCode
                            union all
                            select isnull(sum(opd.NoCompleted),0) as NoCompleted,op.ProcessFactoryCode from TbOrderProgress op
                            left join TbOrderProgressDetail opd on op.OrderCode=opd.OrderCode 
                            where (ISNULL(@ProcessFactoryCode,'')='' or op.ProcessFactoryCode=@ProcessFactoryCode)
                            and CONVERT(varchar(7), op.DistributionTime, 120)=CONVERT(varchar(4),YEAR(DATEADD(MONTH,-1,@month+'-01')))+'-'+Right(100+Month(DATEADD(MONTH,-1,@month+'-01')),2)
                            and opd.RevokeStart='正常'  group by op.ProcessFactoryCode)Tb  group by Tb.ProcessFactoryCode
) Tb1 on cf.ProcessFactoryCode=Tb1.ProcessFactoryCode 
where cf.CapacityMonth=@month
and (ISNULL(@ProcessFactoryCode,'')='' or cf.ProcessFactoryCode=@ProcessFactoryCode)) TbCF where (ISNULL(@ProcessFactoryCode,'')='' or TbCF.ProcessFactoryCode=@ProcessFactoryCode)	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@month[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-14 10:59:29
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 10:59:29
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode162) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode163,@WorkAreaCode164))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus165) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth166))) 	
Parameters:
@ProcessFactoryCode162[String] = 6386683729561128960
@WorkAreaCode163[String] = 6372921396045311451
@WorkAreaCode164[String] = 6372921398380745033
@Examinestatus165[String] = 审核完成
@DemandMonth166[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-14 10:59:29
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 10:59:29
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 10:59:29
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:59:29
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:59:29
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode169) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode170))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState171)) 	
Parameters:
@ProcessFactoryCode169[String] = 6386683729561128960
@SiteCode170[String] = 6372921375874657752
@ProcessingState171[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-14 10:59:29
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-14 10:59:29
Text:	 SELECT   [TbOrderProgress].[ProcessingState],[TbOrderProgress].[OrderCode],[TbOrderProgress].[FinishProcessingDateTime],[TbOrderProgress].[DistributionTime],[TbOrderProgress].[SiteCode] FROM [TbOrderProgress]  WHERE ((([TbOrderProgress].[SiteCode] IN (@SiteCode167)) AND ([TbOrderProgress].[ProcessFactoryCode] = @ProcessFactoryCode168)) AND ((YEAR(DistributionTime)=2020 and MONTH(DistributionTime)=7) or (DistributionTime<'2020/7/1 0:00:00' and (ProcessingState!='Finishing')))) 	
Parameters:
@SiteCode167[String] = 6372921375874657752
@ProcessFactoryCode168[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 10:59:29
Text:	 SELECT   * FROM [TbWorkOrderDetail]  WHERE (1=2) AND ([TbWorkOrderDetail].[DaetailWorkStrat] = @DaetailWorkStrat172) 	
Parameters:
@DaetailWorkStrat172[String] = 未加工


-----------------------------------------------------------------------------
2020-07-14 10:59:29
Text:	 SELECT   [TbOrderProgress].[WeightTotal] AS [TotalWeight],[TbCompany].[ParentCompanyCode] FROM [TbOrderProgress] LEFT OUTER JOIN [TbCompany] ON ([TbOrderProgress].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((1=2) AND ([TbOrderProgress].[ProcessingState] <> @ProcessingState173)) AND ((([TbOrderProgress].[FinishProcessingDateTime] is not null ) AND ([TbOrderProgress].[DistributionTime] < [TbOrderProgress].[FinishProcessingDateTime])) OR (([TbOrderProgress].[FinishProcessingDateTime] is null ) AND ([TbOrderProgress].[DistributionTime] < @DistributionTime174)))) 	
Parameters:
@ProcessingState173[String] = Finishing
@DistributionTime174[DateTime] = 2020/7/14 0:00:00


-----------------------------------------------------------------------------
2020-07-14 10:59:29
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:59:29
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode175) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode176))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState177)) 	
Parameters:
@ProcessFactoryCode175[String] = 6386683729561128960
@SiteCode176[String] = 6372921375874657752
@ProcessingState177[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-14 10:59:29
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-14 10:59:30
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 10:59:30
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode179) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode180,@WorkAreaCode181))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus182) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth183))) 	
Parameters:
@ProcessFactoryCode179[String] = 6386683729561128960
@WorkAreaCode180[String] = 6372921396045311451
@WorkAreaCode181[String] = 6372921398380745033
@Examinestatus182[String] = 审核完成
@DemandMonth183[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-14 10:59:30
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 10:59:30
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:59:30
Text:	 SELECT   [TbRawMaterialStockRecord].[MaterialCode],sum([TbRawMaterialStockRecord].[UseCount]) AS [UseCount],sum([TbRawMaterialStockRecord].[LockCount]) AS [LockCount] FROM [TbRawMaterialStockRecord] LEFT OUTER JOIN [TbStorage] ON ([TbRawMaterialStockRecord].[StorageCode] = [TbStorage].[StorageCode]) LEFT OUTER JOIN [TbRawMaterialArchives] ON ([TbRawMaterialStockRecord].[MaterialCode] = [TbRawMaterialArchives].[MaterialCode])  WHERE ((([TbStorage].[ProcessFactoryCode] = @ProcessFactoryCode186) AND ([TbRawMaterialStockRecord].[WorkAreaCode] IN (@WorkAreaCode188,@WorkAreaCode189))) AND ([TbRawMaterialArchives].[RebarType] = @RebarType191)) GROUP BY [TbRawMaterialStockRecord].[MaterialCode] 	
Parameters:
@ProcessFactoryCode186[String] = 6386683729561128960
@WorkAreaCode188[String] = 6372921396045311451
@WorkAreaCode189[String] = 6372921398380745033
@RebarType191[String] = BuildingSteel


-----------------------------------------------------------------------------
2020-07-14 10:59:30
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 10:59:30
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:59:30
Text:	 SELECT   [TbRawMaterialStockRecord].[MaterialCode],sum([TbRawMaterialStockRecord].[UseCount]) AS [UseCount],sum([TbRawMaterialStockRecord].[LockCount]) AS [LockCount] FROM [TbRawMaterialStockRecord] LEFT OUTER JOIN [TbStorage] ON ([TbRawMaterialStockRecord].[StorageCode] = [TbStorage].[StorageCode]) LEFT OUTER JOIN [TbRawMaterialArchives] ON ([TbRawMaterialStockRecord].[MaterialCode] = [TbRawMaterialArchives].[MaterialCode])  WHERE ((([TbStorage].[ProcessFactoryCode] = @ProcessFactoryCode195) AND ([TbRawMaterialStockRecord].[WorkAreaCode] IN (@WorkAreaCode197,@WorkAreaCode198))) AND ([TbRawMaterialArchives].[RebarType] = @RebarType200)) GROUP BY [TbRawMaterialStockRecord].[MaterialCode] 	
Parameters:
@ProcessFactoryCode195[String] = 6386683729561128960
@WorkAreaCode197[String] = 6372921396045311451
@WorkAreaCode198[String] = 6372921398380745033
@RebarType200[String] = SectionSteel


-----------------------------------------------------------------------------
2020-07-14 10:59:30
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 10:59:30
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode202) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode203,@WorkAreaCode204))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus205) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth206))) 	
Parameters:
@ProcessFactoryCode202[String] = 6386683729561128960
@WorkAreaCode203[String] = 6372921396045311451
@WorkAreaCode204[String] = 6372921398380745033
@Examinestatus205[String] = 审核完成
@DemandMonth206[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-14 10:59:30
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:59:30
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 10:59:30
Text:	SELECT sm.MenuName,fwqi.EWContent,fwqi.EWUserCode,u.UserName,fwqi.EWFormDataCode,cp1.CompanyFullName as  FbName,cp2.CompanyFullName as GqName,fwqi.EWTime,sdd.DictionaryText as RebarType  
                   FROM (  
                    select ret.*
                    FROM ( 
                         SELECT *, row_number()over(partition BY EarlyWarningCode,EWFormDataCode ORDER BY EWNodeCode,EWTime desc) as group_idx 
                         FROM TbFormEarlyWarningNodeInfo fwqi
                         WHERE YEAR(fwqi.EWTime)= @Year and MONTH(fwqi.EWTime)= @Month AND fwqi.MenuCode='RawMonthDemandPlan' AND fwqi.EWStart=0
                    ) ret
                    WHERE ret.group_idx = 1
                   ) fwqi
                    left join TbSysMenu sm on fwqi.MenuCode=sm.MenuCode
                            left join TbCompany cp1 on fwqi.CompanyCode=cp1.CompanyCode
                            left join TbCompany cp2 on fwqi.WorkArea=cp2.CompanyCode
                            left join TbCompany cp3 on fwqi.SiteCode=cp3.CompanyCode
                            left join TbUser u on fwqi.EWUserCode=u.UserId
                            left join TbRawMaterialMonthDemandPlan rmp on fwqi.EWFormDataCode=rmp.ID
                            left join TbSysDictionaryData sdd on sdd.DictionaryCode=rmp.RebarType
                    where 1=1 and fwqi.ProjectId='6372912251695766465' and (fwqi.SiteCode in('6372921375874657752') or fwqi.WorkArea in('6372921396045311451','6372921398380745033')) ORDER BY fwqi.EWTime DESC	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 10:59:30
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:59:30
Text:	--加急订单个数
                           select wo.OrderCode,wo.DistributionTime,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName from TbWorkOrder wo
                           left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on wo.ProcessFactoryCode=cp2.CompanyCode
                           where UrgentDegree='Urgent'
                           and YEAR(wo.DistributionTime)= @Year and MONTH(wo.DistributionTime)= @Month  and wo.ProjectId='6372912251695766465' and wo.ProcessFactoryCode='6386683729561128960' and wo.SiteCode in('6372921375874657752')  ORDER BY wo.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 10:59:30
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:59:30
Text:	--加工进度滞后
                           select op.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,op.DistributionTime,op.FinishProcessingDateTime from TbOrderProgress op 
                           left join TbCompany cp1 on op.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on op.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(op.DistributionTime)= @Year and MONTH(op.DistributionTime)= @Month
                           and (op.FinishProcessingDateTime>op.DistributionTime or (GETDATE()>op.DistributionTime and op.FinishProcessingDateTime is null))  and op.ProjectId='6372912251695766465' and op.ProcessFactoryCode='6386683729561128960' and op.SiteCode in('6372921375874657752') ORDER BY op.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 10:59:30
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:59:30
Text:	--配送超期
                           select dpi.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,dpi.DistributionTime,dpi.DeliveryCompleteTime,dpi.Remark from TbDistributionPlanInfo dpi
                           left join TbCompany cp1 on dpi.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on dpi.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(dpi.DistributionTime)= @Year and MONTH(dpi.DistributionTime)= @Month
                           and (dpi.DeliveryCompleteTime>dpi.DistributionTime or (GETDATE()>dpi.DistributionTime and dpi.DeliveryCompleteTime is null))  and dpi.ProjectId='6372912251695766465' and dpi.ProcessFactoryCode='6386683729561128960' and dpi.SiteCode in('6372921375874657752') ORDER BY dpi.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 10:59:30
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:59:30
Text:	select TbYj.*,cp1.CompanyFullName as SiteName,tcr.EnterSpaceTime,tcr.StartDischargeTime,tcr.EndDischargeTime,disEnt.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SiteDischargeCargo' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbTransportCarReport tcr on TbYj.EWFormDataCode=tcr.DisEntOrderId
                           left join TbDistributionEnt disEnt on tcr.DistributionCode=disEnt.DistributionCode
                           left join TbCompany cp on disEnt.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and disEnt.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ORDER BY tcr.EnterSpaceTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 10:59:30
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:59:30
Text:	select TbYj.*,cp1.CompanyFullName as SiteName,sfs.DistributionCode,sdc.DistributionTime,sfs.SigninTime,sfs.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SemiFinishedSign' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbSemiFinishedSign sfs on TbYj.EWFormDataCode=sfs.ID
                           left join TbSiteDischargeCargo sdc on sfs.DistributionCode=sdc.DistributionCode and sfs.DischargeCargoCode=sdc.DischargeCargoCode
                           left join TbCompany cp on sfs.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month and TbYj.ProjectId='6372912251695766465' and sfs.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752')	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 10:59:31
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:59:31
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 10:59:31
Text:	
                        select fewoi.DataCode as OddNumbers,
                         fewoi.EarlyWarningContent,
                         fewoi.EWFormDataCode,
                         CONVERT(varchar(100), fewoi.EarlyWarningTime, 120) as EarlyWarningTime,
                         EWFormCode,sm.MenuName,fn.FlowNodeName,cp1.CompanyFullName as BranchName,
                         cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,
                         u1.UserName as FlowSpUserName,u2.UserName as FlowYjUserName 
                        FROM (
                        select*
                           FROM ( 
                        		SELECT a.*, row_number()over(partition BY a.FlowCode ORDER BY a.FlowNodeCode,a.EarlyWarningTime desc) as group_idx 
                        		FROM TbFlowEarlyWarningOtherInfo  a
                        		INNER JOIN  TbFlowEarlyWarningInfo b ON a.FlowCode=b.FlowCode 
                        		AND a.EWFormDataCode=b.EWFormDataCode AND a.FlowNodeCode=b.FlowNodeCode 
                        		WHERE YEAR(a.EarlyWarningTime)= @Year and MONTH(a.EarlyWarningTime)= @Month AND b.EarlyWarningStart=0
                           ) ret
                        WHERE ret.group_idx =1
                        ) fewoi
                        left join TbFlowNode fn on fewoi.FlowCode=fn.FlowCode and fewoi.FlowNodeCode=fn.FlowNodeCode
                        left join TbSysMenu sm on fewoi.EWFormCode=sm.MenuCode
                        left join TbCompany cp1 on fewoi.BranchCode=cp1.CompanyCode
                        left join TbCompany cp2 on fewoi.WorkAreaCode=cp2.CompanyCode
                        left join TbCompany cp3 on fewoi.SiteCode=cp3.CompanyCode
                        left join TbCompany cp4 on fewoi.ProcessFactoryCode=cp4.CompanyCode
                        left join TbUser u1 on fewoi.FlowSpUserCode=u1.UserId
                        left join TbUser u2 on fewoi.FlowYjUserCode=u2.UserId where 1=1 and fewoi.ProjectId='6372912251695766465' and fewoi.ProcessFactoryCode='6386683729561128960' and (fewoi.SiteCode in('6372921375874657752') or fewoi.WorkAreaCode in('6372921396045311451','6372921398380745033')) ORDER BY fewoi.EarlyWarningTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 10:59:31
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:59:31
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 10:59:31
Text:	--原材料供货超时
                           select BatchPlanNum,cp1.CompanyFullName as BranchName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,sup.SupplyDate,sup.SupplyCompleteTime,sup.ProjectId,sup.Remarks from TbSupplyList sup
                           left join TbCompany cp1 on cp1.CompanyCode=sup.BranchCode
                           left join TbCompany cp2 on cp2.CompanyCode=sup.WorkAreaCode
                           left join TbCompany cp3 on cp3.CompanyCode=sup.SiteCode
                           left join TbCompany cp4 on cp4.CompanyCode=sup.ProcessFactoryCode
                           where YEAR(sup.SupplyDate)= @Year and MONTH(sup.SupplyDate)= @Month
                           and (sup.SupplyCompleteTime>sup.SupplyDate or (GETDATE()>sup.SupplyDate and sup.SupplyCompleteTime is null))  and sup.ProjectId='6372912251695766465' and sup.ProcessFactoryCode='6386683729561128960' and (sup.SiteCode in('6372921375874657752') or sup.WorkAreaCode in('6372921396045311451','6372921398380745033'))	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 10:59:32
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:59:32
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:59:32
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode209) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode210))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState211)) 	
Parameters:
@ProcessFactoryCode209[String] = 6386683729561128960
@SiteCode210[String] = 6372921375874657752
@ProcessingState211[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-14 10:59:32
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-14 10:59:32
Text:	 SELECT   [TbOrderProgress].[ProcessingState],[TbOrderProgress].[OrderCode],[TbOrderProgress].[FinishProcessingDateTime],[TbOrderProgress].[DistributionTime],[TbOrderProgress].[SiteCode] FROM [TbOrderProgress]  WHERE ((([TbOrderProgress].[SiteCode] IN (@SiteCode207)) AND ([TbOrderProgress].[ProcessFactoryCode] = @ProcessFactoryCode208)) AND ((YEAR(DistributionTime)=2020 and MONTH(DistributionTime)=7) or (DistributionTime<'2020/7/1 0:00:00' and (ProcessingState!='Finishing')))) 	
Parameters:
@SiteCode207[String] = 6372921375874657752
@ProcessFactoryCode208[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 10:59:32
Text:	 SELECT   * FROM [TbWorkOrderDetail]  WHERE (1=2) AND ([TbWorkOrderDetail].[DaetailWorkStrat] = @DaetailWorkStrat212) 	
Parameters:
@DaetailWorkStrat212[String] = 未加工


-----------------------------------------------------------------------------
2020-07-14 10:59:32
Text:	 SELECT   [TbOrderProgress].[WeightTotal] AS [TotalWeight],[TbCompany].[ParentCompanyCode] FROM [TbOrderProgress] LEFT OUTER JOIN [TbCompany] ON ([TbOrderProgress].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((1=2) AND ([TbOrderProgress].[ProcessingState] <> @ProcessingState213)) AND ((([TbOrderProgress].[FinishProcessingDateTime] is not null ) AND ([TbOrderProgress].[DistributionTime] < [TbOrderProgress].[FinishProcessingDateTime])) OR (([TbOrderProgress].[FinishProcessingDateTime] is null ) AND ([TbOrderProgress].[DistributionTime] < @DistributionTime214)))) 	
Parameters:
@ProcessingState213[String] = Finishing
@DistributionTime214[DateTime] = 2020/7/14 0:00:00


-----------------------------------------------------------------------------
2020-07-14 10:59:32
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:59:32
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 10:59:32
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:59:32
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 10:59:32
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:59:32
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 10:59:32
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:59:32
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:59:32
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:59:32
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:59:32
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:59:32
Text:	SELECT 
                            '审批超时' as YjTypeName,COUNT(1) as YjNum
                            FROM (
									SELECT a.*, row_number()over(partition BY a.FlowCode ORDER BY a.FlowNodeCode,a.EarlyWarningTime desc) as group_idx 
									FROM TbFlowEarlyWarningOtherInfo  a
									INNER JOIN  TbFlowEarlyWarningInfo b ON a.FlowCode=b.FlowCode 
									AND a.EWFormDataCode=b.EWFormDataCode AND a.FlowNodeCode=b.FlowNodeCode 
									WHERE  b.EarlyWarningStart=0 AND YEAR(a.EarlyWarningTime)= @Year and MONTH(a.EarlyWarningTime)= @Month  and a.ProjectId='6372912251695766465' and a.ProcessFactoryCode='6386683729561128960' and (a.SiteCode in('6372921375874657752') or a.WorkAreaCode in('6372921396045311451','6372921398380745033'))
							   ) Tb1
                            WHERE Tb1.group_idx =1
                           union all
                            select '未报月度需求计划' as YjTypeName,COUNT(1)as YjNum
                             FROM ( 
                                  SELECT *, row_number()over(partition BY EarlyWarningCode,EWFormDataCode ORDER BY EWNodeCode,EWTime desc) as group_idx 
                                  FROM TbFormEarlyWarningNodeInfo fwqi
                                  WHERE fwqi.MenuCode='RawMonthDemandPlan' AND fwqi.EWStart=0 AND YEAR(fwqi.EWTime)= @Year and MONTH(fwqi.EWTime)= @Month  and fwqi.ProjectId='6372912251695766465' and (fwqi.SiteCode in('6372921375874657752') or fwqi.WorkArea in('6372921396045311451','6372921398380745033'))  
                             ) Tb2
                             WHERE Tb2.group_idx =1
                           union all
                           select '原材料供货超时' as YjTypeName,COUNT(1) as YjNum from (
                           select BatchPlanNum,cp1.CompanyFullName as BranchName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,sup.SupplyDate,sup.SupplyCompleteTime,sup.ProjectId from TbSupplyList sup
                           left join TbCompany cp1 on cp1.CompanyCode=sup.BranchCode
                           left join TbCompany cp2 on cp2.CompanyCode=sup.WorkAreaCode
                           left join TbCompany cp3 on cp3.CompanyCode=sup.SiteCode
                           left join TbCompany cp4 on cp4.CompanyCode=sup.ProcessFactoryCode
                           where (sup.SupplyCompleteTime>sup.SupplyDate or (GETDATE()>sup.SupplyDate and sup.SupplyCompleteTime is null))
						   and YEAR(sup.SupplyDate)= @Year and MONTH(sup.SupplyDate)= @Month  and sup.ProjectId='6372912251695766465' and sup.ProcessFactoryCode='6386683729561128960' and (sup.SiteCode in('6372921375874657752') or sup.WorkAreaCode in('6372921396045311451','6372921398380745033'))) Tb3
                           union all
                           select '加急订单' as YjTypeName,COUNT(1) as YjNum from (--加急订单个数
                           select wo.OrderCode,wo.DistributionTime,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName from TbWorkOrder wo
                           left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on wo.ProcessFactoryCode=cp2.CompanyCode
                           where UrgentDegree='Urgent' 
						   and YEAR(wo.DistributionTime)= @Year and MONTH(wo.DistributionTime)= @Month  and wo.ProjectId='6372912251695766465' and wo.ProcessFactoryCode='6386683729561128960' and wo.SiteCode in('6372921375874657752') ) Tb4
                           union all
                           select '加工进度滞后' as YjTypeName,COUNT(1) as YjNum from (--加工进度滞后
                           select op.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,op.DistributionTime,op.FinishProcessingDateTime from TbOrderProgress op 
                           left join TbCompany cp1 on op.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on op.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(op.DistributionTime)= @Year and MONTH(op.DistributionTime)= @Month
                           and (op.FinishProcessingDateTime>op.DistributionTime or (GETDATE()>op.DistributionTime and op.FinishProcessingDateTime is null))  and op.ProjectId='6372912251695766465' and op.ProcessFactoryCode='6386683729561128960' and op.SiteCode in('6372921375874657752') ) Tb5
                           union all
                           select '接收配送超期' as YjTypeName,COUNT(1) as YjNum from (--配送超期
                           select dpi.OrderCode,cp1.CompanyFullName as SIteName,cp2.CompanyFullName as ProcessFactoryName,dpi.DistributionTime,dpi.DeliveryCompleteTime from TbDistributionPlanInfo dpi
                           left join TbCompany cp1 on dpi.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on dpi.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(dpi.DistributionTime)= @Year and MONTH(dpi.DistributionTime)= @Month
                           and (dpi.DeliveryCompleteTime>dpi.DistributionTime or (GETDATE()>dpi.DistributionTime and dpi.DeliveryCompleteTime is null))  and dpi.ProjectId='6372912251695766465' and dpi.ProcessFactoryCode='6386683729561128960' and dpi.SiteCode in('6372921375874657752') ) Tb6 
                           union all
                           select '卸货超时' as YjTypeName,COUNT(1) as YjNum from(--卸货超时
                           select TbYj.*,cp1.CompanyFullName as SiteName,tcr.EnterSpaceTime,tcr.StartDischargeTime,tcr.EndDischargeTime,disEnt.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SiteDischargeCargo' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbTransportCarReport tcr on TbYj.EWFormDataCode=tcr.DisEntOrderId
                           left join TbDistributionEnt disEnt on tcr.DistributionCode=disEnt.DistributionCode
                           left join TbCompany cp on disEnt.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and disEnt.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ) Tb7
                           union all
                           select '签收超时' as YjTypeName,COUNT(1) as YjNum from (select TbYj.*,cp1.CompanyFullName as SiteName,sfs.DistributionCode,sdc.DistributionTime,sfs.SigninTime,sfs.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SemiFinishedSign' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbSemiFinishedSign sfs on TbYj.EWFormDataCode=sfs.ID
                           left join TbSiteDischargeCargo sdc on sfs.DistributionCode=sdc.DistributionCode and sfs.DischargeCargoCode=sdc.DischargeCargoCode
                           left join TbCompany cp on sfs.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and sfs.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ) Tb8	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 10:59:33
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 10:59:33
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode215) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode216,@WorkAreaCode217))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus218) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth219))) 	
Parameters:
@ProcessFactoryCode215[String] = 6386683729561128960
@WorkAreaCode216[String] = 6372921396045311451
@WorkAreaCode217[String] = 6372921398380745033
@Examinestatus218[String] = 审核完成
@DemandMonth219[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-14 10:59:36
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 10:59:36
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-14 10:59:36
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 10:59:36
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 10:59:36
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 10:59:36
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-14 10:59:36
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 10:59:36
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:59:36
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 10:59:36
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-14 10:59:36
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 10:59:37
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 10:59:37
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 10:59:37
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 10:59:37
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 10:59:37
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 10:59:37
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/InOrder/Index


-----------------------------------------------------------------------------
2020-07-14 10:59:37
Text:	 SELECT count(*) as r_cnt FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode]) WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode220)	
Parameters:
@ProcessFactoryCode220[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 10:59:37
Text:	 SELECT   TOP 50 [TbStockTaking].[ID],[TbStockTaking].[TakNum],[TbStockTaking].[TakDay],[TbStockTaking].[TotalInventory],[TbStockTaking].[TotalTak],[TbStockTaking].[TotalEarnOrLos],[TbStockTaking].[EarnOrLos],[TbStockTaking].[Remarks],[TbStockTaking].[InsertUserCode],[TbStockTaking].[InsertTime],[TbUser].[UserName],[TbCompany].[CompanyFullName] AS [FactoryName],[TbSysDictionaryData].[DictionaryText] AS [WarehouseTypeName] FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode])  WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode220) ORDER BY [TbStockTaking].[ID] DESC 	
Parameters:
@ProcessFactoryCode220[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 10:59:37
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 10:59:38
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 10:59:38
Text:	select Tb.DataMonth,ISNULL(sum(TbData.InorderCount),0) as InCount,ISNULL(sum(TbData.InCount),0) as InWeight from (select datepart(MONTH,dateadd(mm,-t.number,getdate())) as DataMonth
from
(select number from master..spt_values where type='P') t
where year(dateadd(mm,-t.number,getdate()))=year(getdate())) Tb 
left join (select COUNT(1) as InorderCount,SUM(a.InCount) as InCount,a.RebarType,datepart(year,a.InsertTime) InsertYear,datepart(MONTH,a.InsertTime) InsertMonth from TbInOrder a 
left join TbStorage b on a.StorageCode=b.StorageCode
where a.Examinestatus!='已退回' 
and a.Examinestatus!='已撤销' 
and datepart(year,a.InsertTime)=datepart(year,GETDATE())  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
group by a.RebarType,datepart(year,a.InsertTime),datepart(MONTH,a.InsertTime)) TbData on  Tb.DataMonth=TbData.InsertMonth
group by Tb.DataMonth order by Tb.DataMonth asc 	


-----------------------------------------------------------------------------
2020-07-14 10:59:38
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 10:59:38
Text:	select TbType.InType,isnull(TbData.InCount,0) as InCount from (select '入库单数' as InType
                           union all
                           select '未取样' as InType
                           union all
                           select '验收不合格' as InType
                           union all
                           select '检测部分合格' as InType
                           union all
                           select '检测不合格' as InType) TbType
                           left join(select '入库单数' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode 
                           where 1=1 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '未取样' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1 and a.SampleOrderState='取样未完成' and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '验收不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and NoPassTotal>0 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测部分合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=3 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=2 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')) TbData on TbType.InType=TbData.InType	


-----------------------------------------------------------------------------
2020-07-14 10:59:38
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 10:59:38
Text:	select Tb.GhType,sum(Tb.GhWeight) as GhWeight,sum(tb.GhCount) as GhCount from (select TbGhType.GhType,isnull(TbGhInfo.HasSupplier,0) as GhWeight,isnull(TbGhInfo.GhCount,0) as GhCount from (select '供货' as GhType
                            union all
                            select '验收不合格' as GhType
                            union all
                            select '检测不合格' as GhType) TbGhType
                            left join(
                            --供货次数、总量
                            select isnull(sum(Tb.HasSupplier),0) as HasSupplier,isnull(sum(Tb.GhCount),0) as GhCount,'供货' as GhType from (select a.HasSupplier,isnull(b.GhCount,0) as GhCount from (select a.BatchPlanNum,sum(a.HasSupplier) as HasSupplier from TbSupplyListDetail a 
                            left join TbSupplyList s on a.BatchPlanNum=s.BatchPlanNum where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')
                            GROUP BY a.BatchPlanNum) a
                            left join(select Tb.BatchPlanNum,count(1) as GhCount from (select BatchPlanNum,ThisTime from TbSupplyListDetailHistory
                            group by BatchPlanNum,ThisTime) Tb group by Tb.BatchPlanNum) b on a.BatchPlanNum=b.BatchPlanNum) Tb 
                            union all
                            --验收不合格次数、验收不合格重量
                            select sum(TbSum.NoPass) as NoPass,sum(TbSum.YsNoPassCount) as YsNoPassCount,'验收不合格' as GhType from (select count(1) as YsNoPassCount,sum(Tb.NoPass) as NoPass from (select b.BatchPlanCode,c.ThisTime,sum(a.NoPass) as NoPass from TbInOrderItem a
                            left join TbInOrder b on a.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            left join TbSupplyListDetailHistory c on a.BatchPlanItemNewCode=c.BatchPlanItemNewCode
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033') and a.BatchPlanItemNewCode is not null and a.NoPass>0 
                            group by b.BatchPlanCode,c.ThisTime) Tb group by Tb.BatchPlanCode) TbSum
                            union all
                            --检测不合格次数、重量
                            select isnull(sum(Tb.JcNoPass),0) as JcNoPass,count(1) as JcNoPassCount,'检测不合格' as GhType from (select b.BatchPlanCode,d.ThisTime,Isnull(sum(c.PassCount),0) as JcNoPass from TbSampleOrderItem a
                            left join TbSampleOrder e on a.SampleOrderCode=e.SampleOrderCode
                            left join TbInOrderItem c on a.InOrderItemId=c.ID
                            left join TbSupplyListDetailHistory d on c.BatchPlanItemNewCode=d.BatchPlanItemNewCode
                            left join TbInOrder b on c.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')  and a.ChackState=2 and c.BatchPlanItemNewCode is not null
                            group by b.BatchPlanCode,d.ThisTime) Tb group by Tb.BatchPlanCode) TbGhInfo on TbGhType.GhType=TbGhInfo.GhType) Tb group by Tb.GhType	


-----------------------------------------------------------------------------
2020-07-14 10:59:38
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 10:59:38
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/StockTaking/Index


-----------------------------------------------------------------------------
2020-07-14 10:59:38
Text:	select * from TbSysDictionaryData where 1=1 and FDictionaryCode=@name order by DictionaryOrder asc	
Parameters:
@name[String] = MaterialType


-----------------------------------------------------------------------------
2020-07-14 10:59:38
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:00:55
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:00:55
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/StockTaking/Index


-----------------------------------------------------------------------------
2020-07-14 11:00:55
Text:	 SELECT count(*) as r_cnt FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode]) WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode221)	
Parameters:
@ProcessFactoryCode221[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:00:55
Text:	 SELECT   TOP 50 [TbStockTaking].[ID],[TbStockTaking].[TakNum],[TbStockTaking].[TakDay],[TbStockTaking].[TotalInventory],[TbStockTaking].[TotalTak],[TbStockTaking].[TotalEarnOrLos],[TbStockTaking].[EarnOrLos],[TbStockTaking].[Remarks],[TbStockTaking].[InsertUserCode],[TbStockTaking].[InsertTime],[TbUser].[UserName],[TbCompany].[CompanyFullName] AS [FactoryName],[TbSysDictionaryData].[DictionaryText] AS [WarehouseTypeName] FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode])  WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode221) ORDER BY [TbStockTaking].[ID] DESC 	
Parameters:
@ProcessFactoryCode221[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:00:55
Text:	select * from TbSysDictionaryData where 1=1 and FDictionaryCode=@name order by DictionaryOrder asc	
Parameters:
@name[String] = MaterialType


-----------------------------------------------------------------------------
2020-07-14 11:01:06
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:01:06
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/InOrder/Index


-----------------------------------------------------------------------------
2020-07-14 11:01:06
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:01:06
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:01:06
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:01:06
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:01:06
Text:	select ino.*,case when ISNULL(ino.ChackResult,0)=0 then '' when ISNULL(ino.ChackResult,0)=1 then '合格' when ISNULL(ino.ChackResult,0)=2 then '不合格' when ISNULL(ino.ChackResult,0)=3 then '部分合格' end ChackResultName,ur.UserName,ur1.UserName as DeliverUser,st.StorageName,sdd.DictionaryText as RebarTypeName,sp.SupplierName,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as BranchName,case when rmsp.DemandPlanCode is null then fbnp.RawMaterialDemandNum else rmsp.DemandPlanCode end DemandPlanCode,inoi.IsTh,sap.NoJcBhgCount from TbInOrder ino
							left join(select '退回' as IsTh,InOrderCode from TbInOrderItem where ReturnTime is not null group by InOrderCode) inoi on ino.InOrderCode=inoi.InOrderCode
                            left join TbUser ur on ino.InsertUserCode=ur.UserCode
                            left join TbUser ur1 on ino.UserCode=ur1.UserCode
                            left join TbStorage st on ino.StorageCode=st.StorageCode
                            left join TbSysDictionaryData sdd on ino.RebarType=sdd.DictionaryCode
                            left join TbCompany cp1 on ino.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on ino.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbSupplier sp on ino.SupplierCode=sp.SupplierCode
                            left join TbFactoryBatchNeedPlan fbnp on ino.BatchPlanCode=fbnp.BatchPlanNum
							left join TbRawMaterialMonthDemandSupplyPlan rmsp on fbnp.RawMaterialDemandNum=rmsp.SupplyPlanCode
							left join (	select a.InOrderCode,SUM(c.PassCount) as NoJcBhgCount from TbSampleOrder a
							left join TbSampleOrderItem b on a.SampleOrderCode=b.SampleOrderCode
							left join TbInOrderItem c on b.InOrderItemId=c.ID
							where b.ChackState=2 group by a.InOrderCode) sap on ino.InOrderCode=sap.InOrderCode where 1=1 and  ino.BatchPlanCode!='' and ino.BatchPlanCode is not null and (ino.SiteCode in('6372921375874657752') or ino.WorkAreaCode in('6372921396045311451','6372921398380745033')) and ino.ProjectId='6372912251695766465' and st.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-14 11:01:06
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by InOrderCode desc)AS Row, * from (select ino.*,case when ISNULL(ino.ChackResult,0)=0 then '' when ISNULL(ino.ChackResult,0)=1 then '合格' when ISNULL(ino.ChackResult,0)=2 then '不合格' when ISNULL(ino.ChackResult,0)=3 then '部分合格' end ChackResultName,ur.UserName,ur1.UserName as DeliverUser,st.StorageName,sdd.DictionaryText as RebarTypeName,sp.SupplierName,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as BranchName,case when rmsp.DemandPlanCode is null then fbnp.RawMaterialDemandNum else rmsp.DemandPlanCode end DemandPlanCode,inoi.IsTh,sap.NoJcBhgCount from TbInOrder ino
							left join(select '退回' as IsTh,InOrderCode from TbInOrderItem where ReturnTime is not null group by InOrderCode) inoi on ino.InOrderCode=inoi.InOrderCode
                            left join TbUser ur on ino.InsertUserCode=ur.UserCode
                            left join TbUser ur1 on ino.UserCode=ur1.UserCode
                            left join TbStorage st on ino.StorageCode=st.StorageCode
                            left join TbSysDictionaryData sdd on ino.RebarType=sdd.DictionaryCode
                            left join TbCompany cp1 on ino.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on ino.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbSupplier sp on ino.SupplierCode=sp.SupplierCode
                            left join TbFactoryBatchNeedPlan fbnp on ino.BatchPlanCode=fbnp.BatchPlanNum
							left join TbRawMaterialMonthDemandSupplyPlan rmsp on fbnp.RawMaterialDemandNum=rmsp.SupplyPlanCode
							left join (	select a.InOrderCode,SUM(c.PassCount) as NoJcBhgCount from TbSampleOrder a
							left join TbSampleOrderItem b on a.SampleOrderCode=b.SampleOrderCode
							left join TbInOrderItem c on b.InOrderItemId=c.ID
							where b.ChackState=2 group by a.InOrderCode) sap on ino.InOrderCode=sap.InOrderCode where 1=1 and  ino.BatchPlanCode!='' and ino.BatchPlanCode is not null and (ino.SiteCode in('6372921375874657752') or ino.WorkAreaCode in('6372921396045311451','6372921398380745033')) and ino.ProjectId='6372912251695766465' and st.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:01:06
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:01:06
Text:	select Tb.DataMonth,ISNULL(sum(TbData.InorderCount),0) as InCount,ISNULL(sum(TbData.InCount),0) as InWeight from (select datepart(MONTH,dateadd(mm,-t.number,getdate())) as DataMonth
from
(select number from master..spt_values where type='P') t
where year(dateadd(mm,-t.number,getdate()))=year(getdate())) Tb 
left join (select COUNT(1) as InorderCount,SUM(a.InCount) as InCount,a.RebarType,datepart(year,a.InsertTime) InsertYear,datepart(MONTH,a.InsertTime) InsertMonth from TbInOrder a 
left join TbStorage b on a.StorageCode=b.StorageCode
where a.Examinestatus!='已退回' 
and a.Examinestatus!='已撤销' 
and datepart(year,a.InsertTime)=datepart(year,GETDATE())  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
group by a.RebarType,datepart(year,a.InsertTime),datepart(MONTH,a.InsertTime)) TbData on  Tb.DataMonth=TbData.InsertMonth
group by Tb.DataMonth order by Tb.DataMonth asc 	


-----------------------------------------------------------------------------
2020-07-14 11:01:06
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:01:06
Text:	select TbType.InType,isnull(TbData.InCount,0) as InCount from (select '入库单数' as InType
                           union all
                           select '未取样' as InType
                           union all
                           select '验收不合格' as InType
                           union all
                           select '检测部分合格' as InType
                           union all
                           select '检测不合格' as InType) TbType
                           left join(select '入库单数' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode 
                           where 1=1 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '未取样' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1 and a.SampleOrderState='取样未完成' and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '验收不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and NoPassTotal>0 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测部分合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=3 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=2 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')) TbData on TbType.InType=TbData.InType	


-----------------------------------------------------------------------------
2020-07-14 11:01:06
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:01:06
Text:	select Tb.GhType,sum(Tb.GhWeight) as GhWeight,sum(tb.GhCount) as GhCount from (select TbGhType.GhType,isnull(TbGhInfo.HasSupplier,0) as GhWeight,isnull(TbGhInfo.GhCount,0) as GhCount from (select '供货' as GhType
                            union all
                            select '验收不合格' as GhType
                            union all
                            select '检测不合格' as GhType) TbGhType
                            left join(
                            --供货次数、总量
                            select isnull(sum(Tb.HasSupplier),0) as HasSupplier,isnull(sum(Tb.GhCount),0) as GhCount,'供货' as GhType from (select a.HasSupplier,isnull(b.GhCount,0) as GhCount from (select a.BatchPlanNum,sum(a.HasSupplier) as HasSupplier from TbSupplyListDetail a 
                            left join TbSupplyList s on a.BatchPlanNum=s.BatchPlanNum where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')
                            GROUP BY a.BatchPlanNum) a
                            left join(select Tb.BatchPlanNum,count(1) as GhCount from (select BatchPlanNum,ThisTime from TbSupplyListDetailHistory
                            group by BatchPlanNum,ThisTime) Tb group by Tb.BatchPlanNum) b on a.BatchPlanNum=b.BatchPlanNum) Tb 
                            union all
                            --验收不合格次数、验收不合格重量
                            select sum(TbSum.NoPass) as NoPass,sum(TbSum.YsNoPassCount) as YsNoPassCount,'验收不合格' as GhType from (select count(1) as YsNoPassCount,sum(Tb.NoPass) as NoPass from (select b.BatchPlanCode,c.ThisTime,sum(a.NoPass) as NoPass from TbInOrderItem a
                            left join TbInOrder b on a.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            left join TbSupplyListDetailHistory c on a.BatchPlanItemNewCode=c.BatchPlanItemNewCode
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033') and a.BatchPlanItemNewCode is not null and a.NoPass>0 
                            group by b.BatchPlanCode,c.ThisTime) Tb group by Tb.BatchPlanCode) TbSum
                            union all
                            --检测不合格次数、重量
                            select isnull(sum(Tb.JcNoPass),0) as JcNoPass,count(1) as JcNoPassCount,'检测不合格' as GhType from (select b.BatchPlanCode,d.ThisTime,Isnull(sum(c.PassCount),0) as JcNoPass from TbSampleOrderItem a
                            left join TbSampleOrder e on a.SampleOrderCode=e.SampleOrderCode
                            left join TbInOrderItem c on a.InOrderItemId=c.ID
                            left join TbSupplyListDetailHistory d on c.BatchPlanItemNewCode=d.BatchPlanItemNewCode
                            left join TbInOrder b on c.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')  and a.ChackState=2 and c.BatchPlanItemNewCode is not null
                            group by b.BatchPlanCode,d.ThisTime) Tb group by Tb.BatchPlanCode) TbGhInfo on TbGhType.GhType=TbGhInfo.GhType) Tb group by Tb.GhType	


-----------------------------------------------------------------------------
2020-07-14 11:01:10
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:01:11
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/InOrder/Index


-----------------------------------------------------------------------------
2020-07-14 11:01:11
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:01:11
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:01:11
Text:	select ino.*,case when ISNULL(ino.ChackResult,0)=0 then '' when ISNULL(ino.ChackResult,0)=1 then '合格' when ISNULL(ino.ChackResult,0)=2 then '不合格' when ISNULL(ino.ChackResult,0)=3 then '部分合格' end ChackResultName,ur.UserName,ur1.UserName as DeliverUser,st.StorageName,sdd.DictionaryText as RebarTypeName,sp.SupplierName,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as BranchName,case when rmsp.DemandPlanCode is null then fbnp.RawMaterialDemandNum else rmsp.DemandPlanCode end DemandPlanCode,inoi.IsTh,sap.NoJcBhgCount from TbInOrder ino
							left join(select '退回' as IsTh,InOrderCode from TbInOrderItem where ReturnTime is not null group by InOrderCode) inoi on ino.InOrderCode=inoi.InOrderCode
                            left join TbUser ur on ino.InsertUserCode=ur.UserCode
                            left join TbUser ur1 on ino.UserCode=ur1.UserCode
                            left join TbStorage st on ino.StorageCode=st.StorageCode
                            left join TbSysDictionaryData sdd on ino.RebarType=sdd.DictionaryCode
                            left join TbCompany cp1 on ino.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on ino.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbSupplier sp on ino.SupplierCode=sp.SupplierCode
                            left join TbFactoryBatchNeedPlan fbnp on ino.BatchPlanCode=fbnp.BatchPlanNum
							left join TbRawMaterialMonthDemandSupplyPlan rmsp on fbnp.RawMaterialDemandNum=rmsp.SupplyPlanCode
							left join (	select a.InOrderCode,SUM(c.PassCount) as NoJcBhgCount from TbSampleOrder a
							left join TbSampleOrderItem b on a.SampleOrderCode=b.SampleOrderCode
							left join TbInOrderItem c on b.InOrderItemId=c.ID
							where b.ChackState=2 group by a.InOrderCode) sap on ino.InOrderCode=sap.InOrderCode where 1=1 and  ino.BatchPlanCode!='' and ino.BatchPlanCode is not null and (ino.SiteCode in('6372921375874657752') or ino.WorkAreaCode in('6372921396045311451','6372921398380745033')) and ino.ProjectId='6372912251695766465' and st.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-14 11:01:11
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by InOrderCode desc)AS Row, * from (select ino.*,case when ISNULL(ino.ChackResult,0)=0 then '' when ISNULL(ino.ChackResult,0)=1 then '合格' when ISNULL(ino.ChackResult,0)=2 then '不合格' when ISNULL(ino.ChackResult,0)=3 then '部分合格' end ChackResultName,ur.UserName,ur1.UserName as DeliverUser,st.StorageName,sdd.DictionaryText as RebarTypeName,sp.SupplierName,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as BranchName,case when rmsp.DemandPlanCode is null then fbnp.RawMaterialDemandNum else rmsp.DemandPlanCode end DemandPlanCode,inoi.IsTh,sap.NoJcBhgCount from TbInOrder ino
							left join(select '退回' as IsTh,InOrderCode from TbInOrderItem where ReturnTime is not null group by InOrderCode) inoi on ino.InOrderCode=inoi.InOrderCode
                            left join TbUser ur on ino.InsertUserCode=ur.UserCode
                            left join TbUser ur1 on ino.UserCode=ur1.UserCode
                            left join TbStorage st on ino.StorageCode=st.StorageCode
                            left join TbSysDictionaryData sdd on ino.RebarType=sdd.DictionaryCode
                            left join TbCompany cp1 on ino.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on ino.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbSupplier sp on ino.SupplierCode=sp.SupplierCode
                            left join TbFactoryBatchNeedPlan fbnp on ino.BatchPlanCode=fbnp.BatchPlanNum
							left join TbRawMaterialMonthDemandSupplyPlan rmsp on fbnp.RawMaterialDemandNum=rmsp.SupplyPlanCode
							left join (	select a.InOrderCode,SUM(c.PassCount) as NoJcBhgCount from TbSampleOrder a
							left join TbSampleOrderItem b on a.SampleOrderCode=b.SampleOrderCode
							left join TbInOrderItem c on b.InOrderItemId=c.ID
							where b.ChackState=2 group by a.InOrderCode) sap on ino.InOrderCode=sap.InOrderCode where 1=1 and  ino.BatchPlanCode!='' and ino.BatchPlanCode is not null and (ino.SiteCode in('6372921375874657752') or ino.WorkAreaCode in('6372921396045311451','6372921398380745033')) and ino.ProjectId='6372912251695766465' and st.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:01:11
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:01:11
Text:	select Tb.DataMonth,ISNULL(sum(TbData.InorderCount),0) as InCount,ISNULL(sum(TbData.InCount),0) as InWeight from (select datepart(MONTH,dateadd(mm,-t.number,getdate())) as DataMonth
from
(select number from master..spt_values where type='P') t
where year(dateadd(mm,-t.number,getdate()))=year(getdate())) Tb 
left join (select COUNT(1) as InorderCount,SUM(a.InCount) as InCount,a.RebarType,datepart(year,a.InsertTime) InsertYear,datepart(MONTH,a.InsertTime) InsertMonth from TbInOrder a 
left join TbStorage b on a.StorageCode=b.StorageCode
where a.Examinestatus!='已退回' 
and a.Examinestatus!='已撤销' 
and datepart(year,a.InsertTime)=datepart(year,GETDATE())  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
group by a.RebarType,datepart(year,a.InsertTime),datepart(MONTH,a.InsertTime)) TbData on  Tb.DataMonth=TbData.InsertMonth
group by Tb.DataMonth order by Tb.DataMonth asc 	


-----------------------------------------------------------------------------
2020-07-14 11:01:11
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:01:11
Text:	select TbType.InType,isnull(TbData.InCount,0) as InCount from (select '入库单数' as InType
                           union all
                           select '未取样' as InType
                           union all
                           select '验收不合格' as InType
                           union all
                           select '检测部分合格' as InType
                           union all
                           select '检测不合格' as InType) TbType
                           left join(select '入库单数' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode 
                           where 1=1 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '未取样' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1 and a.SampleOrderState='取样未完成' and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '验收不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and NoPassTotal>0 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测部分合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=3 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=2 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')) TbData on TbType.InType=TbData.InType	


-----------------------------------------------------------------------------
2020-07-14 11:01:11
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:01:11
Text:	select Tb.GhType,sum(Tb.GhWeight) as GhWeight,sum(tb.GhCount) as GhCount from (select TbGhType.GhType,isnull(TbGhInfo.HasSupplier,0) as GhWeight,isnull(TbGhInfo.GhCount,0) as GhCount from (select '供货' as GhType
                            union all
                            select '验收不合格' as GhType
                            union all
                            select '检测不合格' as GhType) TbGhType
                            left join(
                            --供货次数、总量
                            select isnull(sum(Tb.HasSupplier),0) as HasSupplier,isnull(sum(Tb.GhCount),0) as GhCount,'供货' as GhType from (select a.HasSupplier,isnull(b.GhCount,0) as GhCount from (select a.BatchPlanNum,sum(a.HasSupplier) as HasSupplier from TbSupplyListDetail a 
                            left join TbSupplyList s on a.BatchPlanNum=s.BatchPlanNum where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')
                            GROUP BY a.BatchPlanNum) a
                            left join(select Tb.BatchPlanNum,count(1) as GhCount from (select BatchPlanNum,ThisTime from TbSupplyListDetailHistory
                            group by BatchPlanNum,ThisTime) Tb group by Tb.BatchPlanNum) b on a.BatchPlanNum=b.BatchPlanNum) Tb 
                            union all
                            --验收不合格次数、验收不合格重量
                            select sum(TbSum.NoPass) as NoPass,sum(TbSum.YsNoPassCount) as YsNoPassCount,'验收不合格' as GhType from (select count(1) as YsNoPassCount,sum(Tb.NoPass) as NoPass from (select b.BatchPlanCode,c.ThisTime,sum(a.NoPass) as NoPass from TbInOrderItem a
                            left join TbInOrder b on a.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            left join TbSupplyListDetailHistory c on a.BatchPlanItemNewCode=c.BatchPlanItemNewCode
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033') and a.BatchPlanItemNewCode is not null and a.NoPass>0 
                            group by b.BatchPlanCode,c.ThisTime) Tb group by Tb.BatchPlanCode) TbSum
                            union all
                            --检测不合格次数、重量
                            select isnull(sum(Tb.JcNoPass),0) as JcNoPass,count(1) as JcNoPassCount,'检测不合格' as GhType from (select b.BatchPlanCode,d.ThisTime,Isnull(sum(c.PassCount),0) as JcNoPass from TbSampleOrderItem a
                            left join TbSampleOrder e on a.SampleOrderCode=e.SampleOrderCode
                            left join TbInOrderItem c on a.InOrderItemId=c.ID
                            left join TbSupplyListDetailHistory d on c.BatchPlanItemNewCode=d.BatchPlanItemNewCode
                            left join TbInOrder b on c.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')  and a.ChackState=2 and c.BatchPlanItemNewCode is not null
                            group by b.BatchPlanCode,d.ThisTime) Tb group by Tb.BatchPlanCode) TbGhInfo on TbGhType.GhType=TbGhInfo.GhType) Tb group by Tb.GhType	


-----------------------------------------------------------------------------
2020-07-14 11:01:12
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:01:12
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:01:39
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:01:39
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/InOrder/Index


-----------------------------------------------------------------------------
2020-07-14 11:01:39
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:01:39
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:01:39
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:01:39
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:01:39
Text:	select ino.*,case when ISNULL(ino.ChackResult,0)=0 then '' when ISNULL(ino.ChackResult,0)=1 then '合格' when ISNULL(ino.ChackResult,0)=2 then '不合格' when ISNULL(ino.ChackResult,0)=3 then '部分合格' end ChackResultName,ur.UserName,ur1.UserName as DeliverUser,st.StorageName,sdd.DictionaryText as RebarTypeName,sp.SupplierName,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as BranchName,case when rmsp.DemandPlanCode is null then fbnp.RawMaterialDemandNum else rmsp.DemandPlanCode end DemandPlanCode,inoi.IsTh,sap.NoJcBhgCount from TbInOrder ino
							left join(select '退回' as IsTh,InOrderCode from TbInOrderItem where ReturnTime is not null group by InOrderCode) inoi on ino.InOrderCode=inoi.InOrderCode
                            left join TbUser ur on ino.InsertUserCode=ur.UserCode
                            left join TbUser ur1 on ino.UserCode=ur1.UserCode
                            left join TbStorage st on ino.StorageCode=st.StorageCode
                            left join TbSysDictionaryData sdd on ino.RebarType=sdd.DictionaryCode
                            left join TbCompany cp1 on ino.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on ino.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbSupplier sp on ino.SupplierCode=sp.SupplierCode
                            left join TbFactoryBatchNeedPlan fbnp on ino.BatchPlanCode=fbnp.BatchPlanNum
							left join TbRawMaterialMonthDemandSupplyPlan rmsp on fbnp.RawMaterialDemandNum=rmsp.SupplyPlanCode
							left join (	select a.InOrderCode,SUM(c.PassCount) as NoJcBhgCount from TbSampleOrder a
							left join TbSampleOrderItem b on a.SampleOrderCode=b.SampleOrderCode
							left join TbInOrderItem c on b.InOrderItemId=c.ID
							where b.ChackState=2 group by a.InOrderCode) sap on ino.InOrderCode=sap.InOrderCode where 1=1 and  ino.BatchPlanCode!='' and ino.BatchPlanCode is not null and (ino.SiteCode in('6372921375874657752') or ino.WorkAreaCode in('6372921396045311451','6372921398380745033')) and ino.ProjectId='6372912251695766465' and st.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-14 11:01:39
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by InOrderCode desc)AS Row, * from (select ino.*,case when ISNULL(ino.ChackResult,0)=0 then '' when ISNULL(ino.ChackResult,0)=1 then '合格' when ISNULL(ino.ChackResult,0)=2 then '不合格' when ISNULL(ino.ChackResult,0)=3 then '部分合格' end ChackResultName,ur.UserName,ur1.UserName as DeliverUser,st.StorageName,sdd.DictionaryText as RebarTypeName,sp.SupplierName,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as BranchName,case when rmsp.DemandPlanCode is null then fbnp.RawMaterialDemandNum else rmsp.DemandPlanCode end DemandPlanCode,inoi.IsTh,sap.NoJcBhgCount from TbInOrder ino
							left join(select '退回' as IsTh,InOrderCode from TbInOrderItem where ReturnTime is not null group by InOrderCode) inoi on ino.InOrderCode=inoi.InOrderCode
                            left join TbUser ur on ino.InsertUserCode=ur.UserCode
                            left join TbUser ur1 on ino.UserCode=ur1.UserCode
                            left join TbStorage st on ino.StorageCode=st.StorageCode
                            left join TbSysDictionaryData sdd on ino.RebarType=sdd.DictionaryCode
                            left join TbCompany cp1 on ino.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on ino.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbSupplier sp on ino.SupplierCode=sp.SupplierCode
                            left join TbFactoryBatchNeedPlan fbnp on ino.BatchPlanCode=fbnp.BatchPlanNum
							left join TbRawMaterialMonthDemandSupplyPlan rmsp on fbnp.RawMaterialDemandNum=rmsp.SupplyPlanCode
							left join (	select a.InOrderCode,SUM(c.PassCount) as NoJcBhgCount from TbSampleOrder a
							left join TbSampleOrderItem b on a.SampleOrderCode=b.SampleOrderCode
							left join TbInOrderItem c on b.InOrderItemId=c.ID
							where b.ChackState=2 group by a.InOrderCode) sap on ino.InOrderCode=sap.InOrderCode where 1=1 and  ino.BatchPlanCode!='' and ino.BatchPlanCode is not null and (ino.SiteCode in('6372921375874657752') or ino.WorkAreaCode in('6372921396045311451','6372921398380745033')) and ino.ProjectId='6372912251695766465' and st.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:01:39
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:01:39
Text:	select Tb.DataMonth,ISNULL(sum(TbData.InorderCount),0) as InCount,ISNULL(sum(TbData.InCount),0) as InWeight from (select datepart(MONTH,dateadd(mm,-t.number,getdate())) as DataMonth
from
(select number from master..spt_values where type='P') t
where year(dateadd(mm,-t.number,getdate()))=year(getdate())) Tb 
left join (select COUNT(1) as InorderCount,SUM(a.InCount) as InCount,a.RebarType,datepart(year,a.InsertTime) InsertYear,datepart(MONTH,a.InsertTime) InsertMonth from TbInOrder a 
left join TbStorage b on a.StorageCode=b.StorageCode
where a.Examinestatus!='已退回' 
and a.Examinestatus!='已撤销' 
and datepart(year,a.InsertTime)=datepart(year,GETDATE())  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
group by a.RebarType,datepart(year,a.InsertTime),datepart(MONTH,a.InsertTime)) TbData on  Tb.DataMonth=TbData.InsertMonth
group by Tb.DataMonth order by Tb.DataMonth asc 	


-----------------------------------------------------------------------------
2020-07-14 11:01:39
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:01:39
Text:	select TbType.InType,isnull(TbData.InCount,0) as InCount from (select '入库单数' as InType
                           union all
                           select '未取样' as InType
                           union all
                           select '验收不合格' as InType
                           union all
                           select '检测部分合格' as InType
                           union all
                           select '检测不合格' as InType) TbType
                           left join(select '入库单数' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode 
                           where 1=1 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '未取样' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1 and a.SampleOrderState='取样未完成' and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '验收不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and NoPassTotal>0 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测部分合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=3 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=2 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')) TbData on TbType.InType=TbData.InType	


-----------------------------------------------------------------------------
2020-07-14 11:01:40
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:01:40
Text:	select Tb.GhType,sum(Tb.GhWeight) as GhWeight,sum(tb.GhCount) as GhCount from (select TbGhType.GhType,isnull(TbGhInfo.HasSupplier,0) as GhWeight,isnull(TbGhInfo.GhCount,0) as GhCount from (select '供货' as GhType
                            union all
                            select '验收不合格' as GhType
                            union all
                            select '检测不合格' as GhType) TbGhType
                            left join(
                            --供货次数、总量
                            select isnull(sum(Tb.HasSupplier),0) as HasSupplier,isnull(sum(Tb.GhCount),0) as GhCount,'供货' as GhType from (select a.HasSupplier,isnull(b.GhCount,0) as GhCount from (select a.BatchPlanNum,sum(a.HasSupplier) as HasSupplier from TbSupplyListDetail a 
                            left join TbSupplyList s on a.BatchPlanNum=s.BatchPlanNum where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')
                            GROUP BY a.BatchPlanNum) a
                            left join(select Tb.BatchPlanNum,count(1) as GhCount from (select BatchPlanNum,ThisTime from TbSupplyListDetailHistory
                            group by BatchPlanNum,ThisTime) Tb group by Tb.BatchPlanNum) b on a.BatchPlanNum=b.BatchPlanNum) Tb 
                            union all
                            --验收不合格次数、验收不合格重量
                            select sum(TbSum.NoPass) as NoPass,sum(TbSum.YsNoPassCount) as YsNoPassCount,'验收不合格' as GhType from (select count(1) as YsNoPassCount,sum(Tb.NoPass) as NoPass from (select b.BatchPlanCode,c.ThisTime,sum(a.NoPass) as NoPass from TbInOrderItem a
                            left join TbInOrder b on a.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            left join TbSupplyListDetailHistory c on a.BatchPlanItemNewCode=c.BatchPlanItemNewCode
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033') and a.BatchPlanItemNewCode is not null and a.NoPass>0 
                            group by b.BatchPlanCode,c.ThisTime) Tb group by Tb.BatchPlanCode) TbSum
                            union all
                            --检测不合格次数、重量
                            select isnull(sum(Tb.JcNoPass),0) as JcNoPass,count(1) as JcNoPassCount,'检测不合格' as GhType from (select b.BatchPlanCode,d.ThisTime,Isnull(sum(c.PassCount),0) as JcNoPass from TbSampleOrderItem a
                            left join TbSampleOrder e on a.SampleOrderCode=e.SampleOrderCode
                            left join TbInOrderItem c on a.InOrderItemId=c.ID
                            left join TbSupplyListDetailHistory d on c.BatchPlanItemNewCode=d.BatchPlanItemNewCode
                            left join TbInOrder b on c.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')  and a.ChackState=2 and c.BatchPlanItemNewCode is not null
                            group by b.BatchPlanCode,d.ThisTime) Tb group by Tb.BatchPlanCode) TbGhInfo on TbGhType.GhType=TbGhInfo.GhType) Tb group by Tb.GhType	


-----------------------------------------------------------------------------
2020-07-14 11:02:28
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:05:16
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:05:16
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-14 11:05:16
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:05:16
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:05:16
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:05:16
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-14 11:05:16
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:05:16
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:05:16
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:05:16
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:05:16
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-14 11:05:16
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:05:16
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:05:16
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:05:16
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:05:16
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:05:16
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/InOrder/Index


-----------------------------------------------------------------------------
2020-07-14 11:05:16
Text:	 SELECT count(*) as r_cnt FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode]) WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode222)	
Parameters:
@ProcessFactoryCode222[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:05:16
Text:	 SELECT   TOP 50 [TbStockTaking].[ID],[TbStockTaking].[TakNum],[TbStockTaking].[TakDay],[TbStockTaking].[TotalInventory],[TbStockTaking].[TotalTak],[TbStockTaking].[TotalEarnOrLos],[TbStockTaking].[EarnOrLos],[TbStockTaking].[Remarks],[TbStockTaking].[InsertUserCode],[TbStockTaking].[InsertTime],[TbUser].[UserName],[TbCompany].[CompanyFullName] AS [FactoryName],[TbSysDictionaryData].[DictionaryText] AS [WarehouseTypeName] FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode])  WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode222) ORDER BY [TbStockTaking].[ID] DESC 	
Parameters:
@ProcessFactoryCode222[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:05:17
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:05:17
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:05:17
Text:	select Tb.DataMonth,ISNULL(sum(TbData.InorderCount),0) as InCount,ISNULL(sum(TbData.InCount),0) as InWeight from (select datepart(MONTH,dateadd(mm,-t.number,getdate())) as DataMonth
from
(select number from master..spt_values where type='P') t
where year(dateadd(mm,-t.number,getdate()))=year(getdate())) Tb 
left join (select COUNT(1) as InorderCount,SUM(a.InCount) as InCount,a.RebarType,datepart(year,a.InsertTime) InsertYear,datepart(MONTH,a.InsertTime) InsertMonth from TbInOrder a 
left join TbStorage b on a.StorageCode=b.StorageCode
where a.Examinestatus!='已退回' 
and a.Examinestatus!='已撤销' 
and datepart(year,a.InsertTime)=datepart(year,GETDATE())  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
group by a.RebarType,datepart(year,a.InsertTime),datepart(MONTH,a.InsertTime)) TbData on  Tb.DataMonth=TbData.InsertMonth
group by Tb.DataMonth order by Tb.DataMonth asc 	


-----------------------------------------------------------------------------
2020-07-14 11:05:17
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:05:17
Text:	select TbType.InType,isnull(TbData.InCount,0) as InCount from (select '入库单数' as InType
                           union all
                           select '未取样' as InType
                           union all
                           select '验收不合格' as InType
                           union all
                           select '检测部分合格' as InType
                           union all
                           select '检测不合格' as InType) TbType
                           left join(select '入库单数' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode 
                           where 1=1 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '未取样' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1 and a.SampleOrderState='取样未完成' and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '验收不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and NoPassTotal>0 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测部分合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=3 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=2 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')) TbData on TbType.InType=TbData.InType	


-----------------------------------------------------------------------------
2020-07-14 11:05:17
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:05:17
Text:	select Tb.GhType,sum(Tb.GhWeight) as GhWeight,sum(tb.GhCount) as GhCount from (select TbGhType.GhType,isnull(TbGhInfo.HasSupplier,0) as GhWeight,isnull(TbGhInfo.GhCount,0) as GhCount from (select '供货' as GhType
                            union all
                            select '验收不合格' as GhType
                            union all
                            select '检测不合格' as GhType) TbGhType
                            left join(
                            --供货次数、总量
                            select isnull(sum(Tb.HasSupplier),0) as HasSupplier,isnull(sum(Tb.GhCount),0) as GhCount,'供货' as GhType from (select a.HasSupplier,isnull(b.GhCount,0) as GhCount from (select a.BatchPlanNum,sum(a.HasSupplier) as HasSupplier from TbSupplyListDetail a 
                            left join TbSupplyList s on a.BatchPlanNum=s.BatchPlanNum where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')
                            GROUP BY a.BatchPlanNum) a
                            left join(select Tb.BatchPlanNum,count(1) as GhCount from (select BatchPlanNum,ThisTime from TbSupplyListDetailHistory
                            group by BatchPlanNum,ThisTime) Tb group by Tb.BatchPlanNum) b on a.BatchPlanNum=b.BatchPlanNum) Tb 
                            union all
                            --验收不合格次数、验收不合格重量
                            select sum(TbSum.NoPass) as NoPass,sum(TbSum.YsNoPassCount) as YsNoPassCount,'验收不合格' as GhType from (select count(1) as YsNoPassCount,sum(Tb.NoPass) as NoPass from (select b.BatchPlanCode,c.ThisTime,sum(a.NoPass) as NoPass from TbInOrderItem a
                            left join TbInOrder b on a.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            left join TbSupplyListDetailHistory c on a.BatchPlanItemNewCode=c.BatchPlanItemNewCode
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033') and a.BatchPlanItemNewCode is not null and a.NoPass>0 
                            group by b.BatchPlanCode,c.ThisTime) Tb group by Tb.BatchPlanCode) TbSum
                            union all
                            --检测不合格次数、重量
                            select isnull(sum(Tb.JcNoPass),0) as JcNoPass,count(1) as JcNoPassCount,'检测不合格' as GhType from (select b.BatchPlanCode,d.ThisTime,Isnull(sum(c.PassCount),0) as JcNoPass from TbSampleOrderItem a
                            left join TbSampleOrder e on a.SampleOrderCode=e.SampleOrderCode
                            left join TbInOrderItem c on a.InOrderItemId=c.ID
                            left join TbSupplyListDetailHistory d on c.BatchPlanItemNewCode=d.BatchPlanItemNewCode
                            left join TbInOrder b on c.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')  and a.ChackState=2 and c.BatchPlanItemNewCode is not null
                            group by b.BatchPlanCode,d.ThisTime) Tb group by Tb.BatchPlanCode) TbGhInfo on TbGhType.GhType=TbGhInfo.GhType) Tb group by Tb.GhType	


-----------------------------------------------------------------------------
2020-07-14 11:05:17
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:05:17
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/StockTaking/Index


-----------------------------------------------------------------------------
2020-07-14 11:05:17
Text:	select * from TbSysDictionaryData where 1=1 and FDictionaryCode=@name order by DictionaryOrder asc	
Parameters:
@name[String] = MaterialType


-----------------------------------------------------------------------------
2020-07-14 11:05:17
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:05:28
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:05:41
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:05:41
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/InOrder/Index


-----------------------------------------------------------------------------
2020-07-14 11:05:41
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:05:41
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:05:41
Text:	select ino.*,case when ISNULL(ino.ChackResult,0)=0 then '' when ISNULL(ino.ChackResult,0)=1 then '合格' when ISNULL(ino.ChackResult,0)=2 then '不合格' when ISNULL(ino.ChackResult,0)=3 then '部分合格' end ChackResultName,ur.UserName,ur1.UserName as DeliverUser,st.StorageName,sdd.DictionaryText as RebarTypeName,sp.SupplierName,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as BranchName,case when rmsp.DemandPlanCode is null then fbnp.RawMaterialDemandNum else rmsp.DemandPlanCode end DemandPlanCode,inoi.IsTh,sap.NoJcBhgCount from TbInOrder ino
							left join(select '退回' as IsTh,InOrderCode from TbInOrderItem where ReturnTime is not null group by InOrderCode) inoi on ino.InOrderCode=inoi.InOrderCode
                            left join TbUser ur on ino.InsertUserCode=ur.UserCode
                            left join TbUser ur1 on ino.UserCode=ur1.UserCode
                            left join TbStorage st on ino.StorageCode=st.StorageCode
                            left join TbSysDictionaryData sdd on ino.RebarType=sdd.DictionaryCode
                            left join TbCompany cp1 on ino.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on ino.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbSupplier sp on ino.SupplierCode=sp.SupplierCode
                            left join TbFactoryBatchNeedPlan fbnp on ino.BatchPlanCode=fbnp.BatchPlanNum
							left join TbRawMaterialMonthDemandSupplyPlan rmsp on fbnp.RawMaterialDemandNum=rmsp.SupplyPlanCode
							left join (	select a.InOrderCode,SUM(c.PassCount) as NoJcBhgCount from TbSampleOrder a
							left join TbSampleOrderItem b on a.SampleOrderCode=b.SampleOrderCode
							left join TbInOrderItem c on b.InOrderItemId=c.ID
							where b.ChackState=2 group by a.InOrderCode) sap on ino.InOrderCode=sap.InOrderCode where 1=1 and  ino.BatchPlanCode!='' and ino.BatchPlanCode is not null and (ino.SiteCode in('6372921375874657752') or ino.WorkAreaCode in('6372921396045311451','6372921398380745033')) and ino.ProjectId='6372912251695766465' and st.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-14 11:05:41
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by InOrderCode desc)AS Row, * from (select ino.*,case when ISNULL(ino.ChackResult,0)=0 then '' when ISNULL(ino.ChackResult,0)=1 then '合格' when ISNULL(ino.ChackResult,0)=2 then '不合格' when ISNULL(ino.ChackResult,0)=3 then '部分合格' end ChackResultName,ur.UserName,ur1.UserName as DeliverUser,st.StorageName,sdd.DictionaryText as RebarTypeName,sp.SupplierName,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as BranchName,case when rmsp.DemandPlanCode is null then fbnp.RawMaterialDemandNum else rmsp.DemandPlanCode end DemandPlanCode,inoi.IsTh,sap.NoJcBhgCount from TbInOrder ino
							left join(select '退回' as IsTh,InOrderCode from TbInOrderItem where ReturnTime is not null group by InOrderCode) inoi on ino.InOrderCode=inoi.InOrderCode
                            left join TbUser ur on ino.InsertUserCode=ur.UserCode
                            left join TbUser ur1 on ino.UserCode=ur1.UserCode
                            left join TbStorage st on ino.StorageCode=st.StorageCode
                            left join TbSysDictionaryData sdd on ino.RebarType=sdd.DictionaryCode
                            left join TbCompany cp1 on ino.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on ino.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbSupplier sp on ino.SupplierCode=sp.SupplierCode
                            left join TbFactoryBatchNeedPlan fbnp on ino.BatchPlanCode=fbnp.BatchPlanNum
							left join TbRawMaterialMonthDemandSupplyPlan rmsp on fbnp.RawMaterialDemandNum=rmsp.SupplyPlanCode
							left join (	select a.InOrderCode,SUM(c.PassCount) as NoJcBhgCount from TbSampleOrder a
							left join TbSampleOrderItem b on a.SampleOrderCode=b.SampleOrderCode
							left join TbInOrderItem c on b.InOrderItemId=c.ID
							where b.ChackState=2 group by a.InOrderCode) sap on ino.InOrderCode=sap.InOrderCode where 1=1 and  ino.BatchPlanCode!='' and ino.BatchPlanCode is not null and (ino.SiteCode in('6372921375874657752') or ino.WorkAreaCode in('6372921396045311451','6372921398380745033')) and ino.ProjectId='6372912251695766465' and st.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:05:42
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:05:42
Text:	select Tb.DataMonth,ISNULL(sum(TbData.InorderCount),0) as InCount,ISNULL(sum(TbData.InCount),0) as InWeight from (select datepart(MONTH,dateadd(mm,-t.number,getdate())) as DataMonth
from
(select number from master..spt_values where type='P') t
where year(dateadd(mm,-t.number,getdate()))=year(getdate())) Tb 
left join (select COUNT(1) as InorderCount,SUM(a.InCount) as InCount,a.RebarType,datepart(year,a.InsertTime) InsertYear,datepart(MONTH,a.InsertTime) InsertMonth from TbInOrder a 
left join TbStorage b on a.StorageCode=b.StorageCode
where a.Examinestatus!='已退回' 
and a.Examinestatus!='已撤销' 
and datepart(year,a.InsertTime)=datepart(year,GETDATE())  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
group by a.RebarType,datepart(year,a.InsertTime),datepart(MONTH,a.InsertTime)) TbData on  Tb.DataMonth=TbData.InsertMonth
group by Tb.DataMonth order by Tb.DataMonth asc 	


-----------------------------------------------------------------------------
2020-07-14 11:05:42
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:05:42
Text:	select TbType.InType,isnull(TbData.InCount,0) as InCount from (select '入库单数' as InType
                           union all
                           select '未取样' as InType
                           union all
                           select '验收不合格' as InType
                           union all
                           select '检测部分合格' as InType
                           union all
                           select '检测不合格' as InType) TbType
                           left join(select '入库单数' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode 
                           where 1=1 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '未取样' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1 and a.SampleOrderState='取样未完成' and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '验收不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and NoPassTotal>0 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测部分合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=3 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=2 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')) TbData on TbType.InType=TbData.InType	


-----------------------------------------------------------------------------
2020-07-14 11:05:42
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:05:42
Text:	select Tb.GhType,sum(Tb.GhWeight) as GhWeight,sum(tb.GhCount) as GhCount from (select TbGhType.GhType,isnull(TbGhInfo.HasSupplier,0) as GhWeight,isnull(TbGhInfo.GhCount,0) as GhCount from (select '供货' as GhType
                            union all
                            select '验收不合格' as GhType
                            union all
                            select '检测不合格' as GhType) TbGhType
                            left join(
                            --供货次数、总量
                            select isnull(sum(Tb.HasSupplier),0) as HasSupplier,isnull(sum(Tb.GhCount),0) as GhCount,'供货' as GhType from (select a.HasSupplier,isnull(b.GhCount,0) as GhCount from (select a.BatchPlanNum,sum(a.HasSupplier) as HasSupplier from TbSupplyListDetail a 
                            left join TbSupplyList s on a.BatchPlanNum=s.BatchPlanNum where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')
                            GROUP BY a.BatchPlanNum) a
                            left join(select Tb.BatchPlanNum,count(1) as GhCount from (select BatchPlanNum,ThisTime from TbSupplyListDetailHistory
                            group by BatchPlanNum,ThisTime) Tb group by Tb.BatchPlanNum) b on a.BatchPlanNum=b.BatchPlanNum) Tb 
                            union all
                            --验收不合格次数、验收不合格重量
                            select sum(TbSum.NoPass) as NoPass,sum(TbSum.YsNoPassCount) as YsNoPassCount,'验收不合格' as GhType from (select count(1) as YsNoPassCount,sum(Tb.NoPass) as NoPass from (select b.BatchPlanCode,c.ThisTime,sum(a.NoPass) as NoPass from TbInOrderItem a
                            left join TbInOrder b on a.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            left join TbSupplyListDetailHistory c on a.BatchPlanItemNewCode=c.BatchPlanItemNewCode
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033') and a.BatchPlanItemNewCode is not null and a.NoPass>0 
                            group by b.BatchPlanCode,c.ThisTime) Tb group by Tb.BatchPlanCode) TbSum
                            union all
                            --检测不合格次数、重量
                            select isnull(sum(Tb.JcNoPass),0) as JcNoPass,count(1) as JcNoPassCount,'检测不合格' as GhType from (select b.BatchPlanCode,d.ThisTime,Isnull(sum(c.PassCount),0) as JcNoPass from TbSampleOrderItem a
                            left join TbSampleOrder e on a.SampleOrderCode=e.SampleOrderCode
                            left join TbInOrderItem c on a.InOrderItemId=c.ID
                            left join TbSupplyListDetailHistory d on c.BatchPlanItemNewCode=d.BatchPlanItemNewCode
                            left join TbInOrder b on c.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')  and a.ChackState=2 and c.BatchPlanItemNewCode is not null
                            group by b.BatchPlanCode,d.ThisTime) Tb group by Tb.BatchPlanCode) TbGhInfo on TbGhType.GhType=TbGhInfo.GhType) Tb group by Tb.GhType	


-----------------------------------------------------------------------------
2020-07-14 11:05:52
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:05:52
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /Production/WorkOrder/Index


-----------------------------------------------------------------------------
2020-07-14 11:05:52
Text:	select * from TbSysDictionaryData where 1=1 and FDictionaryCode=@name order by DictionaryOrder asc	
Parameters:
@name[String] = ProcessingState


-----------------------------------------------------------------------------
2020-07-14 11:05:52
Text:	select * from TbSysDictionaryData where 1=1 and FDictionaryCode=@name order by DictionaryOrder asc	
Parameters:
@name[String] = UrgentDegree


-----------------------------------------------------------------------------
2020-07-14 11:05:52
Text:	select * from TbSysDictionaryData where 1=1 and FDictionaryCode=@name order by DictionaryOrder asc	
Parameters:
@name[String] = DistributionTimeJg


-----------------------------------------------------------------------------
2020-07-14 11:05:52
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:05:52
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:05:52
Text:	select a.SiteCode from TbWorkOrder a
where a.Examinestatus='审核完成' 
and (CONVERT(varchar(7), a.DistributionTime, 120)='2020-07' or (CONVERT(varchar(7), a.DistributionTime, 120)<='2020-07' and a.ProcessingState!='Finishing')) 
and a.ProcessFactoryCode='6386683729561128960' 
and (ISNULL(@ProjectId,'')='' or a.ProjectId=@ProjectId)
group by a.SiteCode	
Parameters:
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:05:52
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:05:52
Text:	 SELECT count(*) as r_cnt FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON (([TbWorkOrder].[ProcessingState] = [TbSysDictionaryData].[DictionaryCode]) AND ([TbSysDictionaryData].[FDictionaryCode] = @FDictionaryCode227)) LEFT OUTER JOIN [TbUser] ON ([TbWorkOrder].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbDistributionPlanInfo] ON ([TbWorkOrder].[OrderCode] = [TbDistributionPlanInfo].[OrderCode]) LEFT OUTER JOIN [TbSemiFinishedSign] ON ([TbWorkOrder].[OrderCode] = [TbSemiFinishedSign].[OrderCodeH]) LEFT OUTER JOIN [TbOrderProgress] ON ([TbWorkOrder].[OrderCode] = [TbOrderProgress].[OrderCode]) WHERE ((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode223) AND ([TbWorkOrder].[ProjectId] = @ProjectId224)) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode225)))	
Parameters:
@ProcessFactoryCode223[String] = 6386683729561128960
@ProjectId224[String] = 6372912251695766465
@SiteCode225[String] = 6372921375874657752
@FDictionaryCode226[String] = UrgentDegree
@FDictionaryCode227[String] = ProcessingState


-----------------------------------------------------------------------------
2020-07-14 11:05:52
Text:	 SELECT   TOP 50 [TbWorkOrder].*,[TbCompany].[CompanyFullName] AS [SiteName],[TbSysDictionaryData].[DictionaryText] AS [ProcessingStateNew],[TbUser].[UserName],isnull([TbDistributionPlanInfo].[DistributionStart],N'') AS [DistributionStart],[TbDistributionPlanInfo].[DeliveryCompleteTime],[TbWorkOrder].[Examinestatus] AS [ExaminestatusNew],[TbSemiFinishedSign].[ID] AS [SemiFinishedSignId],[TbSemiFinishedSign].[Enclosure] AS [EnclosureSF],[TbOrderProgress].[FinishProcessingDateTime],( SELECT   [TbCompany].[CompanyFullName] FROM [TbCompany]  WHERE [TbCompany].[CompanyCode] = [TbWorkOrder].[ProcessFactoryCode] ) AS [ProcessFactoryName],( SELECT   [TbSysDictionaryData].[DictionaryText] FROM [TbSysDictionaryData]  WHERE ([TbSysDictionaryData].[DictionaryCode] = [TbWorkOrder].[UrgentDegree]) AND ([TbSysDictionaryData].[FDictionaryCode] = @FDictionaryCode226) ) AS [UrgentDegreeNew] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON (([TbWorkOrder].[ProcessingState] = [TbSysDictionaryData].[DictionaryCode]) AND ([TbSysDictionaryData].[FDictionaryCode] = @FDictionaryCode227)) LEFT OUTER JOIN [TbUser] ON ([TbWorkOrder].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbDistributionPlanInfo] ON ([TbWorkOrder].[OrderCode] = [TbDistributionPlanInfo].[OrderCode]) LEFT OUTER JOIN [TbSemiFinishedSign] ON ([TbWorkOrder].[OrderCode] = [TbSemiFinishedSign].[OrderCodeH]) LEFT OUTER JOIN [TbOrderProgress] ON ([TbWorkOrder].[OrderCode] = [TbOrderProgress].[OrderCode])  WHERE ((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode223) AND ([TbWorkOrder].[ProjectId] = @ProjectId224)) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode225))) ORDER BY [TbWorkOrder].[ID] DESC 	
Parameters:
@ProcessFactoryCode223[String] = 6386683729561128960
@ProjectId224[String] = 6372912251695766465
@SiteCode225[String] = 6372921375874657752
@FDictionaryCode226[String] = UrgentDegree
@FDictionaryCode227[String] = ProcessingState


-----------------------------------------------------------------------------
2020-07-14 11:05:52
Text:	select isnull(sum(TbCF.Capacity),0) as Capacity,isnull(sum(TbCF.WeightSmallPlan),0) as WeightSmallPlan,isnull(cast(sum(TbCF.WeightSmallPlan)/sum(TbCF.Capacity)*100 as decimal(18,2)),0) as ActualLoadNew from (select cf.Capacity,Tb1.WeightSmallPlan,cf.ProcessFactoryCode from TbCapacityFilling cf  
left join(
select SUM(Tb.WeightSmallPlan) as WeightSmallPlan,Tb.ProcessFactoryCode from (
                            select isnull(SUM(wod.WeightSmallPlan),0) as WeightSmallPlan,wo.ProcessFactoryCode from TbWorkOrder wo
                            left join TbWorkOrderDetail wod on wo.OrderCode=wod.OrderCode
                            where (ISNULL(@ProcessFactoryCode,'')='' or wo.ProcessFactoryCode=@ProcessFactoryCode)
                            and CONVERT(varchar(7), wo.DistributionTime, 120)=@month
                            and wod.RevokeStart='正常' and wo.ProcessingState!='ConfirmWork' and wo.ProcessingState!='Finishing'  group by wo.ProcessFactoryCode
                            union all
                            select isnull(sum(opd.NoCompleted),0) as NoCompleted,op.ProcessFactoryCode from TbOrderProgress op
                            left join TbOrderProgressDetail opd on op.OrderCode=opd.OrderCode 
                            where (ISNULL(@ProcessFactoryCode,'')='' or op.ProcessFactoryCode=@ProcessFactoryCode)
                            and CONVERT(varchar(7), op.DistributionTime, 120)=CONVERT(varchar(4),YEAR(DATEADD(MONTH,-1,@month+'-01')))+'-'+Right(100+Month(DATEADD(MONTH,-1,@month+'-01')),2)
                            and opd.RevokeStart='正常'  group by op.ProcessFactoryCode)Tb  group by Tb.ProcessFactoryCode
) Tb1 on cf.ProcessFactoryCode=Tb1.ProcessFactoryCode 
where cf.CapacityMonth=@month
and (ISNULL(@ProcessFactoryCode,'')='' or cf.ProcessFactoryCode=@ProcessFactoryCode)) TbCF where (ISNULL(@ProcessFactoryCode,'')='' or TbCF.ProcessFactoryCode=@ProcessFactoryCode)	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@month[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-14 11:05:52
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:05:52
Text:	select isnull(SUM(Tb.AlreadyCompleted),0) as AlreadyCompleted, cast(round(isnull(SUM(Tb.AlreadyCompleted),0)/(isnull(SUM(Tb.AlreadyCompleted),0)+isnull(SUM(Tb.NoCompleted),0))*100,0) as int) as AlreadyCompletedBfb,isnull(SUM(Tb.NoCompleted),0) as NoCompleted, cast(round(isnull(SUM(Tb.NoCompleted),0)/(isnull(SUM(Tb.AlreadyCompleted),0)+isnull(SUM(Tb.NoCompleted),0))*100,0) as int) as NoCompletedBfb from (
                              select case when c.ID is null then b.WeightSmallPlan else c.NoCompleted end as NoCompleted,c.AlreadyCompleted from TbWorkOrder a 
                              left join TbWorkOrderDetail b on a.OrderCode=b.OrderCode
                              left join TbOrderProgressDetail c on c.WorkorderdetailId=b.ID where 1=1  and a.ProjectId='6372912251695766465' and a.ProcessFactoryCode='6386683729561128960' and a.SiteCode in('6372921375874657752') and (CONVERT(varchar(7),a.DistributionTime, 120)='2020-07' or (CONVERT(varchar(7),a.DistributionTime, 120)<'2020-07' and a.ProcessingState!='Finishing')) and a.Examinestatus='审核完成') Tb 	


-----------------------------------------------------------------------------
2020-07-14 11:05:52
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:05:52
Text:	select TbProgressType.ProgressType,isnull(TbProgress.WeightTotal,0) as WeightTotal from (select '进度正常' as ProgressType
union all
select '进度超前' as ProgressType
union all
select '已完成（滞后）' as ProgressType
union all
select '未完成（滞后）' as ProgressType
) TbProgressType
left join(
select sum(a.WeightTotal) as WeightTotal,'进度正常' as  ProgressType from  TbWorkOrder a
left join TbOrderProgress b on a.OrderCode=b.OrderCode 
where 1=1  and a.ProjectId='6372912251695766465' and a.ProcessFactoryCode='6386683729561128960' and a.SiteCode in('6372921375874657752') and (CONVERT(varchar(7),a.DistributionTime, 120)='2020-07' or (CONVERT(varchar(7),a.DistributionTime, 120)<'2020-07' and a.ProcessingState!='Finishing')) and a.Examinestatus='审核完成' and ((CONVERT(varchar(100),b.FinishProcessingDateTime,23)=CONVERT(varchar(100),a.DistributionTime,23) or (b.FinishProcessingDateTime is null and a.Examinestatus='审核完成' and CONVERT(varchar(100),a.DistributionTime,23)>=CONVERT(varchar(100),GETDATE(),23))))
union all
select sum(a.WeightTotal) as WeightTotal,'进度超前' as  ProgressType from  TbWorkOrder a
left join TbOrderProgress b on a.OrderCode=b.OrderCode 
where 1=1  and a.ProjectId='6372912251695766465' and a.ProcessFactoryCode='6386683729561128960' and a.SiteCode in('6372921375874657752') and (CONVERT(varchar(7),a.DistributionTime, 120)='2020-07' or (CONVERT(varchar(7),a.DistributionTime, 120)<'2020-07' and a.ProcessingState!='Finishing')) and a.Examinestatus='审核完成' and CONVERT(varchar(100),b.FinishProcessingDateTime,23)<CONVERT(varchar(100),a.DistributionTime,23) and a.Examinestatus='审核完成'
union all
select sum(a.WeightTotal) as WeightTotal,'已完成（滞后）' as  ProgressType from  TbWorkOrder a
left join TbOrderProgress b on a.OrderCode=b.OrderCode 
where 1=1  and a.ProjectId='6372912251695766465' and a.ProcessFactoryCode='6386683729561128960' and a.SiteCode in('6372921375874657752') and (CONVERT(varchar(7),a.DistributionTime, 120)='2020-07' or (CONVERT(varchar(7),a.DistributionTime, 120)<'2020-07' and a.ProcessingState!='Finishing')) and a.Examinestatus='审核完成' and CONVERT(varchar(100),b.FinishProcessingDateTime,23)>CONVERT(varchar(100),a.DistributionTime,23) and a.Examinestatus='审核完成'
union all
select sum(a.WeightTotal) as WeightTotal,'未完成（滞后）' as  ProgressType from  TbWorkOrder a
left join TbOrderProgress b on a.OrderCode=b.OrderCode 
where 1=1  and a.ProjectId='6372912251695766465' and a.ProcessFactoryCode='6386683729561128960' and a.SiteCode in('6372921375874657752') and (CONVERT(varchar(7),a.DistributionTime, 120)='2020-07' or (CONVERT(varchar(7),a.DistributionTime, 120)<'2020-07' and a.ProcessingState!='Finishing')) and a.Examinestatus='审核完成' and CONVERT(varchar(100),a.DistributionTime,23)<CONVERT(varchar(100),GETDATE(),23) and b.FinishProcessingDateTime is null and a.Examinestatus='审核完成') TbProgress on TbProgressType.ProgressType=TbProgress.ProgressType	


-----------------------------------------------------------------------------
2020-07-14 11:05:52
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:05:52
Text:	select TbOrderStart.*,isnull(TbOrderCount.WeightTotal,0) as WeightTotal,isnull(TbOrderCount.OrderCount,0) as OrderCount from(select '正常订单' as OrderStart
                               union all
                               select '加急订单' as OrderStart
                               union all
                               select '变更订单' as OrderStart
                               union all
                               select '退回订单' as OrderStart) TbOrderStart
                               left join(select count(1) as OrderCount,isnull(sum(a.WeightTotal),0) as WeightTotal,'正常订单' as OrderStart from TbWorkOrder a where 1=1  and a.ProjectId='6372912251695766465' and a.ProcessFactoryCode='6386683729561128960' and a.SiteCode in('6372921375874657752') and a.Examinestatus='审核完成' and (CONVERT(varchar(7),a.DistributionTime, 120)='2020-07' or (CONVERT(varchar(7),a.DistributionTime, 120)<'2020-07' and a.ProcessingState!='Finishing' and a.Examinestatus='审核完成')) and a.UrgentDegree='Commonly' 
                               union all
                               select count(1) as OrderCount,isnull(sum(a.WeightTotal),0) as WeightTotal,'加急订单' as OrderStart from TbWorkOrder a where 1=1  and a.ProjectId='6372912251695766465' and a.ProcessFactoryCode='6386683729561128960' and a.SiteCode in('6372921375874657752') and a.Examinestatus='审核完成' and (CONVERT(varchar(7),a.DistributionTime, 120)='2020-07' or (CONVERT(varchar(7),a.DistributionTime, 120)<'2020-07' and a.ProcessingState!='Finishing' and a.Examinestatus='审核完成')) and a.UrgentDegree='Urgent'
                               union all
                               select count(1) as OrderCount,isnull(sum(a.WeightTotal),0) as WeightTotal,'变更订单' as OrderStart from TbWorkOrder a where 1=1  and a.ProjectId='6372912251695766465' and a.ProcessFactoryCode='6386683729561128960' and a.SiteCode in('6372921375874657752')and (CONVERT(varchar(7),a.DistributionTime, 120)='2020-07')  and (a.OrderStart='部分变更' or a.OrderStart='全部变更')
                               union all
                               select count(1) as OrderCount,isnull(sum(a.WeightTotal),0) as WeightTotal,'退回订单' as OrderStart from TbWorkOrder a where 1=1  and a.ProjectId='6372912251695766465' and a.ProcessFactoryCode='6386683729561128960' and a.SiteCode in('6372921375874657752')and (CONVERT(varchar(7),a.DistributionTime, 120)='2020-07')  and a.Examinestatus='已退回') TbOrderCount on TbOrderStart.OrderStart=TbOrderCount.OrderStart 	


-----------------------------------------------------------------------------
2020-07-14 11:06:08
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:06:08
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:06:08
Text:	select isnull(sum(TbCF.Capacity),0) as Capacity,isnull(sum(TbCF.WeightSmallPlan),0) as WeightSmallPlan,isnull(cast(sum(TbCF.WeightSmallPlan)/sum(TbCF.Capacity)*100 as decimal(18,2)),0) as ActualLoadNew from (select cf.Capacity,Tb1.WeightSmallPlan,cf.ProcessFactoryCode from TbCapacityFilling cf  
left join(
select SUM(Tb.WeightSmallPlan) as WeightSmallPlan,Tb.ProcessFactoryCode from (
                            select isnull(SUM(wod.WeightSmallPlan),0) as WeightSmallPlan,wo.ProcessFactoryCode from TbWorkOrder wo
                            left join TbWorkOrderDetail wod on wo.OrderCode=wod.OrderCode
                            where (ISNULL(@ProcessFactoryCode,'')='' or wo.ProcessFactoryCode=@ProcessFactoryCode)
                            and CONVERT(varchar(7), wo.DistributionTime, 120)=@month
                            and wod.RevokeStart='正常' and wo.ProcessingState!='ConfirmWork' and wo.ProcessingState!='Finishing'  group by wo.ProcessFactoryCode
                            union all
                            select isnull(sum(opd.NoCompleted),0) as NoCompleted,op.ProcessFactoryCode from TbOrderProgress op
                            left join TbOrderProgressDetail opd on op.OrderCode=opd.OrderCode 
                            where (ISNULL(@ProcessFactoryCode,'')='' or op.ProcessFactoryCode=@ProcessFactoryCode)
                            and CONVERT(varchar(7), op.DistributionTime, 120)=CONVERT(varchar(4),YEAR(DATEADD(MONTH,-1,@month+'-01')))+'-'+Right(100+Month(DATEADD(MONTH,-1,@month+'-01')),2)
                            and opd.RevokeStart='正常'  group by op.ProcessFactoryCode)Tb  group by Tb.ProcessFactoryCode
) Tb1 on cf.ProcessFactoryCode=Tb1.ProcessFactoryCode 
where cf.CapacityMonth=@month
and (ISNULL(@ProcessFactoryCode,'')='' or cf.ProcessFactoryCode=@ProcessFactoryCode)) TbCF where (ISNULL(@ProcessFactoryCode,'')='' or TbCF.ProcessFactoryCode=@ProcessFactoryCode)	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@month[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-14 11:06:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:06:09
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode228) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode229,@WorkAreaCode230))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus231) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth232))) 	
Parameters:
@ProcessFactoryCode228[String] = 6386683729561128960
@WorkAreaCode229[String] = 6372921396045311451
@WorkAreaCode230[String] = 6372921398380745033
@Examinestatus231[String] = 审核完成
@DemandMonth232[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-14 11:06:09
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:06:09
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:06:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:06:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:06:09
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode235) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode236))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState237)) 	
Parameters:
@ProcessFactoryCode235[String] = 6386683729561128960
@SiteCode236[String] = 6372921375874657752
@ProcessingState237[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-14 11:06:09
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-14 11:06:09
Text:	 SELECT   [TbOrderProgress].[ProcessingState],[TbOrderProgress].[OrderCode],[TbOrderProgress].[FinishProcessingDateTime],[TbOrderProgress].[DistributionTime],[TbOrderProgress].[SiteCode] FROM [TbOrderProgress]  WHERE ((([TbOrderProgress].[SiteCode] IN (@SiteCode233)) AND ([TbOrderProgress].[ProcessFactoryCode] = @ProcessFactoryCode234)) AND ((YEAR(DistributionTime)=2020 and MONTH(DistributionTime)=7) or (DistributionTime<'2020/7/1 0:00:00' and (ProcessingState!='Finishing')))) 	
Parameters:
@SiteCode233[String] = 6372921375874657752
@ProcessFactoryCode234[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:06:09
Text:	 SELECT   * FROM [TbWorkOrderDetail]  WHERE (1=2) AND ([TbWorkOrderDetail].[DaetailWorkStrat] = @DaetailWorkStrat238) 	
Parameters:
@DaetailWorkStrat238[String] = 未加工


-----------------------------------------------------------------------------
2020-07-14 11:06:09
Text:	 SELECT   [TbOrderProgress].[WeightTotal] AS [TotalWeight],[TbCompany].[ParentCompanyCode] FROM [TbOrderProgress] LEFT OUTER JOIN [TbCompany] ON ([TbOrderProgress].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((1=2) AND ([TbOrderProgress].[ProcessingState] <> @ProcessingState239)) AND ((([TbOrderProgress].[FinishProcessingDateTime] is not null ) AND ([TbOrderProgress].[DistributionTime] < [TbOrderProgress].[FinishProcessingDateTime])) OR (([TbOrderProgress].[FinishProcessingDateTime] is null ) AND ([TbOrderProgress].[DistributionTime] < @DistributionTime240)))) 	
Parameters:
@ProcessingState239[String] = Finishing
@DistributionTime240[DateTime] = 2020/7/14 0:00:00


-----------------------------------------------------------------------------
2020-07-14 11:06:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:06:09
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode241) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode242))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState243)) 	
Parameters:
@ProcessFactoryCode241[String] = 6386683729561128960
@SiteCode242[String] = 6372921375874657752
@ProcessingState243[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-14 11:06:09
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-14 11:06:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:06:10
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode245) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode246,@WorkAreaCode247))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus248) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth249))) 	
Parameters:
@ProcessFactoryCode245[String] = 6386683729561128960
@WorkAreaCode246[String] = 6372921396045311451
@WorkAreaCode247[String] = 6372921398380745033
@Examinestatus248[String] = 审核完成
@DemandMonth249[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-14 11:06:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:06:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:06:10
Text:	 SELECT   [TbRawMaterialStockRecord].[MaterialCode],sum([TbRawMaterialStockRecord].[UseCount]) AS [UseCount],sum([TbRawMaterialStockRecord].[LockCount]) AS [LockCount] FROM [TbRawMaterialStockRecord] LEFT OUTER JOIN [TbStorage] ON ([TbRawMaterialStockRecord].[StorageCode] = [TbStorage].[StorageCode]) LEFT OUTER JOIN [TbRawMaterialArchives] ON ([TbRawMaterialStockRecord].[MaterialCode] = [TbRawMaterialArchives].[MaterialCode])  WHERE ((([TbStorage].[ProcessFactoryCode] = @ProcessFactoryCode252) AND ([TbRawMaterialStockRecord].[WorkAreaCode] IN (@WorkAreaCode254,@WorkAreaCode255))) AND ([TbRawMaterialArchives].[RebarType] = @RebarType257)) GROUP BY [TbRawMaterialStockRecord].[MaterialCode] 	
Parameters:
@ProcessFactoryCode252[String] = 6386683729561128960
@WorkAreaCode254[String] = 6372921396045311451
@WorkAreaCode255[String] = 6372921398380745033
@RebarType257[String] = BuildingSteel


-----------------------------------------------------------------------------
2020-07-14 11:06:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:06:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:06:10
Text:	 SELECT   [TbRawMaterialStockRecord].[MaterialCode],sum([TbRawMaterialStockRecord].[UseCount]) AS [UseCount],sum([TbRawMaterialStockRecord].[LockCount]) AS [LockCount] FROM [TbRawMaterialStockRecord] LEFT OUTER JOIN [TbStorage] ON ([TbRawMaterialStockRecord].[StorageCode] = [TbStorage].[StorageCode]) LEFT OUTER JOIN [TbRawMaterialArchives] ON ([TbRawMaterialStockRecord].[MaterialCode] = [TbRawMaterialArchives].[MaterialCode])  WHERE ((([TbStorage].[ProcessFactoryCode] = @ProcessFactoryCode261) AND ([TbRawMaterialStockRecord].[WorkAreaCode] IN (@WorkAreaCode263,@WorkAreaCode264))) AND ([TbRawMaterialArchives].[RebarType] = @RebarType266)) GROUP BY [TbRawMaterialStockRecord].[MaterialCode] 	
Parameters:
@ProcessFactoryCode261[String] = 6386683729561128960
@WorkAreaCode263[String] = 6372921396045311451
@WorkAreaCode264[String] = 6372921398380745033
@RebarType266[String] = SectionSteel


-----------------------------------------------------------------------------
2020-07-14 11:06:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:06:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:06:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:06:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:06:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:06:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:06:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:06:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:06:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:06:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:06:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:06:10
Text:	SELECT 
                            '审批超时' as YjTypeName,COUNT(1) as YjNum
                            FROM (
									SELECT a.*, row_number()over(partition BY a.FlowCode ORDER BY a.FlowNodeCode,a.EarlyWarningTime desc) as group_idx 
									FROM TbFlowEarlyWarningOtherInfo  a
									INNER JOIN  TbFlowEarlyWarningInfo b ON a.FlowCode=b.FlowCode 
									AND a.EWFormDataCode=b.EWFormDataCode AND a.FlowNodeCode=b.FlowNodeCode 
									WHERE  b.EarlyWarningStart=0 AND YEAR(a.EarlyWarningTime)= @Year and MONTH(a.EarlyWarningTime)= @Month  and a.ProjectId='6372912251695766465' and a.ProcessFactoryCode='6386683729561128960' and (a.SiteCode in('6372921375874657752') or a.WorkAreaCode in('6372921396045311451','6372921398380745033'))
							   ) Tb1
                            WHERE Tb1.group_idx =1
                           union all
                            select '未报月度需求计划' as YjTypeName,COUNT(1)as YjNum
                             FROM ( 
                                  SELECT *, row_number()over(partition BY EarlyWarningCode,EWFormDataCode ORDER BY EWNodeCode,EWTime desc) as group_idx 
                                  FROM TbFormEarlyWarningNodeInfo fwqi
                                  WHERE fwqi.MenuCode='RawMonthDemandPlan' AND fwqi.EWStart=0 AND YEAR(fwqi.EWTime)= @Year and MONTH(fwqi.EWTime)= @Month  and fwqi.ProjectId='6372912251695766465' and (fwqi.SiteCode in('6372921375874657752') or fwqi.WorkArea in('6372921396045311451','6372921398380745033'))  
                             ) Tb2
                             WHERE Tb2.group_idx =1
                           union all
                           select '原材料供货超时' as YjTypeName,COUNT(1) as YjNum from (
                           select BatchPlanNum,cp1.CompanyFullName as BranchName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,sup.SupplyDate,sup.SupplyCompleteTime,sup.ProjectId from TbSupplyList sup
                           left join TbCompany cp1 on cp1.CompanyCode=sup.BranchCode
                           left join TbCompany cp2 on cp2.CompanyCode=sup.WorkAreaCode
                           left join TbCompany cp3 on cp3.CompanyCode=sup.SiteCode
                           left join TbCompany cp4 on cp4.CompanyCode=sup.ProcessFactoryCode
                           where (sup.SupplyCompleteTime>sup.SupplyDate or (GETDATE()>sup.SupplyDate and sup.SupplyCompleteTime is null))
						   and YEAR(sup.SupplyDate)= @Year and MONTH(sup.SupplyDate)= @Month  and sup.ProjectId='6372912251695766465' and sup.ProcessFactoryCode='6386683729561128960' and (sup.SiteCode in('6372921375874657752') or sup.WorkAreaCode in('6372921396045311451','6372921398380745033'))) Tb3
                           union all
                           select '加急订单' as YjTypeName,COUNT(1) as YjNum from (--加急订单个数
                           select wo.OrderCode,wo.DistributionTime,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName from TbWorkOrder wo
                           left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on wo.ProcessFactoryCode=cp2.CompanyCode
                           where UrgentDegree='Urgent' 
						   and YEAR(wo.DistributionTime)= @Year and MONTH(wo.DistributionTime)= @Month  and wo.ProjectId='6372912251695766465' and wo.ProcessFactoryCode='6386683729561128960' and wo.SiteCode in('6372921375874657752') ) Tb4
                           union all
                           select '加工进度滞后' as YjTypeName,COUNT(1) as YjNum from (--加工进度滞后
                           select op.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,op.DistributionTime,op.FinishProcessingDateTime from TbOrderProgress op 
                           left join TbCompany cp1 on op.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on op.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(op.DistributionTime)= @Year and MONTH(op.DistributionTime)= @Month
                           and (op.FinishProcessingDateTime>op.DistributionTime or (GETDATE()>op.DistributionTime and op.FinishProcessingDateTime is null))  and op.ProjectId='6372912251695766465' and op.ProcessFactoryCode='6386683729561128960' and op.SiteCode in('6372921375874657752') ) Tb5
                           union all
                           select '接收配送超期' as YjTypeName,COUNT(1) as YjNum from (--配送超期
                           select dpi.OrderCode,cp1.CompanyFullName as SIteName,cp2.CompanyFullName as ProcessFactoryName,dpi.DistributionTime,dpi.DeliveryCompleteTime from TbDistributionPlanInfo dpi
                           left join TbCompany cp1 on dpi.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on dpi.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(dpi.DistributionTime)= @Year and MONTH(dpi.DistributionTime)= @Month
                           and (dpi.DeliveryCompleteTime>dpi.DistributionTime or (GETDATE()>dpi.DistributionTime and dpi.DeliveryCompleteTime is null))  and dpi.ProjectId='6372912251695766465' and dpi.ProcessFactoryCode='6386683729561128960' and dpi.SiteCode in('6372921375874657752') ) Tb6 
                           union all
                           select '卸货超时' as YjTypeName,COUNT(1) as YjNum from(--卸货超时
                           select TbYj.*,cp1.CompanyFullName as SiteName,tcr.EnterSpaceTime,tcr.StartDischargeTime,tcr.EndDischargeTime,disEnt.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SiteDischargeCargo' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbTransportCarReport tcr on TbYj.EWFormDataCode=tcr.DisEntOrderId
                           left join TbDistributionEnt disEnt on tcr.DistributionCode=disEnt.DistributionCode
                           left join TbCompany cp on disEnt.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and disEnt.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ) Tb7
                           union all
                           select '签收超时' as YjTypeName,COUNT(1) as YjNum from (select TbYj.*,cp1.CompanyFullName as SiteName,sfs.DistributionCode,sdc.DistributionTime,sfs.SigninTime,sfs.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SemiFinishedSign' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbSemiFinishedSign sfs on TbYj.EWFormDataCode=sfs.ID
                           left join TbSiteDischargeCargo sdc on sfs.DistributionCode=sdc.DistributionCode and sfs.DischargeCargoCode=sdc.DischargeCargoCode
                           left join TbCompany cp on sfs.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and sfs.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ) Tb8	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 11:06:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:06:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:06:10
Text:	--原材料供货超时
                           select BatchPlanNum,cp1.CompanyFullName as BranchName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,sup.SupplyDate,sup.SupplyCompleteTime,sup.ProjectId,sup.Remarks from TbSupplyList sup
                           left join TbCompany cp1 on cp1.CompanyCode=sup.BranchCode
                           left join TbCompany cp2 on cp2.CompanyCode=sup.WorkAreaCode
                           left join TbCompany cp3 on cp3.CompanyCode=sup.SiteCode
                           left join TbCompany cp4 on cp4.CompanyCode=sup.ProcessFactoryCode
                           where YEAR(sup.SupplyDate)= @Year and MONTH(sup.SupplyDate)= @Month
                           and (sup.SupplyCompleteTime>sup.SupplyDate or (GETDATE()>sup.SupplyDate and sup.SupplyCompleteTime is null))  and sup.ProjectId='6372912251695766465' and sup.ProcessFactoryCode='6386683729561128960' and (sup.SiteCode in('6372921375874657752') or sup.WorkAreaCode in('6372921396045311451','6372921398380745033'))	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 11:06:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:06:10
Text:	--加急订单个数
                           select wo.OrderCode,wo.DistributionTime,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName from TbWorkOrder wo
                           left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on wo.ProcessFactoryCode=cp2.CompanyCode
                           where UrgentDegree='Urgent'
                           and YEAR(wo.DistributionTime)= @Year and MONTH(wo.DistributionTime)= @Month  and wo.ProjectId='6372912251695766465' and wo.ProcessFactoryCode='6386683729561128960' and wo.SiteCode in('6372921375874657752')  ORDER BY wo.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 11:06:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:06:10
Text:	--加工进度滞后
                           select op.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,op.DistributionTime,op.FinishProcessingDateTime from TbOrderProgress op 
                           left join TbCompany cp1 on op.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on op.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(op.DistributionTime)= @Year and MONTH(op.DistributionTime)= @Month
                           and (op.FinishProcessingDateTime>op.DistributionTime or (GETDATE()>op.DistributionTime and op.FinishProcessingDateTime is null))  and op.ProjectId='6372912251695766465' and op.ProcessFactoryCode='6386683729561128960' and op.SiteCode in('6372921375874657752') ORDER BY op.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 11:06:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:06:10
Text:	--配送超期
                           select dpi.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,dpi.DistributionTime,dpi.DeliveryCompleteTime,dpi.Remark from TbDistributionPlanInfo dpi
                           left join TbCompany cp1 on dpi.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on dpi.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(dpi.DistributionTime)= @Year and MONTH(dpi.DistributionTime)= @Month
                           and (dpi.DeliveryCompleteTime>dpi.DistributionTime or (GETDATE()>dpi.DistributionTime and dpi.DeliveryCompleteTime is null))  and dpi.ProjectId='6372912251695766465' and dpi.ProcessFactoryCode='6386683729561128960' and dpi.SiteCode in('6372921375874657752') ORDER BY dpi.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 11:06:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:06:10
Text:	select TbYj.*,cp1.CompanyFullName as SiteName,tcr.EnterSpaceTime,tcr.StartDischargeTime,tcr.EndDischargeTime,disEnt.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SiteDischargeCargo' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbTransportCarReport tcr on TbYj.EWFormDataCode=tcr.DisEntOrderId
                           left join TbDistributionEnt disEnt on tcr.DistributionCode=disEnt.DistributionCode
                           left join TbCompany cp on disEnt.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and disEnt.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ORDER BY tcr.EnterSpaceTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 11:06:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:06:10
Text:	select TbYj.*,cp1.CompanyFullName as SiteName,sfs.DistributionCode,sdc.DistributionTime,sfs.SigninTime,sfs.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SemiFinishedSign' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbSemiFinishedSign sfs on TbYj.EWFormDataCode=sfs.ID
                           left join TbSiteDischargeCargo sdc on sfs.DistributionCode=sdc.DistributionCode and sfs.DischargeCargoCode=sdc.DischargeCargoCode
                           left join TbCompany cp on sfs.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month and TbYj.ProjectId='6372912251695766465' and sfs.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752')	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 11:06:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:06:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:06:10
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode270) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode271))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState272)) 	
Parameters:
@ProcessFactoryCode270[String] = 6386683729561128960
@SiteCode271[String] = 6372921375874657752
@ProcessingState272[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-14 11:06:10
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-14 11:06:10
Text:	 SELECT   [TbOrderProgress].[ProcessingState],[TbOrderProgress].[OrderCode],[TbOrderProgress].[FinishProcessingDateTime],[TbOrderProgress].[DistributionTime],[TbOrderProgress].[SiteCode] FROM [TbOrderProgress]  WHERE ((([TbOrderProgress].[SiteCode] IN (@SiteCode268)) AND ([TbOrderProgress].[ProcessFactoryCode] = @ProcessFactoryCode269)) AND ((YEAR(DistributionTime)=2020 and MONTH(DistributionTime)=7) or (DistributionTime<'2020/7/1 0:00:00' and (ProcessingState!='Finishing')))) 	
Parameters:
@SiteCode268[String] = 6372921375874657752
@ProcessFactoryCode269[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:06:10
Text:	 SELECT   * FROM [TbWorkOrderDetail]  WHERE (1=2) AND ([TbWorkOrderDetail].[DaetailWorkStrat] = @DaetailWorkStrat273) 	
Parameters:
@DaetailWorkStrat273[String] = 未加工


-----------------------------------------------------------------------------
2020-07-14 11:06:10
Text:	 SELECT   [TbOrderProgress].[WeightTotal] AS [TotalWeight],[TbCompany].[ParentCompanyCode] FROM [TbOrderProgress] LEFT OUTER JOIN [TbCompany] ON ([TbOrderProgress].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((1=2) AND ([TbOrderProgress].[ProcessingState] <> @ProcessingState274)) AND ((([TbOrderProgress].[FinishProcessingDateTime] is not null ) AND ([TbOrderProgress].[DistributionTime] < [TbOrderProgress].[FinishProcessingDateTime])) OR (([TbOrderProgress].[FinishProcessingDateTime] is null ) AND ([TbOrderProgress].[DistributionTime] < @DistributionTime275)))) 	
Parameters:
@ProcessingState274[String] = Finishing
@DistributionTime275[DateTime] = 2020/7/14 0:00:00


-----------------------------------------------------------------------------
2020-07-14 11:06:11
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:06:11
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:06:11
Text:	
                        select fewoi.DataCode as OddNumbers,
                         fewoi.EarlyWarningContent,
                         fewoi.EWFormDataCode,
                         CONVERT(varchar(100), fewoi.EarlyWarningTime, 120) as EarlyWarningTime,
                         EWFormCode,sm.MenuName,fn.FlowNodeName,cp1.CompanyFullName as BranchName,
                         cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,
                         u1.UserName as FlowSpUserName,u2.UserName as FlowYjUserName 
                        FROM (
                        select*
                           FROM ( 
                        		SELECT a.*, row_number()over(partition BY a.FlowCode ORDER BY a.FlowNodeCode,a.EarlyWarningTime desc) as group_idx 
                        		FROM TbFlowEarlyWarningOtherInfo  a
                        		INNER JOIN  TbFlowEarlyWarningInfo b ON a.FlowCode=b.FlowCode 
                        		AND a.EWFormDataCode=b.EWFormDataCode AND a.FlowNodeCode=b.FlowNodeCode 
                        		WHERE YEAR(a.EarlyWarningTime)= @Year and MONTH(a.EarlyWarningTime)= @Month AND b.EarlyWarningStart=0
                           ) ret
                        WHERE ret.group_idx =1
                        ) fewoi
                        left join TbFlowNode fn on fewoi.FlowCode=fn.FlowCode and fewoi.FlowNodeCode=fn.FlowNodeCode
                        left join TbSysMenu sm on fewoi.EWFormCode=sm.MenuCode
                        left join TbCompany cp1 on fewoi.BranchCode=cp1.CompanyCode
                        left join TbCompany cp2 on fewoi.WorkAreaCode=cp2.CompanyCode
                        left join TbCompany cp3 on fewoi.SiteCode=cp3.CompanyCode
                        left join TbCompany cp4 on fewoi.ProcessFactoryCode=cp4.CompanyCode
                        left join TbUser u1 on fewoi.FlowSpUserCode=u1.UserId
                        left join TbUser u2 on fewoi.FlowYjUserCode=u2.UserId where 1=1 and fewoi.ProjectId='6372912251695766465' and fewoi.ProcessFactoryCode='6386683729561128960' and (fewoi.SiteCode in('6372921375874657752') or fewoi.WorkAreaCode in('6372921396045311451','6372921398380745033')) ORDER BY fewoi.EarlyWarningTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 11:06:11
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:06:11
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:06:11
Text:	SELECT sm.MenuName,fwqi.EWContent,fwqi.EWUserCode,u.UserName,fwqi.EWFormDataCode,cp1.CompanyFullName as  FbName,cp2.CompanyFullName as GqName,fwqi.EWTime,sdd.DictionaryText as RebarType  
                   FROM (  
                    select ret.*
                    FROM ( 
                         SELECT *, row_number()over(partition BY EarlyWarningCode,EWFormDataCode ORDER BY EWNodeCode,EWTime desc) as group_idx 
                         FROM TbFormEarlyWarningNodeInfo fwqi
                         WHERE YEAR(fwqi.EWTime)= @Year and MONTH(fwqi.EWTime)= @Month AND fwqi.MenuCode='RawMonthDemandPlan' AND fwqi.EWStart=0
                    ) ret
                    WHERE ret.group_idx = 1
                   ) fwqi
                    left join TbSysMenu sm on fwqi.MenuCode=sm.MenuCode
                            left join TbCompany cp1 on fwqi.CompanyCode=cp1.CompanyCode
                            left join TbCompany cp2 on fwqi.WorkArea=cp2.CompanyCode
                            left join TbCompany cp3 on fwqi.SiteCode=cp3.CompanyCode
                            left join TbUser u on fwqi.EWUserCode=u.UserId
                            left join TbRawMaterialMonthDemandPlan rmp on fwqi.EWFormDataCode=rmp.ID
                            left join TbSysDictionaryData sdd on sdd.DictionaryCode=rmp.RebarType
                    where 1=1 and fwqi.ProjectId='6372912251695766465' and (fwqi.SiteCode in('6372921375874657752') or fwqi.WorkArea in('6372921396045311451','6372921398380745033')) ORDER BY fwqi.EWTime DESC	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 11:06:11
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:06:11
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode276) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode277,@WorkAreaCode278))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus279) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth280))) 	
Parameters:
@ProcessFactoryCode276[String] = 6386683729561128960
@WorkAreaCode277[String] = 6372921396045311451
@WorkAreaCode278[String] = 6372921398380745033
@Examinestatus279[String] = 审核完成
@DemandMonth280[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-14 11:06:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:06:12
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode281) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode282,@WorkAreaCode283))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus284) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth285))) 	
Parameters:
@ProcessFactoryCode281[String] = 6386683729561128960
@WorkAreaCode282[String] = 6372921396045311451
@WorkAreaCode283[String] = 6372921398380745033
@Examinestatus284[String] = 审核完成
@DemandMonth285[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-14 11:06:12
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:06:12
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:06:13
Text:	 SELECT count(*) as r_cnt FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode]) WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode286)	
Parameters:
@ProcessFactoryCode286[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:06:13
Text:	 SELECT   TOP 50 [TbStockTaking].[ID],[TbStockTaking].[TakNum],[TbStockTaking].[TakDay],[TbStockTaking].[TotalInventory],[TbStockTaking].[TotalTak],[TbStockTaking].[TotalEarnOrLos],[TbStockTaking].[EarnOrLos],[TbStockTaking].[Remarks],[TbStockTaking].[InsertUserCode],[TbStockTaking].[InsertTime],[TbUser].[UserName],[TbCompany].[CompanyFullName] AS [FactoryName],[TbSysDictionaryData].[DictionaryText] AS [WarehouseTypeName] FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode])  WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode286) ORDER BY [TbStockTaking].[ID] DESC 	
Parameters:
@ProcessFactoryCode286[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:08:28
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:10:06
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:10:06
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-14 11:10:06
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:10:06
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:10:06
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:10:06
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-14 11:10:06
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:10:06
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:10:06
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:10:06
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:10:06
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:10:06
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/InOrder/Index


-----------------------------------------------------------------------------
2020-07-14 11:10:06
Text:	 SELECT count(*) as r_cnt FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode]) WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode287)	
Parameters:
@ProcessFactoryCode287[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:10:06
Text:	 SELECT   TOP 50 [TbStockTaking].[ID],[TbStockTaking].[TakNum],[TbStockTaking].[TakDay],[TbStockTaking].[TotalInventory],[TbStockTaking].[TotalTak],[TbStockTaking].[TotalEarnOrLos],[TbStockTaking].[EarnOrLos],[TbStockTaking].[Remarks],[TbStockTaking].[InsertUserCode],[TbStockTaking].[InsertTime],[TbUser].[UserName],[TbCompany].[CompanyFullName] AS [FactoryName],[TbSysDictionaryData].[DictionaryText] AS [WarehouseTypeName] FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode])  WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode287) ORDER BY [TbStockTaking].[ID] DESC 	
Parameters:
@ProcessFactoryCode287[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:10:06
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:10:06
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:10:06
Text:	select Tb.DataMonth,ISNULL(sum(TbData.InorderCount),0) as InCount,ISNULL(sum(TbData.InCount),0) as InWeight from (select datepart(MONTH,dateadd(mm,-t.number,getdate())) as DataMonth
from
(select number from master..spt_values where type='P') t
where year(dateadd(mm,-t.number,getdate()))=year(getdate())) Tb 
left join (select COUNT(1) as InorderCount,SUM(a.InCount) as InCount,a.RebarType,datepart(year,a.InsertTime) InsertYear,datepart(MONTH,a.InsertTime) InsertMonth from TbInOrder a 
left join TbStorage b on a.StorageCode=b.StorageCode
where a.Examinestatus!='已退回' 
and a.Examinestatus!='已撤销' 
and datepart(year,a.InsertTime)=datepart(year,GETDATE())  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
group by a.RebarType,datepart(year,a.InsertTime),datepart(MONTH,a.InsertTime)) TbData on  Tb.DataMonth=TbData.InsertMonth
group by Tb.DataMonth order by Tb.DataMonth asc 	


-----------------------------------------------------------------------------
2020-07-14 11:10:07
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:10:07
Text:	select TbType.InType,isnull(TbData.InCount,0) as InCount from (select '入库单数' as InType
                           union all
                           select '未取样' as InType
                           union all
                           select '验收不合格' as InType
                           union all
                           select '检测部分合格' as InType
                           union all
                           select '检测不合格' as InType) TbType
                           left join(select '入库单数' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode 
                           where 1=1 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '未取样' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1 and a.SampleOrderState='取样未完成' and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '验收不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and NoPassTotal>0 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测部分合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=3 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=2 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')) TbData on TbType.InType=TbData.InType	


-----------------------------------------------------------------------------
2020-07-14 11:10:07
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:10:07
Text:	select Tb.GhType,sum(Tb.GhWeight) as GhWeight,sum(tb.GhCount) as GhCount from (select TbGhType.GhType,isnull(TbGhInfo.HasSupplier,0) as GhWeight,isnull(TbGhInfo.GhCount,0) as GhCount from (select '供货' as GhType
                            union all
                            select '验收不合格' as GhType
                            union all
                            select '检测不合格' as GhType) TbGhType
                            left join(
                            --供货次数、总量
                            select isnull(sum(Tb.HasSupplier),0) as HasSupplier,isnull(sum(Tb.GhCount),0) as GhCount,'供货' as GhType from (select a.HasSupplier,isnull(b.GhCount,0) as GhCount from (select a.BatchPlanNum,sum(a.HasSupplier) as HasSupplier from TbSupplyListDetail a 
                            left join TbSupplyList s on a.BatchPlanNum=s.BatchPlanNum where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')
                            GROUP BY a.BatchPlanNum) a
                            left join(select Tb.BatchPlanNum,count(1) as GhCount from (select BatchPlanNum,ThisTime from TbSupplyListDetailHistory
                            group by BatchPlanNum,ThisTime) Tb group by Tb.BatchPlanNum) b on a.BatchPlanNum=b.BatchPlanNum) Tb 
                            union all
                            --验收不合格次数、验收不合格重量
                            select sum(TbSum.NoPass) as NoPass,sum(TbSum.YsNoPassCount) as YsNoPassCount,'验收不合格' as GhType from (select count(1) as YsNoPassCount,sum(Tb.NoPass) as NoPass from (select b.BatchPlanCode,c.ThisTime,sum(a.NoPass) as NoPass from TbInOrderItem a
                            left join TbInOrder b on a.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            left join TbSupplyListDetailHistory c on a.BatchPlanItemNewCode=c.BatchPlanItemNewCode
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033') and a.BatchPlanItemNewCode is not null and a.NoPass>0 
                            group by b.BatchPlanCode,c.ThisTime) Tb group by Tb.BatchPlanCode) TbSum
                            union all
                            --检测不合格次数、重量
                            select isnull(sum(Tb.JcNoPass),0) as JcNoPass,count(1) as JcNoPassCount,'检测不合格' as GhType from (select b.BatchPlanCode,d.ThisTime,Isnull(sum(c.PassCount),0) as JcNoPass from TbSampleOrderItem a
                            left join TbSampleOrder e on a.SampleOrderCode=e.SampleOrderCode
                            left join TbInOrderItem c on a.InOrderItemId=c.ID
                            left join TbSupplyListDetailHistory d on c.BatchPlanItemNewCode=d.BatchPlanItemNewCode
                            left join TbInOrder b on c.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')  and a.ChackState=2 and c.BatchPlanItemNewCode is not null
                            group by b.BatchPlanCode,d.ThisTime) Tb group by Tb.BatchPlanCode) TbGhInfo on TbGhType.GhType=TbGhInfo.GhType) Tb group by Tb.GhType	


-----------------------------------------------------------------------------
2020-07-14 11:10:07
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:10:07
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/StockTaking/Index


-----------------------------------------------------------------------------
2020-07-14 11:10:07
Text:	select * from TbSysDictionaryData where 1=1 and FDictionaryCode=@name order by DictionaryOrder asc	
Parameters:
@name[String] = MaterialType


-----------------------------------------------------------------------------
2020-07-14 11:10:07
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:10:07
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:10:07
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:10:07
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-14 11:10:07
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:10:08
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:10:21
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:10:21
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-14 11:10:21
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:10:21
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:10:22
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:10:22
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-14 11:10:22
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:10:22
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:10:22
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:10:22
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-14 11:10:22
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:10:22
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:10:22
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:10:22
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:10:22
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:10:22
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/InOrder/Index


-----------------------------------------------------------------------------
2020-07-14 11:10:22
Text:	 SELECT count(*) as r_cnt FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode]) WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode288)	
Parameters:
@ProcessFactoryCode288[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:10:22
Text:	 SELECT   TOP 50 [TbStockTaking].[ID],[TbStockTaking].[TakNum],[TbStockTaking].[TakDay],[TbStockTaking].[TotalInventory],[TbStockTaking].[TotalTak],[TbStockTaking].[TotalEarnOrLos],[TbStockTaking].[EarnOrLos],[TbStockTaking].[Remarks],[TbStockTaking].[InsertUserCode],[TbStockTaking].[InsertTime],[TbUser].[UserName],[TbCompany].[CompanyFullName] AS [FactoryName],[TbSysDictionaryData].[DictionaryText] AS [WarehouseTypeName] FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode])  WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode288) ORDER BY [TbStockTaking].[ID] DESC 	
Parameters:
@ProcessFactoryCode288[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:10:22
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:10:23
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:10:23
Text:	select Tb.DataMonth,ISNULL(sum(TbData.InorderCount),0) as InCount,ISNULL(sum(TbData.InCount),0) as InWeight from (select datepart(MONTH,dateadd(mm,-t.number,getdate())) as DataMonth
from
(select number from master..spt_values where type='P') t
where year(dateadd(mm,-t.number,getdate()))=year(getdate())) Tb 
left join (select COUNT(1) as InorderCount,SUM(a.InCount) as InCount,a.RebarType,datepart(year,a.InsertTime) InsertYear,datepart(MONTH,a.InsertTime) InsertMonth from TbInOrder a 
left join TbStorage b on a.StorageCode=b.StorageCode
where a.Examinestatus!='已退回' 
and a.Examinestatus!='已撤销' 
and datepart(year,a.InsertTime)=datepart(year,GETDATE())  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
group by a.RebarType,datepart(year,a.InsertTime),datepart(MONTH,a.InsertTime)) TbData on  Tb.DataMonth=TbData.InsertMonth
group by Tb.DataMonth order by Tb.DataMonth asc 	


-----------------------------------------------------------------------------
2020-07-14 11:10:23
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:10:23
Text:	select TbType.InType,isnull(TbData.InCount,0) as InCount from (select '入库单数' as InType
                           union all
                           select '未取样' as InType
                           union all
                           select '验收不合格' as InType
                           union all
                           select '检测部分合格' as InType
                           union all
                           select '检测不合格' as InType) TbType
                           left join(select '入库单数' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode 
                           where 1=1 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '未取样' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1 and a.SampleOrderState='取样未完成' and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '验收不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and NoPassTotal>0 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测部分合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=3 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=2 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')) TbData on TbType.InType=TbData.InType	


-----------------------------------------------------------------------------
2020-07-14 11:10:23
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:10:23
Text:	select Tb.GhType,sum(Tb.GhWeight) as GhWeight,sum(tb.GhCount) as GhCount from (select TbGhType.GhType,isnull(TbGhInfo.HasSupplier,0) as GhWeight,isnull(TbGhInfo.GhCount,0) as GhCount from (select '供货' as GhType
                            union all
                            select '验收不合格' as GhType
                            union all
                            select '检测不合格' as GhType) TbGhType
                            left join(
                            --供货次数、总量
                            select isnull(sum(Tb.HasSupplier),0) as HasSupplier,isnull(sum(Tb.GhCount),0) as GhCount,'供货' as GhType from (select a.HasSupplier,isnull(b.GhCount,0) as GhCount from (select a.BatchPlanNum,sum(a.HasSupplier) as HasSupplier from TbSupplyListDetail a 
                            left join TbSupplyList s on a.BatchPlanNum=s.BatchPlanNum where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')
                            GROUP BY a.BatchPlanNum) a
                            left join(select Tb.BatchPlanNum,count(1) as GhCount from (select BatchPlanNum,ThisTime from TbSupplyListDetailHistory
                            group by BatchPlanNum,ThisTime) Tb group by Tb.BatchPlanNum) b on a.BatchPlanNum=b.BatchPlanNum) Tb 
                            union all
                            --验收不合格次数、验收不合格重量
                            select sum(TbSum.NoPass) as NoPass,sum(TbSum.YsNoPassCount) as YsNoPassCount,'验收不合格' as GhType from (select count(1) as YsNoPassCount,sum(Tb.NoPass) as NoPass from (select b.BatchPlanCode,c.ThisTime,sum(a.NoPass) as NoPass from TbInOrderItem a
                            left join TbInOrder b on a.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            left join TbSupplyListDetailHistory c on a.BatchPlanItemNewCode=c.BatchPlanItemNewCode
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033') and a.BatchPlanItemNewCode is not null and a.NoPass>0 
                            group by b.BatchPlanCode,c.ThisTime) Tb group by Tb.BatchPlanCode) TbSum
                            union all
                            --检测不合格次数、重量
                            select isnull(sum(Tb.JcNoPass),0) as JcNoPass,count(1) as JcNoPassCount,'检测不合格' as GhType from (select b.BatchPlanCode,d.ThisTime,Isnull(sum(c.PassCount),0) as JcNoPass from TbSampleOrderItem a
                            left join TbSampleOrder e on a.SampleOrderCode=e.SampleOrderCode
                            left join TbInOrderItem c on a.InOrderItemId=c.ID
                            left join TbSupplyListDetailHistory d on c.BatchPlanItemNewCode=d.BatchPlanItemNewCode
                            left join TbInOrder b on c.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')  and a.ChackState=2 and c.BatchPlanItemNewCode is not null
                            group by b.BatchPlanCode,d.ThisTime) Tb group by Tb.BatchPlanCode) TbGhInfo on TbGhType.GhType=TbGhInfo.GhType) Tb group by Tb.GhType	


-----------------------------------------------------------------------------
2020-07-14 11:10:23
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:10:23
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/StockTaking/Index


-----------------------------------------------------------------------------
2020-07-14 11:10:23
Text:	select * from TbSysDictionaryData where 1=1 and FDictionaryCode=@name order by DictionaryOrder asc	
Parameters:
@name[String] = MaterialType


-----------------------------------------------------------------------------
2020-07-14 11:10:23
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:10:23
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:10:28
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)	


-----------------------------------------------------------------------------
2020-07-14 11:10:28
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:10:29
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)	


-----------------------------------------------------------------------------
2020-07-14 11:10:29
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:11:09
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:11:09
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-14 11:11:10
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:11:10
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:11:10
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:11:10
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-14 11:11:10
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:11:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:11:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:11:10
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-14 11:11:10
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:11:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:11:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:11:10
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:11:10
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:11:11
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:11:11
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:11:12
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:11:25
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/InOrder/Index


-----------------------------------------------------------------------------
2020-07-14 11:11:25
Text:	 SELECT count(*) as r_cnt FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode]) WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode289)	
Parameters:
@ProcessFactoryCode289[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:11:25
Text:	 SELECT   TOP 50 [TbStockTaking].[ID],[TbStockTaking].[TakNum],[TbStockTaking].[TakDay],[TbStockTaking].[TotalInventory],[TbStockTaking].[TotalTak],[TbStockTaking].[TotalEarnOrLos],[TbStockTaking].[EarnOrLos],[TbStockTaking].[Remarks],[TbStockTaking].[InsertUserCode],[TbStockTaking].[InsertTime],[TbUser].[UserName],[TbCompany].[CompanyFullName] AS [FactoryName],[TbSysDictionaryData].[DictionaryText] AS [WarehouseTypeName] FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode])  WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode289) ORDER BY [TbStockTaking].[ID] DESC 	
Parameters:
@ProcessFactoryCode289[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:11:25
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:11:25
Text:	select Tb.DataMonth,ISNULL(sum(TbData.InorderCount),0) as InCount,ISNULL(sum(TbData.InCount),0) as InWeight from (select datepart(MONTH,dateadd(mm,-t.number,getdate())) as DataMonth
from
(select number from master..spt_values where type='P') t
where year(dateadd(mm,-t.number,getdate()))=year(getdate())) Tb 
left join (select COUNT(1) as InorderCount,SUM(a.InCount) as InCount,a.RebarType,datepart(year,a.InsertTime) InsertYear,datepart(MONTH,a.InsertTime) InsertMonth from TbInOrder a 
left join TbStorage b on a.StorageCode=b.StorageCode
where a.Examinestatus!='已退回' 
and a.Examinestatus!='已撤销' 
and datepart(year,a.InsertTime)=datepart(year,GETDATE())  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
group by a.RebarType,datepart(year,a.InsertTime),datepart(MONTH,a.InsertTime)) TbData on  Tb.DataMonth=TbData.InsertMonth
group by Tb.DataMonth order by Tb.DataMonth asc 	


-----------------------------------------------------------------------------
2020-07-14 11:11:25
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:11:25
Text:	select TbType.InType,isnull(TbData.InCount,0) as InCount from (select '入库单数' as InType
                           union all
                           select '未取样' as InType
                           union all
                           select '验收不合格' as InType
                           union all
                           select '检测部分合格' as InType
                           union all
                           select '检测不合格' as InType) TbType
                           left join(select '入库单数' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode 
                           where 1=1 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '未取样' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1 and a.SampleOrderState='取样未完成' and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '验收不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and NoPassTotal>0 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测部分合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=3 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=2 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')) TbData on TbType.InType=TbData.InType	


-----------------------------------------------------------------------------
2020-07-14 11:11:25
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:11:25
Text:	select Tb.GhType,sum(Tb.GhWeight) as GhWeight,sum(tb.GhCount) as GhCount from (select TbGhType.GhType,isnull(TbGhInfo.HasSupplier,0) as GhWeight,isnull(TbGhInfo.GhCount,0) as GhCount from (select '供货' as GhType
                            union all
                            select '验收不合格' as GhType
                            union all
                            select '检测不合格' as GhType) TbGhType
                            left join(
                            --供货次数、总量
                            select isnull(sum(Tb.HasSupplier),0) as HasSupplier,isnull(sum(Tb.GhCount),0) as GhCount,'供货' as GhType from (select a.HasSupplier,isnull(b.GhCount,0) as GhCount from (select a.BatchPlanNum,sum(a.HasSupplier) as HasSupplier from TbSupplyListDetail a 
                            left join TbSupplyList s on a.BatchPlanNum=s.BatchPlanNum where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')
                            GROUP BY a.BatchPlanNum) a
                            left join(select Tb.BatchPlanNum,count(1) as GhCount from (select BatchPlanNum,ThisTime from TbSupplyListDetailHistory
                            group by BatchPlanNum,ThisTime) Tb group by Tb.BatchPlanNum) b on a.BatchPlanNum=b.BatchPlanNum) Tb 
                            union all
                            --验收不合格次数、验收不合格重量
                            select sum(TbSum.NoPass) as NoPass,sum(TbSum.YsNoPassCount) as YsNoPassCount,'验收不合格' as GhType from (select count(1) as YsNoPassCount,sum(Tb.NoPass) as NoPass from (select b.BatchPlanCode,c.ThisTime,sum(a.NoPass) as NoPass from TbInOrderItem a
                            left join TbInOrder b on a.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            left join TbSupplyListDetailHistory c on a.BatchPlanItemNewCode=c.BatchPlanItemNewCode
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033') and a.BatchPlanItemNewCode is not null and a.NoPass>0 
                            group by b.BatchPlanCode,c.ThisTime) Tb group by Tb.BatchPlanCode) TbSum
                            union all
                            --检测不合格次数、重量
                            select isnull(sum(Tb.JcNoPass),0) as JcNoPass,count(1) as JcNoPassCount,'检测不合格' as GhType from (select b.BatchPlanCode,d.ThisTime,Isnull(sum(c.PassCount),0) as JcNoPass from TbSampleOrderItem a
                            left join TbSampleOrder e on a.SampleOrderCode=e.SampleOrderCode
                            left join TbInOrderItem c on a.InOrderItemId=c.ID
                            left join TbSupplyListDetailHistory d on c.BatchPlanItemNewCode=d.BatchPlanItemNewCode
                            left join TbInOrder b on c.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')  and a.ChackState=2 and c.BatchPlanItemNewCode is not null
                            group by b.BatchPlanCode,d.ThisTime) Tb group by Tb.BatchPlanCode) TbGhInfo on TbGhType.GhType=TbGhInfo.GhType) Tb group by Tb.GhType	


-----------------------------------------------------------------------------
2020-07-14 11:11:25
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:11:25
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/StockTaking/Index


-----------------------------------------------------------------------------
2020-07-14 11:11:25
Text:	select * from TbSysDictionaryData where 1=1 and FDictionaryCode=@name order by DictionaryOrder asc	
Parameters:
@name[String] = MaterialType


-----------------------------------------------------------------------------
2020-07-14 11:11:28
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:12:01
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:12:01
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-14 11:12:01
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:12:01
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:12:02
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:12:02
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-14 11:12:02
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:12:02
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:12:02
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:12:02
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-14 11:12:02
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:12:02
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:12:02
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:12:02
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:12:02
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:12:02
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/InOrder/Index


-----------------------------------------------------------------------------
2020-07-14 11:12:02
Text:	 SELECT count(*) as r_cnt FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode]) WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode290)	
Parameters:
@ProcessFactoryCode290[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:12:02
Text:	 SELECT   TOP 50 [TbStockTaking].[ID],[TbStockTaking].[TakNum],[TbStockTaking].[TakDay],[TbStockTaking].[TotalInventory],[TbStockTaking].[TotalTak],[TbStockTaking].[TotalEarnOrLos],[TbStockTaking].[EarnOrLos],[TbStockTaking].[Remarks],[TbStockTaking].[InsertUserCode],[TbStockTaking].[InsertTime],[TbUser].[UserName],[TbCompany].[CompanyFullName] AS [FactoryName],[TbSysDictionaryData].[DictionaryText] AS [WarehouseTypeName] FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode])  WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode290) ORDER BY [TbStockTaking].[ID] DESC 	
Parameters:
@ProcessFactoryCode290[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:12:02
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:12:02
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:12:02
Text:	select Tb.DataMonth,ISNULL(sum(TbData.InorderCount),0) as InCount,ISNULL(sum(TbData.InCount),0) as InWeight from (select datepart(MONTH,dateadd(mm,-t.number,getdate())) as DataMonth
from
(select number from master..spt_values where type='P') t
where year(dateadd(mm,-t.number,getdate()))=year(getdate())) Tb 
left join (select COUNT(1) as InorderCount,SUM(a.InCount) as InCount,a.RebarType,datepart(year,a.InsertTime) InsertYear,datepart(MONTH,a.InsertTime) InsertMonth from TbInOrder a 
left join TbStorage b on a.StorageCode=b.StorageCode
where a.Examinestatus!='已退回' 
and a.Examinestatus!='已撤销' 
and datepart(year,a.InsertTime)=datepart(year,GETDATE())  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
group by a.RebarType,datepart(year,a.InsertTime),datepart(MONTH,a.InsertTime)) TbData on  Tb.DataMonth=TbData.InsertMonth
group by Tb.DataMonth order by Tb.DataMonth asc 	


-----------------------------------------------------------------------------
2020-07-14 11:12:03
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:12:03
Text:	select TbType.InType,isnull(TbData.InCount,0) as InCount from (select '入库单数' as InType
                           union all
                           select '未取样' as InType
                           union all
                           select '验收不合格' as InType
                           union all
                           select '检测部分合格' as InType
                           union all
                           select '检测不合格' as InType) TbType
                           left join(select '入库单数' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode 
                           where 1=1 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '未取样' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1 and a.SampleOrderState='取样未完成' and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '验收不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and NoPassTotal>0 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测部分合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=3 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=2 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')) TbData on TbType.InType=TbData.InType	


-----------------------------------------------------------------------------
2020-07-14 11:12:03
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:12:03
Text:	select Tb.GhType,sum(Tb.GhWeight) as GhWeight,sum(tb.GhCount) as GhCount from (select TbGhType.GhType,isnull(TbGhInfo.HasSupplier,0) as GhWeight,isnull(TbGhInfo.GhCount,0) as GhCount from (select '供货' as GhType
                            union all
                            select '验收不合格' as GhType
                            union all
                            select '检测不合格' as GhType) TbGhType
                            left join(
                            --供货次数、总量
                            select isnull(sum(Tb.HasSupplier),0) as HasSupplier,isnull(sum(Tb.GhCount),0) as GhCount,'供货' as GhType from (select a.HasSupplier,isnull(b.GhCount,0) as GhCount from (select a.BatchPlanNum,sum(a.HasSupplier) as HasSupplier from TbSupplyListDetail a 
                            left join TbSupplyList s on a.BatchPlanNum=s.BatchPlanNum where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')
                            GROUP BY a.BatchPlanNum) a
                            left join(select Tb.BatchPlanNum,count(1) as GhCount from (select BatchPlanNum,ThisTime from TbSupplyListDetailHistory
                            group by BatchPlanNum,ThisTime) Tb group by Tb.BatchPlanNum) b on a.BatchPlanNum=b.BatchPlanNum) Tb 
                            union all
                            --验收不合格次数、验收不合格重量
                            select sum(TbSum.NoPass) as NoPass,sum(TbSum.YsNoPassCount) as YsNoPassCount,'验收不合格' as GhType from (select count(1) as YsNoPassCount,sum(Tb.NoPass) as NoPass from (select b.BatchPlanCode,c.ThisTime,sum(a.NoPass) as NoPass from TbInOrderItem a
                            left join TbInOrder b on a.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            left join TbSupplyListDetailHistory c on a.BatchPlanItemNewCode=c.BatchPlanItemNewCode
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033') and a.BatchPlanItemNewCode is not null and a.NoPass>0 
                            group by b.BatchPlanCode,c.ThisTime) Tb group by Tb.BatchPlanCode) TbSum
                            union all
                            --检测不合格次数、重量
                            select isnull(sum(Tb.JcNoPass),0) as JcNoPass,count(1) as JcNoPassCount,'检测不合格' as GhType from (select b.BatchPlanCode,d.ThisTime,Isnull(sum(c.PassCount),0) as JcNoPass from TbSampleOrderItem a
                            left join TbSampleOrder e on a.SampleOrderCode=e.SampleOrderCode
                            left join TbInOrderItem c on a.InOrderItemId=c.ID
                            left join TbSupplyListDetailHistory d on c.BatchPlanItemNewCode=d.BatchPlanItemNewCode
                            left join TbInOrder b on c.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')  and a.ChackState=2 and c.BatchPlanItemNewCode is not null
                            group by b.BatchPlanCode,d.ThisTime) Tb group by Tb.BatchPlanCode) TbGhInfo on TbGhType.GhType=TbGhInfo.GhType) Tb group by Tb.GhType	


-----------------------------------------------------------------------------
2020-07-14 11:12:03
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:12:03
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/StockTaking/Index


-----------------------------------------------------------------------------
2020-07-14 11:12:03
Text:	select * from TbSysDictionaryData where 1=1 and FDictionaryCode=@name order by DictionaryOrder asc	
Parameters:
@name[String] = MaterialType


-----------------------------------------------------------------------------
2020-07-14 11:12:03
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:12:03
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:12:26
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:12:26
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-14 11:12:26
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:12:26
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:12:27
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:12:27
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-14 11:12:27
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:12:27
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:12:27
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:12:27
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:12:27
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-14 11:12:27
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:12:27
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:12:27
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:12:27
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:12:27
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:12:27
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:12:27
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/InOrder/Index


-----------------------------------------------------------------------------
2020-07-14 11:12:28
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:12:40
Text:	 SELECT count(*) as r_cnt FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode]) WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode291)	
Parameters:
@ProcessFactoryCode291[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:12:40
Text:	 SELECT   TOP 50 [TbStockTaking].[ID],[TbStockTaking].[TakNum],[TbStockTaking].[TakDay],[TbStockTaking].[TotalInventory],[TbStockTaking].[TotalTak],[TbStockTaking].[TotalEarnOrLos],[TbStockTaking].[EarnOrLos],[TbStockTaking].[Remarks],[TbStockTaking].[InsertUserCode],[TbStockTaking].[InsertTime],[TbUser].[UserName],[TbCompany].[CompanyFullName] AS [FactoryName],[TbSysDictionaryData].[DictionaryText] AS [WarehouseTypeName] FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode])  WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode291) ORDER BY [TbStockTaking].[ID] DESC 	
Parameters:
@ProcessFactoryCode291[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:12:47
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:12:47
Text:	select Tb.DataMonth,ISNULL(sum(TbData.InorderCount),0) as InCount,ISNULL(sum(TbData.InCount),0) as InWeight from (select datepart(MONTH,dateadd(mm,-t.number,getdate())) as DataMonth
from
(select number from master..spt_values where type='P') t
where year(dateadd(mm,-t.number,getdate()))=year(getdate())) Tb 
left join (select COUNT(1) as InorderCount,SUM(a.InCount) as InCount,a.RebarType,datepart(year,a.InsertTime) InsertYear,datepart(MONTH,a.InsertTime) InsertMonth from TbInOrder a 
left join TbStorage b on a.StorageCode=b.StorageCode
where a.Examinestatus!='已退回' 
and a.Examinestatus!='已撤销' 
and datepart(year,a.InsertTime)=datepart(year,GETDATE())  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
group by a.RebarType,datepart(year,a.InsertTime),datepart(MONTH,a.InsertTime)) TbData on  Tb.DataMonth=TbData.InsertMonth
group by Tb.DataMonth order by Tb.DataMonth asc 	


-----------------------------------------------------------------------------
2020-07-14 11:12:47
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:12:47
Text:	select TbType.InType,isnull(TbData.InCount,0) as InCount from (select '入库单数' as InType
                           union all
                           select '未取样' as InType
                           union all
                           select '验收不合格' as InType
                           union all
                           select '检测部分合格' as InType
                           union all
                           select '检测不合格' as InType) TbType
                           left join(select '入库单数' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode 
                           where 1=1 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '未取样' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1 and a.SampleOrderState='取样未完成' and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '验收不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and NoPassTotal>0 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测部分合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=3 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=2 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')) TbData on TbType.InType=TbData.InType	


-----------------------------------------------------------------------------
2020-07-14 11:12:47
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:12:47
Text:	select Tb.GhType,sum(Tb.GhWeight) as GhWeight,sum(tb.GhCount) as GhCount from (select TbGhType.GhType,isnull(TbGhInfo.HasSupplier,0) as GhWeight,isnull(TbGhInfo.GhCount,0) as GhCount from (select '供货' as GhType
                            union all
                            select '验收不合格' as GhType
                            union all
                            select '检测不合格' as GhType) TbGhType
                            left join(
                            --供货次数、总量
                            select isnull(sum(Tb.HasSupplier),0) as HasSupplier,isnull(sum(Tb.GhCount),0) as GhCount,'供货' as GhType from (select a.HasSupplier,isnull(b.GhCount,0) as GhCount from (select a.BatchPlanNum,sum(a.HasSupplier) as HasSupplier from TbSupplyListDetail a 
                            left join TbSupplyList s on a.BatchPlanNum=s.BatchPlanNum where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')
                            GROUP BY a.BatchPlanNum) a
                            left join(select Tb.BatchPlanNum,count(1) as GhCount from (select BatchPlanNum,ThisTime from TbSupplyListDetailHistory
                            group by BatchPlanNum,ThisTime) Tb group by Tb.BatchPlanNum) b on a.BatchPlanNum=b.BatchPlanNum) Tb 
                            union all
                            --验收不合格次数、验收不合格重量
                            select sum(TbSum.NoPass) as NoPass,sum(TbSum.YsNoPassCount) as YsNoPassCount,'验收不合格' as GhType from (select count(1) as YsNoPassCount,sum(Tb.NoPass) as NoPass from (select b.BatchPlanCode,c.ThisTime,sum(a.NoPass) as NoPass from TbInOrderItem a
                            left join TbInOrder b on a.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            left join TbSupplyListDetailHistory c on a.BatchPlanItemNewCode=c.BatchPlanItemNewCode
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033') and a.BatchPlanItemNewCode is not null and a.NoPass>0 
                            group by b.BatchPlanCode,c.ThisTime) Tb group by Tb.BatchPlanCode) TbSum
                            union all
                            --检测不合格次数、重量
                            select isnull(sum(Tb.JcNoPass),0) as JcNoPass,count(1) as JcNoPassCount,'检测不合格' as GhType from (select b.BatchPlanCode,d.ThisTime,Isnull(sum(c.PassCount),0) as JcNoPass from TbSampleOrderItem a
                            left join TbSampleOrder e on a.SampleOrderCode=e.SampleOrderCode
                            left join TbInOrderItem c on a.InOrderItemId=c.ID
                            left join TbSupplyListDetailHistory d on c.BatchPlanItemNewCode=d.BatchPlanItemNewCode
                            left join TbInOrder b on c.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')  and a.ChackState=2 and c.BatchPlanItemNewCode is not null
                            group by b.BatchPlanCode,d.ThisTime) Tb group by Tb.BatchPlanCode) TbGhInfo on TbGhType.GhType=TbGhInfo.GhType) Tb group by Tb.GhType	


-----------------------------------------------------------------------------
2020-07-14 11:12:47
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:12:47
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/StockTaking/Index


-----------------------------------------------------------------------------
2020-07-14 11:12:47
Text:	select * from TbSysDictionaryData where 1=1 and FDictionaryCode=@name order by DictionaryOrder asc	
Parameters:
@name[String] = MaterialType


-----------------------------------------------------------------------------
2020-07-14 11:13:37
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:13:37
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-14 11:13:37
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:13:37
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:13:38
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:13:38
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-14 11:13:38
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:13:38
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:13:38
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:13:38
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:13:38
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:13:38
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/InOrder/Index


-----------------------------------------------------------------------------
2020-07-14 11:13:38
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:13:39
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:13:39
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:13:39
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:13:39
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-14 11:13:39
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:13:40
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:14:21
Text:	 SELECT count(*) as r_cnt FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode]) WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode292)	
Parameters:
@ProcessFactoryCode292[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:14:21
Text:	 SELECT   TOP 50 [TbStockTaking].[ID],[TbStockTaking].[TakNum],[TbStockTaking].[TakDay],[TbStockTaking].[TotalInventory],[TbStockTaking].[TotalTak],[TbStockTaking].[TotalEarnOrLos],[TbStockTaking].[EarnOrLos],[TbStockTaking].[Remarks],[TbStockTaking].[InsertUserCode],[TbStockTaking].[InsertTime],[TbUser].[UserName],[TbCompany].[CompanyFullName] AS [FactoryName],[TbSysDictionaryData].[DictionaryText] AS [WarehouseTypeName] FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode])  WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode292) ORDER BY [TbStockTaking].[ID] DESC 	
Parameters:
@ProcessFactoryCode292[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:14:21
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:14:21
Text:	select Tb.DataMonth,ISNULL(sum(TbData.InorderCount),0) as InCount,ISNULL(sum(TbData.InCount),0) as InWeight from (select datepart(MONTH,dateadd(mm,-t.number,getdate())) as DataMonth
from
(select number from master..spt_values where type='P') t
where year(dateadd(mm,-t.number,getdate()))=year(getdate())) Tb 
left join (select COUNT(1) as InorderCount,SUM(a.InCount) as InCount,a.RebarType,datepart(year,a.InsertTime) InsertYear,datepart(MONTH,a.InsertTime) InsertMonth from TbInOrder a 
left join TbStorage b on a.StorageCode=b.StorageCode
where a.Examinestatus!='已退回' 
and a.Examinestatus!='已撤销' 
and datepart(year,a.InsertTime)=datepart(year,GETDATE())  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
group by a.RebarType,datepart(year,a.InsertTime),datepart(MONTH,a.InsertTime)) TbData on  Tb.DataMonth=TbData.InsertMonth
group by Tb.DataMonth order by Tb.DataMonth asc 	


-----------------------------------------------------------------------------
2020-07-14 11:14:21
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:14:21
Text:	select TbType.InType,isnull(TbData.InCount,0) as InCount from (select '入库单数' as InType
                           union all
                           select '未取样' as InType
                           union all
                           select '验收不合格' as InType
                           union all
                           select '检测部分合格' as InType
                           union all
                           select '检测不合格' as InType) TbType
                           left join(select '入库单数' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode 
                           where 1=1 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '未取样' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1 and a.SampleOrderState='取样未完成' and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '验收不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and NoPassTotal>0 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测部分合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=3 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=2 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')) TbData on TbType.InType=TbData.InType	


-----------------------------------------------------------------------------
2020-07-14 11:14:21
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:14:21
Text:	select Tb.GhType,sum(Tb.GhWeight) as GhWeight,sum(tb.GhCount) as GhCount from (select TbGhType.GhType,isnull(TbGhInfo.HasSupplier,0) as GhWeight,isnull(TbGhInfo.GhCount,0) as GhCount from (select '供货' as GhType
                            union all
                            select '验收不合格' as GhType
                            union all
                            select '检测不合格' as GhType) TbGhType
                            left join(
                            --供货次数、总量
                            select isnull(sum(Tb.HasSupplier),0) as HasSupplier,isnull(sum(Tb.GhCount),0) as GhCount,'供货' as GhType from (select a.HasSupplier,isnull(b.GhCount,0) as GhCount from (select a.BatchPlanNum,sum(a.HasSupplier) as HasSupplier from TbSupplyListDetail a 
                            left join TbSupplyList s on a.BatchPlanNum=s.BatchPlanNum where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')
                            GROUP BY a.BatchPlanNum) a
                            left join(select Tb.BatchPlanNum,count(1) as GhCount from (select BatchPlanNum,ThisTime from TbSupplyListDetailHistory
                            group by BatchPlanNum,ThisTime) Tb group by Tb.BatchPlanNum) b on a.BatchPlanNum=b.BatchPlanNum) Tb 
                            union all
                            --验收不合格次数、验收不合格重量
                            select sum(TbSum.NoPass) as NoPass,sum(TbSum.YsNoPassCount) as YsNoPassCount,'验收不合格' as GhType from (select count(1) as YsNoPassCount,sum(Tb.NoPass) as NoPass from (select b.BatchPlanCode,c.ThisTime,sum(a.NoPass) as NoPass from TbInOrderItem a
                            left join TbInOrder b on a.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            left join TbSupplyListDetailHistory c on a.BatchPlanItemNewCode=c.BatchPlanItemNewCode
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033') and a.BatchPlanItemNewCode is not null and a.NoPass>0 
                            group by b.BatchPlanCode,c.ThisTime) Tb group by Tb.BatchPlanCode) TbSum
                            union all
                            --检测不合格次数、重量
                            select isnull(sum(Tb.JcNoPass),0) as JcNoPass,count(1) as JcNoPassCount,'检测不合格' as GhType from (select b.BatchPlanCode,d.ThisTime,Isnull(sum(c.PassCount),0) as JcNoPass from TbSampleOrderItem a
                            left join TbSampleOrder e on a.SampleOrderCode=e.SampleOrderCode
                            left join TbInOrderItem c on a.InOrderItemId=c.ID
                            left join TbSupplyListDetailHistory d on c.BatchPlanItemNewCode=d.BatchPlanItemNewCode
                            left join TbInOrder b on c.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')  and a.ChackState=2 and c.BatchPlanItemNewCode is not null
                            group by b.BatchPlanCode,d.ThisTime) Tb group by Tb.BatchPlanCode) TbGhInfo on TbGhType.GhType=TbGhInfo.GhType) Tb group by Tb.GhType	


-----------------------------------------------------------------------------
2020-07-14 11:14:21
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:14:21
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/StockTaking/Index


-----------------------------------------------------------------------------
2020-07-14 11:14:22
Text:	select * from TbSysDictionaryData where 1=1 and FDictionaryCode=@name order by DictionaryOrder asc	
Parameters:
@name[String] = MaterialType


-----------------------------------------------------------------------------
2020-07-14 11:14:28
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:14:37
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)	


-----------------------------------------------------------------------------
2020-07-14 11:14:37
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:14:38
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)	


-----------------------------------------------------------------------------
2020-07-14 11:14:38
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:14:48
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:14:48
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-14 11:14:48
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:14:48
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:14:49
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:14:49
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-14 11:14:49
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:14:49
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:14:49
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:14:49
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-14 11:14:49
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:14:49
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:14:49
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:14:49
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:14:49
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:14:49
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:14:49
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/InOrder/Index


-----------------------------------------------------------------------------
2020-07-14 11:14:49
Text:	 SELECT count(*) as r_cnt FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode]) WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode293)	
Parameters:
@ProcessFactoryCode293[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:14:49
Text:	 SELECT   TOP 50 [TbStockTaking].[ID],[TbStockTaking].[TakNum],[TbStockTaking].[TakDay],[TbStockTaking].[TotalInventory],[TbStockTaking].[TotalTak],[TbStockTaking].[TotalEarnOrLos],[TbStockTaking].[EarnOrLos],[TbStockTaking].[Remarks],[TbStockTaking].[InsertUserCode],[TbStockTaking].[InsertTime],[TbUser].[UserName],[TbCompany].[CompanyFullName] AS [FactoryName],[TbSysDictionaryData].[DictionaryText] AS [WarehouseTypeName] FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode])  WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode293) ORDER BY [TbStockTaking].[ID] DESC 	
Parameters:
@ProcessFactoryCode293[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:14:50
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:14:50
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:14:50
Text:	select Tb.DataMonth,ISNULL(sum(TbData.InorderCount),0) as InCount,ISNULL(sum(TbData.InCount),0) as InWeight from (select datepart(MONTH,dateadd(mm,-t.number,getdate())) as DataMonth
from
(select number from master..spt_values where type='P') t
where year(dateadd(mm,-t.number,getdate()))=year(getdate())) Tb 
left join (select COUNT(1) as InorderCount,SUM(a.InCount) as InCount,a.RebarType,datepart(year,a.InsertTime) InsertYear,datepart(MONTH,a.InsertTime) InsertMonth from TbInOrder a 
left join TbStorage b on a.StorageCode=b.StorageCode
where a.Examinestatus!='已退回' 
and a.Examinestatus!='已撤销' 
and datepart(year,a.InsertTime)=datepart(year,GETDATE())  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
group by a.RebarType,datepart(year,a.InsertTime),datepart(MONTH,a.InsertTime)) TbData on  Tb.DataMonth=TbData.InsertMonth
group by Tb.DataMonth order by Tb.DataMonth asc 	


-----------------------------------------------------------------------------
2020-07-14 11:14:50
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:14:50
Text:	select TbType.InType,isnull(TbData.InCount,0) as InCount from (select '入库单数' as InType
                           union all
                           select '未取样' as InType
                           union all
                           select '验收不合格' as InType
                           union all
                           select '检测部分合格' as InType
                           union all
                           select '检测不合格' as InType) TbType
                           left join(select '入库单数' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode 
                           where 1=1 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '未取样' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1 and a.SampleOrderState='取样未完成' and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '验收不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and NoPassTotal>0 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测部分合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=3 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=2 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')) TbData on TbType.InType=TbData.InType	


-----------------------------------------------------------------------------
2020-07-14 11:14:50
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:14:50
Text:	select Tb.GhType,sum(Tb.GhWeight) as GhWeight,sum(tb.GhCount) as GhCount from (select TbGhType.GhType,isnull(TbGhInfo.HasSupplier,0) as GhWeight,isnull(TbGhInfo.GhCount,0) as GhCount from (select '供货' as GhType
                            union all
                            select '验收不合格' as GhType
                            union all
                            select '检测不合格' as GhType) TbGhType
                            left join(
                            --供货次数、总量
                            select isnull(sum(Tb.HasSupplier),0) as HasSupplier,isnull(sum(Tb.GhCount),0) as GhCount,'供货' as GhType from (select a.HasSupplier,isnull(b.GhCount,0) as GhCount from (select a.BatchPlanNum,sum(a.HasSupplier) as HasSupplier from TbSupplyListDetail a 
                            left join TbSupplyList s on a.BatchPlanNum=s.BatchPlanNum where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')
                            GROUP BY a.BatchPlanNum) a
                            left join(select Tb.BatchPlanNum,count(1) as GhCount from (select BatchPlanNum,ThisTime from TbSupplyListDetailHistory
                            group by BatchPlanNum,ThisTime) Tb group by Tb.BatchPlanNum) b on a.BatchPlanNum=b.BatchPlanNum) Tb 
                            union all
                            --验收不合格次数、验收不合格重量
                            select sum(TbSum.NoPass) as NoPass,sum(TbSum.YsNoPassCount) as YsNoPassCount,'验收不合格' as GhType from (select count(1) as YsNoPassCount,sum(Tb.NoPass) as NoPass from (select b.BatchPlanCode,c.ThisTime,sum(a.NoPass) as NoPass from TbInOrderItem a
                            left join TbInOrder b on a.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            left join TbSupplyListDetailHistory c on a.BatchPlanItemNewCode=c.BatchPlanItemNewCode
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033') and a.BatchPlanItemNewCode is not null and a.NoPass>0 
                            group by b.BatchPlanCode,c.ThisTime) Tb group by Tb.BatchPlanCode) TbSum
                            union all
                            --检测不合格次数、重量
                            select isnull(sum(Tb.JcNoPass),0) as JcNoPass,count(1) as JcNoPassCount,'检测不合格' as GhType from (select b.BatchPlanCode,d.ThisTime,Isnull(sum(c.PassCount),0) as JcNoPass from TbSampleOrderItem a
                            left join TbSampleOrder e on a.SampleOrderCode=e.SampleOrderCode
                            left join TbInOrderItem c on a.InOrderItemId=c.ID
                            left join TbSupplyListDetailHistory d on c.BatchPlanItemNewCode=d.BatchPlanItemNewCode
                            left join TbInOrder b on c.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')  and a.ChackState=2 and c.BatchPlanItemNewCode is not null
                            group by b.BatchPlanCode,d.ThisTime) Tb group by Tb.BatchPlanCode) TbGhInfo on TbGhType.GhType=TbGhInfo.GhType) Tb group by Tb.GhType	


-----------------------------------------------------------------------------
2020-07-14 11:14:50
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:14:50
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/StockTaking/Index


-----------------------------------------------------------------------------
2020-07-14 11:14:50
Text:	select * from TbSysDictionaryData where 1=1 and FDictionaryCode=@name order by DictionaryOrder asc	
Parameters:
@name[String] = MaterialType


-----------------------------------------------------------------------------
2020-07-14 11:14:50
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:14:55
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:14:55
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:14:55
Text:	select 
                           a.RootNumber,
                           a.SizeSelection,
                           a.MaterialCode,
                           a.WeightSmallPlanN,
                           b.MaterialName,
                           b.SpecificationModel,
                           b.MeasurementUnitZl,
                           c.CompanyFullName StartSiteName,
                           d.CompanyFullName EndSiteName
                           from 
                           (
                           select 
                           a.MaterialCode,
                           a.Size as SizeSelection,
                           a.StartSiteCode,
                           a.EndSiteCode,
                           sum(a.Number) RootNumber,
                           sum(a.Weight) WeightSmallPlanN
                           from TbCloutStockPlace a
                           left join TbRMProductionMaterial rmpm on a.CollarCode=rmpm.CollarCode
                           where a.State=1 
                           and (ISNULL(@ProjectId,'')='' OR a.ProjectId=@ProjectId)
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                            and a.EndSiteCode in('6372921375874657752')
                           group by a.MaterialCode,a.Size,a.StartSiteCode,a.EndSiteCode
                           ) a
                           left join TbRawMaterialArchives b on a.MaterialCode=b.MaterialCode
                           left join TbCompany c on c.CompanyCode=a.StartSiteCode
                           left join TbCompany d on d.CompanyCode=a.EndSiteCode
                           where 1=1 
                           and (ISNULL(@MaterialName,'')='' or b.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or b.SpecificationModel like '%'+@SpecificationModel+'%')	
Parameters:
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 
@BegTime[DateTime] = 
@EndTime[DateTime] = 


-----------------------------------------------------------------------------
2020-07-14 11:14:55
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode asc)AS Row, * from (select 
                           a.RootNumber,
                           a.SizeSelection,
                           a.MaterialCode,
                           a.WeightSmallPlanN,
                           b.MaterialName,
                           b.SpecificationModel,
                           b.MeasurementUnitZl,
                           c.CompanyFullName StartSiteName,
                           d.CompanyFullName EndSiteName
                           from 
                           (
                           select 
                           a.MaterialCode,
                           a.Size as SizeSelection,
                           a.StartSiteCode,
                           a.EndSiteCode,
                           sum(a.Number) RootNumber,
                           sum(a.Weight) WeightSmallPlanN
                           from TbCloutStockPlace a
                           left join TbRMProductionMaterial rmpm on a.CollarCode=rmpm.CollarCode
                           where a.State=1 
                           and (ISNULL(@ProjectId,'')='' OR a.ProjectId=@ProjectId)
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                            and a.EndSiteCode in('6372921375874657752')
                           group by a.MaterialCode,a.Size,a.StartSiteCode,a.EndSiteCode
                           ) a
                           left join TbRawMaterialArchives b on a.MaterialCode=b.MaterialCode
                           left join TbCompany c on c.CompanyCode=a.StartSiteCode
                           left join TbCompany d on d.CompanyCode=a.EndSiteCode
                           where 1=1 
                           and (ISNULL(@MaterialName,'')='' or b.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or b.SpecificationModel like '%'+@SpecificationModel+'%')) as a)  SELECT * FROM temptbl where Row between 1 and 50	
Parameters:
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 
@BegTime[DateTime] = 
@EndTime[DateTime] = 


-----------------------------------------------------------------------------
2020-07-14 11:14:59
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)	


-----------------------------------------------------------------------------
2020-07-14 11:14:59
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:15:00
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)	


-----------------------------------------------------------------------------
2020-07-14 11:15:00
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:16:18
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:16:18
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-14 11:16:18
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:16:18
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:16:18
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:16:18
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-14 11:16:18
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:16:18
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:16:18
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:16:18
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-14 11:16:18
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:16:18
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:16:18
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:16:18
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:16:18
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:16:18
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/InOrder/Index


-----------------------------------------------------------------------------
2020-07-14 11:16:18
Text:	 SELECT count(*) as r_cnt FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode]) WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode294)	
Parameters:
@ProcessFactoryCode294[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:16:18
Text:	 SELECT   TOP 50 [TbStockTaking].[ID],[TbStockTaking].[TakNum],[TbStockTaking].[TakDay],[TbStockTaking].[TotalInventory],[TbStockTaking].[TotalTak],[TbStockTaking].[TotalEarnOrLos],[TbStockTaking].[EarnOrLos],[TbStockTaking].[Remarks],[TbStockTaking].[InsertUserCode],[TbStockTaking].[InsertTime],[TbUser].[UserName],[TbCompany].[CompanyFullName] AS [FactoryName],[TbSysDictionaryData].[DictionaryText] AS [WarehouseTypeName] FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode])  WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode294) ORDER BY [TbStockTaking].[ID] DESC 	
Parameters:
@ProcessFactoryCode294[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:16:19
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:16:19
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:16:19
Text:	select Tb.DataMonth,ISNULL(sum(TbData.InorderCount),0) as InCount,ISNULL(sum(TbData.InCount),0) as InWeight from (select datepart(MONTH,dateadd(mm,-t.number,getdate())) as DataMonth
from
(select number from master..spt_values where type='P') t
where year(dateadd(mm,-t.number,getdate()))=year(getdate())) Tb 
left join (select COUNT(1) as InorderCount,SUM(a.InCount) as InCount,a.RebarType,datepart(year,a.InsertTime) InsertYear,datepart(MONTH,a.InsertTime) InsertMonth from TbInOrder a 
left join TbStorage b on a.StorageCode=b.StorageCode
where a.Examinestatus!='已退回' 
and a.Examinestatus!='已撤销' 
and datepart(year,a.InsertTime)=datepart(year,GETDATE())  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
group by a.RebarType,datepart(year,a.InsertTime),datepart(MONTH,a.InsertTime)) TbData on  Tb.DataMonth=TbData.InsertMonth
group by Tb.DataMonth order by Tb.DataMonth asc 	


-----------------------------------------------------------------------------
2020-07-14 11:16:19
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:16:19
Text:	select TbType.InType,isnull(TbData.InCount,0) as InCount from (select '入库单数' as InType
                           union all
                           select '未取样' as InType
                           union all
                           select '验收不合格' as InType
                           union all
                           select '检测部分合格' as InType
                           union all
                           select '检测不合格' as InType) TbType
                           left join(select '入库单数' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode 
                           where 1=1 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '未取样' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1 and a.SampleOrderState='取样未完成' and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '验收不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and NoPassTotal>0 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测部分合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=3 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=2 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')) TbData on TbType.InType=TbData.InType	


-----------------------------------------------------------------------------
2020-07-14 11:16:19
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:16:19
Text:	select Tb.GhType,sum(Tb.GhWeight) as GhWeight,sum(tb.GhCount) as GhCount from (select TbGhType.GhType,isnull(TbGhInfo.HasSupplier,0) as GhWeight,isnull(TbGhInfo.GhCount,0) as GhCount from (select '供货' as GhType
                            union all
                            select '验收不合格' as GhType
                            union all
                            select '检测不合格' as GhType) TbGhType
                            left join(
                            --供货次数、总量
                            select isnull(sum(Tb.HasSupplier),0) as HasSupplier,isnull(sum(Tb.GhCount),0) as GhCount,'供货' as GhType from (select a.HasSupplier,isnull(b.GhCount,0) as GhCount from (select a.BatchPlanNum,sum(a.HasSupplier) as HasSupplier from TbSupplyListDetail a 
                            left join TbSupplyList s on a.BatchPlanNum=s.BatchPlanNum where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')
                            GROUP BY a.BatchPlanNum) a
                            left join(select Tb.BatchPlanNum,count(1) as GhCount from (select BatchPlanNum,ThisTime from TbSupplyListDetailHistory
                            group by BatchPlanNum,ThisTime) Tb group by Tb.BatchPlanNum) b on a.BatchPlanNum=b.BatchPlanNum) Tb 
                            union all
                            --验收不合格次数、验收不合格重量
                            select sum(TbSum.NoPass) as NoPass,sum(TbSum.YsNoPassCount) as YsNoPassCount,'验收不合格' as GhType from (select count(1) as YsNoPassCount,sum(Tb.NoPass) as NoPass from (select b.BatchPlanCode,c.ThisTime,sum(a.NoPass) as NoPass from TbInOrderItem a
                            left join TbInOrder b on a.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            left join TbSupplyListDetailHistory c on a.BatchPlanItemNewCode=c.BatchPlanItemNewCode
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033') and a.BatchPlanItemNewCode is not null and a.NoPass>0 
                            group by b.BatchPlanCode,c.ThisTime) Tb group by Tb.BatchPlanCode) TbSum
                            union all
                            --检测不合格次数、重量
                            select isnull(sum(Tb.JcNoPass),0) as JcNoPass,count(1) as JcNoPassCount,'检测不合格' as GhType from (select b.BatchPlanCode,d.ThisTime,Isnull(sum(c.PassCount),0) as JcNoPass from TbSampleOrderItem a
                            left join TbSampleOrder e on a.SampleOrderCode=e.SampleOrderCode
                            left join TbInOrderItem c on a.InOrderItemId=c.ID
                            left join TbSupplyListDetailHistory d on c.BatchPlanItemNewCode=d.BatchPlanItemNewCode
                            left join TbInOrder b on c.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')  and a.ChackState=2 and c.BatchPlanItemNewCode is not null
                            group by b.BatchPlanCode,d.ThisTime) Tb group by Tb.BatchPlanCode) TbGhInfo on TbGhType.GhType=TbGhInfo.GhType) Tb group by Tb.GhType	


-----------------------------------------------------------------------------
2020-07-14 11:16:19
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:16:19
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/StockTaking/Index


-----------------------------------------------------------------------------
2020-07-14 11:16:19
Text:	select * from TbSysDictionaryData where 1=1 and FDictionaryCode=@name order by DictionaryOrder asc	
Parameters:
@name[String] = MaterialType


-----------------------------------------------------------------------------
2020-07-14 11:16:19
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:16:20
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:16:23
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:16:23
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:16:23
Text:	select 
                           a.RootNumber,
                           a.SizeSelection,
                           a.MaterialCode,
                           a.WeightSmallPlanN,
                           b.MaterialName,
                           b.SpecificationModel,
                           b.MeasurementUnitZl,
                           c.CompanyFullName StartSiteName,
                           d.CompanyFullName EndSiteName
                           from 
                           (
                           select 
                           a.MaterialCode,
                           a.Size as SizeSelection,
                           a.StartSiteCode,
                           a.EndSiteCode,
                           sum(a.Number) RootNumber,
                           sum(a.Weight) WeightSmallPlanN
                           from TbCloutStockPlace a
                           left join TbRMProductionMaterial rmpm on a.CollarCode=rmpm.CollarCode
                           where a.State=1 
                           and (ISNULL(@ProjectId,'')='' OR a.ProjectId=@ProjectId)
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                            and a.EndSiteCode in('6372921375874657752')
                           group by a.MaterialCode,a.Size,a.StartSiteCode,a.EndSiteCode
                           ) a
                           left join TbRawMaterialArchives b on a.MaterialCode=b.MaterialCode
                           left join TbCompany c on c.CompanyCode=a.StartSiteCode
                           left join TbCompany d on d.CompanyCode=a.EndSiteCode
                           where 1=1 
                           and (ISNULL(@MaterialName,'')='' or b.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or b.SpecificationModel like '%'+@SpecificationModel+'%')	
Parameters:
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 
@BegTime[DateTime] = 
@EndTime[DateTime] = 


-----------------------------------------------------------------------------
2020-07-14 11:16:23
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode asc)AS Row, * from (select 
                           a.RootNumber,
                           a.SizeSelection,
                           a.MaterialCode,
                           a.WeightSmallPlanN,
                           b.MaterialName,
                           b.SpecificationModel,
                           b.MeasurementUnitZl,
                           c.CompanyFullName StartSiteName,
                           d.CompanyFullName EndSiteName
                           from 
                           (
                           select 
                           a.MaterialCode,
                           a.Size as SizeSelection,
                           a.StartSiteCode,
                           a.EndSiteCode,
                           sum(a.Number) RootNumber,
                           sum(a.Weight) WeightSmallPlanN
                           from TbCloutStockPlace a
                           left join TbRMProductionMaterial rmpm on a.CollarCode=rmpm.CollarCode
                           where a.State=1 
                           and (ISNULL(@ProjectId,'')='' OR a.ProjectId=@ProjectId)
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                            and a.EndSiteCode in('6372921375874657752')
                           group by a.MaterialCode,a.Size,a.StartSiteCode,a.EndSiteCode
                           ) a
                           left join TbRawMaterialArchives b on a.MaterialCode=b.MaterialCode
                           left join TbCompany c on c.CompanyCode=a.StartSiteCode
                           left join TbCompany d on d.CompanyCode=a.EndSiteCode
                           where 1=1 
                           and (ISNULL(@MaterialName,'')='' or b.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or b.SpecificationModel like '%'+@SpecificationModel+'%')) as a)  SELECT * FROM temptbl where Row between 1 and 50	
Parameters:
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 
@BegTime[DateTime] = 
@EndTime[DateTime] = 


-----------------------------------------------------------------------------
2020-07-14 11:16:35
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)	


-----------------------------------------------------------------------------
2020-07-14 11:16:35
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:16:36
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)	


-----------------------------------------------------------------------------
2020-07-14 11:16:36
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:16:50
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:16:50
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/InOrder/Index


-----------------------------------------------------------------------------
2020-07-14 11:16:50
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:16:50
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:16:50
Text:	select ino.*,case when ISNULL(ino.ChackResult,0)=0 then '' when ISNULL(ino.ChackResult,0)=1 then '合格' when ISNULL(ino.ChackResult,0)=2 then '不合格' when ISNULL(ino.ChackResult,0)=3 then '部分合格' end ChackResultName,ur.UserName,ur1.UserName as DeliverUser,st.StorageName,sdd.DictionaryText as RebarTypeName,sp.SupplierName,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as BranchName,case when rmsp.DemandPlanCode is null then fbnp.RawMaterialDemandNum else rmsp.DemandPlanCode end DemandPlanCode,inoi.IsTh,sap.NoJcBhgCount from TbInOrder ino
							left join(select '退回' as IsTh,InOrderCode from TbInOrderItem where ReturnTime is not null group by InOrderCode) inoi on ino.InOrderCode=inoi.InOrderCode
                            left join TbUser ur on ino.InsertUserCode=ur.UserCode
                            left join TbUser ur1 on ino.UserCode=ur1.UserCode
                            left join TbStorage st on ino.StorageCode=st.StorageCode
                            left join TbSysDictionaryData sdd on ino.RebarType=sdd.DictionaryCode
                            left join TbCompany cp1 on ino.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on ino.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbSupplier sp on ino.SupplierCode=sp.SupplierCode
                            left join TbFactoryBatchNeedPlan fbnp on ino.BatchPlanCode=fbnp.BatchPlanNum
							left join TbRawMaterialMonthDemandSupplyPlan rmsp on fbnp.RawMaterialDemandNum=rmsp.SupplyPlanCode
							left join (	select a.InOrderCode,SUM(c.PassCount) as NoJcBhgCount from TbSampleOrder a
							left join TbSampleOrderItem b on a.SampleOrderCode=b.SampleOrderCode
							left join TbInOrderItem c on b.InOrderItemId=c.ID
							where b.ChackState=2 group by a.InOrderCode) sap on ino.InOrderCode=sap.InOrderCode where 1=1 and  ino.BatchPlanCode!='' and ino.BatchPlanCode is not null and (ino.SiteCode in('6372921375874657752') or ino.WorkAreaCode in('6372921396045311451','6372921398380745033')) and ino.ProjectId='6372912251695766465' and st.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-14 11:16:50
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by InOrderCode desc)AS Row, * from (select ino.*,case when ISNULL(ino.ChackResult,0)=0 then '' when ISNULL(ino.ChackResult,0)=1 then '合格' when ISNULL(ino.ChackResult,0)=2 then '不合格' when ISNULL(ino.ChackResult,0)=3 then '部分合格' end ChackResultName,ur.UserName,ur1.UserName as DeliverUser,st.StorageName,sdd.DictionaryText as RebarTypeName,sp.SupplierName,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as BranchName,case when rmsp.DemandPlanCode is null then fbnp.RawMaterialDemandNum else rmsp.DemandPlanCode end DemandPlanCode,inoi.IsTh,sap.NoJcBhgCount from TbInOrder ino
							left join(select '退回' as IsTh,InOrderCode from TbInOrderItem where ReturnTime is not null group by InOrderCode) inoi on ino.InOrderCode=inoi.InOrderCode
                            left join TbUser ur on ino.InsertUserCode=ur.UserCode
                            left join TbUser ur1 on ino.UserCode=ur1.UserCode
                            left join TbStorage st on ino.StorageCode=st.StorageCode
                            left join TbSysDictionaryData sdd on ino.RebarType=sdd.DictionaryCode
                            left join TbCompany cp1 on ino.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on ino.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbSupplier sp on ino.SupplierCode=sp.SupplierCode
                            left join TbFactoryBatchNeedPlan fbnp on ino.BatchPlanCode=fbnp.BatchPlanNum
							left join TbRawMaterialMonthDemandSupplyPlan rmsp on fbnp.RawMaterialDemandNum=rmsp.SupplyPlanCode
							left join (	select a.InOrderCode,SUM(c.PassCount) as NoJcBhgCount from TbSampleOrder a
							left join TbSampleOrderItem b on a.SampleOrderCode=b.SampleOrderCode
							left join TbInOrderItem c on b.InOrderItemId=c.ID
							where b.ChackState=2 group by a.InOrderCode) sap on ino.InOrderCode=sap.InOrderCode where 1=1 and  ino.BatchPlanCode!='' and ino.BatchPlanCode is not null and (ino.SiteCode in('6372921375874657752') or ino.WorkAreaCode in('6372921396045311451','6372921398380745033')) and ino.ProjectId='6372912251695766465' and st.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:16:50
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:16:50
Text:	select Tb.DataMonth,ISNULL(sum(TbData.InorderCount),0) as InCount,ISNULL(sum(TbData.InCount),0) as InWeight from (select datepart(MONTH,dateadd(mm,-t.number,getdate())) as DataMonth
from
(select number from master..spt_values where type='P') t
where year(dateadd(mm,-t.number,getdate()))=year(getdate())) Tb 
left join (select COUNT(1) as InorderCount,SUM(a.InCount) as InCount,a.RebarType,datepart(year,a.InsertTime) InsertYear,datepart(MONTH,a.InsertTime) InsertMonth from TbInOrder a 
left join TbStorage b on a.StorageCode=b.StorageCode
where a.Examinestatus!='已退回' 
and a.Examinestatus!='已撤销' 
and datepart(year,a.InsertTime)=datepart(year,GETDATE())  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
group by a.RebarType,datepart(year,a.InsertTime),datepart(MONTH,a.InsertTime)) TbData on  Tb.DataMonth=TbData.InsertMonth
group by Tb.DataMonth order by Tb.DataMonth asc 	


-----------------------------------------------------------------------------
2020-07-14 11:16:56
Text:	 SELECT count(*) as r_cnt FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode]) WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode295)	
Parameters:
@ProcessFactoryCode295[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:16:56
Text:	 SELECT   TOP 50 [TbStockTaking].[ID],[TbStockTaking].[TakNum],[TbStockTaking].[TakDay],[TbStockTaking].[TotalInventory],[TbStockTaking].[TotalTak],[TbStockTaking].[TotalEarnOrLos],[TbStockTaking].[EarnOrLos],[TbStockTaking].[Remarks],[TbStockTaking].[InsertUserCode],[TbStockTaking].[InsertTime],[TbUser].[UserName],[TbCompany].[CompanyFullName] AS [FactoryName],[TbSysDictionaryData].[DictionaryText] AS [WarehouseTypeName] FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode])  WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode295) ORDER BY [TbStockTaking].[ID] DESC 	
Parameters:
@ProcessFactoryCode295[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:16:56
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:16:56
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:16:56
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:16:56
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:16:56
Text:	select ino.*,case when ISNULL(ino.ChackResult,0)=0 then '' when ISNULL(ino.ChackResult,0)=1 then '合格' when ISNULL(ino.ChackResult,0)=2 then '不合格' when ISNULL(ino.ChackResult,0)=3 then '部分合格' end ChackResultName,ur.UserName,ur1.UserName as DeliverUser,st.StorageName,sdd.DictionaryText as RebarTypeName,sp.SupplierName,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as BranchName,case when rmsp.DemandPlanCode is null then fbnp.RawMaterialDemandNum else rmsp.DemandPlanCode end DemandPlanCode,inoi.IsTh,sap.NoJcBhgCount from TbInOrder ino
							left join(select '退回' as IsTh,InOrderCode from TbInOrderItem where ReturnTime is not null group by InOrderCode) inoi on ino.InOrderCode=inoi.InOrderCode
                            left join TbUser ur on ino.InsertUserCode=ur.UserCode
                            left join TbUser ur1 on ino.UserCode=ur1.UserCode
                            left join TbStorage st on ino.StorageCode=st.StorageCode
                            left join TbSysDictionaryData sdd on ino.RebarType=sdd.DictionaryCode
                            left join TbCompany cp1 on ino.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on ino.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbSupplier sp on ino.SupplierCode=sp.SupplierCode
                            left join TbFactoryBatchNeedPlan fbnp on ino.BatchPlanCode=fbnp.BatchPlanNum
							left join TbRawMaterialMonthDemandSupplyPlan rmsp on fbnp.RawMaterialDemandNum=rmsp.SupplyPlanCode
							left join (	select a.InOrderCode,SUM(c.PassCount) as NoJcBhgCount from TbSampleOrder a
							left join TbSampleOrderItem b on a.SampleOrderCode=b.SampleOrderCode
							left join TbInOrderItem c on b.InOrderItemId=c.ID
							where b.ChackState=2 group by a.InOrderCode) sap on ino.InOrderCode=sap.InOrderCode where 1=1 and  ino.BatchPlanCode!='' and ino.BatchPlanCode is not null and (ino.SiteCode in('6372921375874657752') or ino.WorkAreaCode in('6372921396045311451','6372921398380745033')) and ino.ProjectId='6372912251695766465' and st.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-14 11:16:56
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by InOrderCode desc)AS Row, * from (select ino.*,case when ISNULL(ino.ChackResult,0)=0 then '' when ISNULL(ino.ChackResult,0)=1 then '合格' when ISNULL(ino.ChackResult,0)=2 then '不合格' when ISNULL(ino.ChackResult,0)=3 then '部分合格' end ChackResultName,ur.UserName,ur1.UserName as DeliverUser,st.StorageName,sdd.DictionaryText as RebarTypeName,sp.SupplierName,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as BranchName,case when rmsp.DemandPlanCode is null then fbnp.RawMaterialDemandNum else rmsp.DemandPlanCode end DemandPlanCode,inoi.IsTh,sap.NoJcBhgCount from TbInOrder ino
							left join(select '退回' as IsTh,InOrderCode from TbInOrderItem where ReturnTime is not null group by InOrderCode) inoi on ino.InOrderCode=inoi.InOrderCode
                            left join TbUser ur on ino.InsertUserCode=ur.UserCode
                            left join TbUser ur1 on ino.UserCode=ur1.UserCode
                            left join TbStorage st on ino.StorageCode=st.StorageCode
                            left join TbSysDictionaryData sdd on ino.RebarType=sdd.DictionaryCode
                            left join TbCompany cp1 on ino.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on ino.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbSupplier sp on ino.SupplierCode=sp.SupplierCode
                            left join TbFactoryBatchNeedPlan fbnp on ino.BatchPlanCode=fbnp.BatchPlanNum
							left join TbRawMaterialMonthDemandSupplyPlan rmsp on fbnp.RawMaterialDemandNum=rmsp.SupplyPlanCode
							left join (	select a.InOrderCode,SUM(c.PassCount) as NoJcBhgCount from TbSampleOrder a
							left join TbSampleOrderItem b on a.SampleOrderCode=b.SampleOrderCode
							left join TbInOrderItem c on b.InOrderItemId=c.ID
							where b.ChackState=2 group by a.InOrderCode) sap on ino.InOrderCode=sap.InOrderCode where 1=1 and  ino.BatchPlanCode!='' and ino.BatchPlanCode is not null and (ino.SiteCode in('6372921375874657752') or ino.WorkAreaCode in('6372921396045311451','6372921398380745033')) and ino.ProjectId='6372912251695766465' and st.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:17:28
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:18:08
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:18:09
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-14 11:18:09
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:18:09
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:18:09
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:18:09
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-14 11:18:09
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:18:09
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:18:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:18:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:18:09
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-14 11:18:09
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:18:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:18:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:18:09
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:18:09
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/InOrder/Index


-----------------------------------------------------------------------------
2020-07-14 11:18:09
Text:	 SELECT count(*) as r_cnt FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode]) WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode296)	
Parameters:
@ProcessFactoryCode296[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:18:09
Text:	 SELECT   TOP 50 [TbStockTaking].[ID],[TbStockTaking].[TakNum],[TbStockTaking].[TakDay],[TbStockTaking].[TotalInventory],[TbStockTaking].[TotalTak],[TbStockTaking].[TotalEarnOrLos],[TbStockTaking].[EarnOrLos],[TbStockTaking].[Remarks],[TbStockTaking].[InsertUserCode],[TbStockTaking].[InsertTime],[TbUser].[UserName],[TbCompany].[CompanyFullName] AS [FactoryName],[TbSysDictionaryData].[DictionaryText] AS [WarehouseTypeName] FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode])  WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode296) ORDER BY [TbStockTaking].[ID] DESC 	
Parameters:
@ProcessFactoryCode296[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:18:10
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:18:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:18:10
Text:	select Tb.DataMonth,ISNULL(sum(TbData.InorderCount),0) as InCount,ISNULL(sum(TbData.InCount),0) as InWeight from (select datepart(MONTH,dateadd(mm,-t.number,getdate())) as DataMonth
from
(select number from master..spt_values where type='P') t
where year(dateadd(mm,-t.number,getdate()))=year(getdate())) Tb 
left join (select COUNT(1) as InorderCount,SUM(a.InCount) as InCount,a.RebarType,datepart(year,a.InsertTime) InsertYear,datepart(MONTH,a.InsertTime) InsertMonth from TbInOrder a 
left join TbStorage b on a.StorageCode=b.StorageCode
where a.Examinestatus!='已退回' 
and a.Examinestatus!='已撤销' 
and datepart(year,a.InsertTime)=datepart(year,GETDATE())  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
group by a.RebarType,datepart(year,a.InsertTime),datepart(MONTH,a.InsertTime)) TbData on  Tb.DataMonth=TbData.InsertMonth
group by Tb.DataMonth order by Tb.DataMonth asc 	


-----------------------------------------------------------------------------
2020-07-14 11:18:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:18:10
Text:	select TbType.InType,isnull(TbData.InCount,0) as InCount from (select '入库单数' as InType
                           union all
                           select '未取样' as InType
                           union all
                           select '验收不合格' as InType
                           union all
                           select '检测部分合格' as InType
                           union all
                           select '检测不合格' as InType) TbType
                           left join(select '入库单数' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode 
                           where 1=1 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '未取样' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1 and a.SampleOrderState='取样未完成' and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '验收不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and NoPassTotal>0 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测部分合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=3 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=2 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')) TbData on TbType.InType=TbData.InType	


-----------------------------------------------------------------------------
2020-07-14 11:18:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:18:10
Text:	select Tb.GhType,sum(Tb.GhWeight) as GhWeight,sum(tb.GhCount) as GhCount from (select TbGhType.GhType,isnull(TbGhInfo.HasSupplier,0) as GhWeight,isnull(TbGhInfo.GhCount,0) as GhCount from (select '供货' as GhType
                            union all
                            select '验收不合格' as GhType
                            union all
                            select '检测不合格' as GhType) TbGhType
                            left join(
                            --供货次数、总量
                            select isnull(sum(Tb.HasSupplier),0) as HasSupplier,isnull(sum(Tb.GhCount),0) as GhCount,'供货' as GhType from (select a.HasSupplier,isnull(b.GhCount,0) as GhCount from (select a.BatchPlanNum,sum(a.HasSupplier) as HasSupplier from TbSupplyListDetail a 
                            left join TbSupplyList s on a.BatchPlanNum=s.BatchPlanNum where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')
                            GROUP BY a.BatchPlanNum) a
                            left join(select Tb.BatchPlanNum,count(1) as GhCount from (select BatchPlanNum,ThisTime from TbSupplyListDetailHistory
                            group by BatchPlanNum,ThisTime) Tb group by Tb.BatchPlanNum) b on a.BatchPlanNum=b.BatchPlanNum) Tb 
                            union all
                            --验收不合格次数、验收不合格重量
                            select sum(TbSum.NoPass) as NoPass,sum(TbSum.YsNoPassCount) as YsNoPassCount,'验收不合格' as GhType from (select count(1) as YsNoPassCount,sum(Tb.NoPass) as NoPass from (select b.BatchPlanCode,c.ThisTime,sum(a.NoPass) as NoPass from TbInOrderItem a
                            left join TbInOrder b on a.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            left join TbSupplyListDetailHistory c on a.BatchPlanItemNewCode=c.BatchPlanItemNewCode
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033') and a.BatchPlanItemNewCode is not null and a.NoPass>0 
                            group by b.BatchPlanCode,c.ThisTime) Tb group by Tb.BatchPlanCode) TbSum
                            union all
                            --检测不合格次数、重量
                            select isnull(sum(Tb.JcNoPass),0) as JcNoPass,count(1) as JcNoPassCount,'检测不合格' as GhType from (select b.BatchPlanCode,d.ThisTime,Isnull(sum(c.PassCount),0) as JcNoPass from TbSampleOrderItem a
                            left join TbSampleOrder e on a.SampleOrderCode=e.SampleOrderCode
                            left join TbInOrderItem c on a.InOrderItemId=c.ID
                            left join TbSupplyListDetailHistory d on c.BatchPlanItemNewCode=d.BatchPlanItemNewCode
                            left join TbInOrder b on c.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')  and a.ChackState=2 and c.BatchPlanItemNewCode is not null
                            group by b.BatchPlanCode,d.ThisTime) Tb group by Tb.BatchPlanCode) TbGhInfo on TbGhType.GhType=TbGhInfo.GhType) Tb group by Tb.GhType	


-----------------------------------------------------------------------------
2020-07-14 11:18:10
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/StockTaking/Index


-----------------------------------------------------------------------------
2020-07-14 11:18:10
Text:	select * from TbSysDictionaryData where 1=1 and FDictionaryCode=@name order by DictionaryOrder asc	
Parameters:
@name[String] = MaterialType


-----------------------------------------------------------------------------
2020-07-14 11:18:10
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:19:00
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:19:00
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-14 11:19:00
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:19:00
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:19:01
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:19:01
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-14 11:19:01
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:19:01
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:19:01
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:19:01
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-14 11:19:01
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:19:01
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:19:01
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:19:01
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:19:01
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/InOrder/Index


-----------------------------------------------------------------------------
2020-07-14 11:19:01
Text:	 SELECT count(*) as r_cnt FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode]) WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode297)	
Parameters:
@ProcessFactoryCode297[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:19:01
Text:	 SELECT   TOP 50 [TbStockTaking].[ID],[TbStockTaking].[TakNum],[TbStockTaking].[TakDay],[TbStockTaking].[TotalInventory],[TbStockTaking].[TotalTak],[TbStockTaking].[TotalEarnOrLos],[TbStockTaking].[EarnOrLos],[TbStockTaking].[Remarks],[TbStockTaking].[InsertUserCode],[TbStockTaking].[InsertTime],[TbUser].[UserName],[TbCompany].[CompanyFullName] AS [FactoryName],[TbSysDictionaryData].[DictionaryText] AS [WarehouseTypeName] FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode])  WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode297) ORDER BY [TbStockTaking].[ID] DESC 	
Parameters:
@ProcessFactoryCode297[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:19:02
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:19:02
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:19:02
Text:	select Tb.DataMonth,ISNULL(sum(TbData.InorderCount),0) as InCount,ISNULL(sum(TbData.InCount),0) as InWeight from (select datepart(MONTH,dateadd(mm,-t.number,getdate())) as DataMonth
from
(select number from master..spt_values where type='P') t
where year(dateadd(mm,-t.number,getdate()))=year(getdate())) Tb 
left join (select COUNT(1) as InorderCount,SUM(a.InCount) as InCount,a.RebarType,datepart(year,a.InsertTime) InsertYear,datepart(MONTH,a.InsertTime) InsertMonth from TbInOrder a 
left join TbStorage b on a.StorageCode=b.StorageCode
where a.Examinestatus!='已退回' 
and a.Examinestatus!='已撤销' 
and datepart(year,a.InsertTime)=datepart(year,GETDATE())  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
group by a.RebarType,datepart(year,a.InsertTime),datepart(MONTH,a.InsertTime)) TbData on  Tb.DataMonth=TbData.InsertMonth
group by Tb.DataMonth order by Tb.DataMonth asc 	


-----------------------------------------------------------------------------
2020-07-14 11:19:02
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:19:02
Text:	select TbType.InType,isnull(TbData.InCount,0) as InCount from (select '入库单数' as InType
                           union all
                           select '未取样' as InType
                           union all
                           select '验收不合格' as InType
                           union all
                           select '检测部分合格' as InType
                           union all
                           select '检测不合格' as InType) TbType
                           left join(select '入库单数' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode 
                           where 1=1 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '未取样' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1 and a.SampleOrderState='取样未完成' and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '验收不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and NoPassTotal>0 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测部分合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=3 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=2 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')) TbData on TbType.InType=TbData.InType	


-----------------------------------------------------------------------------
2020-07-14 11:19:02
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:19:02
Text:	select Tb.GhType,sum(Tb.GhWeight) as GhWeight,sum(tb.GhCount) as GhCount from (select TbGhType.GhType,isnull(TbGhInfo.HasSupplier,0) as GhWeight,isnull(TbGhInfo.GhCount,0) as GhCount from (select '供货' as GhType
                            union all
                            select '验收不合格' as GhType
                            union all
                            select '检测不合格' as GhType) TbGhType
                            left join(
                            --供货次数、总量
                            select isnull(sum(Tb.HasSupplier),0) as HasSupplier,isnull(sum(Tb.GhCount),0) as GhCount,'供货' as GhType from (select a.HasSupplier,isnull(b.GhCount,0) as GhCount from (select a.BatchPlanNum,sum(a.HasSupplier) as HasSupplier from TbSupplyListDetail a 
                            left join TbSupplyList s on a.BatchPlanNum=s.BatchPlanNum where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')
                            GROUP BY a.BatchPlanNum) a
                            left join(select Tb.BatchPlanNum,count(1) as GhCount from (select BatchPlanNum,ThisTime from TbSupplyListDetailHistory
                            group by BatchPlanNum,ThisTime) Tb group by Tb.BatchPlanNum) b on a.BatchPlanNum=b.BatchPlanNum) Tb 
                            union all
                            --验收不合格次数、验收不合格重量
                            select sum(TbSum.NoPass) as NoPass,sum(TbSum.YsNoPassCount) as YsNoPassCount,'验收不合格' as GhType from (select count(1) as YsNoPassCount,sum(Tb.NoPass) as NoPass from (select b.BatchPlanCode,c.ThisTime,sum(a.NoPass) as NoPass from TbInOrderItem a
                            left join TbInOrder b on a.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            left join TbSupplyListDetailHistory c on a.BatchPlanItemNewCode=c.BatchPlanItemNewCode
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033') and a.BatchPlanItemNewCode is not null and a.NoPass>0 
                            group by b.BatchPlanCode,c.ThisTime) Tb group by Tb.BatchPlanCode) TbSum
                            union all
                            --检测不合格次数、重量
                            select isnull(sum(Tb.JcNoPass),0) as JcNoPass,count(1) as JcNoPassCount,'检测不合格' as GhType from (select b.BatchPlanCode,d.ThisTime,Isnull(sum(c.PassCount),0) as JcNoPass from TbSampleOrderItem a
                            left join TbSampleOrder e on a.SampleOrderCode=e.SampleOrderCode
                            left join TbInOrderItem c on a.InOrderItemId=c.ID
                            left join TbSupplyListDetailHistory d on c.BatchPlanItemNewCode=d.BatchPlanItemNewCode
                            left join TbInOrder b on c.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')  and a.ChackState=2 and c.BatchPlanItemNewCode is not null
                            group by b.BatchPlanCode,d.ThisTime) Tb group by Tb.BatchPlanCode) TbGhInfo on TbGhType.GhType=TbGhInfo.GhType) Tb group by Tb.GhType	


-----------------------------------------------------------------------------
2020-07-14 11:19:02
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/StockTaking/Index


-----------------------------------------------------------------------------
2020-07-14 11:19:02
Text:	select * from TbSysDictionaryData where 1=1 and FDictionaryCode=@name order by DictionaryOrder asc	
Parameters:
@name[String] = MaterialType


-----------------------------------------------------------------------------
2020-07-14 11:19:02
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:19:03
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:20:28
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:20:41
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:20:41
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-14 11:20:41
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:20:41
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:20:41
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:20:41
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-14 11:20:41
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:20:41
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:20:41
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:20:41
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-14 11:20:41
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:20:41
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:20:41
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:20:41
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:20:41
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:20:41
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/InOrder/Index


-----------------------------------------------------------------------------
2020-07-14 11:20:41
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:20:41
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:20:41
Text:	select ino.*,case when ISNULL(ino.ChackResult,0)=0 then '' when ISNULL(ino.ChackResult,0)=1 then '合格' when ISNULL(ino.ChackResult,0)=2 then '不合格' when ISNULL(ino.ChackResult,0)=3 then '部分合格' end ChackResultName,ur.UserName,ur1.UserName as DeliverUser,st.StorageName,sdd.DictionaryText as RebarTypeName,sp.SupplierName,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as BranchName,case when rmsp.DemandPlanCode is null then fbnp.RawMaterialDemandNum else rmsp.DemandPlanCode end DemandPlanCode,inoi.IsTh,sap.NoJcBhgCount from TbInOrder ino
							left join(select '退回' as IsTh,InOrderCode from TbInOrderItem where ReturnTime is not null group by InOrderCode) inoi on ino.InOrderCode=inoi.InOrderCode
                            left join TbUser ur on ino.InsertUserCode=ur.UserCode
                            left join TbUser ur1 on ino.UserCode=ur1.UserCode
                            left join TbStorage st on ino.StorageCode=st.StorageCode
                            left join TbSysDictionaryData sdd on ino.RebarType=sdd.DictionaryCode
                            left join TbCompany cp1 on ino.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on ino.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbSupplier sp on ino.SupplierCode=sp.SupplierCode
                            left join TbFactoryBatchNeedPlan fbnp on ino.BatchPlanCode=fbnp.BatchPlanNum
							left join TbRawMaterialMonthDemandSupplyPlan rmsp on fbnp.RawMaterialDemandNum=rmsp.SupplyPlanCode
							left join (	select a.InOrderCode,SUM(c.PassCount) as NoJcBhgCount from TbSampleOrder a
							left join TbSampleOrderItem b on a.SampleOrderCode=b.SampleOrderCode
							left join TbInOrderItem c on b.InOrderItemId=c.ID
							where b.ChackState=2 group by a.InOrderCode) sap on ino.InOrderCode=sap.InOrderCode where 1=1 and  ino.BatchPlanCode!='' and ino.BatchPlanCode is not null and (ino.SiteCode in('6372921375874657752') or ino.WorkAreaCode in('6372921396045311451','6372921398380745033')) and ino.ProjectId='6372912251695766465' and st.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-14 11:20:41
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by InOrderCode desc)AS Row, * from (select ino.*,case when ISNULL(ino.ChackResult,0)=0 then '' when ISNULL(ino.ChackResult,0)=1 then '合格' when ISNULL(ino.ChackResult,0)=2 then '不合格' when ISNULL(ino.ChackResult,0)=3 then '部分合格' end ChackResultName,ur.UserName,ur1.UserName as DeliverUser,st.StorageName,sdd.DictionaryText as RebarTypeName,sp.SupplierName,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as BranchName,case when rmsp.DemandPlanCode is null then fbnp.RawMaterialDemandNum else rmsp.DemandPlanCode end DemandPlanCode,inoi.IsTh,sap.NoJcBhgCount from TbInOrder ino
							left join(select '退回' as IsTh,InOrderCode from TbInOrderItem where ReturnTime is not null group by InOrderCode) inoi on ino.InOrderCode=inoi.InOrderCode
                            left join TbUser ur on ino.InsertUserCode=ur.UserCode
                            left join TbUser ur1 on ino.UserCode=ur1.UserCode
                            left join TbStorage st on ino.StorageCode=st.StorageCode
                            left join TbSysDictionaryData sdd on ino.RebarType=sdd.DictionaryCode
                            left join TbCompany cp1 on ino.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on ino.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbSupplier sp on ino.SupplierCode=sp.SupplierCode
                            left join TbFactoryBatchNeedPlan fbnp on ino.BatchPlanCode=fbnp.BatchPlanNum
							left join TbRawMaterialMonthDemandSupplyPlan rmsp on fbnp.RawMaterialDemandNum=rmsp.SupplyPlanCode
							left join (	select a.InOrderCode,SUM(c.PassCount) as NoJcBhgCount from TbSampleOrder a
							left join TbSampleOrderItem b on a.SampleOrderCode=b.SampleOrderCode
							left join TbInOrderItem c on b.InOrderItemId=c.ID
							where b.ChackState=2 group by a.InOrderCode) sap on ino.InOrderCode=sap.InOrderCode where 1=1 and  ino.BatchPlanCode!='' and ino.BatchPlanCode is not null and (ino.SiteCode in('6372921375874657752') or ino.WorkAreaCode in('6372921396045311451','6372921398380745033')) and ino.ProjectId='6372912251695766465' and st.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:20:42
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:20:42
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:20:42
Text:	select Tb.DataMonth,ISNULL(sum(TbData.InorderCount),0) as InCount,ISNULL(sum(TbData.InCount),0) as InWeight from (select datepart(MONTH,dateadd(mm,-t.number,getdate())) as DataMonth
from
(select number from master..spt_values where type='P') t
where year(dateadd(mm,-t.number,getdate()))=year(getdate())) Tb 
left join (select COUNT(1) as InorderCount,SUM(a.InCount) as InCount,a.RebarType,datepart(year,a.InsertTime) InsertYear,datepart(MONTH,a.InsertTime) InsertMonth from TbInOrder a 
left join TbStorage b on a.StorageCode=b.StorageCode
where a.Examinestatus!='已退回' 
and a.Examinestatus!='已撤销' 
and datepart(year,a.InsertTime)=datepart(year,GETDATE())  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
group by a.RebarType,datepart(year,a.InsertTime),datepart(MONTH,a.InsertTime)) TbData on  Tb.DataMonth=TbData.InsertMonth
group by Tb.DataMonth order by Tb.DataMonth asc 	


-----------------------------------------------------------------------------
2020-07-14 11:20:42
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:20:42
Text:	select TbType.InType,isnull(TbData.InCount,0) as InCount from (select '入库单数' as InType
                           union all
                           select '未取样' as InType
                           union all
                           select '验收不合格' as InType
                           union all
                           select '检测部分合格' as InType
                           union all
                           select '检测不合格' as InType) TbType
                           left join(select '入库单数' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode 
                           where 1=1 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '未取样' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1 and a.SampleOrderState='取样未完成' and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '验收不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and NoPassTotal>0 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测部分合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=3 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=2 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')) TbData on TbType.InType=TbData.InType	


-----------------------------------------------------------------------------
2020-07-14 11:20:42
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:20:42
Text:	select Tb.GhType,sum(Tb.GhWeight) as GhWeight,sum(tb.GhCount) as GhCount from (select TbGhType.GhType,isnull(TbGhInfo.HasSupplier,0) as GhWeight,isnull(TbGhInfo.GhCount,0) as GhCount from (select '供货' as GhType
                            union all
                            select '验收不合格' as GhType
                            union all
                            select '检测不合格' as GhType) TbGhType
                            left join(
                            --供货次数、总量
                            select isnull(sum(Tb.HasSupplier),0) as HasSupplier,isnull(sum(Tb.GhCount),0) as GhCount,'供货' as GhType from (select a.HasSupplier,isnull(b.GhCount,0) as GhCount from (select a.BatchPlanNum,sum(a.HasSupplier) as HasSupplier from TbSupplyListDetail a 
                            left join TbSupplyList s on a.BatchPlanNum=s.BatchPlanNum where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')
                            GROUP BY a.BatchPlanNum) a
                            left join(select Tb.BatchPlanNum,count(1) as GhCount from (select BatchPlanNum,ThisTime from TbSupplyListDetailHistory
                            group by BatchPlanNum,ThisTime) Tb group by Tb.BatchPlanNum) b on a.BatchPlanNum=b.BatchPlanNum) Tb 
                            union all
                            --验收不合格次数、验收不合格重量
                            select sum(TbSum.NoPass) as NoPass,sum(TbSum.YsNoPassCount) as YsNoPassCount,'验收不合格' as GhType from (select count(1) as YsNoPassCount,sum(Tb.NoPass) as NoPass from (select b.BatchPlanCode,c.ThisTime,sum(a.NoPass) as NoPass from TbInOrderItem a
                            left join TbInOrder b on a.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            left join TbSupplyListDetailHistory c on a.BatchPlanItemNewCode=c.BatchPlanItemNewCode
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033') and a.BatchPlanItemNewCode is not null and a.NoPass>0 
                            group by b.BatchPlanCode,c.ThisTime) Tb group by Tb.BatchPlanCode) TbSum
                            union all
                            --检测不合格次数、重量
                            select isnull(sum(Tb.JcNoPass),0) as JcNoPass,count(1) as JcNoPassCount,'检测不合格' as GhType from (select b.BatchPlanCode,d.ThisTime,Isnull(sum(c.PassCount),0) as JcNoPass from TbSampleOrderItem a
                            left join TbSampleOrder e on a.SampleOrderCode=e.SampleOrderCode
                            left join TbInOrderItem c on a.InOrderItemId=c.ID
                            left join TbSupplyListDetailHistory d on c.BatchPlanItemNewCode=d.BatchPlanItemNewCode
                            left join TbInOrder b on c.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')  and a.ChackState=2 and c.BatchPlanItemNewCode is not null
                            group by b.BatchPlanCode,d.ThisTime) Tb group by Tb.BatchPlanCode) TbGhInfo on TbGhType.GhType=TbGhInfo.GhType) Tb group by Tb.GhType	


-----------------------------------------------------------------------------
2020-07-14 11:20:42
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/StockTaking/Index


-----------------------------------------------------------------------------
2020-07-14 11:20:42
Text:	select * from TbSysDictionaryData where 1=1 and FDictionaryCode=@name order by DictionaryOrder asc	
Parameters:
@name[String] = MaterialType


-----------------------------------------------------------------------------
2020-07-14 11:20:42
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:20:43
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:20:56
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:20:56
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:20:56
Text:	select 
                           a.RootNumber,
                           a.SizeSelection,
                           a.MaterialCode,
                           a.WeightSmallPlanN,
                           b.MaterialName,
                           b.SpecificationModel,
                           b.MeasurementUnitZl,
                           c.CompanyFullName StartSiteName,
                           d.CompanyFullName EndSiteName
                           from 
                           (
                           select 
                           a.MaterialCode,
                           a.Size as SizeSelection,
                           a.StartSiteCode,
                           a.EndSiteCode,
                           sum(a.Number) RootNumber,
                           sum(a.Weight) WeightSmallPlanN
                           from TbCloutStockPlace a
                           left join TbRMProductionMaterial rmpm on a.CollarCode=rmpm.CollarCode
                           where a.State=1 
                           and (ISNULL(@ProjectId,'')='' OR a.ProjectId=@ProjectId)
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                            and a.EndSiteCode in('6372921375874657752')
                           group by a.MaterialCode,a.Size,a.StartSiteCode,a.EndSiteCode
                           ) a
                           left join TbRawMaterialArchives b on a.MaterialCode=b.MaterialCode
                           left join TbCompany c on c.CompanyCode=a.StartSiteCode
                           left join TbCompany d on d.CompanyCode=a.EndSiteCode
                           where 1=1 
                           and (ISNULL(@MaterialName,'')='' or b.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or b.SpecificationModel like '%'+@SpecificationModel+'%')	
Parameters:
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 
@BegTime[DateTime] = 
@EndTime[DateTime] = 


-----------------------------------------------------------------------------
2020-07-14 11:20:56
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode asc)AS Row, * from (select 
                           a.RootNumber,
                           a.SizeSelection,
                           a.MaterialCode,
                           a.WeightSmallPlanN,
                           b.MaterialName,
                           b.SpecificationModel,
                           b.MeasurementUnitZl,
                           c.CompanyFullName StartSiteName,
                           d.CompanyFullName EndSiteName
                           from 
                           (
                           select 
                           a.MaterialCode,
                           a.Size as SizeSelection,
                           a.StartSiteCode,
                           a.EndSiteCode,
                           sum(a.Number) RootNumber,
                           sum(a.Weight) WeightSmallPlanN
                           from TbCloutStockPlace a
                           left join TbRMProductionMaterial rmpm on a.CollarCode=rmpm.CollarCode
                           where a.State=1 
                           and (ISNULL(@ProjectId,'')='' OR a.ProjectId=@ProjectId)
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                            and a.EndSiteCode in('6372921375874657752')
                           group by a.MaterialCode,a.Size,a.StartSiteCode,a.EndSiteCode
                           ) a
                           left join TbRawMaterialArchives b on a.MaterialCode=b.MaterialCode
                           left join TbCompany c on c.CompanyCode=a.StartSiteCode
                           left join TbCompany d on d.CompanyCode=a.EndSiteCode
                           where 1=1 
                           and (ISNULL(@MaterialName,'')='' or b.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or b.SpecificationModel like '%'+@SpecificationModel+'%')) as a)  SELECT * FROM temptbl where Row between 1 and 50	
Parameters:
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 
@BegTime[DateTime] = 
@EndTime[DateTime] = 


-----------------------------------------------------------------------------
2020-07-14 11:20:57
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)	


-----------------------------------------------------------------------------
2020-07-14 11:20:57
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:20:58
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)	


-----------------------------------------------------------------------------
2020-07-14 11:20:58
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:21:43
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:21:43
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-14 11:21:43
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:21:43
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:21:43
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-14 11:21:43
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:21:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:21:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:21:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:21:43
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:21:43
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:21:43
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:21:43
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:21:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:21:43
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:21:43
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-14 11:21:43
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:21:43
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:21:43
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/InOrder/Index


-----------------------------------------------------------------------------
2020-07-14 11:21:54
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:21:54
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:21:54
Text:	select ino.*,case when ISNULL(ino.ChackResult,0)=0 then '' when ISNULL(ino.ChackResult,0)=1 then '合格' when ISNULL(ino.ChackResult,0)=2 then '不合格' when ISNULL(ino.ChackResult,0)=3 then '部分合格' end ChackResultName,ur.UserName,ur1.UserName as DeliverUser,st.StorageName,sdd.DictionaryText as RebarTypeName,sp.SupplierName,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as BranchName,case when rmsp.DemandPlanCode is null then fbnp.RawMaterialDemandNum else rmsp.DemandPlanCode end DemandPlanCode,inoi.IsTh,sap.NoJcBhgCount from TbInOrder ino
							left join(select '退回' as IsTh,InOrderCode from TbInOrderItem where ReturnTime is not null group by InOrderCode) inoi on ino.InOrderCode=inoi.InOrderCode
                            left join TbUser ur on ino.InsertUserCode=ur.UserCode
                            left join TbUser ur1 on ino.UserCode=ur1.UserCode
                            left join TbStorage st on ino.StorageCode=st.StorageCode
                            left join TbSysDictionaryData sdd on ino.RebarType=sdd.DictionaryCode
                            left join TbCompany cp1 on ino.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on ino.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbSupplier sp on ino.SupplierCode=sp.SupplierCode
                            left join TbFactoryBatchNeedPlan fbnp on ino.BatchPlanCode=fbnp.BatchPlanNum
							left join TbRawMaterialMonthDemandSupplyPlan rmsp on fbnp.RawMaterialDemandNum=rmsp.SupplyPlanCode
							left join (	select a.InOrderCode,SUM(c.PassCount) as NoJcBhgCount from TbSampleOrder a
							left join TbSampleOrderItem b on a.SampleOrderCode=b.SampleOrderCode
							left join TbInOrderItem c on b.InOrderItemId=c.ID
							where b.ChackState=2 group by a.InOrderCode) sap on ino.InOrderCode=sap.InOrderCode where 1=1 and  ino.BatchPlanCode!='' and ino.BatchPlanCode is not null and (ino.SiteCode in('6372921375874657752') or ino.WorkAreaCode in('6372921396045311451','6372921398380745033')) and ino.ProjectId='6372912251695766465' and st.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-14 11:21:54
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:21:54
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by InOrderCode desc)AS Row, * from (select ino.*,case when ISNULL(ino.ChackResult,0)=0 then '' when ISNULL(ino.ChackResult,0)=1 then '合格' when ISNULL(ino.ChackResult,0)=2 then '不合格' when ISNULL(ino.ChackResult,0)=3 then '部分合格' end ChackResultName,ur.UserName,ur1.UserName as DeliverUser,st.StorageName,sdd.DictionaryText as RebarTypeName,sp.SupplierName,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as BranchName,case when rmsp.DemandPlanCode is null then fbnp.RawMaterialDemandNum else rmsp.DemandPlanCode end DemandPlanCode,inoi.IsTh,sap.NoJcBhgCount from TbInOrder ino
							left join(select '退回' as IsTh,InOrderCode from TbInOrderItem where ReturnTime is not null group by InOrderCode) inoi on ino.InOrderCode=inoi.InOrderCode
                            left join TbUser ur on ino.InsertUserCode=ur.UserCode
                            left join TbUser ur1 on ino.UserCode=ur1.UserCode
                            left join TbStorage st on ino.StorageCode=st.StorageCode
                            left join TbSysDictionaryData sdd on ino.RebarType=sdd.DictionaryCode
                            left join TbCompany cp1 on ino.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on ino.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbSupplier sp on ino.SupplierCode=sp.SupplierCode
                            left join TbFactoryBatchNeedPlan fbnp on ino.BatchPlanCode=fbnp.BatchPlanNum
							left join TbRawMaterialMonthDemandSupplyPlan rmsp on fbnp.RawMaterialDemandNum=rmsp.SupplyPlanCode
							left join (	select a.InOrderCode,SUM(c.PassCount) as NoJcBhgCount from TbSampleOrder a
							left join TbSampleOrderItem b on a.SampleOrderCode=b.SampleOrderCode
							left join TbInOrderItem c on b.InOrderItemId=c.ID
							where b.ChackState=2 group by a.InOrderCode) sap on ino.InOrderCode=sap.InOrderCode where 1=1 and  ino.BatchPlanCode!='' and ino.BatchPlanCode is not null and (ino.SiteCode in('6372921375874657752') or ino.WorkAreaCode in('6372921396045311451','6372921398380745033')) and ino.ProjectId='6372912251695766465' and st.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:21:54
Text:	select Tb.DataMonth,ISNULL(sum(TbData.InorderCount),0) as InCount,ISNULL(sum(TbData.InCount),0) as InWeight from (select datepart(MONTH,dateadd(mm,-t.number,getdate())) as DataMonth
from
(select number from master..spt_values where type='P') t
where year(dateadd(mm,-t.number,getdate()))=year(getdate())) Tb 
left join (select COUNT(1) as InorderCount,SUM(a.InCount) as InCount,a.RebarType,datepart(year,a.InsertTime) InsertYear,datepart(MONTH,a.InsertTime) InsertMonth from TbInOrder a 
left join TbStorage b on a.StorageCode=b.StorageCode
where a.Examinestatus!='已退回' 
and a.Examinestatus!='已撤销' 
and datepart(year,a.InsertTime)=datepart(year,GETDATE())  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
group by a.RebarType,datepart(year,a.InsertTime),datepart(MONTH,a.InsertTime)) TbData on  Tb.DataMonth=TbData.InsertMonth
group by Tb.DataMonth order by Tb.DataMonth asc 	


-----------------------------------------------------------------------------
2020-07-14 11:21:54
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:21:54
Text:	select TbType.InType,isnull(TbData.InCount,0) as InCount from (select '入库单数' as InType
                           union all
                           select '未取样' as InType
                           union all
                           select '验收不合格' as InType
                           union all
                           select '检测部分合格' as InType
                           union all
                           select '检测不合格' as InType) TbType
                           left join(select '入库单数' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode 
                           where 1=1 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '未取样' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1 and a.SampleOrderState='取样未完成' and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '验收不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and NoPassTotal>0 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测部分合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=3 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=2 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')) TbData on TbType.InType=TbData.InType	


-----------------------------------------------------------------------------
2020-07-14 11:21:54
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:21:54
Text:	select Tb.GhType,sum(Tb.GhWeight) as GhWeight,sum(tb.GhCount) as GhCount from (select TbGhType.GhType,isnull(TbGhInfo.HasSupplier,0) as GhWeight,isnull(TbGhInfo.GhCount,0) as GhCount from (select '供货' as GhType
                            union all
                            select '验收不合格' as GhType
                            union all
                            select '检测不合格' as GhType) TbGhType
                            left join(
                            --供货次数、总量
                            select isnull(sum(Tb.HasSupplier),0) as HasSupplier,isnull(sum(Tb.GhCount),0) as GhCount,'供货' as GhType from (select a.HasSupplier,isnull(b.GhCount,0) as GhCount from (select a.BatchPlanNum,sum(a.HasSupplier) as HasSupplier from TbSupplyListDetail a 
                            left join TbSupplyList s on a.BatchPlanNum=s.BatchPlanNum where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')
                            GROUP BY a.BatchPlanNum) a
                            left join(select Tb.BatchPlanNum,count(1) as GhCount from (select BatchPlanNum,ThisTime from TbSupplyListDetailHistory
                            group by BatchPlanNum,ThisTime) Tb group by Tb.BatchPlanNum) b on a.BatchPlanNum=b.BatchPlanNum) Tb 
                            union all
                            --验收不合格次数、验收不合格重量
                            select sum(TbSum.NoPass) as NoPass,sum(TbSum.YsNoPassCount) as YsNoPassCount,'验收不合格' as GhType from (select count(1) as YsNoPassCount,sum(Tb.NoPass) as NoPass from (select b.BatchPlanCode,c.ThisTime,sum(a.NoPass) as NoPass from TbInOrderItem a
                            left join TbInOrder b on a.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            left join TbSupplyListDetailHistory c on a.BatchPlanItemNewCode=c.BatchPlanItemNewCode
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033') and a.BatchPlanItemNewCode is not null and a.NoPass>0 
                            group by b.BatchPlanCode,c.ThisTime) Tb group by Tb.BatchPlanCode) TbSum
                            union all
                            --检测不合格次数、重量
                            select isnull(sum(Tb.JcNoPass),0) as JcNoPass,count(1) as JcNoPassCount,'检测不合格' as GhType from (select b.BatchPlanCode,d.ThisTime,Isnull(sum(c.PassCount),0) as JcNoPass from TbSampleOrderItem a
                            left join TbSampleOrder e on a.SampleOrderCode=e.SampleOrderCode
                            left join TbInOrderItem c on a.InOrderItemId=c.ID
                            left join TbSupplyListDetailHistory d on c.BatchPlanItemNewCode=d.BatchPlanItemNewCode
                            left join TbInOrder b on c.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')  and a.ChackState=2 and c.BatchPlanItemNewCode is not null
                            group by b.BatchPlanCode,d.ThisTime) Tb group by Tb.BatchPlanCode) TbGhInfo on TbGhType.GhType=TbGhInfo.GhType) Tb group by Tb.GhType	


-----------------------------------------------------------------------------
2020-07-14 11:21:54
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/StockTaking/Index


-----------------------------------------------------------------------------
2020-07-14 11:21:54
Text:	select * from TbSysDictionaryData where 1=1 and FDictionaryCode=@name order by DictionaryOrder asc	
Parameters:
@name[String] = MaterialType


-----------------------------------------------------------------------------
2020-07-14 11:23:25
Text:	 SELECT   TOP 1 * FROM [TbUser]  WHERE ([TbUser].[UserCode] = @UserCode1) AND ([TbUser].[UserPwd] = @UserPwd2) 	
Parameters:
@UserCode1[String] = 500000
@UserPwd2[String] = c4ca4238a0b923820dcc509a6f75849b


-----------------------------------------------------------------------------
2020-07-14 11:23:25
Text:	SELECT UserClosed FROM TbUser WHERE UserCode=@UserName	
Parameters:
@UserName[String] = 500000


-----------------------------------------------------------------------------
2020-07-14 11:23:25
Text:	select top 1 ur.ProjectId,pro.ProjectName,ur.OrgId,cm.CompanyFullName,cm.ParentCompanyCode,ur.OrgType,ur.UserCode as UserId,u.UserCode,u.UserName from TbUserRole ur 
left join TbCompany cm on ur.OrgId=cm.CompanyCode
left join TbProjectInfo pro on ur.ProjectId=pro.ProjectId
left join TbUser u on ur.UserCode=u.UserId
where u.UserCode=@UserCode and ur.Flag=0 group by ur.ProjectId,pro.ProjectName,ur.OrgId,cm.CompanyFullName,cm.ParentCompanyCode,ur.OrgType,ur.UserCode,u.UserCode,u.UserName order by OrgId asc	
Parameters:
@UserCode[String] = 500000


-----------------------------------------------------------------------------
2020-07-14 11:23:25
Text:	select distinct ur.RoleCode as RoleId,r.RoleCode,r.RoleName from TbUserRole ur
left join TbUser u on ur.UserCode=u.UserId
left join TbRole r on ur.RoleCode=r.RoleId
where u.UserCode=@UserCode and ProjectId=@ProjectId and OrgId=@OrgId and ur.Flag=0	
Parameters:
@UserCode[String] = 500000
@ProjectId[String] = 6372912251695766465
@OrgId[String] = 6372921375874657752


-----------------------------------------------------------------------------
2020-07-14 11:23:25
Text:	 SELECT   TOP 1 [TbCarInfoDetail].[ID] FROM [TbCarInfoDetail]  WHERE [TbCarInfoDetail].[UserCode] = @UserCode3 	
Parameters:
@UserCode3[String] = 500000


-----------------------------------------------------------------------------
2020-07-14 11:23:25
Text:	INSERT INTO [TbSysLog] ([ActionMenu],[ActionType],[HostName],[LogDate],[UserCode],[UserIP]) VALUES (@ActionMenu4,@ActionType5,@HostName6,@LogDate7,@UserCode8,@UserIP9);select scope_identity()	
Parameters:
@ActionMenu4[String] = 0
@ActionType5[String] = 登录系统
@HostName6[String] = 
@LogDate7[DateTime] = 2020/7/14 11:23:25
@UserCode8[String] = 500000
@UserIP9[String] = 192.168.3.222


-----------------------------------------------------------------------------
2020-07-14 11:23:26
Text:	select tsm.* from TbRoleMenu tum
                           left join TbSysMenu tsm on tum.MenuCode=tsm.MenuCode
                           where tsm.IsShow=0 and tsm.MenuType='PC' and tum.RoleCode in('6372919444627396738','6372919451594895243') order by tsm.Sort asc	


-----------------------------------------------------------------------------
2020-07-14 11:23:26
Text:	select 
                        	tsm.*
                        from TbUserMenu tum
                        left join TbSysMenu tsm on tum.MenuCode=tsm.MenuCode
                        where tsm.IsShow=0 and tsm.MenuType='PC' and tum.UserCode=@userCode order by tsm.Sort asc	
Parameters:
@userCode[String] = 6372930471544160074


-----------------------------------------------------------------------------
2020-07-14 11:23:26
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:23:26
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:23:26
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:23:26
Text:	select isnull(sum(TbCF.Capacity),0) as Capacity,isnull(sum(TbCF.WeightSmallPlan),0) as WeightSmallPlan,isnull(cast(sum(TbCF.WeightSmallPlan)/sum(TbCF.Capacity)*100 as decimal(18,2)),0) as ActualLoadNew from (select cf.Capacity,Tb1.WeightSmallPlan,cf.ProcessFactoryCode from TbCapacityFilling cf  
left join(
select SUM(Tb.WeightSmallPlan) as WeightSmallPlan,Tb.ProcessFactoryCode from (
                            select isnull(SUM(wod.WeightSmallPlan),0) as WeightSmallPlan,wo.ProcessFactoryCode from TbWorkOrder wo
                            left join TbWorkOrderDetail wod on wo.OrderCode=wod.OrderCode
                            where (ISNULL(@ProcessFactoryCode,'')='' or wo.ProcessFactoryCode=@ProcessFactoryCode)
                            and CONVERT(varchar(7), wo.DistributionTime, 120)=@month
                            and wod.RevokeStart='正常' and wo.ProcessingState!='ConfirmWork' and wo.ProcessingState!='Finishing'  group by wo.ProcessFactoryCode
                            union all
                            select isnull(sum(opd.NoCompleted),0) as NoCompleted,op.ProcessFactoryCode from TbOrderProgress op
                            left join TbOrderProgressDetail opd on op.OrderCode=opd.OrderCode 
                            where (ISNULL(@ProcessFactoryCode,'')='' or op.ProcessFactoryCode=@ProcessFactoryCode)
                            and CONVERT(varchar(7), op.DistributionTime, 120)=CONVERT(varchar(4),YEAR(DATEADD(MONTH,-1,@month+'-01')))+'-'+Right(100+Month(DATEADD(MONTH,-1,@month+'-01')),2)
                            and opd.RevokeStart='正常'  group by op.ProcessFactoryCode)Tb  group by Tb.ProcessFactoryCode
) Tb1 on cf.ProcessFactoryCode=Tb1.ProcessFactoryCode 
where cf.CapacityMonth=@month
and (ISNULL(@ProcessFactoryCode,'')='' or cf.ProcessFactoryCode=@ProcessFactoryCode)) TbCF where (ISNULL(@ProcessFactoryCode,'')='' or TbCF.ProcessFactoryCode=@ProcessFactoryCode)	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@month[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-14 11:23:27
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:23:27
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode10) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode11,@WorkAreaCode12))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus13) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth14))) 	
Parameters:
@ProcessFactoryCode10[String] = 6386683729561128960
@WorkAreaCode11[String] = 6372921396045311451
@WorkAreaCode12[String] = 6372921398380745033
@Examinestatus13[String] = 审核完成
@DemandMonth14[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-14 11:23:27
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:23:27
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:23:27
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:23:27
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:23:27
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode17) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode18))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState19)) 	
Parameters:
@ProcessFactoryCode17[String] = 6386683729561128960
@SiteCode18[String] = 6372921375874657752
@ProcessingState19[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-14 11:23:27
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-14 11:23:27
Text:	 SELECT   [TbOrderProgress].[ProcessingState],[TbOrderProgress].[OrderCode],[TbOrderProgress].[FinishProcessingDateTime],[TbOrderProgress].[DistributionTime],[TbOrderProgress].[SiteCode] FROM [TbOrderProgress]  WHERE ((([TbOrderProgress].[SiteCode] IN (@SiteCode15)) AND ([TbOrderProgress].[ProcessFactoryCode] = @ProcessFactoryCode16)) AND ((YEAR(DistributionTime)=2020 and MONTH(DistributionTime)=7) or (DistributionTime<'2020/7/1 0:00:00' and (ProcessingState!='Finishing')))) 	
Parameters:
@SiteCode15[String] = 6372921375874657752
@ProcessFactoryCode16[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:23:27
Text:	 SELECT   * FROM [TbWorkOrderDetail]  WHERE (1=2) AND ([TbWorkOrderDetail].[DaetailWorkStrat] = @DaetailWorkStrat20) 	
Parameters:
@DaetailWorkStrat20[String] = 未加工


-----------------------------------------------------------------------------
2020-07-14 11:23:27
Text:	 SELECT   [TbOrderProgress].[WeightTotal] AS [TotalWeight],[TbCompany].[ParentCompanyCode] FROM [TbOrderProgress] LEFT OUTER JOIN [TbCompany] ON ([TbOrderProgress].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((1=2) AND ([TbOrderProgress].[ProcessingState] <> @ProcessingState21)) AND ((([TbOrderProgress].[FinishProcessingDateTime] is not null ) AND ([TbOrderProgress].[DistributionTime] < [TbOrderProgress].[FinishProcessingDateTime])) OR (([TbOrderProgress].[FinishProcessingDateTime] is null ) AND ([TbOrderProgress].[DistributionTime] < @DistributionTime22)))) 	
Parameters:
@ProcessingState21[String] = Finishing
@DistributionTime22[DateTime] = 2020/7/14 0:00:00


-----------------------------------------------------------------------------
2020-07-14 11:23:27
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:23:27
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode23) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode24))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState25)) 	
Parameters:
@ProcessFactoryCode23[String] = 6386683729561128960
@SiteCode24[String] = 6372921375874657752
@ProcessingState25[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-14 11:23:27
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-14 11:23:28
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:23:28
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode27) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode28,@WorkAreaCode29))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus30) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth31))) 	
Parameters:
@ProcessFactoryCode27[String] = 6386683729561128960
@WorkAreaCode28[String] = 6372921396045311451
@WorkAreaCode29[String] = 6372921398380745033
@Examinestatus30[String] = 审核完成
@DemandMonth31[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-14 11:23:28
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:23:28
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:23:28
Text:	 SELECT   [TbRawMaterialStockRecord].[MaterialCode],sum([TbRawMaterialStockRecord].[UseCount]) AS [UseCount],sum([TbRawMaterialStockRecord].[LockCount]) AS [LockCount] FROM [TbRawMaterialStockRecord] LEFT OUTER JOIN [TbStorage] ON ([TbRawMaterialStockRecord].[StorageCode] = [TbStorage].[StorageCode]) LEFT OUTER JOIN [TbRawMaterialArchives] ON ([TbRawMaterialStockRecord].[MaterialCode] = [TbRawMaterialArchives].[MaterialCode])  WHERE ((([TbStorage].[ProcessFactoryCode] = @ProcessFactoryCode34) AND ([TbRawMaterialStockRecord].[WorkAreaCode] IN (@WorkAreaCode36,@WorkAreaCode37))) AND ([TbRawMaterialArchives].[RebarType] = @RebarType39)) GROUP BY [TbRawMaterialStockRecord].[MaterialCode] 	
Parameters:
@ProcessFactoryCode34[String] = 6386683729561128960
@WorkAreaCode36[String] = 6372921396045311451
@WorkAreaCode37[String] = 6372921398380745033
@RebarType39[String] = BuildingSteel


-----------------------------------------------------------------------------
2020-07-14 11:23:28
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:23:28
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:23:28
Text:	 SELECT   [TbRawMaterialStockRecord].[MaterialCode],sum([TbRawMaterialStockRecord].[UseCount]) AS [UseCount],sum([TbRawMaterialStockRecord].[LockCount]) AS [LockCount] FROM [TbRawMaterialStockRecord] LEFT OUTER JOIN [TbStorage] ON ([TbRawMaterialStockRecord].[StorageCode] = [TbStorage].[StorageCode]) LEFT OUTER JOIN [TbRawMaterialArchives] ON ([TbRawMaterialStockRecord].[MaterialCode] = [TbRawMaterialArchives].[MaterialCode])  WHERE ((([TbStorage].[ProcessFactoryCode] = @ProcessFactoryCode43) AND ([TbRawMaterialStockRecord].[WorkAreaCode] IN (@WorkAreaCode45,@WorkAreaCode46))) AND ([TbRawMaterialArchives].[RebarType] = @RebarType48)) GROUP BY [TbRawMaterialStockRecord].[MaterialCode] 	
Parameters:
@ProcessFactoryCode43[String] = 6386683729561128960
@WorkAreaCode45[String] = 6372921396045311451
@WorkAreaCode46[String] = 6372921398380745033
@RebarType48[String] = SectionSteel


-----------------------------------------------------------------------------
2020-07-14 11:23:28
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:23:28
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:23:28
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode52) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode53))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState54)) 	
Parameters:
@ProcessFactoryCode52[String] = 6386683729561128960
@SiteCode53[String] = 6372921375874657752
@ProcessingState54[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-14 11:23:28
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-14 11:23:28
Text:	 SELECT   [TbOrderProgress].[ProcessingState],[TbOrderProgress].[OrderCode],[TbOrderProgress].[FinishProcessingDateTime],[TbOrderProgress].[DistributionTime],[TbOrderProgress].[SiteCode] FROM [TbOrderProgress]  WHERE ((([TbOrderProgress].[SiteCode] IN (@SiteCode50)) AND ([TbOrderProgress].[ProcessFactoryCode] = @ProcessFactoryCode51)) AND ((YEAR(DistributionTime)=2020 and MONTH(DistributionTime)=7) or (DistributionTime<'2020/7/1 0:00:00' and (ProcessingState!='Finishing')))) 	
Parameters:
@SiteCode50[String] = 6372921375874657752
@ProcessFactoryCode51[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:23:28
Text:	 SELECT   * FROM [TbWorkOrderDetail]  WHERE (1=2) AND ([TbWorkOrderDetail].[DaetailWorkStrat] = @DaetailWorkStrat55) 	
Parameters:
@DaetailWorkStrat55[String] = 未加工


-----------------------------------------------------------------------------
2020-07-14 11:23:28
Text:	 SELECT   [TbOrderProgress].[WeightTotal] AS [TotalWeight],[TbCompany].[ParentCompanyCode] FROM [TbOrderProgress] LEFT OUTER JOIN [TbCompany] ON ([TbOrderProgress].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((1=2) AND ([TbOrderProgress].[ProcessingState] <> @ProcessingState56)) AND ((([TbOrderProgress].[FinishProcessingDateTime] is not null ) AND ([TbOrderProgress].[DistributionTime] < [TbOrderProgress].[FinishProcessingDateTime])) OR (([TbOrderProgress].[FinishProcessingDateTime] is null ) AND ([TbOrderProgress].[DistributionTime] < @DistributionTime57)))) 	
Parameters:
@ProcessingState56[String] = Finishing
@DistributionTime57[DateTime] = 2020/7/14 0:00:00


-----------------------------------------------------------------------------
2020-07-14 11:23:28
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:23:28
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:23:28
Text:	--原材料供货超时
                           select BatchPlanNum,cp1.CompanyFullName as BranchName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,sup.SupplyDate,sup.SupplyCompleteTime,sup.ProjectId,sup.Remarks from TbSupplyList sup
                           left join TbCompany cp1 on cp1.CompanyCode=sup.BranchCode
                           left join TbCompany cp2 on cp2.CompanyCode=sup.WorkAreaCode
                           left join TbCompany cp3 on cp3.CompanyCode=sup.SiteCode
                           left join TbCompany cp4 on cp4.CompanyCode=sup.ProcessFactoryCode
                           where YEAR(sup.SupplyDate)= @Year and MONTH(sup.SupplyDate)= @Month
                           and (sup.SupplyCompleteTime>sup.SupplyDate or (GETDATE()>sup.SupplyDate and sup.SupplyCompleteTime is null))  and sup.ProjectId='6372912251695766465' and sup.ProcessFactoryCode='6386683729561128960' and (sup.SiteCode in('6372921375874657752') or sup.WorkAreaCode in('6372921396045311451','6372921398380745033'))	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 11:23:28
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:23:28
Text:	--加急订单个数
                           select wo.OrderCode,wo.DistributionTime,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName from TbWorkOrder wo
                           left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on wo.ProcessFactoryCode=cp2.CompanyCode
                           where UrgentDegree='Urgent'
                           and YEAR(wo.DistributionTime)= @Year and MONTH(wo.DistributionTime)= @Month  and wo.ProjectId='6372912251695766465' and wo.ProcessFactoryCode='6386683729561128960' and wo.SiteCode in('6372921375874657752')  ORDER BY wo.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 11:23:28
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:23:28
Text:	--加工进度滞后
                           select op.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,op.DistributionTime,op.FinishProcessingDateTime from TbOrderProgress op 
                           left join TbCompany cp1 on op.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on op.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(op.DistributionTime)= @Year and MONTH(op.DistributionTime)= @Month
                           and (op.FinishProcessingDateTime>op.DistributionTime or (GETDATE()>op.DistributionTime and op.FinishProcessingDateTime is null))  and op.ProjectId='6372912251695766465' and op.ProcessFactoryCode='6386683729561128960' and op.SiteCode in('6372921375874657752') ORDER BY op.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 11:23:28
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:23:28
Text:	--配送超期
                           select dpi.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,dpi.DistributionTime,dpi.DeliveryCompleteTime,dpi.Remark from TbDistributionPlanInfo dpi
                           left join TbCompany cp1 on dpi.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on dpi.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(dpi.DistributionTime)= @Year and MONTH(dpi.DistributionTime)= @Month
                           and (dpi.DeliveryCompleteTime>dpi.DistributionTime or (GETDATE()>dpi.DistributionTime and dpi.DeliveryCompleteTime is null))  and dpi.ProjectId='6372912251695766465' and dpi.ProcessFactoryCode='6386683729561128960' and dpi.SiteCode in('6372921375874657752') ORDER BY dpi.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 11:23:28
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:23:28
Text:	select TbYj.*,cp1.CompanyFullName as SiteName,tcr.EnterSpaceTime,tcr.StartDischargeTime,tcr.EndDischargeTime,disEnt.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SiteDischargeCargo' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbTransportCarReport tcr on TbYj.EWFormDataCode=tcr.DisEntOrderId
                           left join TbDistributionEnt disEnt on tcr.DistributionCode=disEnt.DistributionCode
                           left join TbCompany cp on disEnt.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and disEnt.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ORDER BY tcr.EnterSpaceTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 11:23:28
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:23:28
Text:	select TbYj.*,cp1.CompanyFullName as SiteName,sfs.DistributionCode,sdc.DistributionTime,sfs.SigninTime,sfs.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SemiFinishedSign' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbSemiFinishedSign sfs on TbYj.EWFormDataCode=sfs.ID
                           left join TbSiteDischargeCargo sdc on sfs.DistributionCode=sdc.DistributionCode and sfs.DischargeCargoCode=sdc.DischargeCargoCode
                           left join TbCompany cp on sfs.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month and TbYj.ProjectId='6372912251695766465' and sfs.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752')	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 11:23:28
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:23:28
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:23:28
Text:	SELECT sm.MenuName,fwqi.EWContent,fwqi.EWUserCode,u.UserName,fwqi.EWFormDataCode,cp1.CompanyFullName as  FbName,cp2.CompanyFullName as GqName,fwqi.EWTime,sdd.DictionaryText as RebarType  
                   FROM (  
                    select ret.*
                    FROM ( 
                         SELECT *, row_number()over(partition BY EarlyWarningCode,EWFormDataCode ORDER BY EWNodeCode,EWTime desc) as group_idx 
                         FROM TbFormEarlyWarningNodeInfo fwqi
                         WHERE YEAR(fwqi.EWTime)= @Year and MONTH(fwqi.EWTime)= @Month AND fwqi.MenuCode='RawMonthDemandPlan' AND fwqi.EWStart=0
                    ) ret
                    WHERE ret.group_idx = 1
                   ) fwqi
                    left join TbSysMenu sm on fwqi.MenuCode=sm.MenuCode
                            left join TbCompany cp1 on fwqi.CompanyCode=cp1.CompanyCode
                            left join TbCompany cp2 on fwqi.WorkArea=cp2.CompanyCode
                            left join TbCompany cp3 on fwqi.SiteCode=cp3.CompanyCode
                            left join TbUser u on fwqi.EWUserCode=u.UserId
                            left join TbRawMaterialMonthDemandPlan rmp on fwqi.EWFormDataCode=rmp.ID
                            left join TbSysDictionaryData sdd on sdd.DictionaryCode=rmp.RebarType
                    where 1=1 and fwqi.ProjectId='6372912251695766465' and (fwqi.SiteCode in('6372921375874657752') or fwqi.WorkArea in('6372921396045311451','6372921398380745033')) ORDER BY fwqi.EWTime DESC	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 11:23:29
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:23:29
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:23:29
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:23:29
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:23:29
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:23:29
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:23:29
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:23:29
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:23:29
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:23:29
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:23:29
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:23:29
Text:	SELECT 
                            '审批超时' as YjTypeName,COUNT(1) as YjNum
                            FROM (
									SELECT a.*, row_number()over(partition BY a.FlowCode ORDER BY a.FlowNodeCode,a.EarlyWarningTime desc) as group_idx 
									FROM TbFlowEarlyWarningOtherInfo  a
									INNER JOIN  TbFlowEarlyWarningInfo b ON a.FlowCode=b.FlowCode 
									AND a.EWFormDataCode=b.EWFormDataCode AND a.FlowNodeCode=b.FlowNodeCode 
									WHERE  b.EarlyWarningStart=0 AND YEAR(a.EarlyWarningTime)= @Year and MONTH(a.EarlyWarningTime)= @Month  and a.ProjectId='6372912251695766465' and a.ProcessFactoryCode='6386683729561128960' and (a.SiteCode in('6372921375874657752') or a.WorkAreaCode in('6372921396045311451','6372921398380745033'))
							   ) Tb1
                            WHERE Tb1.group_idx =1
                           union all
                            select '未报月度需求计划' as YjTypeName,COUNT(1)as YjNum
                             FROM ( 
                                  SELECT *, row_number()over(partition BY EarlyWarningCode,EWFormDataCode ORDER BY EWNodeCode,EWTime desc) as group_idx 
                                  FROM TbFormEarlyWarningNodeInfo fwqi
                                  WHERE fwqi.MenuCode='RawMonthDemandPlan' AND fwqi.EWStart=0 AND YEAR(fwqi.EWTime)= @Year and MONTH(fwqi.EWTime)= @Month  and fwqi.ProjectId='6372912251695766465' and (fwqi.SiteCode in('6372921375874657752') or fwqi.WorkArea in('6372921396045311451','6372921398380745033'))  
                             ) Tb2
                             WHERE Tb2.group_idx =1
                           union all
                           select '原材料供货超时' as YjTypeName,COUNT(1) as YjNum from (
                           select BatchPlanNum,cp1.CompanyFullName as BranchName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,sup.SupplyDate,sup.SupplyCompleteTime,sup.ProjectId from TbSupplyList sup
                           left join TbCompany cp1 on cp1.CompanyCode=sup.BranchCode
                           left join TbCompany cp2 on cp2.CompanyCode=sup.WorkAreaCode
                           left join TbCompany cp3 on cp3.CompanyCode=sup.SiteCode
                           left join TbCompany cp4 on cp4.CompanyCode=sup.ProcessFactoryCode
                           where (sup.SupplyCompleteTime>sup.SupplyDate or (GETDATE()>sup.SupplyDate and sup.SupplyCompleteTime is null))
						   and YEAR(sup.SupplyDate)= @Year and MONTH(sup.SupplyDate)= @Month  and sup.ProjectId='6372912251695766465' and sup.ProcessFactoryCode='6386683729561128960' and (sup.SiteCode in('6372921375874657752') or sup.WorkAreaCode in('6372921396045311451','6372921398380745033'))) Tb3
                           union all
                           select '加急订单' as YjTypeName,COUNT(1) as YjNum from (--加急订单个数
                           select wo.OrderCode,wo.DistributionTime,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName from TbWorkOrder wo
                           left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on wo.ProcessFactoryCode=cp2.CompanyCode
                           where UrgentDegree='Urgent' 
						   and YEAR(wo.DistributionTime)= @Year and MONTH(wo.DistributionTime)= @Month  and wo.ProjectId='6372912251695766465' and wo.ProcessFactoryCode='6386683729561128960' and wo.SiteCode in('6372921375874657752') ) Tb4
                           union all
                           select '加工进度滞后' as YjTypeName,COUNT(1) as YjNum from (--加工进度滞后
                           select op.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,op.DistributionTime,op.FinishProcessingDateTime from TbOrderProgress op 
                           left join TbCompany cp1 on op.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on op.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(op.DistributionTime)= @Year and MONTH(op.DistributionTime)= @Month
                           and (op.FinishProcessingDateTime>op.DistributionTime or (GETDATE()>op.DistributionTime and op.FinishProcessingDateTime is null))  and op.ProjectId='6372912251695766465' and op.ProcessFactoryCode='6386683729561128960' and op.SiteCode in('6372921375874657752') ) Tb5
                           union all
                           select '接收配送超期' as YjTypeName,COUNT(1) as YjNum from (--配送超期
                           select dpi.OrderCode,cp1.CompanyFullName as SIteName,cp2.CompanyFullName as ProcessFactoryName,dpi.DistributionTime,dpi.DeliveryCompleteTime from TbDistributionPlanInfo dpi
                           left join TbCompany cp1 on dpi.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on dpi.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(dpi.DistributionTime)= @Year and MONTH(dpi.DistributionTime)= @Month
                           and (dpi.DeliveryCompleteTime>dpi.DistributionTime or (GETDATE()>dpi.DistributionTime and dpi.DeliveryCompleteTime is null))  and dpi.ProjectId='6372912251695766465' and dpi.ProcessFactoryCode='6386683729561128960' and dpi.SiteCode in('6372921375874657752') ) Tb6 
                           union all
                           select '卸货超时' as YjTypeName,COUNT(1) as YjNum from(--卸货超时
                           select TbYj.*,cp1.CompanyFullName as SiteName,tcr.EnterSpaceTime,tcr.StartDischargeTime,tcr.EndDischargeTime,disEnt.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SiteDischargeCargo' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbTransportCarReport tcr on TbYj.EWFormDataCode=tcr.DisEntOrderId
                           left join TbDistributionEnt disEnt on tcr.DistributionCode=disEnt.DistributionCode
                           left join TbCompany cp on disEnt.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and disEnt.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ) Tb7
                           union all
                           select '签收超时' as YjTypeName,COUNT(1) as YjNum from (select TbYj.*,cp1.CompanyFullName as SiteName,sfs.DistributionCode,sdc.DistributionTime,sfs.SigninTime,sfs.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SemiFinishedSign' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbSemiFinishedSign sfs on TbYj.EWFormDataCode=sfs.ID
                           left join TbSiteDischargeCargo sdc on sfs.DistributionCode=sdc.DistributionCode and sfs.DischargeCargoCode=sdc.DischargeCargoCode
                           left join TbCompany cp on sfs.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and sfs.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ) Tb8	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 11:23:29
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:23:29
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode58) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode59,@WorkAreaCode60))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus61) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth62))) 	
Parameters:
@ProcessFactoryCode58[String] = 6386683729561128960
@WorkAreaCode59[String] = 6372921396045311451
@WorkAreaCode60[String] = 6372921398380745033
@Examinestatus61[String] = 审核完成
@DemandMonth62[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-14 11:23:30
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:23:30
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode63) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode64,@WorkAreaCode65))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus66) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth67))) 	
Parameters:
@ProcessFactoryCode63[String] = 6386683729561128960
@WorkAreaCode64[String] = 6372921396045311451
@WorkAreaCode65[String] = 6372921398380745033
@Examinestatus66[String] = 审核完成
@DemandMonth67[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-14 11:23:30
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:23:30
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:23:30
Text:	
                        select fewoi.DataCode as OddNumbers,
                         fewoi.EarlyWarningContent,
                         fewoi.EWFormDataCode,
                         CONVERT(varchar(100), fewoi.EarlyWarningTime, 120) as EarlyWarningTime,
                         EWFormCode,sm.MenuName,fn.FlowNodeName,cp1.CompanyFullName as BranchName,
                         cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,
                         u1.UserName as FlowSpUserName,u2.UserName as FlowYjUserName 
                        FROM (
                        select*
                           FROM ( 
                        		SELECT a.*, row_number()over(partition BY a.FlowCode ORDER BY a.FlowNodeCode,a.EarlyWarningTime desc) as group_idx 
                        		FROM TbFlowEarlyWarningOtherInfo  a
                        		INNER JOIN  TbFlowEarlyWarningInfo b ON a.FlowCode=b.FlowCode 
                        		AND a.EWFormDataCode=b.EWFormDataCode AND a.FlowNodeCode=b.FlowNodeCode 
                        		WHERE YEAR(a.EarlyWarningTime)= @Year and MONTH(a.EarlyWarningTime)= @Month AND b.EarlyWarningStart=0
                           ) ret
                        WHERE ret.group_idx =1
                        ) fewoi
                        left join TbFlowNode fn on fewoi.FlowCode=fn.FlowCode and fewoi.FlowNodeCode=fn.FlowNodeCode
                        left join TbSysMenu sm on fewoi.EWFormCode=sm.MenuCode
                        left join TbCompany cp1 on fewoi.BranchCode=cp1.CompanyCode
                        left join TbCompany cp2 on fewoi.WorkAreaCode=cp2.CompanyCode
                        left join TbCompany cp3 on fewoi.SiteCode=cp3.CompanyCode
                        left join TbCompany cp4 on fewoi.ProcessFactoryCode=cp4.CompanyCode
                        left join TbUser u1 on fewoi.FlowSpUserCode=u1.UserId
                        left join TbUser u2 on fewoi.FlowYjUserCode=u2.UserId where 1=1 and fewoi.ProjectId='6372912251695766465' and fewoi.ProcessFactoryCode='6386683729561128960' and (fewoi.SiteCode in('6372921375874657752') or fewoi.WorkAreaCode in('6372921396045311451','6372921398380745033')) ORDER BY fewoi.EarlyWarningTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 11:23:35
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:23:35
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialArchives/Index


-----------------------------------------------------------------------------
2020-07-14 11:23:35
Text:	select * from TbSysDictionaryData where 1=1 and FDictionaryCode=@name order by DictionaryOrder asc	
Parameters:
@name[String] = RebarType


-----------------------------------------------------------------------------
2020-07-14 11:23:35
Text:	 SELECT count(*) as r_cnt FROM [TbRawMaterialArchives] LEFT OUTER JOIN [TbSysDictionaryData] ON (([TbRawMaterialArchives].[MeasurementUnit] = [TbSysDictionaryData].[DictionaryCode]) AND ([TbSysDictionaryData].[FDictionaryCode] = @FDictionaryCode68))	
Parameters:
@FDictionaryCode68[String] = Unit
@FDictionaryCode69[String] = RebarType


-----------------------------------------------------------------------------
2020-07-14 11:23:35
Text:	 SELECT   TOP 50 [TbRawMaterialArchives].*,[TbSysDictionaryData].[DictionaryText] AS [MeasurementUnitNew],( SELECT   [TbSysDictionaryData].[DictionaryText] FROM [TbSysDictionaryData]  WHERE ([TbSysDictionaryData].[DictionaryCode] = [TbRawMaterialArchives].[RebarType]) AND ([TbSysDictionaryData].[FDictionaryCode] = @FDictionaryCode69) ) AS [RebarTypeNew] FROM [TbRawMaterialArchives] LEFT OUTER JOIN [TbSysDictionaryData] ON (([TbRawMaterialArchives].[MeasurementUnit] = [TbSysDictionaryData].[DictionaryCode]) AND ([TbSysDictionaryData].[FDictionaryCode] = @FDictionaryCode68))  ORDER BY [TbRawMaterialArchives].[ID] ASC 	
Parameters:
@FDictionaryCode68[String] = Unit
@FDictionaryCode69[String] = RebarType


-----------------------------------------------------------------------------
2020-07-14 11:23:38
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:23:38
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-14 11:23:38
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:23:38
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:23:38
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:23:38
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-14 11:23:38
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:23:38
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:23:38
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:23:38
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-14 11:23:38
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:23:38
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:23:38
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:23:38
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:23:38
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:23:38
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/InOrder/Index


-----------------------------------------------------------------------------
2020-07-14 11:23:38
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:23:38
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:23:38
Text:	select ino.*,case when ISNULL(ino.ChackResult,0)=0 then '' when ISNULL(ino.ChackResult,0)=1 then '合格' when ISNULL(ino.ChackResult,0)=2 then '不合格' when ISNULL(ino.ChackResult,0)=3 then '部分合格' end ChackResultName,ur.UserName,ur1.UserName as DeliverUser,st.StorageName,sdd.DictionaryText as RebarTypeName,sp.SupplierName,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as BranchName,case when rmsp.DemandPlanCode is null then fbnp.RawMaterialDemandNum else rmsp.DemandPlanCode end DemandPlanCode,inoi.IsTh,sap.NoJcBhgCount from TbInOrder ino
							left join(select '退回' as IsTh,InOrderCode from TbInOrderItem where ReturnTime is not null group by InOrderCode) inoi on ino.InOrderCode=inoi.InOrderCode
                            left join TbUser ur on ino.InsertUserCode=ur.UserCode
                            left join TbUser ur1 on ino.UserCode=ur1.UserCode
                            left join TbStorage st on ino.StorageCode=st.StorageCode
                            left join TbSysDictionaryData sdd on ino.RebarType=sdd.DictionaryCode
                            left join TbCompany cp1 on ino.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on ino.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbSupplier sp on ino.SupplierCode=sp.SupplierCode
                            left join TbFactoryBatchNeedPlan fbnp on ino.BatchPlanCode=fbnp.BatchPlanNum
							left join TbRawMaterialMonthDemandSupplyPlan rmsp on fbnp.RawMaterialDemandNum=rmsp.SupplyPlanCode
							left join (	select a.InOrderCode,SUM(c.PassCount) as NoJcBhgCount from TbSampleOrder a
							left join TbSampleOrderItem b on a.SampleOrderCode=b.SampleOrderCode
							left join TbInOrderItem c on b.InOrderItemId=c.ID
							where b.ChackState=2 group by a.InOrderCode) sap on ino.InOrderCode=sap.InOrderCode where 1=1 and  ino.BatchPlanCode!='' and ino.BatchPlanCode is not null and (ino.SiteCode in('6372921375874657752') or ino.WorkAreaCode in('6372921396045311451','6372921398380745033')) and ino.ProjectId='6372912251695766465' and st.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-14 11:23:38
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by InOrderCode desc)AS Row, * from (select ino.*,case when ISNULL(ino.ChackResult,0)=0 then '' when ISNULL(ino.ChackResult,0)=1 then '合格' when ISNULL(ino.ChackResult,0)=2 then '不合格' when ISNULL(ino.ChackResult,0)=3 then '部分合格' end ChackResultName,ur.UserName,ur1.UserName as DeliverUser,st.StorageName,sdd.DictionaryText as RebarTypeName,sp.SupplierName,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as BranchName,case when rmsp.DemandPlanCode is null then fbnp.RawMaterialDemandNum else rmsp.DemandPlanCode end DemandPlanCode,inoi.IsTh,sap.NoJcBhgCount from TbInOrder ino
							left join(select '退回' as IsTh,InOrderCode from TbInOrderItem where ReturnTime is not null group by InOrderCode) inoi on ino.InOrderCode=inoi.InOrderCode
                            left join TbUser ur on ino.InsertUserCode=ur.UserCode
                            left join TbUser ur1 on ino.UserCode=ur1.UserCode
                            left join TbStorage st on ino.StorageCode=st.StorageCode
                            left join TbSysDictionaryData sdd on ino.RebarType=sdd.DictionaryCode
                            left join TbCompany cp1 on ino.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on ino.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbSupplier sp on ino.SupplierCode=sp.SupplierCode
                            left join TbFactoryBatchNeedPlan fbnp on ino.BatchPlanCode=fbnp.BatchPlanNum
							left join TbRawMaterialMonthDemandSupplyPlan rmsp on fbnp.RawMaterialDemandNum=rmsp.SupplyPlanCode
							left join (	select a.InOrderCode,SUM(c.PassCount) as NoJcBhgCount from TbSampleOrder a
							left join TbSampleOrderItem b on a.SampleOrderCode=b.SampleOrderCode
							left join TbInOrderItem c on b.InOrderItemId=c.ID
							where b.ChackState=2 group by a.InOrderCode) sap on ino.InOrderCode=sap.InOrderCode where 1=1 and  ino.BatchPlanCode!='' and ino.BatchPlanCode is not null and (ino.SiteCode in('6372921375874657752') or ino.WorkAreaCode in('6372921396045311451','6372921398380745033')) and ino.ProjectId='6372912251695766465' and st.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:23:39
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:23:39
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:23:39
Text:	select Tb.DataMonth,ISNULL(sum(TbData.InorderCount),0) as InCount,ISNULL(sum(TbData.InCount),0) as InWeight from (select datepart(MONTH,dateadd(mm,-t.number,getdate())) as DataMonth
from
(select number from master..spt_values where type='P') t
where year(dateadd(mm,-t.number,getdate()))=year(getdate())) Tb 
left join (select COUNT(1) as InorderCount,SUM(a.InCount) as InCount,a.RebarType,datepart(year,a.InsertTime) InsertYear,datepart(MONTH,a.InsertTime) InsertMonth from TbInOrder a 
left join TbStorage b on a.StorageCode=b.StorageCode
where a.Examinestatus!='已退回' 
and a.Examinestatus!='已撤销' 
and datepart(year,a.InsertTime)=datepart(year,GETDATE())  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
group by a.RebarType,datepart(year,a.InsertTime),datepart(MONTH,a.InsertTime)) TbData on  Tb.DataMonth=TbData.InsertMonth
group by Tb.DataMonth order by Tb.DataMonth asc 	


-----------------------------------------------------------------------------
2020-07-14 11:23:39
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:23:39
Text:	select TbType.InType,isnull(TbData.InCount,0) as InCount from (select '入库单数' as InType
                           union all
                           select '未取样' as InType
                           union all
                           select '验收不合格' as InType
                           union all
                           select '检测部分合格' as InType
                           union all
                           select '检测不合格' as InType) TbType
                           left join(select '入库单数' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode 
                           where 1=1 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '未取样' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1 and a.SampleOrderState='取样未完成' and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '验收不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and NoPassTotal>0 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测部分合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=3 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=2 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')) TbData on TbType.InType=TbData.InType	


-----------------------------------------------------------------------------
2020-07-14 11:23:39
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:23:39
Text:	select Tb.GhType,sum(Tb.GhWeight) as GhWeight,sum(tb.GhCount) as GhCount from (select TbGhType.GhType,isnull(TbGhInfo.HasSupplier,0) as GhWeight,isnull(TbGhInfo.GhCount,0) as GhCount from (select '供货' as GhType
                            union all
                            select '验收不合格' as GhType
                            union all
                            select '检测不合格' as GhType) TbGhType
                            left join(
                            --供货次数、总量
                            select isnull(sum(Tb.HasSupplier),0) as HasSupplier,isnull(sum(Tb.GhCount),0) as GhCount,'供货' as GhType from (select a.HasSupplier,isnull(b.GhCount,0) as GhCount from (select a.BatchPlanNum,sum(a.HasSupplier) as HasSupplier from TbSupplyListDetail a 
                            left join TbSupplyList s on a.BatchPlanNum=s.BatchPlanNum where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')
                            GROUP BY a.BatchPlanNum) a
                            left join(select Tb.BatchPlanNum,count(1) as GhCount from (select BatchPlanNum,ThisTime from TbSupplyListDetailHistory
                            group by BatchPlanNum,ThisTime) Tb group by Tb.BatchPlanNum) b on a.BatchPlanNum=b.BatchPlanNum) Tb 
                            union all
                            --验收不合格次数、验收不合格重量
                            select sum(TbSum.NoPass) as NoPass,sum(TbSum.YsNoPassCount) as YsNoPassCount,'验收不合格' as GhType from (select count(1) as YsNoPassCount,sum(Tb.NoPass) as NoPass from (select b.BatchPlanCode,c.ThisTime,sum(a.NoPass) as NoPass from TbInOrderItem a
                            left join TbInOrder b on a.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            left join TbSupplyListDetailHistory c on a.BatchPlanItemNewCode=c.BatchPlanItemNewCode
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033') and a.BatchPlanItemNewCode is not null and a.NoPass>0 
                            group by b.BatchPlanCode,c.ThisTime) Tb group by Tb.BatchPlanCode) TbSum
                            union all
                            --检测不合格次数、重量
                            select isnull(sum(Tb.JcNoPass),0) as JcNoPass,count(1) as JcNoPassCount,'检测不合格' as GhType from (select b.BatchPlanCode,d.ThisTime,Isnull(sum(c.PassCount),0) as JcNoPass from TbSampleOrderItem a
                            left join TbSampleOrder e on a.SampleOrderCode=e.SampleOrderCode
                            left join TbInOrderItem c on a.InOrderItemId=c.ID
                            left join TbSupplyListDetailHistory d on c.BatchPlanItemNewCode=d.BatchPlanItemNewCode
                            left join TbInOrder b on c.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')  and a.ChackState=2 and c.BatchPlanItemNewCode is not null
                            group by b.BatchPlanCode,d.ThisTime) Tb group by Tb.BatchPlanCode) TbGhInfo on TbGhType.GhType=TbGhInfo.GhType) Tb group by Tb.GhType	


-----------------------------------------------------------------------------
2020-07-14 11:23:39
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/StockTaking/Index


-----------------------------------------------------------------------------
2020-07-14 11:23:39
Text:	select * from TbSysDictionaryData where 1=1 and FDictionaryCode=@name order by DictionaryOrder asc	
Parameters:
@name[String] = MaterialType


-----------------------------------------------------------------------------
2020-07-14 11:23:39
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:23:40
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:23:52
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:23:52
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-14 11:23:52
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:23:52
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:23:52
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:23:52
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-14 11:23:52
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:23:52
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:23:52
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:23:52
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:23:52
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-14 11:23:52
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:23:53
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:23:53
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:23:53
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:23:53
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:23:53
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:23:53
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/InOrder/Index


-----------------------------------------------------------------------------
2020-07-14 11:23:53
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:24:03
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:24:03
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:24:03
Text:	select ino.*,case when ISNULL(ino.ChackResult,0)=0 then '' when ISNULL(ino.ChackResult,0)=1 then '合格' when ISNULL(ino.ChackResult,0)=2 then '不合格' when ISNULL(ino.ChackResult,0)=3 then '部分合格' end ChackResultName,ur.UserName,ur1.UserName as DeliverUser,st.StorageName,sdd.DictionaryText as RebarTypeName,sp.SupplierName,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as BranchName,case when rmsp.DemandPlanCode is null then fbnp.RawMaterialDemandNum else rmsp.DemandPlanCode end DemandPlanCode,inoi.IsTh,sap.NoJcBhgCount from TbInOrder ino
							left join(select '退回' as IsTh,InOrderCode from TbInOrderItem where ReturnTime is not null group by InOrderCode) inoi on ino.InOrderCode=inoi.InOrderCode
                            left join TbUser ur on ino.InsertUserCode=ur.UserCode
                            left join TbUser ur1 on ino.UserCode=ur1.UserCode
                            left join TbStorage st on ino.StorageCode=st.StorageCode
                            left join TbSysDictionaryData sdd on ino.RebarType=sdd.DictionaryCode
                            left join TbCompany cp1 on ino.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on ino.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbSupplier sp on ino.SupplierCode=sp.SupplierCode
                            left join TbFactoryBatchNeedPlan fbnp on ino.BatchPlanCode=fbnp.BatchPlanNum
							left join TbRawMaterialMonthDemandSupplyPlan rmsp on fbnp.RawMaterialDemandNum=rmsp.SupplyPlanCode
							left join (	select a.InOrderCode,SUM(c.PassCount) as NoJcBhgCount from TbSampleOrder a
							left join TbSampleOrderItem b on a.SampleOrderCode=b.SampleOrderCode
							left join TbInOrderItem c on b.InOrderItemId=c.ID
							where b.ChackState=2 group by a.InOrderCode) sap on ino.InOrderCode=sap.InOrderCode where 1=1 and  ino.BatchPlanCode!='' and ino.BatchPlanCode is not null and (ino.SiteCode in('6372921375874657752') or ino.WorkAreaCode in('6372921396045311451','6372921398380745033')) and ino.ProjectId='6372912251695766465' and st.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-14 11:24:03
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by InOrderCode desc)AS Row, * from (select ino.*,case when ISNULL(ino.ChackResult,0)=0 then '' when ISNULL(ino.ChackResult,0)=1 then '合格' when ISNULL(ino.ChackResult,0)=2 then '不合格' when ISNULL(ino.ChackResult,0)=3 then '部分合格' end ChackResultName,ur.UserName,ur1.UserName as DeliverUser,st.StorageName,sdd.DictionaryText as RebarTypeName,sp.SupplierName,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as BranchName,case when rmsp.DemandPlanCode is null then fbnp.RawMaterialDemandNum else rmsp.DemandPlanCode end DemandPlanCode,inoi.IsTh,sap.NoJcBhgCount from TbInOrder ino
							left join(select '退回' as IsTh,InOrderCode from TbInOrderItem where ReturnTime is not null group by InOrderCode) inoi on ino.InOrderCode=inoi.InOrderCode
                            left join TbUser ur on ino.InsertUserCode=ur.UserCode
                            left join TbUser ur1 on ino.UserCode=ur1.UserCode
                            left join TbStorage st on ino.StorageCode=st.StorageCode
                            left join TbSysDictionaryData sdd on ino.RebarType=sdd.DictionaryCode
                            left join TbCompany cp1 on ino.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on ino.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbSupplier sp on ino.SupplierCode=sp.SupplierCode
                            left join TbFactoryBatchNeedPlan fbnp on ino.BatchPlanCode=fbnp.BatchPlanNum
							left join TbRawMaterialMonthDemandSupplyPlan rmsp on fbnp.RawMaterialDemandNum=rmsp.SupplyPlanCode
							left join (	select a.InOrderCode,SUM(c.PassCount) as NoJcBhgCount from TbSampleOrder a
							left join TbSampleOrderItem b on a.SampleOrderCode=b.SampleOrderCode
							left join TbInOrderItem c on b.InOrderItemId=c.ID
							where b.ChackState=2 group by a.InOrderCode) sap on ino.InOrderCode=sap.InOrderCode where 1=1 and  ino.BatchPlanCode!='' and ino.BatchPlanCode is not null and (ino.SiteCode in('6372921375874657752') or ino.WorkAreaCode in('6372921396045311451','6372921398380745033')) and ino.ProjectId='6372912251695766465' and st.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:24:03
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:24:03
Text:	select Tb.DataMonth,ISNULL(sum(TbData.InorderCount),0) as InCount,ISNULL(sum(TbData.InCount),0) as InWeight from (select datepart(MONTH,dateadd(mm,-t.number,getdate())) as DataMonth
from
(select number from master..spt_values where type='P') t
where year(dateadd(mm,-t.number,getdate()))=year(getdate())) Tb 
left join (select COUNT(1) as InorderCount,SUM(a.InCount) as InCount,a.RebarType,datepart(year,a.InsertTime) InsertYear,datepart(MONTH,a.InsertTime) InsertMonth from TbInOrder a 
left join TbStorage b on a.StorageCode=b.StorageCode
where a.Examinestatus!='已退回' 
and a.Examinestatus!='已撤销' 
and datepart(year,a.InsertTime)=datepart(year,GETDATE())  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
group by a.RebarType,datepart(year,a.InsertTime),datepart(MONTH,a.InsertTime)) TbData on  Tb.DataMonth=TbData.InsertMonth
group by Tb.DataMonth order by Tb.DataMonth asc 	


-----------------------------------------------------------------------------
2020-07-14 11:24:03
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:24:03
Text:	select TbType.InType,isnull(TbData.InCount,0) as InCount from (select '入库单数' as InType
                           union all
                           select '未取样' as InType
                           union all
                           select '验收不合格' as InType
                           union all
                           select '检测部分合格' as InType
                           union all
                           select '检测不合格' as InType) TbType
                           left join(select '入库单数' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode 
                           where 1=1 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '未取样' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1 and a.SampleOrderState='取样未完成' and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '验收不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and NoPassTotal>0 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测部分合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=3 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=2 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')) TbData on TbType.InType=TbData.InType	


-----------------------------------------------------------------------------
2020-07-14 11:24:03
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:24:03
Text:	select Tb.GhType,sum(Tb.GhWeight) as GhWeight,sum(tb.GhCount) as GhCount from (select TbGhType.GhType,isnull(TbGhInfo.HasSupplier,0) as GhWeight,isnull(TbGhInfo.GhCount,0) as GhCount from (select '供货' as GhType
                            union all
                            select '验收不合格' as GhType
                            union all
                            select '检测不合格' as GhType) TbGhType
                            left join(
                            --供货次数、总量
                            select isnull(sum(Tb.HasSupplier),0) as HasSupplier,isnull(sum(Tb.GhCount),0) as GhCount,'供货' as GhType from (select a.HasSupplier,isnull(b.GhCount,0) as GhCount from (select a.BatchPlanNum,sum(a.HasSupplier) as HasSupplier from TbSupplyListDetail a 
                            left join TbSupplyList s on a.BatchPlanNum=s.BatchPlanNum where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')
                            GROUP BY a.BatchPlanNum) a
                            left join(select Tb.BatchPlanNum,count(1) as GhCount from (select BatchPlanNum,ThisTime from TbSupplyListDetailHistory
                            group by BatchPlanNum,ThisTime) Tb group by Tb.BatchPlanNum) b on a.BatchPlanNum=b.BatchPlanNum) Tb 
                            union all
                            --验收不合格次数、验收不合格重量
                            select sum(TbSum.NoPass) as NoPass,sum(TbSum.YsNoPassCount) as YsNoPassCount,'验收不合格' as GhType from (select count(1) as YsNoPassCount,sum(Tb.NoPass) as NoPass from (select b.BatchPlanCode,c.ThisTime,sum(a.NoPass) as NoPass from TbInOrderItem a
                            left join TbInOrder b on a.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            left join TbSupplyListDetailHistory c on a.BatchPlanItemNewCode=c.BatchPlanItemNewCode
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033') and a.BatchPlanItemNewCode is not null and a.NoPass>0 
                            group by b.BatchPlanCode,c.ThisTime) Tb group by Tb.BatchPlanCode) TbSum
                            union all
                            --检测不合格次数、重量
                            select isnull(sum(Tb.JcNoPass),0) as JcNoPass,count(1) as JcNoPassCount,'检测不合格' as GhType from (select b.BatchPlanCode,d.ThisTime,Isnull(sum(c.PassCount),0) as JcNoPass from TbSampleOrderItem a
                            left join TbSampleOrder e on a.SampleOrderCode=e.SampleOrderCode
                            left join TbInOrderItem c on a.InOrderItemId=c.ID
                            left join TbSupplyListDetailHistory d on c.BatchPlanItemNewCode=d.BatchPlanItemNewCode
                            left join TbInOrder b on c.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')  and a.ChackState=2 and c.BatchPlanItemNewCode is not null
                            group by b.BatchPlanCode,d.ThisTime) Tb group by Tb.BatchPlanCode) TbGhInfo on TbGhType.GhType=TbGhInfo.GhType) Tb group by Tb.GhType	


-----------------------------------------------------------------------------
2020-07-14 11:24:03
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/StockTaking/Index


-----------------------------------------------------------------------------
2020-07-14 11:24:03
Text:	select * from TbSysDictionaryData where 1=1 and FDictionaryCode=@name order by DictionaryOrder asc	
Parameters:
@name[String] = MaterialType


-----------------------------------------------------------------------------
2020-07-14 11:26:26
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:27:40
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:27:40
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-14 11:27:41
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:27:41
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:27:41
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:27:41
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-14 11:27:41
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:27:41
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:27:41
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:27:41
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-14 11:27:41
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:27:42
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:27:42
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:27:42
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:27:42
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:27:42
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:27:42
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/InOrder/Index


-----------------------------------------------------------------------------
2020-07-14 11:27:42
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:27:42
Text:	select Tb.DataMonth,ISNULL(sum(TbData.InorderCount),0) as InCount,ISNULL(sum(TbData.InCount),0) as InWeight from (select datepart(MONTH,dateadd(mm,-t.number,getdate())) as DataMonth
from
(select number from master..spt_values where type='P') t
where year(dateadd(mm,-t.number,getdate()))=year(getdate())) Tb 
left join (select COUNT(1) as InorderCount,SUM(a.InCount) as InCount,a.RebarType,datepart(year,a.InsertTime) InsertYear,datepart(MONTH,a.InsertTime) InsertMonth from TbInOrder a 
left join TbStorage b on a.StorageCode=b.StorageCode
where a.Examinestatus!='已退回' 
and a.Examinestatus!='已撤销' 
and datepart(year,a.InsertTime)=datepart(year,GETDATE())  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
group by a.RebarType,datepart(year,a.InsertTime),datepart(MONTH,a.InsertTime)) TbData on  Tb.DataMonth=TbData.InsertMonth
group by Tb.DataMonth order by Tb.DataMonth asc 	


-----------------------------------------------------------------------------
2020-07-14 11:27:42
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:27:42
Text:	select TbType.InType,isnull(TbData.InCount,0) as InCount from (select '入库单数' as InType
                           union all
                           select '未取样' as InType
                           union all
                           select '验收不合格' as InType
                           union all
                           select '检测部分合格' as InType
                           union all
                           select '检测不合格' as InType) TbType
                           left join(select '入库单数' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode 
                           where 1=1 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '未取样' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1 and a.SampleOrderState='取样未完成' and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '验收不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and NoPassTotal>0 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测部分合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=3 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=2 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')) TbData on TbType.InType=TbData.InType	


-----------------------------------------------------------------------------
2020-07-14 11:27:42
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:27:42
Text:	select Tb.GhType,sum(Tb.GhWeight) as GhWeight,sum(tb.GhCount) as GhCount from (select TbGhType.GhType,isnull(TbGhInfo.HasSupplier,0) as GhWeight,isnull(TbGhInfo.GhCount,0) as GhCount from (select '供货' as GhType
                            union all
                            select '验收不合格' as GhType
                            union all
                            select '检测不合格' as GhType) TbGhType
                            left join(
                            --供货次数、总量
                            select isnull(sum(Tb.HasSupplier),0) as HasSupplier,isnull(sum(Tb.GhCount),0) as GhCount,'供货' as GhType from (select a.HasSupplier,isnull(b.GhCount,0) as GhCount from (select a.BatchPlanNum,sum(a.HasSupplier) as HasSupplier from TbSupplyListDetail a 
                            left join TbSupplyList s on a.BatchPlanNum=s.BatchPlanNum where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')
                            GROUP BY a.BatchPlanNum) a
                            left join(select Tb.BatchPlanNum,count(1) as GhCount from (select BatchPlanNum,ThisTime from TbSupplyListDetailHistory
                            group by BatchPlanNum,ThisTime) Tb group by Tb.BatchPlanNum) b on a.BatchPlanNum=b.BatchPlanNum) Tb 
                            union all
                            --验收不合格次数、验收不合格重量
                            select sum(TbSum.NoPass) as NoPass,sum(TbSum.YsNoPassCount) as YsNoPassCount,'验收不合格' as GhType from (select count(1) as YsNoPassCount,sum(Tb.NoPass) as NoPass from (select b.BatchPlanCode,c.ThisTime,sum(a.NoPass) as NoPass from TbInOrderItem a
                            left join TbInOrder b on a.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            left join TbSupplyListDetailHistory c on a.BatchPlanItemNewCode=c.BatchPlanItemNewCode
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033') and a.BatchPlanItemNewCode is not null and a.NoPass>0 
                            group by b.BatchPlanCode,c.ThisTime) Tb group by Tb.BatchPlanCode) TbSum
                            union all
                            --检测不合格次数、重量
                            select isnull(sum(Tb.JcNoPass),0) as JcNoPass,count(1) as JcNoPassCount,'检测不合格' as GhType from (select b.BatchPlanCode,d.ThisTime,Isnull(sum(c.PassCount),0) as JcNoPass from TbSampleOrderItem a
                            left join TbSampleOrder e on a.SampleOrderCode=e.SampleOrderCode
                            left join TbInOrderItem c on a.InOrderItemId=c.ID
                            left join TbSupplyListDetailHistory d on c.BatchPlanItemNewCode=d.BatchPlanItemNewCode
                            left join TbInOrder b on c.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')  and a.ChackState=2 and c.BatchPlanItemNewCode is not null
                            group by b.BatchPlanCode,d.ThisTime) Tb group by Tb.BatchPlanCode) TbGhInfo on TbGhType.GhType=TbGhInfo.GhType) Tb group by Tb.GhType	


-----------------------------------------------------------------------------
2020-07-14 11:27:42
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/StockTaking/Index


-----------------------------------------------------------------------------
2020-07-14 11:27:42
Text:	 SELECT count(*) as r_cnt FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode]) WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode70)	
Parameters:
@ProcessFactoryCode70[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:27:42
Text:	 SELECT   TOP 50 [TbStockTaking].[ID],[TbStockTaking].[TakNum],[TbStockTaking].[TakDay],[TbStockTaking].[TotalInventory],[TbStockTaking].[TotalTak],[TbStockTaking].[TotalEarnOrLos],[TbStockTaking].[EarnOrLos],[TbStockTaking].[Remarks],[TbStockTaking].[InsertUserCode],[TbStockTaking].[InsertTime],[TbUser].[UserName],[TbCompany].[CompanyFullName] AS [FactoryName],[TbSysDictionaryData].[DictionaryText] AS [WarehouseTypeName] FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode])  WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode70) ORDER BY [TbStockTaking].[ID] DESC 	
Parameters:
@ProcessFactoryCode70[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:27:42
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:27:42
Text:	select * from TbSysDictionaryData where 1=1 and FDictionaryCode=@name order by DictionaryOrder asc	
Parameters:
@name[String] = MaterialType


-----------------------------------------------------------------------------
2020-07-14 11:27:43
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:29:26
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:30:40
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:30:40
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-14 11:30:40
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:30:40
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:30:40
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:30:40
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-14 11:30:40
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:30:40
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:30:40
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:30:40
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:30:40
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:30:40
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/InOrder/Index


-----------------------------------------------------------------------------
2020-07-14 11:30:40
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:30:40
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:30:40
Text:	select ino.*,case when ISNULL(ino.ChackResult,0)=0 then '' when ISNULL(ino.ChackResult,0)=1 then '合格' when ISNULL(ino.ChackResult,0)=2 then '不合格' when ISNULL(ino.ChackResult,0)=3 then '部分合格' end ChackResultName,ur.UserName,ur1.UserName as DeliverUser,st.StorageName,sdd.DictionaryText as RebarTypeName,sp.SupplierName,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as BranchName,case when rmsp.DemandPlanCode is null then fbnp.RawMaterialDemandNum else rmsp.DemandPlanCode end DemandPlanCode,inoi.IsTh,sap.NoJcBhgCount from TbInOrder ino
							left join(select '退回' as IsTh,InOrderCode from TbInOrderItem where ReturnTime is not null group by InOrderCode) inoi on ino.InOrderCode=inoi.InOrderCode
                            left join TbUser ur on ino.InsertUserCode=ur.UserCode
                            left join TbUser ur1 on ino.UserCode=ur1.UserCode
                            left join TbStorage st on ino.StorageCode=st.StorageCode
                            left join TbSysDictionaryData sdd on ino.RebarType=sdd.DictionaryCode
                            left join TbCompany cp1 on ino.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on ino.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbSupplier sp on ino.SupplierCode=sp.SupplierCode
                            left join TbFactoryBatchNeedPlan fbnp on ino.BatchPlanCode=fbnp.BatchPlanNum
							left join TbRawMaterialMonthDemandSupplyPlan rmsp on fbnp.RawMaterialDemandNum=rmsp.SupplyPlanCode
							left join (	select a.InOrderCode,SUM(c.PassCount) as NoJcBhgCount from TbSampleOrder a
							left join TbSampleOrderItem b on a.SampleOrderCode=b.SampleOrderCode
							left join TbInOrderItem c on b.InOrderItemId=c.ID
							where b.ChackState=2 group by a.InOrderCode) sap on ino.InOrderCode=sap.InOrderCode where 1=1 and  ino.BatchPlanCode!='' and ino.BatchPlanCode is not null and (ino.SiteCode in('6372921375874657752') or ino.WorkAreaCode in('6372921396045311451','6372921398380745033')) and ino.ProjectId='6372912251695766465' and st.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-14 11:30:40
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by InOrderCode desc)AS Row, * from (select ino.*,case when ISNULL(ino.ChackResult,0)=0 then '' when ISNULL(ino.ChackResult,0)=1 then '合格' when ISNULL(ino.ChackResult,0)=2 then '不合格' when ISNULL(ino.ChackResult,0)=3 then '部分合格' end ChackResultName,ur.UserName,ur1.UserName as DeliverUser,st.StorageName,sdd.DictionaryText as RebarTypeName,sp.SupplierName,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as BranchName,case when rmsp.DemandPlanCode is null then fbnp.RawMaterialDemandNum else rmsp.DemandPlanCode end DemandPlanCode,inoi.IsTh,sap.NoJcBhgCount from TbInOrder ino
							left join(select '退回' as IsTh,InOrderCode from TbInOrderItem where ReturnTime is not null group by InOrderCode) inoi on ino.InOrderCode=inoi.InOrderCode
                            left join TbUser ur on ino.InsertUserCode=ur.UserCode
                            left join TbUser ur1 on ino.UserCode=ur1.UserCode
                            left join TbStorage st on ino.StorageCode=st.StorageCode
                            left join TbSysDictionaryData sdd on ino.RebarType=sdd.DictionaryCode
                            left join TbCompany cp1 on ino.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on ino.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbSupplier sp on ino.SupplierCode=sp.SupplierCode
                            left join TbFactoryBatchNeedPlan fbnp on ino.BatchPlanCode=fbnp.BatchPlanNum
							left join TbRawMaterialMonthDemandSupplyPlan rmsp on fbnp.RawMaterialDemandNum=rmsp.SupplyPlanCode
							left join (	select a.InOrderCode,SUM(c.PassCount) as NoJcBhgCount from TbSampleOrder a
							left join TbSampleOrderItem b on a.SampleOrderCode=b.SampleOrderCode
							left join TbInOrderItem c on b.InOrderItemId=c.ID
							where b.ChackState=2 group by a.InOrderCode) sap on ino.InOrderCode=sap.InOrderCode where 1=1 and  ino.BatchPlanCode!='' and ino.BatchPlanCode is not null and (ino.SiteCode in('6372921375874657752') or ino.WorkAreaCode in('6372921396045311451','6372921398380745033')) and ino.ProjectId='6372912251695766465' and st.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:30:41
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:30:41
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:30:41
Text:	select Tb.DataMonth,ISNULL(sum(TbData.InorderCount),0) as InCount,ISNULL(sum(TbData.InCount),0) as InWeight from (select datepart(MONTH,dateadd(mm,-t.number,getdate())) as DataMonth
from
(select number from master..spt_values where type='P') t
where year(dateadd(mm,-t.number,getdate()))=year(getdate())) Tb 
left join (select COUNT(1) as InorderCount,SUM(a.InCount) as InCount,a.RebarType,datepart(year,a.InsertTime) InsertYear,datepart(MONTH,a.InsertTime) InsertMonth from TbInOrder a 
left join TbStorage b on a.StorageCode=b.StorageCode
where a.Examinestatus!='已退回' 
and a.Examinestatus!='已撤销' 
and datepart(year,a.InsertTime)=datepart(year,GETDATE())  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
group by a.RebarType,datepart(year,a.InsertTime),datepart(MONTH,a.InsertTime)) TbData on  Tb.DataMonth=TbData.InsertMonth
group by Tb.DataMonth order by Tb.DataMonth asc 	


-----------------------------------------------------------------------------
2020-07-14 11:30:41
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:30:41
Text:	select TbType.InType,isnull(TbData.InCount,0) as InCount from (select '入库单数' as InType
                           union all
                           select '未取样' as InType
                           union all
                           select '验收不合格' as InType
                           union all
                           select '检测部分合格' as InType
                           union all
                           select '检测不合格' as InType) TbType
                           left join(select '入库单数' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode 
                           where 1=1 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '未取样' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1 and a.SampleOrderState='取样未完成' and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '验收不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and NoPassTotal>0 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测部分合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=3 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=2 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')) TbData on TbType.InType=TbData.InType	


-----------------------------------------------------------------------------
2020-07-14 11:30:41
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:30:41
Text:	select Tb.GhType,sum(Tb.GhWeight) as GhWeight,sum(tb.GhCount) as GhCount from (select TbGhType.GhType,isnull(TbGhInfo.HasSupplier,0) as GhWeight,isnull(TbGhInfo.GhCount,0) as GhCount from (select '供货' as GhType
                            union all
                            select '验收不合格' as GhType
                            union all
                            select '检测不合格' as GhType) TbGhType
                            left join(
                            --供货次数、总量
                            select isnull(sum(Tb.HasSupplier),0) as HasSupplier,isnull(sum(Tb.GhCount),0) as GhCount,'供货' as GhType from (select a.HasSupplier,isnull(b.GhCount,0) as GhCount from (select a.BatchPlanNum,sum(a.HasSupplier) as HasSupplier from TbSupplyListDetail a 
                            left join TbSupplyList s on a.BatchPlanNum=s.BatchPlanNum where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')
                            GROUP BY a.BatchPlanNum) a
                            left join(select Tb.BatchPlanNum,count(1) as GhCount from (select BatchPlanNum,ThisTime from TbSupplyListDetailHistory
                            group by BatchPlanNum,ThisTime) Tb group by Tb.BatchPlanNum) b on a.BatchPlanNum=b.BatchPlanNum) Tb 
                            union all
                            --验收不合格次数、验收不合格重量
                            select sum(TbSum.NoPass) as NoPass,sum(TbSum.YsNoPassCount) as YsNoPassCount,'验收不合格' as GhType from (select count(1) as YsNoPassCount,sum(Tb.NoPass) as NoPass from (select b.BatchPlanCode,c.ThisTime,sum(a.NoPass) as NoPass from TbInOrderItem a
                            left join TbInOrder b on a.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            left join TbSupplyListDetailHistory c on a.BatchPlanItemNewCode=c.BatchPlanItemNewCode
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033') and a.BatchPlanItemNewCode is not null and a.NoPass>0 
                            group by b.BatchPlanCode,c.ThisTime) Tb group by Tb.BatchPlanCode) TbSum
                            union all
                            --检测不合格次数、重量
                            select isnull(sum(Tb.JcNoPass),0) as JcNoPass,count(1) as JcNoPassCount,'检测不合格' as GhType from (select b.BatchPlanCode,d.ThisTime,Isnull(sum(c.PassCount),0) as JcNoPass from TbSampleOrderItem a
                            left join TbSampleOrder e on a.SampleOrderCode=e.SampleOrderCode
                            left join TbInOrderItem c on a.InOrderItemId=c.ID
                            left join TbSupplyListDetailHistory d on c.BatchPlanItemNewCode=d.BatchPlanItemNewCode
                            left join TbInOrder b on c.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')  and a.ChackState=2 and c.BatchPlanItemNewCode is not null
                            group by b.BatchPlanCode,d.ThisTime) Tb group by Tb.BatchPlanCode) TbGhInfo on TbGhType.GhType=TbGhInfo.GhType) Tb group by Tb.GhType	


-----------------------------------------------------------------------------
2020-07-14 11:30:41
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/StockTaking/Index


-----------------------------------------------------------------------------
2020-07-14 11:30:41
Text:	 SELECT count(*) as r_cnt FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode]) WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode71)	
Parameters:
@ProcessFactoryCode71[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:30:41
Text:	 SELECT   TOP 50 [TbStockTaking].[ID],[TbStockTaking].[TakNum],[TbStockTaking].[TakDay],[TbStockTaking].[TotalInventory],[TbStockTaking].[TotalTak],[TbStockTaking].[TotalEarnOrLos],[TbStockTaking].[EarnOrLos],[TbStockTaking].[Remarks],[TbStockTaking].[InsertUserCode],[TbStockTaking].[InsertTime],[TbUser].[UserName],[TbCompany].[CompanyFullName] AS [FactoryName],[TbSysDictionaryData].[DictionaryText] AS [WarehouseTypeName] FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode])  WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode71) ORDER BY [TbStockTaking].[ID] DESC 	
Parameters:
@ProcessFactoryCode71[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:30:41
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:30:41
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:30:41
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-14 11:30:41
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:30:42
Text:	select * from TbSysDictionaryData where 1=1 and FDictionaryCode=@name order by DictionaryOrder asc	
Parameters:
@name[String] = MaterialType


-----------------------------------------------------------------------------
2020-07-14 11:30:42
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:30:42
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:31:01
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:31:01
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:31:01
Text:	select 
                           a.RootNumber,
                           a.SizeSelection,
                           a.MaterialCode,
                           a.WeightSmallPlanN,
                           b.MaterialName,
                           b.SpecificationModel,
                           b.MeasurementUnitZl,
                           c.CompanyFullName StartSiteName,
                           d.CompanyFullName EndSiteName
                           from 
                           (
                           select 
                           a.MaterialCode,
                           a.Size as SizeSelection,
                           a.StartSiteCode,
                           a.EndSiteCode,
                           sum(a.Number) RootNumber,
                           sum(a.Weight) WeightSmallPlanN
                           from TbCloutStockPlace a
                           left join TbRMProductionMaterial rmpm on a.CollarCode=rmpm.CollarCode
                           where a.State=1 
                           and (ISNULL(@ProjectId,'')='' OR a.ProjectId=@ProjectId)
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                            and a.EndSiteCode in('6372921375874657752')
                           group by a.MaterialCode,a.Size,a.StartSiteCode,a.EndSiteCode
                           ) a
                           left join TbRawMaterialArchives b on a.MaterialCode=b.MaterialCode
                           left join TbCompany c on c.CompanyCode=a.StartSiteCode
                           left join TbCompany d on d.CompanyCode=a.EndSiteCode
                           where 1=1 
                           and (ISNULL(@MaterialName,'')='' or b.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or b.SpecificationModel like '%'+@SpecificationModel+'%')	
Parameters:
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 
@BegTime[DateTime] = 
@EndTime[DateTime] = 


-----------------------------------------------------------------------------
2020-07-14 11:31:01
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode asc)AS Row, * from (select 
                           a.RootNumber,
                           a.SizeSelection,
                           a.MaterialCode,
                           a.WeightSmallPlanN,
                           b.MaterialName,
                           b.SpecificationModel,
                           b.MeasurementUnitZl,
                           c.CompanyFullName StartSiteName,
                           d.CompanyFullName EndSiteName
                           from 
                           (
                           select 
                           a.MaterialCode,
                           a.Size as SizeSelection,
                           a.StartSiteCode,
                           a.EndSiteCode,
                           sum(a.Number) RootNumber,
                           sum(a.Weight) WeightSmallPlanN
                           from TbCloutStockPlace a
                           left join TbRMProductionMaterial rmpm on a.CollarCode=rmpm.CollarCode
                           where a.State=1 
                           and (ISNULL(@ProjectId,'')='' OR a.ProjectId=@ProjectId)
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                            and a.EndSiteCode in('6372921375874657752')
                           group by a.MaterialCode,a.Size,a.StartSiteCode,a.EndSiteCode
                           ) a
                           left join TbRawMaterialArchives b on a.MaterialCode=b.MaterialCode
                           left join TbCompany c on c.CompanyCode=a.StartSiteCode
                           left join TbCompany d on d.CompanyCode=a.EndSiteCode
                           where 1=1 
                           and (ISNULL(@MaterialName,'')='' or b.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or b.SpecificationModel like '%'+@SpecificationModel+'%')) as a)  SELECT * FROM temptbl where Row between 1 and 50	
Parameters:
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 
@BegTime[DateTime] = 
@EndTime[DateTime] = 


-----------------------------------------------------------------------------
2020-07-14 11:32:12
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)	


-----------------------------------------------------------------------------
2020-07-14 11:32:12
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:32:13
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)	


-----------------------------------------------------------------------------
2020-07-14 11:32:13
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:32:26
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:35:26
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:38:26
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:41:26
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:44:26
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:47:26
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:50:19
Text:	select tsm.* from TbRoleMenu tum
                           left join TbSysMenu tsm on tum.MenuCode=tsm.MenuCode
                           where tsm.IsShow=0 and tsm.MenuType='PC' and tum.RoleCode in('6372919444627396738','6372919451594895243') order by tsm.Sort asc	


-----------------------------------------------------------------------------
2020-07-14 11:50:19
Text:	select 
                        	tsm.*
                        from TbUserMenu tum
                        left join TbSysMenu tsm on tum.MenuCode=tsm.MenuCode
                        where tsm.IsShow=0 and tsm.MenuType='PC' and tum.UserCode=@userCode order by tsm.Sort asc	
Parameters:
@userCode[String] = 6372930471544160074


-----------------------------------------------------------------------------
2020-07-14 11:50:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:50:19
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:50:19
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:50:19
Text:	select isnull(sum(TbCF.Capacity),0) as Capacity,isnull(sum(TbCF.WeightSmallPlan),0) as WeightSmallPlan,isnull(cast(sum(TbCF.WeightSmallPlan)/sum(TbCF.Capacity)*100 as decimal(18,2)),0) as ActualLoadNew from (select cf.Capacity,Tb1.WeightSmallPlan,cf.ProcessFactoryCode from TbCapacityFilling cf  
left join(
select SUM(Tb.WeightSmallPlan) as WeightSmallPlan,Tb.ProcessFactoryCode from (
                            select isnull(SUM(wod.WeightSmallPlan),0) as WeightSmallPlan,wo.ProcessFactoryCode from TbWorkOrder wo
                            left join TbWorkOrderDetail wod on wo.OrderCode=wod.OrderCode
                            where (ISNULL(@ProcessFactoryCode,'')='' or wo.ProcessFactoryCode=@ProcessFactoryCode)
                            and CONVERT(varchar(7), wo.DistributionTime, 120)=@month
                            and wod.RevokeStart='正常' and wo.ProcessingState!='ConfirmWork' and wo.ProcessingState!='Finishing'  group by wo.ProcessFactoryCode
                            union all
                            select isnull(sum(opd.NoCompleted),0) as NoCompleted,op.ProcessFactoryCode from TbOrderProgress op
                            left join TbOrderProgressDetail opd on op.OrderCode=opd.OrderCode 
                            where (ISNULL(@ProcessFactoryCode,'')='' or op.ProcessFactoryCode=@ProcessFactoryCode)
                            and CONVERT(varchar(7), op.DistributionTime, 120)=CONVERT(varchar(4),YEAR(DATEADD(MONTH,-1,@month+'-01')))+'-'+Right(100+Month(DATEADD(MONTH,-1,@month+'-01')),2)
                            and opd.RevokeStart='正常'  group by op.ProcessFactoryCode)Tb  group by Tb.ProcessFactoryCode
) Tb1 on cf.ProcessFactoryCode=Tb1.ProcessFactoryCode 
where cf.CapacityMonth=@month
and (ISNULL(@ProcessFactoryCode,'')='' or cf.ProcessFactoryCode=@ProcessFactoryCode)) TbCF where (ISNULL(@ProcessFactoryCode,'')='' or TbCF.ProcessFactoryCode=@ProcessFactoryCode)	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@month[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-14 11:50:19
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:50:19
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode72) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode73,@WorkAreaCode74))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus75) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth76))) 	
Parameters:
@ProcessFactoryCode72[String] = 6386683729561128960
@WorkAreaCode73[String] = 6372921396045311451
@WorkAreaCode74[String] = 6372921398380745033
@Examinestatus75[String] = 审核完成
@DemandMonth76[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-14 11:50:19
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:50:19
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:50:20
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:50:20
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:50:20
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode79) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode80))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState81)) 	
Parameters:
@ProcessFactoryCode79[String] = 6386683729561128960
@SiteCode80[String] = 6372921375874657752
@ProcessingState81[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-14 11:50:20
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-14 11:50:20
Text:	 SELECT   [TbOrderProgress].[ProcessingState],[TbOrderProgress].[OrderCode],[TbOrderProgress].[FinishProcessingDateTime],[TbOrderProgress].[DistributionTime],[TbOrderProgress].[SiteCode] FROM [TbOrderProgress]  WHERE ((([TbOrderProgress].[SiteCode] IN (@SiteCode77)) AND ([TbOrderProgress].[ProcessFactoryCode] = @ProcessFactoryCode78)) AND ((YEAR(DistributionTime)=2020 and MONTH(DistributionTime)=7) or (DistributionTime<'2020/7/1 0:00:00' and (ProcessingState!='Finishing')))) 	
Parameters:
@SiteCode77[String] = 6372921375874657752
@ProcessFactoryCode78[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:50:20
Text:	 SELECT   * FROM [TbWorkOrderDetail]  WHERE (1=2) AND ([TbWorkOrderDetail].[DaetailWorkStrat] = @DaetailWorkStrat82) 	
Parameters:
@DaetailWorkStrat82[String] = 未加工


-----------------------------------------------------------------------------
2020-07-14 11:50:20
Text:	 SELECT   [TbOrderProgress].[WeightTotal] AS [TotalWeight],[TbCompany].[ParentCompanyCode] FROM [TbOrderProgress] LEFT OUTER JOIN [TbCompany] ON ([TbOrderProgress].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((1=2) AND ([TbOrderProgress].[ProcessingState] <> @ProcessingState83)) AND ((([TbOrderProgress].[FinishProcessingDateTime] is not null ) AND ([TbOrderProgress].[DistributionTime] < [TbOrderProgress].[FinishProcessingDateTime])) OR (([TbOrderProgress].[FinishProcessingDateTime] is null ) AND ([TbOrderProgress].[DistributionTime] < @DistributionTime84)))) 	
Parameters:
@ProcessingState83[String] = Finishing
@DistributionTime84[DateTime] = 2020/7/14 0:00:00


-----------------------------------------------------------------------------
2020-07-14 11:50:20
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:50:20
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode85) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode86))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState87)) 	
Parameters:
@ProcessFactoryCode85[String] = 6386683729561128960
@SiteCode86[String] = 6372921375874657752
@ProcessingState87[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-14 11:50:20
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-14 11:50:21
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:50:21
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode89) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode90,@WorkAreaCode91))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus92) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth93))) 	
Parameters:
@ProcessFactoryCode89[String] = 6386683729561128960
@WorkAreaCode90[String] = 6372921396045311451
@WorkAreaCode91[String] = 6372921398380745033
@Examinestatus92[String] = 审核完成
@DemandMonth93[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-14 11:50:21
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:50:21
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:50:21
Text:	 SELECT   [TbRawMaterialStockRecord].[MaterialCode],sum([TbRawMaterialStockRecord].[UseCount]) AS [UseCount],sum([TbRawMaterialStockRecord].[LockCount]) AS [LockCount] FROM [TbRawMaterialStockRecord] LEFT OUTER JOIN [TbStorage] ON ([TbRawMaterialStockRecord].[StorageCode] = [TbStorage].[StorageCode]) LEFT OUTER JOIN [TbRawMaterialArchives] ON ([TbRawMaterialStockRecord].[MaterialCode] = [TbRawMaterialArchives].[MaterialCode])  WHERE ((([TbStorage].[ProcessFactoryCode] = @ProcessFactoryCode96) AND ([TbRawMaterialStockRecord].[WorkAreaCode] IN (@WorkAreaCode98,@WorkAreaCode99))) AND ([TbRawMaterialArchives].[RebarType] = @RebarType101)) GROUP BY [TbRawMaterialStockRecord].[MaterialCode] 	
Parameters:
@ProcessFactoryCode96[String] = 6386683729561128960
@WorkAreaCode98[String] = 6372921396045311451
@WorkAreaCode99[String] = 6372921398380745033
@RebarType101[String] = BuildingSteel


-----------------------------------------------------------------------------
2020-07-14 11:50:21
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:50:21
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:50:21
Text:	 SELECT   [TbRawMaterialStockRecord].[MaterialCode],sum([TbRawMaterialStockRecord].[UseCount]) AS [UseCount],sum([TbRawMaterialStockRecord].[LockCount]) AS [LockCount] FROM [TbRawMaterialStockRecord] LEFT OUTER JOIN [TbStorage] ON ([TbRawMaterialStockRecord].[StorageCode] = [TbStorage].[StorageCode]) LEFT OUTER JOIN [TbRawMaterialArchives] ON ([TbRawMaterialStockRecord].[MaterialCode] = [TbRawMaterialArchives].[MaterialCode])  WHERE ((([TbStorage].[ProcessFactoryCode] = @ProcessFactoryCode105) AND ([TbRawMaterialStockRecord].[WorkAreaCode] IN (@WorkAreaCode107,@WorkAreaCode108))) AND ([TbRawMaterialArchives].[RebarType] = @RebarType110)) GROUP BY [TbRawMaterialStockRecord].[MaterialCode] 	
Parameters:
@ProcessFactoryCode105[String] = 6386683729561128960
@WorkAreaCode107[String] = 6372921396045311451
@WorkAreaCode108[String] = 6372921398380745033
@RebarType110[String] = SectionSteel


-----------------------------------------------------------------------------
2020-07-14 11:50:21
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:50:21
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode112) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode113,@WorkAreaCode114))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus115) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth116))) 	
Parameters:
@ProcessFactoryCode112[String] = 6386683729561128960
@WorkAreaCode113[String] = 6372921396045311451
@WorkAreaCode114[String] = 6372921398380745033
@Examinestatus115[String] = 审核完成
@DemandMonth116[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-14 11:50:21
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:50:21
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:50:21
Text:	
                        select fewoi.DataCode as OddNumbers,
                         fewoi.EarlyWarningContent,
                         fewoi.EWFormDataCode,
                         CONVERT(varchar(100), fewoi.EarlyWarningTime, 120) as EarlyWarningTime,
                         EWFormCode,sm.MenuName,fn.FlowNodeName,cp1.CompanyFullName as BranchName,
                         cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,
                         u1.UserName as FlowSpUserName,u2.UserName as FlowYjUserName 
                        FROM (
                        select*
                           FROM ( 
                        		SELECT a.*, row_number()over(partition BY a.FlowCode ORDER BY a.FlowNodeCode,a.EarlyWarningTime desc) as group_idx 
                        		FROM TbFlowEarlyWarningOtherInfo  a
                        		INNER JOIN  TbFlowEarlyWarningInfo b ON a.FlowCode=b.FlowCode 
                        		AND a.EWFormDataCode=b.EWFormDataCode AND a.FlowNodeCode=b.FlowNodeCode 
                        		WHERE YEAR(a.EarlyWarningTime)= @Year and MONTH(a.EarlyWarningTime)= @Month AND b.EarlyWarningStart=0
                           ) ret
                        WHERE ret.group_idx =1
                        ) fewoi
                        left join TbFlowNode fn on fewoi.FlowCode=fn.FlowCode and fewoi.FlowNodeCode=fn.FlowNodeCode
                        left join TbSysMenu sm on fewoi.EWFormCode=sm.MenuCode
                        left join TbCompany cp1 on fewoi.BranchCode=cp1.CompanyCode
                        left join TbCompany cp2 on fewoi.WorkAreaCode=cp2.CompanyCode
                        left join TbCompany cp3 on fewoi.SiteCode=cp3.CompanyCode
                        left join TbCompany cp4 on fewoi.ProcessFactoryCode=cp4.CompanyCode
                        left join TbUser u1 on fewoi.FlowSpUserCode=u1.UserId
                        left join TbUser u2 on fewoi.FlowYjUserCode=u2.UserId where 1=1 and fewoi.ProjectId='6372912251695766465' and fewoi.ProcessFactoryCode='6386683729561128960' and (fewoi.SiteCode in('6372921375874657752') or fewoi.WorkAreaCode in('6372921396045311451','6372921398380745033')) ORDER BY fewoi.EarlyWarningTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 11:50:21
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:50:21
Text:	--加急订单个数
                           select wo.OrderCode,wo.DistributionTime,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName from TbWorkOrder wo
                           left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on wo.ProcessFactoryCode=cp2.CompanyCode
                           where UrgentDegree='Urgent'
                           and YEAR(wo.DistributionTime)= @Year and MONTH(wo.DistributionTime)= @Month  and wo.ProjectId='6372912251695766465' and wo.ProcessFactoryCode='6386683729561128960' and wo.SiteCode in('6372921375874657752')  ORDER BY wo.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 11:50:21
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:50:21
Text:	--加工进度滞后
                           select op.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,op.DistributionTime,op.FinishProcessingDateTime from TbOrderProgress op 
                           left join TbCompany cp1 on op.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on op.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(op.DistributionTime)= @Year and MONTH(op.DistributionTime)= @Month
                           and (op.FinishProcessingDateTime>op.DistributionTime or (GETDATE()>op.DistributionTime and op.FinishProcessingDateTime is null))  and op.ProjectId='6372912251695766465' and op.ProcessFactoryCode='6386683729561128960' and op.SiteCode in('6372921375874657752') ORDER BY op.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 11:50:21
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:50:21
Text:	--配送超期
                           select dpi.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,dpi.DistributionTime,dpi.DeliveryCompleteTime,dpi.Remark from TbDistributionPlanInfo dpi
                           left join TbCompany cp1 on dpi.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on dpi.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(dpi.DistributionTime)= @Year and MONTH(dpi.DistributionTime)= @Month
                           and (dpi.DeliveryCompleteTime>dpi.DistributionTime or (GETDATE()>dpi.DistributionTime and dpi.DeliveryCompleteTime is null))  and dpi.ProjectId='6372912251695766465' and dpi.ProcessFactoryCode='6386683729561128960' and dpi.SiteCode in('6372921375874657752') ORDER BY dpi.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 11:50:21
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:50:21
Text:	select TbYj.*,cp1.CompanyFullName as SiteName,tcr.EnterSpaceTime,tcr.StartDischargeTime,tcr.EndDischargeTime,disEnt.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SiteDischargeCargo' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbTransportCarReport tcr on TbYj.EWFormDataCode=tcr.DisEntOrderId
                           left join TbDistributionEnt disEnt on tcr.DistributionCode=disEnt.DistributionCode
                           left join TbCompany cp on disEnt.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and disEnt.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ORDER BY tcr.EnterSpaceTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 11:50:21
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:50:21
Text:	select TbYj.*,cp1.CompanyFullName as SiteName,sfs.DistributionCode,sdc.DistributionTime,sfs.SigninTime,sfs.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SemiFinishedSign' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbSemiFinishedSign sfs on TbYj.EWFormDataCode=sfs.ID
                           left join TbSiteDischargeCargo sdc on sfs.DistributionCode=sdc.DistributionCode and sfs.DischargeCargoCode=sdc.DischargeCargoCode
                           left join TbCompany cp on sfs.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month and TbYj.ProjectId='6372912251695766465' and sfs.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752')	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 11:50:21
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:50:21
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:50:21
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode119) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode120))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState121)) 	
Parameters:
@ProcessFactoryCode119[String] = 6386683729561128960
@SiteCode120[String] = 6372921375874657752
@ProcessingState121[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-14 11:50:21
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-14 11:50:21
Text:	 SELECT   [TbOrderProgress].[ProcessingState],[TbOrderProgress].[OrderCode],[TbOrderProgress].[FinishProcessingDateTime],[TbOrderProgress].[DistributionTime],[TbOrderProgress].[SiteCode] FROM [TbOrderProgress]  WHERE ((([TbOrderProgress].[SiteCode] IN (@SiteCode117)) AND ([TbOrderProgress].[ProcessFactoryCode] = @ProcessFactoryCode118)) AND ((YEAR(DistributionTime)=2020 and MONTH(DistributionTime)=7) or (DistributionTime<'2020/7/1 0:00:00' and (ProcessingState!='Finishing')))) 	
Parameters:
@SiteCode117[String] = 6372921375874657752
@ProcessFactoryCode118[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:50:21
Text:	 SELECT   * FROM [TbWorkOrderDetail]  WHERE (1=2) AND ([TbWorkOrderDetail].[DaetailWorkStrat] = @DaetailWorkStrat122) 	
Parameters:
@DaetailWorkStrat122[String] = 未加工


-----------------------------------------------------------------------------
2020-07-14 11:50:21
Text:	 SELECT   [TbOrderProgress].[WeightTotal] AS [TotalWeight],[TbCompany].[ParentCompanyCode] FROM [TbOrderProgress] LEFT OUTER JOIN [TbCompany] ON ([TbOrderProgress].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((1=2) AND ([TbOrderProgress].[ProcessingState] <> @ProcessingState123)) AND ((([TbOrderProgress].[FinishProcessingDateTime] is not null ) AND ([TbOrderProgress].[DistributionTime] < [TbOrderProgress].[FinishProcessingDateTime])) OR (([TbOrderProgress].[FinishProcessingDateTime] is null ) AND ([TbOrderProgress].[DistributionTime] < @DistributionTime124)))) 	
Parameters:
@ProcessingState123[String] = Finishing
@DistributionTime124[DateTime] = 2020/7/14 0:00:00


-----------------------------------------------------------------------------
2020-07-14 11:50:22
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:50:22
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:50:22
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:50:22
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:50:22
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:50:22
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:50:22
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:50:22
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:50:22
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:50:22
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:50:22
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:50:22
Text:	SELECT 
                            '审批超时' as YjTypeName,COUNT(1) as YjNum
                            FROM (
									SELECT a.*, row_number()over(partition BY a.FlowCode ORDER BY a.FlowNodeCode,a.EarlyWarningTime desc) as group_idx 
									FROM TbFlowEarlyWarningOtherInfo  a
									INNER JOIN  TbFlowEarlyWarningInfo b ON a.FlowCode=b.FlowCode 
									AND a.EWFormDataCode=b.EWFormDataCode AND a.FlowNodeCode=b.FlowNodeCode 
									WHERE  b.EarlyWarningStart=0 AND YEAR(a.EarlyWarningTime)= @Year and MONTH(a.EarlyWarningTime)= @Month  and a.ProjectId='6372912251695766465' and a.ProcessFactoryCode='6386683729561128960' and (a.SiteCode in('6372921375874657752') or a.WorkAreaCode in('6372921396045311451','6372921398380745033'))
							   ) Tb1
                            WHERE Tb1.group_idx =1
                           union all
                            select '未报月度需求计划' as YjTypeName,COUNT(1)as YjNum
                             FROM ( 
                                  SELECT *, row_number()over(partition BY EarlyWarningCode,EWFormDataCode ORDER BY EWNodeCode,EWTime desc) as group_idx 
                                  FROM TbFormEarlyWarningNodeInfo fwqi
                                  WHERE fwqi.MenuCode='RawMonthDemandPlan' AND fwqi.EWStart=0 AND YEAR(fwqi.EWTime)= @Year and MONTH(fwqi.EWTime)= @Month  and fwqi.ProjectId='6372912251695766465' and (fwqi.SiteCode in('6372921375874657752') or fwqi.WorkArea in('6372921396045311451','6372921398380745033'))  
                             ) Tb2
                             WHERE Tb2.group_idx =1
                           union all
                           select '原材料供货超时' as YjTypeName,COUNT(1) as YjNum from (
                           select BatchPlanNum,cp1.CompanyFullName as BranchName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,sup.SupplyDate,sup.SupplyCompleteTime,sup.ProjectId from TbSupplyList sup
                           left join TbCompany cp1 on cp1.CompanyCode=sup.BranchCode
                           left join TbCompany cp2 on cp2.CompanyCode=sup.WorkAreaCode
                           left join TbCompany cp3 on cp3.CompanyCode=sup.SiteCode
                           left join TbCompany cp4 on cp4.CompanyCode=sup.ProcessFactoryCode
                           where (sup.SupplyCompleteTime>sup.SupplyDate or (GETDATE()>sup.SupplyDate and sup.SupplyCompleteTime is null))
						   and YEAR(sup.SupplyDate)= @Year and MONTH(sup.SupplyDate)= @Month  and sup.ProjectId='6372912251695766465' and sup.ProcessFactoryCode='6386683729561128960' and (sup.SiteCode in('6372921375874657752') or sup.WorkAreaCode in('6372921396045311451','6372921398380745033'))) Tb3
                           union all
                           select '加急订单' as YjTypeName,COUNT(1) as YjNum from (--加急订单个数
                           select wo.OrderCode,wo.DistributionTime,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName from TbWorkOrder wo
                           left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on wo.ProcessFactoryCode=cp2.CompanyCode
                           where UrgentDegree='Urgent' 
						   and YEAR(wo.DistributionTime)= @Year and MONTH(wo.DistributionTime)= @Month  and wo.ProjectId='6372912251695766465' and wo.ProcessFactoryCode='6386683729561128960' and wo.SiteCode in('6372921375874657752') ) Tb4
                           union all
                           select '加工进度滞后' as YjTypeName,COUNT(1) as YjNum from (--加工进度滞后
                           select op.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,op.DistributionTime,op.FinishProcessingDateTime from TbOrderProgress op 
                           left join TbCompany cp1 on op.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on op.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(op.DistributionTime)= @Year and MONTH(op.DistributionTime)= @Month
                           and (op.FinishProcessingDateTime>op.DistributionTime or (GETDATE()>op.DistributionTime and op.FinishProcessingDateTime is null))  and op.ProjectId='6372912251695766465' and op.ProcessFactoryCode='6386683729561128960' and op.SiteCode in('6372921375874657752') ) Tb5
                           union all
                           select '接收配送超期' as YjTypeName,COUNT(1) as YjNum from (--配送超期
                           select dpi.OrderCode,cp1.CompanyFullName as SIteName,cp2.CompanyFullName as ProcessFactoryName,dpi.DistributionTime,dpi.DeliveryCompleteTime from TbDistributionPlanInfo dpi
                           left join TbCompany cp1 on dpi.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on dpi.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(dpi.DistributionTime)= @Year and MONTH(dpi.DistributionTime)= @Month
                           and (dpi.DeliveryCompleteTime>dpi.DistributionTime or (GETDATE()>dpi.DistributionTime and dpi.DeliveryCompleteTime is null))  and dpi.ProjectId='6372912251695766465' and dpi.ProcessFactoryCode='6386683729561128960' and dpi.SiteCode in('6372921375874657752') ) Tb6 
                           union all
                           select '卸货超时' as YjTypeName,COUNT(1) as YjNum from(--卸货超时
                           select TbYj.*,cp1.CompanyFullName as SiteName,tcr.EnterSpaceTime,tcr.StartDischargeTime,tcr.EndDischargeTime,disEnt.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SiteDischargeCargo' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbTransportCarReport tcr on TbYj.EWFormDataCode=tcr.DisEntOrderId
                           left join TbDistributionEnt disEnt on tcr.DistributionCode=disEnt.DistributionCode
                           left join TbCompany cp on disEnt.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and disEnt.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ) Tb7
                           union all
                           select '签收超时' as YjTypeName,COUNT(1) as YjNum from (select TbYj.*,cp1.CompanyFullName as SiteName,sfs.DistributionCode,sdc.DistributionTime,sfs.SigninTime,sfs.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SemiFinishedSign' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbSemiFinishedSign sfs on TbYj.EWFormDataCode=sfs.ID
                           left join TbSiteDischargeCargo sdc on sfs.DistributionCode=sdc.DistributionCode and sfs.DischargeCargoCode=sdc.DischargeCargoCode
                           left join TbCompany cp on sfs.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and sfs.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ) Tb8	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 11:50:22
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:50:22
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:50:22
Text:	--原材料供货超时
                           select BatchPlanNum,cp1.CompanyFullName as BranchName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,sup.SupplyDate,sup.SupplyCompleteTime,sup.ProjectId,sup.Remarks from TbSupplyList sup
                           left join TbCompany cp1 on cp1.CompanyCode=sup.BranchCode
                           left join TbCompany cp2 on cp2.CompanyCode=sup.WorkAreaCode
                           left join TbCompany cp3 on cp3.CompanyCode=sup.SiteCode
                           left join TbCompany cp4 on cp4.CompanyCode=sup.ProcessFactoryCode
                           where YEAR(sup.SupplyDate)= @Year and MONTH(sup.SupplyDate)= @Month
                           and (sup.SupplyCompleteTime>sup.SupplyDate or (GETDATE()>sup.SupplyDate and sup.SupplyCompleteTime is null))  and sup.ProjectId='6372912251695766465' and sup.ProcessFactoryCode='6386683729561128960' and (sup.SiteCode in('6372921375874657752') or sup.WorkAreaCode in('6372921396045311451','6372921398380745033'))	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 11:50:22
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:50:22
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode125) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode126,@WorkAreaCode127))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus128) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth129))) 	
Parameters:
@ProcessFactoryCode125[String] = 6386683729561128960
@WorkAreaCode126[String] = 6372921396045311451
@WorkAreaCode127[String] = 6372921398380745033
@Examinestatus128[String] = 审核完成
@DemandMonth129[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-14 11:50:22
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:50:22
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:50:22
Text:	SELECT sm.MenuName,fwqi.EWContent,fwqi.EWUserCode,u.UserName,fwqi.EWFormDataCode,cp1.CompanyFullName as  FbName,cp2.CompanyFullName as GqName,fwqi.EWTime,sdd.DictionaryText as RebarType  
                   FROM (  
                    select ret.*
                    FROM ( 
                         SELECT *, row_number()over(partition BY EarlyWarningCode,EWFormDataCode ORDER BY EWNodeCode,EWTime desc) as group_idx 
                         FROM TbFormEarlyWarningNodeInfo fwqi
                         WHERE YEAR(fwqi.EWTime)= @Year and MONTH(fwqi.EWTime)= @Month AND fwqi.MenuCode='RawMonthDemandPlan' AND fwqi.EWStart=0
                    ) ret
                    WHERE ret.group_idx = 1
                   ) fwqi
                    left join TbSysMenu sm on fwqi.MenuCode=sm.MenuCode
                            left join TbCompany cp1 on fwqi.CompanyCode=cp1.CompanyCode
                            left join TbCompany cp2 on fwqi.WorkArea=cp2.CompanyCode
                            left join TbCompany cp3 on fwqi.SiteCode=cp3.CompanyCode
                            left join TbUser u on fwqi.EWUserCode=u.UserId
                            left join TbRawMaterialMonthDemandPlan rmp on fwqi.EWFormDataCode=rmp.ID
                            left join TbSysDictionaryData sdd on sdd.DictionaryCode=rmp.RebarType
                    where 1=1 and fwqi.ProjectId='6372912251695766465' and (fwqi.SiteCode in('6372921375874657752') or fwqi.WorkArea in('6372921396045311451','6372921398380745033')) ORDER BY fwqi.EWTime DESC	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-14 11:50:25
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:50:25
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialArchives/Index


-----------------------------------------------------------------------------
2020-07-14 11:50:25
Text:	select * from TbSysDictionaryData where 1=1 and FDictionaryCode=@name order by DictionaryOrder asc	
Parameters:
@name[String] = RebarType


-----------------------------------------------------------------------------
2020-07-14 11:50:25
Text:	 SELECT count(*) as r_cnt FROM [TbRawMaterialArchives] LEFT OUTER JOIN [TbSysDictionaryData] ON (([TbRawMaterialArchives].[MeasurementUnit] = [TbSysDictionaryData].[DictionaryCode]) AND ([TbSysDictionaryData].[FDictionaryCode] = @FDictionaryCode130))	
Parameters:
@FDictionaryCode130[String] = Unit
@FDictionaryCode131[String] = RebarType


-----------------------------------------------------------------------------
2020-07-14 11:50:25
Text:	 SELECT   TOP 50 [TbRawMaterialArchives].*,[TbSysDictionaryData].[DictionaryText] AS [MeasurementUnitNew],( SELECT   [TbSysDictionaryData].[DictionaryText] FROM [TbSysDictionaryData]  WHERE ([TbSysDictionaryData].[DictionaryCode] = [TbRawMaterialArchives].[RebarType]) AND ([TbSysDictionaryData].[FDictionaryCode] = @FDictionaryCode131) ) AS [RebarTypeNew] FROM [TbRawMaterialArchives] LEFT OUTER JOIN [TbSysDictionaryData] ON (([TbRawMaterialArchives].[MeasurementUnit] = [TbSysDictionaryData].[DictionaryCode]) AND ([TbSysDictionaryData].[FDictionaryCode] = @FDictionaryCode130))  ORDER BY [TbRawMaterialArchives].[ID] ASC 	
Parameters:
@FDictionaryCode130[String] = Unit
@FDictionaryCode131[String] = RebarType


-----------------------------------------------------------------------------
2020-07-14 11:50:28
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:50:29
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-14 11:50:29
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:50:29
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:50:29
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:50:29
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-14 11:50:29
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:50:29
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:50:29
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:50:29
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-14 11:50:29
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:50:30
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:50:30
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:50:30
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:50:30
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:50:30
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/InOrder/Index


-----------------------------------------------------------------------------
2020-07-14 11:50:30
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:50:30
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:50:30
Text:	select ino.*,case when ISNULL(ino.ChackResult,0)=0 then '' when ISNULL(ino.ChackResult,0)=1 then '合格' when ISNULL(ino.ChackResult,0)=2 then '不合格' when ISNULL(ino.ChackResult,0)=3 then '部分合格' end ChackResultName,ur.UserName,ur1.UserName as DeliverUser,st.StorageName,sdd.DictionaryText as RebarTypeName,sp.SupplierName,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as BranchName,case when rmsp.DemandPlanCode is null then fbnp.RawMaterialDemandNum else rmsp.DemandPlanCode end DemandPlanCode,inoi.IsTh,sap.NoJcBhgCount from TbInOrder ino
							left join(select '退回' as IsTh,InOrderCode from TbInOrderItem where ReturnTime is not null group by InOrderCode) inoi on ino.InOrderCode=inoi.InOrderCode
                            left join TbUser ur on ino.InsertUserCode=ur.UserCode
                            left join TbUser ur1 on ino.UserCode=ur1.UserCode
                            left join TbStorage st on ino.StorageCode=st.StorageCode
                            left join TbSysDictionaryData sdd on ino.RebarType=sdd.DictionaryCode
                            left join TbCompany cp1 on ino.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on ino.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbSupplier sp on ino.SupplierCode=sp.SupplierCode
                            left join TbFactoryBatchNeedPlan fbnp on ino.BatchPlanCode=fbnp.BatchPlanNum
							left join TbRawMaterialMonthDemandSupplyPlan rmsp on fbnp.RawMaterialDemandNum=rmsp.SupplyPlanCode
							left join (	select a.InOrderCode,SUM(c.PassCount) as NoJcBhgCount from TbSampleOrder a
							left join TbSampleOrderItem b on a.SampleOrderCode=b.SampleOrderCode
							left join TbInOrderItem c on b.InOrderItemId=c.ID
							where b.ChackState=2 group by a.InOrderCode) sap on ino.InOrderCode=sap.InOrderCode where 1=1 and  ino.BatchPlanCode!='' and ino.BatchPlanCode is not null and (ino.SiteCode in('6372921375874657752') or ino.WorkAreaCode in('6372921396045311451','6372921398380745033')) and ino.ProjectId='6372912251695766465' and st.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-14 11:50:30
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by InOrderCode desc)AS Row, * from (select ino.*,case when ISNULL(ino.ChackResult,0)=0 then '' when ISNULL(ino.ChackResult,0)=1 then '合格' when ISNULL(ino.ChackResult,0)=2 then '不合格' when ISNULL(ino.ChackResult,0)=3 then '部分合格' end ChackResultName,ur.UserName,ur1.UserName as DeliverUser,st.StorageName,sdd.DictionaryText as RebarTypeName,sp.SupplierName,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as BranchName,case when rmsp.DemandPlanCode is null then fbnp.RawMaterialDemandNum else rmsp.DemandPlanCode end DemandPlanCode,inoi.IsTh,sap.NoJcBhgCount from TbInOrder ino
							left join(select '退回' as IsTh,InOrderCode from TbInOrderItem where ReturnTime is not null group by InOrderCode) inoi on ino.InOrderCode=inoi.InOrderCode
                            left join TbUser ur on ino.InsertUserCode=ur.UserCode
                            left join TbUser ur1 on ino.UserCode=ur1.UserCode
                            left join TbStorage st on ino.StorageCode=st.StorageCode
                            left join TbSysDictionaryData sdd on ino.RebarType=sdd.DictionaryCode
                            left join TbCompany cp1 on ino.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on ino.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbSupplier sp on ino.SupplierCode=sp.SupplierCode
                            left join TbFactoryBatchNeedPlan fbnp on ino.BatchPlanCode=fbnp.BatchPlanNum
							left join TbRawMaterialMonthDemandSupplyPlan rmsp on fbnp.RawMaterialDemandNum=rmsp.SupplyPlanCode
							left join (	select a.InOrderCode,SUM(c.PassCount) as NoJcBhgCount from TbSampleOrder a
							left join TbSampleOrderItem b on a.SampleOrderCode=b.SampleOrderCode
							left join TbInOrderItem c on b.InOrderItemId=c.ID
							where b.ChackState=2 group by a.InOrderCode) sap on ino.InOrderCode=sap.InOrderCode where 1=1 and  ino.BatchPlanCode!='' and ino.BatchPlanCode is not null and (ino.SiteCode in('6372921375874657752') or ino.WorkAreaCode in('6372921396045311451','6372921398380745033')) and ino.ProjectId='6372912251695766465' and st.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:50:31
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:50:31
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:50:31
Text:	select Tb.DataMonth,ISNULL(sum(TbData.InorderCount),0) as InCount,ISNULL(sum(TbData.InCount),0) as InWeight from (select datepart(MONTH,dateadd(mm,-t.number,getdate())) as DataMonth
from
(select number from master..spt_values where type='P') t
where year(dateadd(mm,-t.number,getdate()))=year(getdate())) Tb 
left join (select COUNT(1) as InorderCount,SUM(a.InCount) as InCount,a.RebarType,datepart(year,a.InsertTime) InsertYear,datepart(MONTH,a.InsertTime) InsertMonth from TbInOrder a 
left join TbStorage b on a.StorageCode=b.StorageCode
where a.Examinestatus!='已退回' 
and a.Examinestatus!='已撤销' 
and datepart(year,a.InsertTime)=datepart(year,GETDATE())  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
group by a.RebarType,datepart(year,a.InsertTime),datepart(MONTH,a.InsertTime)) TbData on  Tb.DataMonth=TbData.InsertMonth
group by Tb.DataMonth order by Tb.DataMonth asc 	


-----------------------------------------------------------------------------
2020-07-14 11:50:31
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:50:31
Text:	select TbType.InType,isnull(TbData.InCount,0) as InCount from (select '入库单数' as InType
                           union all
                           select '未取样' as InType
                           union all
                           select '验收不合格' as InType
                           union all
                           select '检测部分合格' as InType
                           union all
                           select '检测不合格' as InType) TbType
                           left join(select '入库单数' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode 
                           where 1=1 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '未取样' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1 and a.SampleOrderState='取样未完成' and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '验收不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and NoPassTotal>0 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测部分合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=3 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=2 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')) TbData on TbType.InType=TbData.InType	


-----------------------------------------------------------------------------
2020-07-14 11:50:31
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:50:31
Text:	select Tb.GhType,sum(Tb.GhWeight) as GhWeight,sum(tb.GhCount) as GhCount from (select TbGhType.GhType,isnull(TbGhInfo.HasSupplier,0) as GhWeight,isnull(TbGhInfo.GhCount,0) as GhCount from (select '供货' as GhType
                            union all
                            select '验收不合格' as GhType
                            union all
                            select '检测不合格' as GhType) TbGhType
                            left join(
                            --供货次数、总量
                            select isnull(sum(Tb.HasSupplier),0) as HasSupplier,isnull(sum(Tb.GhCount),0) as GhCount,'供货' as GhType from (select a.HasSupplier,isnull(b.GhCount,0) as GhCount from (select a.BatchPlanNum,sum(a.HasSupplier) as HasSupplier from TbSupplyListDetail a 
                            left join TbSupplyList s on a.BatchPlanNum=s.BatchPlanNum where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')
                            GROUP BY a.BatchPlanNum) a
                            left join(select Tb.BatchPlanNum,count(1) as GhCount from (select BatchPlanNum,ThisTime from TbSupplyListDetailHistory
                            group by BatchPlanNum,ThisTime) Tb group by Tb.BatchPlanNum) b on a.BatchPlanNum=b.BatchPlanNum) Tb 
                            union all
                            --验收不合格次数、验收不合格重量
                            select sum(TbSum.NoPass) as NoPass,sum(TbSum.YsNoPassCount) as YsNoPassCount,'验收不合格' as GhType from (select count(1) as YsNoPassCount,sum(Tb.NoPass) as NoPass from (select b.BatchPlanCode,c.ThisTime,sum(a.NoPass) as NoPass from TbInOrderItem a
                            left join TbInOrder b on a.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            left join TbSupplyListDetailHistory c on a.BatchPlanItemNewCode=c.BatchPlanItemNewCode
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033') and a.BatchPlanItemNewCode is not null and a.NoPass>0 
                            group by b.BatchPlanCode,c.ThisTime) Tb group by Tb.BatchPlanCode) TbSum
                            union all
                            --检测不合格次数、重量
                            select isnull(sum(Tb.JcNoPass),0) as JcNoPass,count(1) as JcNoPassCount,'检测不合格' as GhType from (select b.BatchPlanCode,d.ThisTime,Isnull(sum(c.PassCount),0) as JcNoPass from TbSampleOrderItem a
                            left join TbSampleOrder e on a.SampleOrderCode=e.SampleOrderCode
                            left join TbInOrderItem c on a.InOrderItemId=c.ID
                            left join TbSupplyListDetailHistory d on c.BatchPlanItemNewCode=d.BatchPlanItemNewCode
                            left join TbInOrder b on c.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')  and a.ChackState=2 and c.BatchPlanItemNewCode is not null
                            group by b.BatchPlanCode,d.ThisTime) Tb group by Tb.BatchPlanCode) TbGhInfo on TbGhType.GhType=TbGhInfo.GhType) Tb group by Tb.GhType	


-----------------------------------------------------------------------------
2020-07-14 11:50:31
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/StockTaking/Index


-----------------------------------------------------------------------------
2020-07-14 11:50:31
Text:	 SELECT count(*) as r_cnt FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode]) WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode132)	
Parameters:
@ProcessFactoryCode132[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:50:31
Text:	 SELECT   TOP 50 [TbStockTaking].[ID],[TbStockTaking].[TakNum],[TbStockTaking].[TakDay],[TbStockTaking].[TotalInventory],[TbStockTaking].[TotalTak],[TbStockTaking].[TotalEarnOrLos],[TbStockTaking].[EarnOrLos],[TbStockTaking].[Remarks],[TbStockTaking].[InsertUserCode],[TbStockTaking].[InsertTime],[TbUser].[UserName],[TbCompany].[CompanyFullName] AS [FactoryName],[TbSysDictionaryData].[DictionaryText] AS [WarehouseTypeName] FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode])  WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode132) ORDER BY [TbStockTaking].[ID] DESC 	
Parameters:
@ProcessFactoryCode132[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:50:31
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:50:31
Text:	select * from TbSysDictionaryData where 1=1 and FDictionaryCode=@name order by DictionaryOrder asc	
Parameters:
@name[String] = MaterialType


-----------------------------------------------------------------------------
2020-07-14 11:50:43
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:50:43
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-14 11:50:43
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:50:43
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:50:43
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:50:43
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-14 11:50:43
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:50:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:50:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:50:43
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:50:43
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/InOrder/Index


-----------------------------------------------------------------------------
2020-07-14 11:50:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:50:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:50:43
Text:	select ino.*,case when ISNULL(ino.ChackResult,0)=0 then '' when ISNULL(ino.ChackResult,0)=1 then '合格' when ISNULL(ino.ChackResult,0)=2 then '不合格' when ISNULL(ino.ChackResult,0)=3 then '部分合格' end ChackResultName,ur.UserName,ur1.UserName as DeliverUser,st.StorageName,sdd.DictionaryText as RebarTypeName,sp.SupplierName,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as BranchName,case when rmsp.DemandPlanCode is null then fbnp.RawMaterialDemandNum else rmsp.DemandPlanCode end DemandPlanCode,inoi.IsTh,sap.NoJcBhgCount from TbInOrder ino
							left join(select '退回' as IsTh,InOrderCode from TbInOrderItem where ReturnTime is not null group by InOrderCode) inoi on ino.InOrderCode=inoi.InOrderCode
                            left join TbUser ur on ino.InsertUserCode=ur.UserCode
                            left join TbUser ur1 on ino.UserCode=ur1.UserCode
                            left join TbStorage st on ino.StorageCode=st.StorageCode
                            left join TbSysDictionaryData sdd on ino.RebarType=sdd.DictionaryCode
                            left join TbCompany cp1 on ino.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on ino.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbSupplier sp on ino.SupplierCode=sp.SupplierCode
                            left join TbFactoryBatchNeedPlan fbnp on ino.BatchPlanCode=fbnp.BatchPlanNum
							left join TbRawMaterialMonthDemandSupplyPlan rmsp on fbnp.RawMaterialDemandNum=rmsp.SupplyPlanCode
							left join (	select a.InOrderCode,SUM(c.PassCount) as NoJcBhgCount from TbSampleOrder a
							left join TbSampleOrderItem b on a.SampleOrderCode=b.SampleOrderCode
							left join TbInOrderItem c on b.InOrderItemId=c.ID
							where b.ChackState=2 group by a.InOrderCode) sap on ino.InOrderCode=sap.InOrderCode where 1=1 and  ino.BatchPlanCode!='' and ino.BatchPlanCode is not null and (ino.SiteCode in('6372921375874657752') or ino.WorkAreaCode in('6372921396045311451','6372921398380745033')) and ino.ProjectId='6372912251695766465' and st.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-14 11:50:43
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by InOrderCode desc)AS Row, * from (select ino.*,case when ISNULL(ino.ChackResult,0)=0 then '' when ISNULL(ino.ChackResult,0)=1 then '合格' when ISNULL(ino.ChackResult,0)=2 then '不合格' when ISNULL(ino.ChackResult,0)=3 then '部分合格' end ChackResultName,ur.UserName,ur1.UserName as DeliverUser,st.StorageName,sdd.DictionaryText as RebarTypeName,sp.SupplierName,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as BranchName,case when rmsp.DemandPlanCode is null then fbnp.RawMaterialDemandNum else rmsp.DemandPlanCode end DemandPlanCode,inoi.IsTh,sap.NoJcBhgCount from TbInOrder ino
							left join(select '退回' as IsTh,InOrderCode from TbInOrderItem where ReturnTime is not null group by InOrderCode) inoi on ino.InOrderCode=inoi.InOrderCode
                            left join TbUser ur on ino.InsertUserCode=ur.UserCode
                            left join TbUser ur1 on ino.UserCode=ur1.UserCode
                            left join TbStorage st on ino.StorageCode=st.StorageCode
                            left join TbSysDictionaryData sdd on ino.RebarType=sdd.DictionaryCode
                            left join TbCompany cp1 on ino.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on ino.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbSupplier sp on ino.SupplierCode=sp.SupplierCode
                            left join TbFactoryBatchNeedPlan fbnp on ino.BatchPlanCode=fbnp.BatchPlanNum
							left join TbRawMaterialMonthDemandSupplyPlan rmsp on fbnp.RawMaterialDemandNum=rmsp.SupplyPlanCode
							left join (	select a.InOrderCode,SUM(c.PassCount) as NoJcBhgCount from TbSampleOrder a
							left join TbSampleOrderItem b on a.SampleOrderCode=b.SampleOrderCode
							left join TbInOrderItem c on b.InOrderItemId=c.ID
							where b.ChackState=2 group by a.InOrderCode) sap on ino.InOrderCode=sap.InOrderCode where 1=1 and  ino.BatchPlanCode!='' and ino.BatchPlanCode is not null and (ino.SiteCode in('6372921375874657752') or ino.WorkAreaCode in('6372921396045311451','6372921398380745033')) and ino.ProjectId='6372912251695766465' and st.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:50:44
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:50:44
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:50:44
Text:	select Tb.DataMonth,ISNULL(sum(TbData.InorderCount),0) as InCount,ISNULL(sum(TbData.InCount),0) as InWeight from (select datepart(MONTH,dateadd(mm,-t.number,getdate())) as DataMonth
from
(select number from master..spt_values where type='P') t
where year(dateadd(mm,-t.number,getdate()))=year(getdate())) Tb 
left join (select COUNT(1) as InorderCount,SUM(a.InCount) as InCount,a.RebarType,datepart(year,a.InsertTime) InsertYear,datepart(MONTH,a.InsertTime) InsertMonth from TbInOrder a 
left join TbStorage b on a.StorageCode=b.StorageCode
where a.Examinestatus!='已退回' 
and a.Examinestatus!='已撤销' 
and datepart(year,a.InsertTime)=datepart(year,GETDATE())  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
group by a.RebarType,datepart(year,a.InsertTime),datepart(MONTH,a.InsertTime)) TbData on  Tb.DataMonth=TbData.InsertMonth
group by Tb.DataMonth order by Tb.DataMonth asc 	


-----------------------------------------------------------------------------
2020-07-14 11:50:44
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:50:44
Text:	select TbType.InType,isnull(TbData.InCount,0) as InCount from (select '入库单数' as InType
                           union all
                           select '未取样' as InType
                           union all
                           select '验收不合格' as InType
                           union all
                           select '检测部分合格' as InType
                           union all
                           select '检测不合格' as InType) TbType
                           left join(select '入库单数' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode 
                           where 1=1 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '未取样' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1 and a.SampleOrderState='取样未完成' and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '验收不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and NoPassTotal>0 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测部分合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=3 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=2 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')) TbData on TbType.InType=TbData.InType	


-----------------------------------------------------------------------------
2020-07-14 11:50:44
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:50:44
Text:	select Tb.GhType,sum(Tb.GhWeight) as GhWeight,sum(tb.GhCount) as GhCount from (select TbGhType.GhType,isnull(TbGhInfo.HasSupplier,0) as GhWeight,isnull(TbGhInfo.GhCount,0) as GhCount from (select '供货' as GhType
                            union all
                            select '验收不合格' as GhType
                            union all
                            select '检测不合格' as GhType) TbGhType
                            left join(
                            --供货次数、总量
                            select isnull(sum(Tb.HasSupplier),0) as HasSupplier,isnull(sum(Tb.GhCount),0) as GhCount,'供货' as GhType from (select a.HasSupplier,isnull(b.GhCount,0) as GhCount from (select a.BatchPlanNum,sum(a.HasSupplier) as HasSupplier from TbSupplyListDetail a 
                            left join TbSupplyList s on a.BatchPlanNum=s.BatchPlanNum where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')
                            GROUP BY a.BatchPlanNum) a
                            left join(select Tb.BatchPlanNum,count(1) as GhCount from (select BatchPlanNum,ThisTime from TbSupplyListDetailHistory
                            group by BatchPlanNum,ThisTime) Tb group by Tb.BatchPlanNum) b on a.BatchPlanNum=b.BatchPlanNum) Tb 
                            union all
                            --验收不合格次数、验收不合格重量
                            select sum(TbSum.NoPass) as NoPass,sum(TbSum.YsNoPassCount) as YsNoPassCount,'验收不合格' as GhType from (select count(1) as YsNoPassCount,sum(Tb.NoPass) as NoPass from (select b.BatchPlanCode,c.ThisTime,sum(a.NoPass) as NoPass from TbInOrderItem a
                            left join TbInOrder b on a.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            left join TbSupplyListDetailHistory c on a.BatchPlanItemNewCode=c.BatchPlanItemNewCode
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033') and a.BatchPlanItemNewCode is not null and a.NoPass>0 
                            group by b.BatchPlanCode,c.ThisTime) Tb group by Tb.BatchPlanCode) TbSum
                            union all
                            --检测不合格次数、重量
                            select isnull(sum(Tb.JcNoPass),0) as JcNoPass,count(1) as JcNoPassCount,'检测不合格' as GhType from (select b.BatchPlanCode,d.ThisTime,Isnull(sum(c.PassCount),0) as JcNoPass from TbSampleOrderItem a
                            left join TbSampleOrder e on a.SampleOrderCode=e.SampleOrderCode
                            left join TbInOrderItem c on a.InOrderItemId=c.ID
                            left join TbSupplyListDetailHistory d on c.BatchPlanItemNewCode=d.BatchPlanItemNewCode
                            left join TbInOrder b on c.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')  and a.ChackState=2 and c.BatchPlanItemNewCode is not null
                            group by b.BatchPlanCode,d.ThisTime) Tb group by Tb.BatchPlanCode) TbGhInfo on TbGhType.GhType=TbGhInfo.GhType) Tb group by Tb.GhType	


-----------------------------------------------------------------------------
2020-07-14 11:50:44
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/StockTaking/Index


-----------------------------------------------------------------------------
2020-07-14 11:50:44
Text:	 SELECT count(*) as r_cnt FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode]) WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode133)	
Parameters:
@ProcessFactoryCode133[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:50:44
Text:	 SELECT   TOP 50 [TbStockTaking].[ID],[TbStockTaking].[TakNum],[TbStockTaking].[TakDay],[TbStockTaking].[TotalInventory],[TbStockTaking].[TotalTak],[TbStockTaking].[TotalEarnOrLos],[TbStockTaking].[EarnOrLos],[TbStockTaking].[Remarks],[TbStockTaking].[InsertUserCode],[TbStockTaking].[InsertTime],[TbUser].[UserName],[TbCompany].[CompanyFullName] AS [FactoryName],[TbSysDictionaryData].[DictionaryText] AS [WarehouseTypeName] FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode])  WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode133) ORDER BY [TbStockTaking].[ID] DESC 	
Parameters:
@ProcessFactoryCode133[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:50:44
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:50:44
Text:	select * from TbSysDictionaryData where 1=1 and FDictionaryCode=@name order by DictionaryOrder asc	
Parameters:
@name[String] = MaterialType


-----------------------------------------------------------------------------
2020-07-14 11:50:45
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:50:45
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:50:45
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:50:45
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-14 11:50:45
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:50:50
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:50:50
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-14 11:50:50
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:50:50
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:50:50
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:50:50
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-14 11:50:50
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:50:50
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:50:50
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:50:50
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-14 11:50:50
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:50:50
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:50:50
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:50:50
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:50:50
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/InOrder/Index


-----------------------------------------------------------------------------
2020-07-14 11:50:50
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:50:50
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:50:50
Text:	select ino.*,case when ISNULL(ino.ChackResult,0)=0 then '' when ISNULL(ino.ChackResult,0)=1 then '合格' when ISNULL(ino.ChackResult,0)=2 then '不合格' when ISNULL(ino.ChackResult,0)=3 then '部分合格' end ChackResultName,ur.UserName,ur1.UserName as DeliverUser,st.StorageName,sdd.DictionaryText as RebarTypeName,sp.SupplierName,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as BranchName,case when rmsp.DemandPlanCode is null then fbnp.RawMaterialDemandNum else rmsp.DemandPlanCode end DemandPlanCode,inoi.IsTh,sap.NoJcBhgCount from TbInOrder ino
							left join(select '退回' as IsTh,InOrderCode from TbInOrderItem where ReturnTime is not null group by InOrderCode) inoi on ino.InOrderCode=inoi.InOrderCode
                            left join TbUser ur on ino.InsertUserCode=ur.UserCode
                            left join TbUser ur1 on ino.UserCode=ur1.UserCode
                            left join TbStorage st on ino.StorageCode=st.StorageCode
                            left join TbSysDictionaryData sdd on ino.RebarType=sdd.DictionaryCode
                            left join TbCompany cp1 on ino.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on ino.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbSupplier sp on ino.SupplierCode=sp.SupplierCode
                            left join TbFactoryBatchNeedPlan fbnp on ino.BatchPlanCode=fbnp.BatchPlanNum
							left join TbRawMaterialMonthDemandSupplyPlan rmsp on fbnp.RawMaterialDemandNum=rmsp.SupplyPlanCode
							left join (	select a.InOrderCode,SUM(c.PassCount) as NoJcBhgCount from TbSampleOrder a
							left join TbSampleOrderItem b on a.SampleOrderCode=b.SampleOrderCode
							left join TbInOrderItem c on b.InOrderItemId=c.ID
							where b.ChackState=2 group by a.InOrderCode) sap on ino.InOrderCode=sap.InOrderCode where 1=1 and  ino.BatchPlanCode!='' and ino.BatchPlanCode is not null and (ino.SiteCode in('6372921375874657752') or ino.WorkAreaCode in('6372921396045311451','6372921398380745033')) and ino.ProjectId='6372912251695766465' and st.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-14 11:50:50
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by InOrderCode desc)AS Row, * from (select ino.*,case when ISNULL(ino.ChackResult,0)=0 then '' when ISNULL(ino.ChackResult,0)=1 then '合格' when ISNULL(ino.ChackResult,0)=2 then '不合格' when ISNULL(ino.ChackResult,0)=3 then '部分合格' end ChackResultName,ur.UserName,ur1.UserName as DeliverUser,st.StorageName,sdd.DictionaryText as RebarTypeName,sp.SupplierName,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as BranchName,case when rmsp.DemandPlanCode is null then fbnp.RawMaterialDemandNum else rmsp.DemandPlanCode end DemandPlanCode,inoi.IsTh,sap.NoJcBhgCount from TbInOrder ino
							left join(select '退回' as IsTh,InOrderCode from TbInOrderItem where ReturnTime is not null group by InOrderCode) inoi on ino.InOrderCode=inoi.InOrderCode
                            left join TbUser ur on ino.InsertUserCode=ur.UserCode
                            left join TbUser ur1 on ino.UserCode=ur1.UserCode
                            left join TbStorage st on ino.StorageCode=st.StorageCode
                            left join TbSysDictionaryData sdd on ino.RebarType=sdd.DictionaryCode
                            left join TbCompany cp1 on ino.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on ino.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbSupplier sp on ino.SupplierCode=sp.SupplierCode
                            left join TbFactoryBatchNeedPlan fbnp on ino.BatchPlanCode=fbnp.BatchPlanNum
							left join TbRawMaterialMonthDemandSupplyPlan rmsp on fbnp.RawMaterialDemandNum=rmsp.SupplyPlanCode
							left join (	select a.InOrderCode,SUM(c.PassCount) as NoJcBhgCount from TbSampleOrder a
							left join TbSampleOrderItem b on a.SampleOrderCode=b.SampleOrderCode
							left join TbInOrderItem c on b.InOrderItemId=c.ID
							where b.ChackState=2 group by a.InOrderCode) sap on ino.InOrderCode=sap.InOrderCode where 1=1 and  ino.BatchPlanCode!='' and ino.BatchPlanCode is not null and (ino.SiteCode in('6372921375874657752') or ino.WorkAreaCode in('6372921396045311451','6372921398380745033')) and ino.ProjectId='6372912251695766465' and st.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:50:51
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:50:51
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:50:51
Text:	select Tb.DataMonth,ISNULL(sum(TbData.InorderCount),0) as InCount,ISNULL(sum(TbData.InCount),0) as InWeight from (select datepart(MONTH,dateadd(mm,-t.number,getdate())) as DataMonth
from
(select number from master..spt_values where type='P') t
where year(dateadd(mm,-t.number,getdate()))=year(getdate())) Tb 
left join (select COUNT(1) as InorderCount,SUM(a.InCount) as InCount,a.RebarType,datepart(year,a.InsertTime) InsertYear,datepart(MONTH,a.InsertTime) InsertMonth from TbInOrder a 
left join TbStorage b on a.StorageCode=b.StorageCode
where a.Examinestatus!='已退回' 
and a.Examinestatus!='已撤销' 
and datepart(year,a.InsertTime)=datepart(year,GETDATE())  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
group by a.RebarType,datepart(year,a.InsertTime),datepart(MONTH,a.InsertTime)) TbData on  Tb.DataMonth=TbData.InsertMonth
group by Tb.DataMonth order by Tb.DataMonth asc 	


-----------------------------------------------------------------------------
2020-07-14 11:50:51
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:50:51
Text:	select TbType.InType,isnull(TbData.InCount,0) as InCount from (select '入库单数' as InType
                           union all
                           select '未取样' as InType
                           union all
                           select '验收不合格' as InType
                           union all
                           select '检测部分合格' as InType
                           union all
                           select '检测不合格' as InType) TbType
                           left join(select '入库单数' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode 
                           where 1=1 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '未取样' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1 and a.SampleOrderState='取样未完成' and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '验收不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and NoPassTotal>0 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测部分合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=3 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=2 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')) TbData on TbType.InType=TbData.InType	


-----------------------------------------------------------------------------
2020-07-14 11:50:51
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:50:51
Text:	select Tb.GhType,sum(Tb.GhWeight) as GhWeight,sum(tb.GhCount) as GhCount from (select TbGhType.GhType,isnull(TbGhInfo.HasSupplier,0) as GhWeight,isnull(TbGhInfo.GhCount,0) as GhCount from (select '供货' as GhType
                            union all
                            select '验收不合格' as GhType
                            union all
                            select '检测不合格' as GhType) TbGhType
                            left join(
                            --供货次数、总量
                            select isnull(sum(Tb.HasSupplier),0) as HasSupplier,isnull(sum(Tb.GhCount),0) as GhCount,'供货' as GhType from (select a.HasSupplier,isnull(b.GhCount,0) as GhCount from (select a.BatchPlanNum,sum(a.HasSupplier) as HasSupplier from TbSupplyListDetail a 
                            left join TbSupplyList s on a.BatchPlanNum=s.BatchPlanNum where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')
                            GROUP BY a.BatchPlanNum) a
                            left join(select Tb.BatchPlanNum,count(1) as GhCount from (select BatchPlanNum,ThisTime from TbSupplyListDetailHistory
                            group by BatchPlanNum,ThisTime) Tb group by Tb.BatchPlanNum) b on a.BatchPlanNum=b.BatchPlanNum) Tb 
                            union all
                            --验收不合格次数、验收不合格重量
                            select sum(TbSum.NoPass) as NoPass,sum(TbSum.YsNoPassCount) as YsNoPassCount,'验收不合格' as GhType from (select count(1) as YsNoPassCount,sum(Tb.NoPass) as NoPass from (select b.BatchPlanCode,c.ThisTime,sum(a.NoPass) as NoPass from TbInOrderItem a
                            left join TbInOrder b on a.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            left join TbSupplyListDetailHistory c on a.BatchPlanItemNewCode=c.BatchPlanItemNewCode
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033') and a.BatchPlanItemNewCode is not null and a.NoPass>0 
                            group by b.BatchPlanCode,c.ThisTime) Tb group by Tb.BatchPlanCode) TbSum
                            union all
                            --检测不合格次数、重量
                            select isnull(sum(Tb.JcNoPass),0) as JcNoPass,count(1) as JcNoPassCount,'检测不合格' as GhType from (select b.BatchPlanCode,d.ThisTime,Isnull(sum(c.PassCount),0) as JcNoPass from TbSampleOrderItem a
                            left join TbSampleOrder e on a.SampleOrderCode=e.SampleOrderCode
                            left join TbInOrderItem c on a.InOrderItemId=c.ID
                            left join TbSupplyListDetailHistory d on c.BatchPlanItemNewCode=d.BatchPlanItemNewCode
                            left join TbInOrder b on c.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')  and a.ChackState=2 and c.BatchPlanItemNewCode is not null
                            group by b.BatchPlanCode,d.ThisTime) Tb group by Tb.BatchPlanCode) TbGhInfo on TbGhType.GhType=TbGhInfo.GhType) Tb group by Tb.GhType	


-----------------------------------------------------------------------------
2020-07-14 11:50:51
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/StockTaking/Index


-----------------------------------------------------------------------------
2020-07-14 11:50:51
Text:	 SELECT count(*) as r_cnt FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode]) WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode134)	
Parameters:
@ProcessFactoryCode134[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:50:51
Text:	 SELECT   TOP 50 [TbStockTaking].[ID],[TbStockTaking].[TakNum],[TbStockTaking].[TakDay],[TbStockTaking].[TotalInventory],[TbStockTaking].[TotalTak],[TbStockTaking].[TotalEarnOrLos],[TbStockTaking].[EarnOrLos],[TbStockTaking].[Remarks],[TbStockTaking].[InsertUserCode],[TbStockTaking].[InsertTime],[TbUser].[UserName],[TbCompany].[CompanyFullName] AS [FactoryName],[TbSysDictionaryData].[DictionaryText] AS [WarehouseTypeName] FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode])  WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode134) ORDER BY [TbStockTaking].[ID] DESC 	
Parameters:
@ProcessFactoryCode134[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:50:51
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:50:51
Text:	select * from TbSysDictionaryData where 1=1 and FDictionaryCode=@name order by DictionaryOrder asc	
Parameters:
@name[String] = MaterialType


-----------------------------------------------------------------------------
2020-07-14 11:50:52
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:50:55
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:50:55
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:50:55
Text:	select 
                           a.RootNumber,
                           a.SizeSelection,
                           a.MaterialCode,
                           a.WeightSmallPlanN,
                           b.MaterialName,
                           b.SpecificationModel,
                           b.MeasurementUnitZl,
                           c.CompanyFullName StartSiteName,
                           d.CompanyFullName EndSiteName
                           from 
                           (
                           select 
                           a.MaterialCode,
                           a.Size as SizeSelection,
                           a.StartSiteCode,
                           a.EndSiteCode,
                           sum(a.Number) RootNumber,
                           sum(a.Weight) WeightSmallPlanN
                           from TbCloutStockPlace a
                           left join TbRMProductionMaterial rmpm on a.CollarCode=rmpm.CollarCode
                           where a.State=1 
                           and (ISNULL(@ProjectId,'')='' OR a.ProjectId=@ProjectId)
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                            and a.EndSiteCode in('6372921375874657752')
                           group by a.MaterialCode,a.Size,a.StartSiteCode,a.EndSiteCode
                           ) a
                           left join TbRawMaterialArchives b on a.MaterialCode=b.MaterialCode
                           left join TbCompany c on c.CompanyCode=a.StartSiteCode
                           left join TbCompany d on d.CompanyCode=a.EndSiteCode
                           where 1=1 
                           and (ISNULL(@MaterialName,'')='' or b.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or b.SpecificationModel like '%'+@SpecificationModel+'%')	
Parameters:
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 
@BegTime[DateTime] = 
@EndTime[DateTime] = 


-----------------------------------------------------------------------------
2020-07-14 11:50:55
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode asc)AS Row, * from (select 
                           a.RootNumber,
                           a.SizeSelection,
                           a.MaterialCode,
                           a.WeightSmallPlanN,
                           b.MaterialName,
                           b.SpecificationModel,
                           b.MeasurementUnitZl,
                           c.CompanyFullName StartSiteName,
                           d.CompanyFullName EndSiteName
                           from 
                           (
                           select 
                           a.MaterialCode,
                           a.Size as SizeSelection,
                           a.StartSiteCode,
                           a.EndSiteCode,
                           sum(a.Number) RootNumber,
                           sum(a.Weight) WeightSmallPlanN
                           from TbCloutStockPlace a
                           left join TbRMProductionMaterial rmpm on a.CollarCode=rmpm.CollarCode
                           where a.State=1 
                           and (ISNULL(@ProjectId,'')='' OR a.ProjectId=@ProjectId)
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                            and a.EndSiteCode in('6372921375874657752')
                           group by a.MaterialCode,a.Size,a.StartSiteCode,a.EndSiteCode
                           ) a
                           left join TbRawMaterialArchives b on a.MaterialCode=b.MaterialCode
                           left join TbCompany c on c.CompanyCode=a.StartSiteCode
                           left join TbCompany d on d.CompanyCode=a.EndSiteCode
                           where 1=1 
                           and (ISNULL(@MaterialName,'')='' or b.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or b.SpecificationModel like '%'+@SpecificationModel+'%')) as a)  SELECT * FROM temptbl where Row between 1 and 50	
Parameters:
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 
@BegTime[DateTime] = 
@EndTime[DateTime] = 


-----------------------------------------------------------------------------
2020-07-14 11:50:59
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)	


-----------------------------------------------------------------------------
2020-07-14 11:50:59
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:51:00
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)	


-----------------------------------------------------------------------------
2020-07-14 11:51:00
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:51:39
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:51:39
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-14 11:51:39
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:51:39
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:51:40
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:51:40
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-14 11:51:40
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:51:40
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:51:40
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:51:40
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-14 11:51:40
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:51:40
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:51:40
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:51:40
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:51:40
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:51:41
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/InOrder/Index


-----------------------------------------------------------------------------
2020-07-14 11:51:41
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:51:41
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:51:41
Text:	select ino.*,case when ISNULL(ino.ChackResult,0)=0 then '' when ISNULL(ino.ChackResult,0)=1 then '合格' when ISNULL(ino.ChackResult,0)=2 then '不合格' when ISNULL(ino.ChackResult,0)=3 then '部分合格' end ChackResultName,ur.UserName,ur1.UserName as DeliverUser,st.StorageName,sdd.DictionaryText as RebarTypeName,sp.SupplierName,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as BranchName,case when rmsp.DemandPlanCode is null then fbnp.RawMaterialDemandNum else rmsp.DemandPlanCode end DemandPlanCode,inoi.IsTh,sap.NoJcBhgCount from TbInOrder ino
							left join(select '退回' as IsTh,InOrderCode from TbInOrderItem where ReturnTime is not null group by InOrderCode) inoi on ino.InOrderCode=inoi.InOrderCode
                            left join TbUser ur on ino.InsertUserCode=ur.UserCode
                            left join TbUser ur1 on ino.UserCode=ur1.UserCode
                            left join TbStorage st on ino.StorageCode=st.StorageCode
                            left join TbSysDictionaryData sdd on ino.RebarType=sdd.DictionaryCode
                            left join TbCompany cp1 on ino.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on ino.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbSupplier sp on ino.SupplierCode=sp.SupplierCode
                            left join TbFactoryBatchNeedPlan fbnp on ino.BatchPlanCode=fbnp.BatchPlanNum
							left join TbRawMaterialMonthDemandSupplyPlan rmsp on fbnp.RawMaterialDemandNum=rmsp.SupplyPlanCode
							left join (	select a.InOrderCode,SUM(c.PassCount) as NoJcBhgCount from TbSampleOrder a
							left join TbSampleOrderItem b on a.SampleOrderCode=b.SampleOrderCode
							left join TbInOrderItem c on b.InOrderItemId=c.ID
							where b.ChackState=2 group by a.InOrderCode) sap on ino.InOrderCode=sap.InOrderCode where 1=1 and  ino.BatchPlanCode!='' and ino.BatchPlanCode is not null and (ino.SiteCode in('6372921375874657752') or ino.WorkAreaCode in('6372921396045311451','6372921398380745033')) and ino.ProjectId='6372912251695766465' and st.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-14 11:51:41
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by InOrderCode desc)AS Row, * from (select ino.*,case when ISNULL(ino.ChackResult,0)=0 then '' when ISNULL(ino.ChackResult,0)=1 then '合格' when ISNULL(ino.ChackResult,0)=2 then '不合格' when ISNULL(ino.ChackResult,0)=3 then '部分合格' end ChackResultName,ur.UserName,ur1.UserName as DeliverUser,st.StorageName,sdd.DictionaryText as RebarTypeName,sp.SupplierName,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as BranchName,case when rmsp.DemandPlanCode is null then fbnp.RawMaterialDemandNum else rmsp.DemandPlanCode end DemandPlanCode,inoi.IsTh,sap.NoJcBhgCount from TbInOrder ino
							left join(select '退回' as IsTh,InOrderCode from TbInOrderItem where ReturnTime is not null group by InOrderCode) inoi on ino.InOrderCode=inoi.InOrderCode
                            left join TbUser ur on ino.InsertUserCode=ur.UserCode
                            left join TbUser ur1 on ino.UserCode=ur1.UserCode
                            left join TbStorage st on ino.StorageCode=st.StorageCode
                            left join TbSysDictionaryData sdd on ino.RebarType=sdd.DictionaryCode
                            left join TbCompany cp1 on ino.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on ino.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbSupplier sp on ino.SupplierCode=sp.SupplierCode
                            left join TbFactoryBatchNeedPlan fbnp on ino.BatchPlanCode=fbnp.BatchPlanNum
							left join TbRawMaterialMonthDemandSupplyPlan rmsp on fbnp.RawMaterialDemandNum=rmsp.SupplyPlanCode
							left join (	select a.InOrderCode,SUM(c.PassCount) as NoJcBhgCount from TbSampleOrder a
							left join TbSampleOrderItem b on a.SampleOrderCode=b.SampleOrderCode
							left join TbInOrderItem c on b.InOrderItemId=c.ID
							where b.ChackState=2 group by a.InOrderCode) sap on ino.InOrderCode=sap.InOrderCode where 1=1 and  ino.BatchPlanCode!='' and ino.BatchPlanCode is not null and (ino.SiteCode in('6372921375874657752') or ino.WorkAreaCode in('6372921396045311451','6372921398380745033')) and ino.ProjectId='6372912251695766465' and st.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:51:41
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:51:41
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:51:41
Text:	select Tb.DataMonth,ISNULL(sum(TbData.InorderCount),0) as InCount,ISNULL(sum(TbData.InCount),0) as InWeight from (select datepart(MONTH,dateadd(mm,-t.number,getdate())) as DataMonth
from
(select number from master..spt_values where type='P') t
where year(dateadd(mm,-t.number,getdate()))=year(getdate())) Tb 
left join (select COUNT(1) as InorderCount,SUM(a.InCount) as InCount,a.RebarType,datepart(year,a.InsertTime) InsertYear,datepart(MONTH,a.InsertTime) InsertMonth from TbInOrder a 
left join TbStorage b on a.StorageCode=b.StorageCode
where a.Examinestatus!='已退回' 
and a.Examinestatus!='已撤销' 
and datepart(year,a.InsertTime)=datepart(year,GETDATE())  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
group by a.RebarType,datepart(year,a.InsertTime),datepart(MONTH,a.InsertTime)) TbData on  Tb.DataMonth=TbData.InsertMonth
group by Tb.DataMonth order by Tb.DataMonth asc 	


-----------------------------------------------------------------------------
2020-07-14 11:51:41
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:51:41
Text:	select TbType.InType,isnull(TbData.InCount,0) as InCount from (select '入库单数' as InType
                           union all
                           select '未取样' as InType
                           union all
                           select '验收不合格' as InType
                           union all
                           select '检测部分合格' as InType
                           union all
                           select '检测不合格' as InType) TbType
                           left join(select '入库单数' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode 
                           where 1=1 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '未取样' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1 and a.SampleOrderState='取样未完成' and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '验收不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and NoPassTotal>0 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测部分合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=3 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=2 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')) TbData on TbType.InType=TbData.InType	


-----------------------------------------------------------------------------
2020-07-14 11:51:41
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:51:41
Text:	select Tb.GhType,sum(Tb.GhWeight) as GhWeight,sum(tb.GhCount) as GhCount from (select TbGhType.GhType,isnull(TbGhInfo.HasSupplier,0) as GhWeight,isnull(TbGhInfo.GhCount,0) as GhCount from (select '供货' as GhType
                            union all
                            select '验收不合格' as GhType
                            union all
                            select '检测不合格' as GhType) TbGhType
                            left join(
                            --供货次数、总量
                            select isnull(sum(Tb.HasSupplier),0) as HasSupplier,isnull(sum(Tb.GhCount),0) as GhCount,'供货' as GhType from (select a.HasSupplier,isnull(b.GhCount,0) as GhCount from (select a.BatchPlanNum,sum(a.HasSupplier) as HasSupplier from TbSupplyListDetail a 
                            left join TbSupplyList s on a.BatchPlanNum=s.BatchPlanNum where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')
                            GROUP BY a.BatchPlanNum) a
                            left join(select Tb.BatchPlanNum,count(1) as GhCount from (select BatchPlanNum,ThisTime from TbSupplyListDetailHistory
                            group by BatchPlanNum,ThisTime) Tb group by Tb.BatchPlanNum) b on a.BatchPlanNum=b.BatchPlanNum) Tb 
                            union all
                            --验收不合格次数、验收不合格重量
                            select sum(TbSum.NoPass) as NoPass,sum(TbSum.YsNoPassCount) as YsNoPassCount,'验收不合格' as GhType from (select count(1) as YsNoPassCount,sum(Tb.NoPass) as NoPass from (select b.BatchPlanCode,c.ThisTime,sum(a.NoPass) as NoPass from TbInOrderItem a
                            left join TbInOrder b on a.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            left join TbSupplyListDetailHistory c on a.BatchPlanItemNewCode=c.BatchPlanItemNewCode
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033') and a.BatchPlanItemNewCode is not null and a.NoPass>0 
                            group by b.BatchPlanCode,c.ThisTime) Tb group by Tb.BatchPlanCode) TbSum
                            union all
                            --检测不合格次数、重量
                            select isnull(sum(Tb.JcNoPass),0) as JcNoPass,count(1) as JcNoPassCount,'检测不合格' as GhType from (select b.BatchPlanCode,d.ThisTime,Isnull(sum(c.PassCount),0) as JcNoPass from TbSampleOrderItem a
                            left join TbSampleOrder e on a.SampleOrderCode=e.SampleOrderCode
                            left join TbInOrderItem c on a.InOrderItemId=c.ID
                            left join TbSupplyListDetailHistory d on c.BatchPlanItemNewCode=d.BatchPlanItemNewCode
                            left join TbInOrder b on c.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')  and a.ChackState=2 and c.BatchPlanItemNewCode is not null
                            group by b.BatchPlanCode,d.ThisTime) Tb group by Tb.BatchPlanCode) TbGhInfo on TbGhType.GhType=TbGhInfo.GhType) Tb group by Tb.GhType	


-----------------------------------------------------------------------------
2020-07-14 11:51:41
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/StockTaking/Index


-----------------------------------------------------------------------------
2020-07-14 11:51:41
Text:	 SELECT count(*) as r_cnt FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode]) WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode135)	
Parameters:
@ProcessFactoryCode135[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:51:41
Text:	 SELECT   TOP 50 [TbStockTaking].[ID],[TbStockTaking].[TakNum],[TbStockTaking].[TakDay],[TbStockTaking].[TotalInventory],[TbStockTaking].[TotalTak],[TbStockTaking].[TotalEarnOrLos],[TbStockTaking].[EarnOrLos],[TbStockTaking].[Remarks],[TbStockTaking].[InsertUserCode],[TbStockTaking].[InsertTime],[TbUser].[UserName],[TbCompany].[CompanyFullName] AS [FactoryName],[TbSysDictionaryData].[DictionaryText] AS [WarehouseTypeName] FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode])  WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode135) ORDER BY [TbStockTaking].[ID] DESC 	
Parameters:
@ProcessFactoryCode135[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:51:41
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:51:42
Text:	select * from TbSysDictionaryData where 1=1 and FDictionaryCode=@name order by DictionaryOrder asc	
Parameters:
@name[String] = MaterialType


-----------------------------------------------------------------------------
2020-07-14 11:51:46
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:51:46
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:51:46
Text:	select 
                           a.RootNumber,
                           a.SizeSelection,
                           a.MaterialCode,
                           a.WeightSmallPlanN,
                           b.MaterialName,
                           b.SpecificationModel,
                           b.MeasurementUnitZl,
                           c.CompanyFullName StartSiteName,
                           d.CompanyFullName EndSiteName
                           from 
                           (
                           select 
                           a.MaterialCode,
                           a.Size as SizeSelection,
                           a.StartSiteCode,
                           a.EndSiteCode,
                           sum(a.Number) RootNumber,
                           sum(a.Weight) WeightSmallPlanN
                           from TbCloutStockPlace a
                           left join TbRMProductionMaterial rmpm on a.CollarCode=rmpm.CollarCode
                           where a.State=1 
                           and (ISNULL(@ProjectId,'')='' OR a.ProjectId=@ProjectId)
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                            and a.EndSiteCode in('6372921375874657752')
                           group by a.MaterialCode,a.Size,a.StartSiteCode,a.EndSiteCode
                           ) a
                           left join TbRawMaterialArchives b on a.MaterialCode=b.MaterialCode
                           left join TbCompany c on c.CompanyCode=a.StartSiteCode
                           left join TbCompany d on d.CompanyCode=a.EndSiteCode
                           where 1=1 
                           and (ISNULL(@MaterialName,'')='' or b.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or b.SpecificationModel like '%'+@SpecificationModel+'%')	
Parameters:
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 
@BegTime[DateTime] = 
@EndTime[DateTime] = 


-----------------------------------------------------------------------------
2020-07-14 11:51:46
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode asc)AS Row, * from (select 
                           a.RootNumber,
                           a.SizeSelection,
                           a.MaterialCode,
                           a.WeightSmallPlanN,
                           b.MaterialName,
                           b.SpecificationModel,
                           b.MeasurementUnitZl,
                           c.CompanyFullName StartSiteName,
                           d.CompanyFullName EndSiteName
                           from 
                           (
                           select 
                           a.MaterialCode,
                           a.Size as SizeSelection,
                           a.StartSiteCode,
                           a.EndSiteCode,
                           sum(a.Number) RootNumber,
                           sum(a.Weight) WeightSmallPlanN
                           from TbCloutStockPlace a
                           left join TbRMProductionMaterial rmpm on a.CollarCode=rmpm.CollarCode
                           where a.State=1 
                           and (ISNULL(@ProjectId,'')='' OR a.ProjectId=@ProjectId)
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                            and a.EndSiteCode in('6372921375874657752')
                           group by a.MaterialCode,a.Size,a.StartSiteCode,a.EndSiteCode
                           ) a
                           left join TbRawMaterialArchives b on a.MaterialCode=b.MaterialCode
                           left join TbCompany c on c.CompanyCode=a.StartSiteCode
                           left join TbCompany d on d.CompanyCode=a.EndSiteCode
                           where 1=1 
                           and (ISNULL(@MaterialName,'')='' or b.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or b.SpecificationModel like '%'+@SpecificationModel+'%')) as a)  SELECT * FROM temptbl where Row between 1 and 50	
Parameters:
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 
@BegTime[DateTime] = 
@EndTime[DateTime] = 


-----------------------------------------------------------------------------
2020-07-14 11:52:22
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:52:22
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-14 11:52:22
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:52:22
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:52:23
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:52:23
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-14 11:52:23
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:52:23
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:52:23
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:52:23
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:52:23
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/InOrder/Index


-----------------------------------------------------------------------------
2020-07-14 11:52:23
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:52:23
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:52:23
Text:	select ino.*,case when ISNULL(ino.ChackResult,0)=0 then '' when ISNULL(ino.ChackResult,0)=1 then '合格' when ISNULL(ino.ChackResult,0)=2 then '不合格' when ISNULL(ino.ChackResult,0)=3 then '部分合格' end ChackResultName,ur.UserName,ur1.UserName as DeliverUser,st.StorageName,sdd.DictionaryText as RebarTypeName,sp.SupplierName,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as BranchName,case when rmsp.DemandPlanCode is null then fbnp.RawMaterialDemandNum else rmsp.DemandPlanCode end DemandPlanCode,inoi.IsTh,sap.NoJcBhgCount from TbInOrder ino
							left join(select '退回' as IsTh,InOrderCode from TbInOrderItem where ReturnTime is not null group by InOrderCode) inoi on ino.InOrderCode=inoi.InOrderCode
                            left join TbUser ur on ino.InsertUserCode=ur.UserCode
                            left join TbUser ur1 on ino.UserCode=ur1.UserCode
                            left join TbStorage st on ino.StorageCode=st.StorageCode
                            left join TbSysDictionaryData sdd on ino.RebarType=sdd.DictionaryCode
                            left join TbCompany cp1 on ino.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on ino.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbSupplier sp on ino.SupplierCode=sp.SupplierCode
                            left join TbFactoryBatchNeedPlan fbnp on ino.BatchPlanCode=fbnp.BatchPlanNum
							left join TbRawMaterialMonthDemandSupplyPlan rmsp on fbnp.RawMaterialDemandNum=rmsp.SupplyPlanCode
							left join (	select a.InOrderCode,SUM(c.PassCount) as NoJcBhgCount from TbSampleOrder a
							left join TbSampleOrderItem b on a.SampleOrderCode=b.SampleOrderCode
							left join TbInOrderItem c on b.InOrderItemId=c.ID
							where b.ChackState=2 group by a.InOrderCode) sap on ino.InOrderCode=sap.InOrderCode where 1=1 and  ino.BatchPlanCode!='' and ino.BatchPlanCode is not null and (ino.SiteCode in('6372921375874657752') or ino.WorkAreaCode in('6372921396045311451','6372921398380745033')) and ino.ProjectId='6372912251695766465' and st.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-14 11:52:23
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by InOrderCode desc)AS Row, * from (select ino.*,case when ISNULL(ino.ChackResult,0)=0 then '' when ISNULL(ino.ChackResult,0)=1 then '合格' when ISNULL(ino.ChackResult,0)=2 then '不合格' when ISNULL(ino.ChackResult,0)=3 then '部分合格' end ChackResultName,ur.UserName,ur1.UserName as DeliverUser,st.StorageName,sdd.DictionaryText as RebarTypeName,sp.SupplierName,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as BranchName,case when rmsp.DemandPlanCode is null then fbnp.RawMaterialDemandNum else rmsp.DemandPlanCode end DemandPlanCode,inoi.IsTh,sap.NoJcBhgCount from TbInOrder ino
							left join(select '退回' as IsTh,InOrderCode from TbInOrderItem where ReturnTime is not null group by InOrderCode) inoi on ino.InOrderCode=inoi.InOrderCode
                            left join TbUser ur on ino.InsertUserCode=ur.UserCode
                            left join TbUser ur1 on ino.UserCode=ur1.UserCode
                            left join TbStorage st on ino.StorageCode=st.StorageCode
                            left join TbSysDictionaryData sdd on ino.RebarType=sdd.DictionaryCode
                            left join TbCompany cp1 on ino.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on ino.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbSupplier sp on ino.SupplierCode=sp.SupplierCode
                            left join TbFactoryBatchNeedPlan fbnp on ino.BatchPlanCode=fbnp.BatchPlanNum
							left join TbRawMaterialMonthDemandSupplyPlan rmsp on fbnp.RawMaterialDemandNum=rmsp.SupplyPlanCode
							left join (	select a.InOrderCode,SUM(c.PassCount) as NoJcBhgCount from TbSampleOrder a
							left join TbSampleOrderItem b on a.SampleOrderCode=b.SampleOrderCode
							left join TbInOrderItem c on b.InOrderItemId=c.ID
							where b.ChackState=2 group by a.InOrderCode) sap on ino.InOrderCode=sap.InOrderCode where 1=1 and  ino.BatchPlanCode!='' and ino.BatchPlanCode is not null and (ino.SiteCode in('6372921375874657752') or ino.WorkAreaCode in('6372921396045311451','6372921398380745033')) and ino.ProjectId='6372912251695766465' and st.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:52:23
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:52:23
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:52:23
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-14 11:52:23
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:52:24
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:52:24
Text:	select Tb.DataMonth,ISNULL(sum(TbData.InorderCount),0) as InCount,ISNULL(sum(TbData.InCount),0) as InWeight from (select datepart(MONTH,dateadd(mm,-t.number,getdate())) as DataMonth
from
(select number from master..spt_values where type='P') t
where year(dateadd(mm,-t.number,getdate()))=year(getdate())) Tb 
left join (select COUNT(1) as InorderCount,SUM(a.InCount) as InCount,a.RebarType,datepart(year,a.InsertTime) InsertYear,datepart(MONTH,a.InsertTime) InsertMonth from TbInOrder a 
left join TbStorage b on a.StorageCode=b.StorageCode
where a.Examinestatus!='已退回' 
and a.Examinestatus!='已撤销' 
and datepart(year,a.InsertTime)=datepart(year,GETDATE())  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
group by a.RebarType,datepart(year,a.InsertTime),datepart(MONTH,a.InsertTime)) TbData on  Tb.DataMonth=TbData.InsertMonth
group by Tb.DataMonth order by Tb.DataMonth asc 	


-----------------------------------------------------------------------------
2020-07-14 11:52:24
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:52:24
Text:	select TbType.InType,isnull(TbData.InCount,0) as InCount from (select '入库单数' as InType
                           union all
                           select '未取样' as InType
                           union all
                           select '验收不合格' as InType
                           union all
                           select '检测部分合格' as InType
                           union all
                           select '检测不合格' as InType) TbType
                           left join(select '入库单数' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode 
                           where 1=1 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '未取样' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1 and a.SampleOrderState='取样未完成' and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '验收不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and NoPassTotal>0 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测部分合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=3 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=2 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')) TbData on TbType.InType=TbData.InType	


-----------------------------------------------------------------------------
2020-07-14 11:52:24
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:52:24
Text:	select Tb.GhType,sum(Tb.GhWeight) as GhWeight,sum(tb.GhCount) as GhCount from (select TbGhType.GhType,isnull(TbGhInfo.HasSupplier,0) as GhWeight,isnull(TbGhInfo.GhCount,0) as GhCount from (select '供货' as GhType
                            union all
                            select '验收不合格' as GhType
                            union all
                            select '检测不合格' as GhType) TbGhType
                            left join(
                            --供货次数、总量
                            select isnull(sum(Tb.HasSupplier),0) as HasSupplier,isnull(sum(Tb.GhCount),0) as GhCount,'供货' as GhType from (select a.HasSupplier,isnull(b.GhCount,0) as GhCount from (select a.BatchPlanNum,sum(a.HasSupplier) as HasSupplier from TbSupplyListDetail a 
                            left join TbSupplyList s on a.BatchPlanNum=s.BatchPlanNum where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')
                            GROUP BY a.BatchPlanNum) a
                            left join(select Tb.BatchPlanNum,count(1) as GhCount from (select BatchPlanNum,ThisTime from TbSupplyListDetailHistory
                            group by BatchPlanNum,ThisTime) Tb group by Tb.BatchPlanNum) b on a.BatchPlanNum=b.BatchPlanNum) Tb 
                            union all
                            --验收不合格次数、验收不合格重量
                            select sum(TbSum.NoPass) as NoPass,sum(TbSum.YsNoPassCount) as YsNoPassCount,'验收不合格' as GhType from (select count(1) as YsNoPassCount,sum(Tb.NoPass) as NoPass from (select b.BatchPlanCode,c.ThisTime,sum(a.NoPass) as NoPass from TbInOrderItem a
                            left join TbInOrder b on a.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            left join TbSupplyListDetailHistory c on a.BatchPlanItemNewCode=c.BatchPlanItemNewCode
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033') and a.BatchPlanItemNewCode is not null and a.NoPass>0 
                            group by b.BatchPlanCode,c.ThisTime) Tb group by Tb.BatchPlanCode) TbSum
                            union all
                            --检测不合格次数、重量
                            select isnull(sum(Tb.JcNoPass),0) as JcNoPass,count(1) as JcNoPassCount,'检测不合格' as GhType from (select b.BatchPlanCode,d.ThisTime,Isnull(sum(c.PassCount),0) as JcNoPass from TbSampleOrderItem a
                            left join TbSampleOrder e on a.SampleOrderCode=e.SampleOrderCode
                            left join TbInOrderItem c on a.InOrderItemId=c.ID
                            left join TbSupplyListDetailHistory d on c.BatchPlanItemNewCode=d.BatchPlanItemNewCode
                            left join TbInOrder b on c.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')  and a.ChackState=2 and c.BatchPlanItemNewCode is not null
                            group by b.BatchPlanCode,d.ThisTime) Tb group by Tb.BatchPlanCode) TbGhInfo on TbGhType.GhType=TbGhInfo.GhType) Tb group by Tb.GhType	


-----------------------------------------------------------------------------
2020-07-14 11:52:24
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/StockTaking/Index


-----------------------------------------------------------------------------
2020-07-14 11:52:24
Text:	 SELECT count(*) as r_cnt FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode]) WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode136)	
Parameters:
@ProcessFactoryCode136[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:52:24
Text:	 SELECT   TOP 50 [TbStockTaking].[ID],[TbStockTaking].[TakNum],[TbStockTaking].[TakDay],[TbStockTaking].[TotalInventory],[TbStockTaking].[TotalTak],[TbStockTaking].[TotalEarnOrLos],[TbStockTaking].[EarnOrLos],[TbStockTaking].[Remarks],[TbStockTaking].[InsertUserCode],[TbStockTaking].[InsertTime],[TbUser].[UserName],[TbCompany].[CompanyFullName] AS [FactoryName],[TbSysDictionaryData].[DictionaryText] AS [WarehouseTypeName] FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode])  WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode136) ORDER BY [TbStockTaking].[ID] DESC 	
Parameters:
@ProcessFactoryCode136[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:52:24
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:52:24
Text:	select * from TbSysDictionaryData where 1=1 and FDictionaryCode=@name order by DictionaryOrder asc	
Parameters:
@name[String] = MaterialType


-----------------------------------------------------------------------------
2020-07-14 11:52:24
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:52:25
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:52:39
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:52:39
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-14 11:52:39
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:52:39
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:52:39
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:52:39
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-14 11:52:39
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:52:39
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:52:39
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:52:39
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-14 11:52:39
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:52:40
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:52:40
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:52:40
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:52:40
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:52:40
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/InOrder/Index


-----------------------------------------------------------------------------
2020-07-14 11:52:40
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:52:40
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:52:40
Text:	select ino.*,case when ISNULL(ino.ChackResult,0)=0 then '' when ISNULL(ino.ChackResult,0)=1 then '合格' when ISNULL(ino.ChackResult,0)=2 then '不合格' when ISNULL(ino.ChackResult,0)=3 then '部分合格' end ChackResultName,ur.UserName,ur1.UserName as DeliverUser,st.StorageName,sdd.DictionaryText as RebarTypeName,sp.SupplierName,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as BranchName,case when rmsp.DemandPlanCode is null then fbnp.RawMaterialDemandNum else rmsp.DemandPlanCode end DemandPlanCode,inoi.IsTh,sap.NoJcBhgCount from TbInOrder ino
							left join(select '退回' as IsTh,InOrderCode from TbInOrderItem where ReturnTime is not null group by InOrderCode) inoi on ino.InOrderCode=inoi.InOrderCode
                            left join TbUser ur on ino.InsertUserCode=ur.UserCode
                            left join TbUser ur1 on ino.UserCode=ur1.UserCode
                            left join TbStorage st on ino.StorageCode=st.StorageCode
                            left join TbSysDictionaryData sdd on ino.RebarType=sdd.DictionaryCode
                            left join TbCompany cp1 on ino.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on ino.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbSupplier sp on ino.SupplierCode=sp.SupplierCode
                            left join TbFactoryBatchNeedPlan fbnp on ino.BatchPlanCode=fbnp.BatchPlanNum
							left join TbRawMaterialMonthDemandSupplyPlan rmsp on fbnp.RawMaterialDemandNum=rmsp.SupplyPlanCode
							left join (	select a.InOrderCode,SUM(c.PassCount) as NoJcBhgCount from TbSampleOrder a
							left join TbSampleOrderItem b on a.SampleOrderCode=b.SampleOrderCode
							left join TbInOrderItem c on b.InOrderItemId=c.ID
							where b.ChackState=2 group by a.InOrderCode) sap on ino.InOrderCode=sap.InOrderCode where 1=1 and  ino.BatchPlanCode!='' and ino.BatchPlanCode is not null and (ino.SiteCode in('6372921375874657752') or ino.WorkAreaCode in('6372921396045311451','6372921398380745033')) and ino.ProjectId='6372912251695766465' and st.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-14 11:52:40
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by InOrderCode desc)AS Row, * from (select ino.*,case when ISNULL(ino.ChackResult,0)=0 then '' when ISNULL(ino.ChackResult,0)=1 then '合格' when ISNULL(ino.ChackResult,0)=2 then '不合格' when ISNULL(ino.ChackResult,0)=3 then '部分合格' end ChackResultName,ur.UserName,ur1.UserName as DeliverUser,st.StorageName,sdd.DictionaryText as RebarTypeName,sp.SupplierName,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as BranchName,case when rmsp.DemandPlanCode is null then fbnp.RawMaterialDemandNum else rmsp.DemandPlanCode end DemandPlanCode,inoi.IsTh,sap.NoJcBhgCount from TbInOrder ino
							left join(select '退回' as IsTh,InOrderCode from TbInOrderItem where ReturnTime is not null group by InOrderCode) inoi on ino.InOrderCode=inoi.InOrderCode
                            left join TbUser ur on ino.InsertUserCode=ur.UserCode
                            left join TbUser ur1 on ino.UserCode=ur1.UserCode
                            left join TbStorage st on ino.StorageCode=st.StorageCode
                            left join TbSysDictionaryData sdd on ino.RebarType=sdd.DictionaryCode
                            left join TbCompany cp1 on ino.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on ino.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbSupplier sp on ino.SupplierCode=sp.SupplierCode
                            left join TbFactoryBatchNeedPlan fbnp on ino.BatchPlanCode=fbnp.BatchPlanNum
							left join TbRawMaterialMonthDemandSupplyPlan rmsp on fbnp.RawMaterialDemandNum=rmsp.SupplyPlanCode
							left join (	select a.InOrderCode,SUM(c.PassCount) as NoJcBhgCount from TbSampleOrder a
							left join TbSampleOrderItem b on a.SampleOrderCode=b.SampleOrderCode
							left join TbInOrderItem c on b.InOrderItemId=c.ID
							where b.ChackState=2 group by a.InOrderCode) sap on ino.InOrderCode=sap.InOrderCode where 1=1 and  ino.BatchPlanCode!='' and ino.BatchPlanCode is not null and (ino.SiteCode in('6372921375874657752') or ino.WorkAreaCode in('6372921396045311451','6372921398380745033')) and ino.ProjectId='6372912251695766465' and st.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:52:40
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:52:40
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:52:40
Text:	select Tb.DataMonth,ISNULL(sum(TbData.InorderCount),0) as InCount,ISNULL(sum(TbData.InCount),0) as InWeight from (select datepart(MONTH,dateadd(mm,-t.number,getdate())) as DataMonth
from
(select number from master..spt_values where type='P') t
where year(dateadd(mm,-t.number,getdate()))=year(getdate())) Tb 
left join (select COUNT(1) as InorderCount,SUM(a.InCount) as InCount,a.RebarType,datepart(year,a.InsertTime) InsertYear,datepart(MONTH,a.InsertTime) InsertMonth from TbInOrder a 
left join TbStorage b on a.StorageCode=b.StorageCode
where a.Examinestatus!='已退回' 
and a.Examinestatus!='已撤销' 
and datepart(year,a.InsertTime)=datepart(year,GETDATE())  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
group by a.RebarType,datepart(year,a.InsertTime),datepart(MONTH,a.InsertTime)) TbData on  Tb.DataMonth=TbData.InsertMonth
group by Tb.DataMonth order by Tb.DataMonth asc 	


-----------------------------------------------------------------------------
2020-07-14 11:52:41
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:52:41
Text:	select TbType.InType,isnull(TbData.InCount,0) as InCount from (select '入库单数' as InType
                           union all
                           select '未取样' as InType
                           union all
                           select '验收不合格' as InType
                           union all
                           select '检测部分合格' as InType
                           union all
                           select '检测不合格' as InType) TbType
                           left join(select '入库单数' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode 
                           where 1=1 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '未取样' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1 and a.SampleOrderState='取样未完成' and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '验收不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and NoPassTotal>0 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测部分合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=3 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=2 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')) TbData on TbType.InType=TbData.InType	


-----------------------------------------------------------------------------
2020-07-14 11:52:41
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:52:41
Text:	select Tb.GhType,sum(Tb.GhWeight) as GhWeight,sum(tb.GhCount) as GhCount from (select TbGhType.GhType,isnull(TbGhInfo.HasSupplier,0) as GhWeight,isnull(TbGhInfo.GhCount,0) as GhCount from (select '供货' as GhType
                            union all
                            select '验收不合格' as GhType
                            union all
                            select '检测不合格' as GhType) TbGhType
                            left join(
                            --供货次数、总量
                            select isnull(sum(Tb.HasSupplier),0) as HasSupplier,isnull(sum(Tb.GhCount),0) as GhCount,'供货' as GhType from (select a.HasSupplier,isnull(b.GhCount,0) as GhCount from (select a.BatchPlanNum,sum(a.HasSupplier) as HasSupplier from TbSupplyListDetail a 
                            left join TbSupplyList s on a.BatchPlanNum=s.BatchPlanNum where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')
                            GROUP BY a.BatchPlanNum) a
                            left join(select Tb.BatchPlanNum,count(1) as GhCount from (select BatchPlanNum,ThisTime from TbSupplyListDetailHistory
                            group by BatchPlanNum,ThisTime) Tb group by Tb.BatchPlanNum) b on a.BatchPlanNum=b.BatchPlanNum) Tb 
                            union all
                            --验收不合格次数、验收不合格重量
                            select sum(TbSum.NoPass) as NoPass,sum(TbSum.YsNoPassCount) as YsNoPassCount,'验收不合格' as GhType from (select count(1) as YsNoPassCount,sum(Tb.NoPass) as NoPass from (select b.BatchPlanCode,c.ThisTime,sum(a.NoPass) as NoPass from TbInOrderItem a
                            left join TbInOrder b on a.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            left join TbSupplyListDetailHistory c on a.BatchPlanItemNewCode=c.BatchPlanItemNewCode
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033') and a.BatchPlanItemNewCode is not null and a.NoPass>0 
                            group by b.BatchPlanCode,c.ThisTime) Tb group by Tb.BatchPlanCode) TbSum
                            union all
                            --检测不合格次数、重量
                            select isnull(sum(Tb.JcNoPass),0) as JcNoPass,count(1) as JcNoPassCount,'检测不合格' as GhType from (select b.BatchPlanCode,d.ThisTime,Isnull(sum(c.PassCount),0) as JcNoPass from TbSampleOrderItem a
                            left join TbSampleOrder e on a.SampleOrderCode=e.SampleOrderCode
                            left join TbInOrderItem c on a.InOrderItemId=c.ID
                            left join TbSupplyListDetailHistory d on c.BatchPlanItemNewCode=d.BatchPlanItemNewCode
                            left join TbInOrder b on c.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')  and a.ChackState=2 and c.BatchPlanItemNewCode is not null
                            group by b.BatchPlanCode,d.ThisTime) Tb group by Tb.BatchPlanCode) TbGhInfo on TbGhType.GhType=TbGhInfo.GhType) Tb group by Tb.GhType	


-----------------------------------------------------------------------------
2020-07-14 11:52:41
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/StockTaking/Index


-----------------------------------------------------------------------------
2020-07-14 11:52:41
Text:	 SELECT count(*) as r_cnt FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode]) WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode137)	
Parameters:
@ProcessFactoryCode137[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:52:41
Text:	 SELECT   TOP 50 [TbStockTaking].[ID],[TbStockTaking].[TakNum],[TbStockTaking].[TakDay],[TbStockTaking].[TotalInventory],[TbStockTaking].[TotalTak],[TbStockTaking].[TotalEarnOrLos],[TbStockTaking].[EarnOrLos],[TbStockTaking].[Remarks],[TbStockTaking].[InsertUserCode],[TbStockTaking].[InsertTime],[TbUser].[UserName],[TbCompany].[CompanyFullName] AS [FactoryName],[TbSysDictionaryData].[DictionaryText] AS [WarehouseTypeName] FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode])  WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode137) ORDER BY [TbStockTaking].[ID] DESC 	
Parameters:
@ProcessFactoryCode137[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:52:41
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:52:41
Text:	select * from TbSysDictionaryData where 1=1 and FDictionaryCode=@name order by DictionaryOrder asc	
Parameters:
@name[String] = MaterialType


-----------------------------------------------------------------------------
2020-07-14 11:52:53
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:52:53
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-14 11:52:53
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:52:53
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:52:54
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:52:54
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-14 11:52:54
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:52:54
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:52:54
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:52:54
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:52:54
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/InOrder/Index


-----------------------------------------------------------------------------
2020-07-14 11:52:54
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:52:54
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:52:54
Text:	select ino.*,case when ISNULL(ino.ChackResult,0)=0 then '' when ISNULL(ino.ChackResult,0)=1 then '合格' when ISNULL(ino.ChackResult,0)=2 then '不合格' when ISNULL(ino.ChackResult,0)=3 then '部分合格' end ChackResultName,ur.UserName,ur1.UserName as DeliverUser,st.StorageName,sdd.DictionaryText as RebarTypeName,sp.SupplierName,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as BranchName,case when rmsp.DemandPlanCode is null then fbnp.RawMaterialDemandNum else rmsp.DemandPlanCode end DemandPlanCode,inoi.IsTh,sap.NoJcBhgCount from TbInOrder ino
							left join(select '退回' as IsTh,InOrderCode from TbInOrderItem where ReturnTime is not null group by InOrderCode) inoi on ino.InOrderCode=inoi.InOrderCode
                            left join TbUser ur on ino.InsertUserCode=ur.UserCode
                            left join TbUser ur1 on ino.UserCode=ur1.UserCode
                            left join TbStorage st on ino.StorageCode=st.StorageCode
                            left join TbSysDictionaryData sdd on ino.RebarType=sdd.DictionaryCode
                            left join TbCompany cp1 on ino.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on ino.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbSupplier sp on ino.SupplierCode=sp.SupplierCode
                            left join TbFactoryBatchNeedPlan fbnp on ino.BatchPlanCode=fbnp.BatchPlanNum
							left join TbRawMaterialMonthDemandSupplyPlan rmsp on fbnp.RawMaterialDemandNum=rmsp.SupplyPlanCode
							left join (	select a.InOrderCode,SUM(c.PassCount) as NoJcBhgCount from TbSampleOrder a
							left join TbSampleOrderItem b on a.SampleOrderCode=b.SampleOrderCode
							left join TbInOrderItem c on b.InOrderItemId=c.ID
							where b.ChackState=2 group by a.InOrderCode) sap on ino.InOrderCode=sap.InOrderCode where 1=1 and  ino.BatchPlanCode!='' and ino.BatchPlanCode is not null and (ino.SiteCode in('6372921375874657752') or ino.WorkAreaCode in('6372921396045311451','6372921398380745033')) and ino.ProjectId='6372912251695766465' and st.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-14 11:52:54
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by InOrderCode desc)AS Row, * from (select ino.*,case when ISNULL(ino.ChackResult,0)=0 then '' when ISNULL(ino.ChackResult,0)=1 then '合格' when ISNULL(ino.ChackResult,0)=2 then '不合格' when ISNULL(ino.ChackResult,0)=3 then '部分合格' end ChackResultName,ur.UserName,ur1.UserName as DeliverUser,st.StorageName,sdd.DictionaryText as RebarTypeName,sp.SupplierName,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as BranchName,case when rmsp.DemandPlanCode is null then fbnp.RawMaterialDemandNum else rmsp.DemandPlanCode end DemandPlanCode,inoi.IsTh,sap.NoJcBhgCount from TbInOrder ino
							left join(select '退回' as IsTh,InOrderCode from TbInOrderItem where ReturnTime is not null group by InOrderCode) inoi on ino.InOrderCode=inoi.InOrderCode
                            left join TbUser ur on ino.InsertUserCode=ur.UserCode
                            left join TbUser ur1 on ino.UserCode=ur1.UserCode
                            left join TbStorage st on ino.StorageCode=st.StorageCode
                            left join TbSysDictionaryData sdd on ino.RebarType=sdd.DictionaryCode
                            left join TbCompany cp1 on ino.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on ino.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbSupplier sp on ino.SupplierCode=sp.SupplierCode
                            left join TbFactoryBatchNeedPlan fbnp on ino.BatchPlanCode=fbnp.BatchPlanNum
							left join TbRawMaterialMonthDemandSupplyPlan rmsp on fbnp.RawMaterialDemandNum=rmsp.SupplyPlanCode
							left join (	select a.InOrderCode,SUM(c.PassCount) as NoJcBhgCount from TbSampleOrder a
							left join TbSampleOrderItem b on a.SampleOrderCode=b.SampleOrderCode
							left join TbInOrderItem c on b.InOrderItemId=c.ID
							where b.ChackState=2 group by a.InOrderCode) sap on ino.InOrderCode=sap.InOrderCode where 1=1 and  ino.BatchPlanCode!='' and ino.BatchPlanCode is not null and (ino.SiteCode in('6372921375874657752') or ino.WorkAreaCode in('6372921396045311451','6372921398380745033')) and ino.ProjectId='6372912251695766465' and st.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:52:55
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:52:55
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:52:55
Text:	select Tb.DataMonth,ISNULL(sum(TbData.InorderCount),0) as InCount,ISNULL(sum(TbData.InCount),0) as InWeight from (select datepart(MONTH,dateadd(mm,-t.number,getdate())) as DataMonth
from
(select number from master..spt_values where type='P') t
where year(dateadd(mm,-t.number,getdate()))=year(getdate())) Tb 
left join (select COUNT(1) as InorderCount,SUM(a.InCount) as InCount,a.RebarType,datepart(year,a.InsertTime) InsertYear,datepart(MONTH,a.InsertTime) InsertMonth from TbInOrder a 
left join TbStorage b on a.StorageCode=b.StorageCode
where a.Examinestatus!='已退回' 
and a.Examinestatus!='已撤销' 
and datepart(year,a.InsertTime)=datepart(year,GETDATE())  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
group by a.RebarType,datepart(year,a.InsertTime),datepart(MONTH,a.InsertTime)) TbData on  Tb.DataMonth=TbData.InsertMonth
group by Tb.DataMonth order by Tb.DataMonth asc 	


-----------------------------------------------------------------------------
2020-07-14 11:52:55
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:52:55
Text:	select TbType.InType,isnull(TbData.InCount,0) as InCount from (select '入库单数' as InType
                           union all
                           select '未取样' as InType
                           union all
                           select '验收不合格' as InType
                           union all
                           select '检测部分合格' as InType
                           union all
                           select '检测不合格' as InType) TbType
                           left join(select '入库单数' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode 
                           where 1=1 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '未取样' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1 and a.SampleOrderState='取样未完成' and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '验收不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and NoPassTotal>0 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测部分合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=3 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=2 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')) TbData on TbType.InType=TbData.InType	


-----------------------------------------------------------------------------
2020-07-14 11:52:55
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:52:55
Text:	select Tb.GhType,sum(Tb.GhWeight) as GhWeight,sum(tb.GhCount) as GhCount from (select TbGhType.GhType,isnull(TbGhInfo.HasSupplier,0) as GhWeight,isnull(TbGhInfo.GhCount,0) as GhCount from (select '供货' as GhType
                            union all
                            select '验收不合格' as GhType
                            union all
                            select '检测不合格' as GhType) TbGhType
                            left join(
                            --供货次数、总量
                            select isnull(sum(Tb.HasSupplier),0) as HasSupplier,isnull(sum(Tb.GhCount),0) as GhCount,'供货' as GhType from (select a.HasSupplier,isnull(b.GhCount,0) as GhCount from (select a.BatchPlanNum,sum(a.HasSupplier) as HasSupplier from TbSupplyListDetail a 
                            left join TbSupplyList s on a.BatchPlanNum=s.BatchPlanNum where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')
                            GROUP BY a.BatchPlanNum) a
                            left join(select Tb.BatchPlanNum,count(1) as GhCount from (select BatchPlanNum,ThisTime from TbSupplyListDetailHistory
                            group by BatchPlanNum,ThisTime) Tb group by Tb.BatchPlanNum) b on a.BatchPlanNum=b.BatchPlanNum) Tb 
                            union all
                            --验收不合格次数、验收不合格重量
                            select sum(TbSum.NoPass) as NoPass,sum(TbSum.YsNoPassCount) as YsNoPassCount,'验收不合格' as GhType from (select count(1) as YsNoPassCount,sum(Tb.NoPass) as NoPass from (select b.BatchPlanCode,c.ThisTime,sum(a.NoPass) as NoPass from TbInOrderItem a
                            left join TbInOrder b on a.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            left join TbSupplyListDetailHistory c on a.BatchPlanItemNewCode=c.BatchPlanItemNewCode
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033') and a.BatchPlanItemNewCode is not null and a.NoPass>0 
                            group by b.BatchPlanCode,c.ThisTime) Tb group by Tb.BatchPlanCode) TbSum
                            union all
                            --检测不合格次数、重量
                            select isnull(sum(Tb.JcNoPass),0) as JcNoPass,count(1) as JcNoPassCount,'检测不合格' as GhType from (select b.BatchPlanCode,d.ThisTime,Isnull(sum(c.PassCount),0) as JcNoPass from TbSampleOrderItem a
                            left join TbSampleOrder e on a.SampleOrderCode=e.SampleOrderCode
                            left join TbInOrderItem c on a.InOrderItemId=c.ID
                            left join TbSupplyListDetailHistory d on c.BatchPlanItemNewCode=d.BatchPlanItemNewCode
                            left join TbInOrder b on c.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')  and a.ChackState=2 and c.BatchPlanItemNewCode is not null
                            group by b.BatchPlanCode,d.ThisTime) Tb group by Tb.BatchPlanCode) TbGhInfo on TbGhType.GhType=TbGhInfo.GhType) Tb group by Tb.GhType	


-----------------------------------------------------------------------------
2020-07-14 11:52:55
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/StockTaking/Index


-----------------------------------------------------------------------------
2020-07-14 11:52:55
Text:	 SELECT count(*) as r_cnt FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode]) WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode138)	
Parameters:
@ProcessFactoryCode138[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:52:55
Text:	 SELECT   TOP 50 [TbStockTaking].[ID],[TbStockTaking].[TakNum],[TbStockTaking].[TakDay],[TbStockTaking].[TotalInventory],[TbStockTaking].[TotalTak],[TbStockTaking].[TotalEarnOrLos],[TbStockTaking].[EarnOrLos],[TbStockTaking].[Remarks],[TbStockTaking].[InsertUserCode],[TbStockTaking].[InsertTime],[TbUser].[UserName],[TbCompany].[CompanyFullName] AS [FactoryName],[TbSysDictionaryData].[DictionaryText] AS [WarehouseTypeName] FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode])  WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode138) ORDER BY [TbStockTaking].[ID] DESC 	
Parameters:
@ProcessFactoryCode138[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:52:55
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:52:55
Text:	select * from TbSysDictionaryData where 1=1 and FDictionaryCode=@name order by DictionaryOrder asc	
Parameters:
@name[String] = MaterialType


-----------------------------------------------------------------------------
2020-07-14 11:52:56
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:52:56
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:52:56
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-14 11:52:56
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:52:56
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:53:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:56:12
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:56:12
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-14 11:56:12
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:56:12
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:56:12
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-14 11:56:12
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-14 11:56:13
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:56:13
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:56:13
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:56:13
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-14 11:56:13
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:56:13
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:56:13
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:56:13
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:56:13
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/InOrder/Index


-----------------------------------------------------------------------------
2020-07-14 11:56:13
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:56:13
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:56:13
Text:	select ino.*,case when ISNULL(ino.ChackResult,0)=0 then '' when ISNULL(ino.ChackResult,0)=1 then '合格' when ISNULL(ino.ChackResult,0)=2 then '不合格' when ISNULL(ino.ChackResult,0)=3 then '部分合格' end ChackResultName,ur.UserName,ur1.UserName as DeliverUser,st.StorageName,sdd.DictionaryText as RebarTypeName,sp.SupplierName,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as BranchName,case when rmsp.DemandPlanCode is null then fbnp.RawMaterialDemandNum else rmsp.DemandPlanCode end DemandPlanCode,inoi.IsTh,sap.NoJcBhgCount from TbInOrder ino
							left join(select '退回' as IsTh,InOrderCode from TbInOrderItem where ReturnTime is not null group by InOrderCode) inoi on ino.InOrderCode=inoi.InOrderCode
                            left join TbUser ur on ino.InsertUserCode=ur.UserCode
                            left join TbUser ur1 on ino.UserCode=ur1.UserCode
                            left join TbStorage st on ino.StorageCode=st.StorageCode
                            left join TbSysDictionaryData sdd on ino.RebarType=sdd.DictionaryCode
                            left join TbCompany cp1 on ino.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on ino.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbSupplier sp on ino.SupplierCode=sp.SupplierCode
                            left join TbFactoryBatchNeedPlan fbnp on ino.BatchPlanCode=fbnp.BatchPlanNum
							left join TbRawMaterialMonthDemandSupplyPlan rmsp on fbnp.RawMaterialDemandNum=rmsp.SupplyPlanCode
							left join (	select a.InOrderCode,SUM(c.PassCount) as NoJcBhgCount from TbSampleOrder a
							left join TbSampleOrderItem b on a.SampleOrderCode=b.SampleOrderCode
							left join TbInOrderItem c on b.InOrderItemId=c.ID
							where b.ChackState=2 group by a.InOrderCode) sap on ino.InOrderCode=sap.InOrderCode where 1=1 and  ino.BatchPlanCode!='' and ino.BatchPlanCode is not null and (ino.SiteCode in('6372921375874657752') or ino.WorkAreaCode in('6372921396045311451','6372921398380745033')) and ino.ProjectId='6372912251695766465' and st.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-14 11:56:13
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by InOrderCode desc)AS Row, * from (select ino.*,case when ISNULL(ino.ChackResult,0)=0 then '' when ISNULL(ino.ChackResult,0)=1 then '合格' when ISNULL(ino.ChackResult,0)=2 then '不合格' when ISNULL(ino.ChackResult,0)=3 then '部分合格' end ChackResultName,ur.UserName,ur1.UserName as DeliverUser,st.StorageName,sdd.DictionaryText as RebarTypeName,sp.SupplierName,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as BranchName,case when rmsp.DemandPlanCode is null then fbnp.RawMaterialDemandNum else rmsp.DemandPlanCode end DemandPlanCode,inoi.IsTh,sap.NoJcBhgCount from TbInOrder ino
							left join(select '退回' as IsTh,InOrderCode from TbInOrderItem where ReturnTime is not null group by InOrderCode) inoi on ino.InOrderCode=inoi.InOrderCode
                            left join TbUser ur on ino.InsertUserCode=ur.UserCode
                            left join TbUser ur1 on ino.UserCode=ur1.UserCode
                            left join TbStorage st on ino.StorageCode=st.StorageCode
                            left join TbSysDictionaryData sdd on ino.RebarType=sdd.DictionaryCode
                            left join TbCompany cp1 on ino.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on ino.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbSupplier sp on ino.SupplierCode=sp.SupplierCode
                            left join TbFactoryBatchNeedPlan fbnp on ino.BatchPlanCode=fbnp.BatchPlanNum
							left join TbRawMaterialMonthDemandSupplyPlan rmsp on fbnp.RawMaterialDemandNum=rmsp.SupplyPlanCode
							left join (	select a.InOrderCode,SUM(c.PassCount) as NoJcBhgCount from TbSampleOrder a
							left join TbSampleOrderItem b on a.SampleOrderCode=b.SampleOrderCode
							left join TbInOrderItem c on b.InOrderItemId=c.ID
							where b.ChackState=2 group by a.InOrderCode) sap on ino.InOrderCode=sap.InOrderCode where 1=1 and  ino.BatchPlanCode!='' and ino.BatchPlanCode is not null and (ino.SiteCode in('6372921375874657752') or ino.WorkAreaCode in('6372921396045311451','6372921398380745033')) and ino.ProjectId='6372912251695766465' and st.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-14 11:56:13
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:56:13
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:56:13
Text:	select Tb.DataMonth,ISNULL(sum(TbData.InorderCount),0) as InCount,ISNULL(sum(TbData.InCount),0) as InWeight from (select datepart(MONTH,dateadd(mm,-t.number,getdate())) as DataMonth
from
(select number from master..spt_values where type='P') t
where year(dateadd(mm,-t.number,getdate()))=year(getdate())) Tb 
left join (select COUNT(1) as InorderCount,SUM(a.InCount) as InCount,a.RebarType,datepart(year,a.InsertTime) InsertYear,datepart(MONTH,a.InsertTime) InsertMonth from TbInOrder a 
left join TbStorage b on a.StorageCode=b.StorageCode
where a.Examinestatus!='已退回' 
and a.Examinestatus!='已撤销' 
and datepart(year,a.InsertTime)=datepart(year,GETDATE())  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
group by a.RebarType,datepart(year,a.InsertTime),datepart(MONTH,a.InsertTime)) TbData on  Tb.DataMonth=TbData.InsertMonth
group by Tb.DataMonth order by Tb.DataMonth asc 	


-----------------------------------------------------------------------------
2020-07-14 11:56:13
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:56:13
Text:	select TbType.InType,isnull(TbData.InCount,0) as InCount from (select '入库单数' as InType
                           union all
                           select '未取样' as InType
                           union all
                           select '验收不合格' as InType
                           union all
                           select '检测部分合格' as InType
                           union all
                           select '检测不合格' as InType) TbType
                           left join(select '入库单数' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode 
                           where 1=1 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '未取样' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1 and a.SampleOrderState='取样未完成' and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '验收不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and NoPassTotal>0 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测部分合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=3 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')
                           union all
                           select '检测不合格' as InType,COUNT(1) as InCount from TbInOrder a
                           left join TbStorage b on a.StorageCode=b.StorageCode
                           where 1=1  and ChackResult=2 and a.BatchPlanCode !=''  and a.ProjectId='6372912251695766465' and b.ProcessFactoryCode='6386683729561128960' and a.WorkAreaCode in('6372921396045311451','6372921398380745033')) TbData on TbType.InType=TbData.InType	


-----------------------------------------------------------------------------
2020-07-14 11:56:13
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:56:13
Text:	select Tb.GhType,sum(Tb.GhWeight) as GhWeight,sum(tb.GhCount) as GhCount from (select TbGhType.GhType,isnull(TbGhInfo.HasSupplier,0) as GhWeight,isnull(TbGhInfo.GhCount,0) as GhCount from (select '供货' as GhType
                            union all
                            select '验收不合格' as GhType
                            union all
                            select '检测不合格' as GhType) TbGhType
                            left join(
                            --供货次数、总量
                            select isnull(sum(Tb.HasSupplier),0) as HasSupplier,isnull(sum(Tb.GhCount),0) as GhCount,'供货' as GhType from (select a.HasSupplier,isnull(b.GhCount,0) as GhCount from (select a.BatchPlanNum,sum(a.HasSupplier) as HasSupplier from TbSupplyListDetail a 
                            left join TbSupplyList s on a.BatchPlanNum=s.BatchPlanNum where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')
                            GROUP BY a.BatchPlanNum) a
                            left join(select Tb.BatchPlanNum,count(1) as GhCount from (select BatchPlanNum,ThisTime from TbSupplyListDetailHistory
                            group by BatchPlanNum,ThisTime) Tb group by Tb.BatchPlanNum) b on a.BatchPlanNum=b.BatchPlanNum) Tb 
                            union all
                            --验收不合格次数、验收不合格重量
                            select sum(TbSum.NoPass) as NoPass,sum(TbSum.YsNoPassCount) as YsNoPassCount,'验收不合格' as GhType from (select count(1) as YsNoPassCount,sum(Tb.NoPass) as NoPass from (select b.BatchPlanCode,c.ThisTime,sum(a.NoPass) as NoPass from TbInOrderItem a
                            left join TbInOrder b on a.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            left join TbSupplyListDetailHistory c on a.BatchPlanItemNewCode=c.BatchPlanItemNewCode
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033') and a.BatchPlanItemNewCode is not null and a.NoPass>0 
                            group by b.BatchPlanCode,c.ThisTime) Tb group by Tb.BatchPlanCode) TbSum
                            union all
                            --检测不合格次数、重量
                            select isnull(sum(Tb.JcNoPass),0) as JcNoPass,count(1) as JcNoPassCount,'检测不合格' as GhType from (select b.BatchPlanCode,d.ThisTime,Isnull(sum(c.PassCount),0) as JcNoPass from TbSampleOrderItem a
                            left join TbSampleOrder e on a.SampleOrderCode=e.SampleOrderCode
                            left join TbInOrderItem c on a.InOrderItemId=c.ID
                            left join TbSupplyListDetailHistory d on c.BatchPlanItemNewCode=d.BatchPlanItemNewCode
                            left join TbInOrder b on c.InOrderCode=b.InOrderCode
                            left join TbSupplyList s on b.BatchPlanCode=s.BatchPlanNum
                            where 1=1  and s.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and s.WorkAreaCode in('6372921396045311451','6372921398380745033')  and a.ChackState=2 and c.BatchPlanItemNewCode is not null
                            group by b.BatchPlanCode,d.ThisTime) Tb group by Tb.BatchPlanCode) TbGhInfo on TbGhType.GhType=TbGhInfo.GhType) Tb group by Tb.GhType	


-----------------------------------------------------------------------------
2020-07-14 11:56:13
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/StockTaking/Index


-----------------------------------------------------------------------------
2020-07-14 11:56:13
Text:	 SELECT count(*) as r_cnt FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode]) WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode139)	
Parameters:
@ProcessFactoryCode139[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:56:13
Text:	 SELECT   TOP 50 [TbStockTaking].[ID],[TbStockTaking].[TakNum],[TbStockTaking].[TakDay],[TbStockTaking].[TotalInventory],[TbStockTaking].[TotalTak],[TbStockTaking].[TotalEarnOrLos],[TbStockTaking].[EarnOrLos],[TbStockTaking].[Remarks],[TbStockTaking].[InsertUserCode],[TbStockTaking].[InsertTime],[TbUser].[UserName],[TbCompany].[CompanyFullName] AS [FactoryName],[TbSysDictionaryData].[DictionaryText] AS [WarehouseTypeName] FROM [TbStockTaking] LEFT OUTER JOIN [TbUser] ON ([TbStockTaking].[InsertUserCode] = [TbUser].[UserCode]) LEFT OUTER JOIN [TbSysDictionaryData] ON ([TbStockTaking].[WarehouseType] = [TbSysDictionaryData].[DictionaryCode]) LEFT OUTER JOIN [TbCompany] ON ([TbStockTaking].[ProcessFactoryCode] = [TbCompany].[CompanyCode])  WHERE ([TbStockTaking].[ProcessFactoryCode] = @ProcessFactoryCode139) ORDER BY [TbStockTaking].[ID] DESC 	
Parameters:
@ProcessFactoryCode139[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-14 11:56:14
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-14 11:56:14
Text:	select * from TbSysDictionaryData where 1=1 and FDictionaryCode=@name order by DictionaryOrder asc	
Parameters:
@name[String] = MaterialType


-----------------------------------------------------------------------------
2020-07-14 11:56:14
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-14 11:56:15
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-14 11:56:15
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-14 11:56:15
Text:	select 
                           a.RootNumber,
                           a.SizeSelection,
                           a.MaterialCode,
                           a.WeightSmallPlanN,
                           b.MaterialName,
                           b.SpecificationModel,
                           b.MeasurementUnitZl,
                           c.CompanyFullName StartSiteName,
                           d.CompanyFullName EndSiteName
                           from 
                           (
                           select 
                           a.MaterialCode,
                           a.Size as SizeSelection,
                           a.StartSiteCode,
                           a.EndSiteCode,
                           sum(a.Number) RootNumber,
                           sum(a.Weight) WeightSmallPlanN
                           from TbCloutStockPlace a
                           left join TbRMProductionMaterial rmpm on a.CollarCode=rmpm.CollarCode
                           where a.State=1 
                           and (ISNULL(@ProjectId,'')='' OR a.ProjectId=@ProjectId)
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                            and a.EndSiteCode in('6372921375874657752')
                           group by a.MaterialCode,a.Size,a.StartSiteCode,a.EndSiteCode
                           ) a
                           left join TbRawMaterialArchives b on a.MaterialCode=b.MaterialCode
                           left join TbCompany c on c.CompanyCode=a.StartSiteCode
                           left join TbCompany d on d.CompanyCode=a.EndSiteCode
                           where 1=1 
                           and (ISNULL(@MaterialName,'')='' or b.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or b.SpecificationModel like '%'+@SpecificationModel+'%')	
Parameters:
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 
@BegTime[DateTime] = 
@EndTime[DateTime] = 


-----------------------------------------------------------------------------
2020-07-14 11:56:15
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode asc)AS Row, * from (select 
                           a.RootNumber,
                           a.SizeSelection,
                           a.MaterialCode,
                           a.WeightSmallPlanN,
                           b.MaterialName,
                           b.SpecificationModel,
                           b.MeasurementUnitZl,
                           c.CompanyFullName StartSiteName,
                           d.CompanyFullName EndSiteName
                           from 
                           (
                           select 
                           a.MaterialCode,
                           a.Size as SizeSelection,
                           a.StartSiteCode,
                           a.EndSiteCode,
                           sum(a.Number) RootNumber,
                           sum(a.Weight) WeightSmallPlanN
                           from TbCloutStockPlace a
                           left join TbRMProductionMaterial rmpm on a.CollarCode=rmpm.CollarCode
                           where a.State=1 
                           and (ISNULL(@ProjectId,'')='' OR a.ProjectId=@ProjectId)
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                            and a.EndSiteCode in('6372921375874657752')
                           group by a.MaterialCode,a.Size,a.StartSiteCode,a.EndSiteCode
                           ) a
                           left join TbRawMaterialArchives b on a.MaterialCode=b.MaterialCode
                           left join TbCompany c on c.CompanyCode=a.StartSiteCode
                           left join TbCompany d on d.CompanyCode=a.EndSiteCode
                           where 1=1 
                           and (ISNULL(@MaterialName,'')='' or b.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or b.SpecificationModel like '%'+@SpecificationModel+'%')) as a)  SELECT * FROM temptbl where Row between 1 and 50	
Parameters:
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 
@BegTime[DateTime] = 
@EndTime[DateTime] = 


-----------------------------------------------------------------------------
2020-07-14 11:56:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 11:59:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 12:02:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 12:05:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 12:08:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 12:11:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 12:14:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 12:17:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 12:20:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 12:23:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 12:26:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 12:29:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 12:32:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 12:35:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 12:38:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 12:41:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 12:44:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 12:47:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 12:50:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 12:53:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 12:56:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 12:59:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 13:02:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 13:05:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 13:08:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 13:11:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 13:14:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 13:17:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 13:20:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 13:23:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 13:26:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 13:29:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 13:32:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 13:35:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 13:38:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 13:41:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 13:44:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 13:47:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 13:50:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 13:53:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 13:56:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 13:59:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 14:02:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 14:05:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 14:08:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 14:11:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 14:14:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 14:17:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 14:20:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 14:23:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 14:26:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 14:29:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 14:32:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 14:35:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 14:38:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 14:41:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 14:44:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 14:47:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 14:50:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 14:53:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 14:56:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 14:59:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 15:02:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 15:05:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 15:08:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 15:11:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 15:14:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 15:17:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 15:20:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 15:23:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 15:26:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 15:29:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 15:32:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 15:35:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 15:38:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 15:41:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 15:44:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 15:47:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 15:50:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 15:53:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 15:56:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 15:59:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 16:02:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 16:05:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 16:08:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 16:11:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 16:14:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 16:17:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 16:20:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 16:23:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 16:26:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 16:29:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 16:32:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 16:35:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 16:38:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 16:41:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 16:44:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 16:47:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 16:50:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 16:53:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 16:56:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 16:59:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 17:02:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 17:05:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 17:08:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 17:11:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 17:14:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 17:17:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 17:20:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 17:23:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 17:26:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 17:29:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 17:32:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 17:35:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 17:38:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 17:41:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 17:44:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 17:47:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 17:50:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-14 17:53:19
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------

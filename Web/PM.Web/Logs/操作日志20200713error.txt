2020-07-13 09:49:39
Text:	 SELECT   TOP 1 * FROM [TbUser]  WHERE ([TbUser].[UserCode] = @UserCode1) AND ([TbUser].[UserPwd] = @UserPwd2) 	
Parameters:
@UserCode1[String] = 500000
@UserPwd2[String] = c4ca4238a0b923820dcc509a6f75849b


-----------------------------------------------------------------------------
2020-07-13 09:49:39
Text:	SELECT UserClosed FROM TbUser WHERE UserCode=@UserName	
Parameters:
@UserName[String] = 500000


-----------------------------------------------------------------------------
2020-07-13 09:49:39
Text:	select top 1 ur.ProjectId,pro.ProjectName,ur.OrgId,cm.CompanyFullName,cm.ParentCompanyCode,ur.OrgType,ur.UserCode as UserId,u.UserCode,u.UserName from TbUserRole ur 
left join TbCompany cm on ur.OrgId=cm.CompanyCode
left join TbProjectInfo pro on ur.ProjectId=pro.ProjectId
left join TbUser u on ur.UserCode=u.UserId
where u.UserCode=@UserCode and ur.Flag=0 group by ur.ProjectId,pro.ProjectName,ur.OrgId,cm.CompanyFullName,cm.ParentCompanyCode,ur.OrgType,ur.UserCode,u.UserCode,u.UserName order by OrgId asc	
Parameters:
@UserCode[String] = 500000


-----------------------------------------------------------------------------
2020-07-13 09:49:39
Text:	select distinct ur.RoleCode as RoleId,r.RoleCode,r.RoleName from TbUserRole ur
left join TbUser u on ur.UserCode=u.UserId
left join TbRole r on ur.RoleCode=r.RoleId
where u.UserCode=@UserCode and ProjectId=@ProjectId and OrgId=@OrgId and ur.Flag=0	
Parameters:
@UserCode[String] = 500000
@ProjectId[String] = 6372912251695766465
@OrgId[String] = 6372921375874657752


-----------------------------------------------------------------------------
2020-07-13 09:49:39
Text:	 SELECT   TOP 1 [TbCarInfoDetail].[ID] FROM [TbCarInfoDetail]  WHERE [TbCarInfoDetail].[UserCode] = @UserCode3 	
Parameters:
@UserCode3[String] = 500000


-----------------------------------------------------------------------------
2020-07-13 09:49:39
Text:	INSERT INTO [TbSysLog] ([ActionMenu],[ActionType],[HostName],[LogDate],[UserCode],[UserIP]) VALUES (@ActionMenu4,@ActionType5,@HostName6,@LogDate7,@UserCode8,@UserIP9);select scope_identity()	
Parameters:
@ActionMenu4[String] = 0
@ActionType5[String] = 登录系统
@HostName6[String] = 
@LogDate7[DateTime] = 2020/7/13 9:49:39
@UserCode8[String] = 500000
@UserIP9[String] = 192.168.3.222


-----------------------------------------------------------------------------
2020-07-13 09:49:40
Text:	select tsm.* from TbRoleMenu tum
                           left join TbSysMenu tsm on tum.MenuCode=tsm.MenuCode
                           where tsm.IsShow=0 and tsm.MenuType='PC' and tum.RoleCode in('6372919444627396738','6372919451594895243') order by tsm.Sort asc	


-----------------------------------------------------------------------------
2020-07-13 09:49:40
Text:	select 
                        	tsm.*
                        from TbUserMenu tum
                        left join TbSysMenu tsm on tum.MenuCode=tsm.MenuCode
                        where tsm.IsShow=0 and tsm.MenuType='PC' and tum.UserCode=@userCode order by tsm.Sort asc	
Parameters:
@userCode[String] = 6372930471544160074


-----------------------------------------------------------------------------
2020-07-13 09:49:40
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 09:49:41
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 09:49:41
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 09:49:41
Text:	select isnull(sum(TbCF.Capacity),0) as Capacity,isnull(sum(TbCF.WeightSmallPlan),0) as WeightSmallPlan,isnull(cast(sum(TbCF.WeightSmallPlan)/sum(TbCF.Capacity)*100 as decimal(18,2)),0) as ActualLoadNew from (select cf.Capacity,Tb1.WeightSmallPlan,cf.ProcessFactoryCode from TbCapacityFilling cf  
left join(
select SUM(Tb.WeightSmallPlan) as WeightSmallPlan,Tb.ProcessFactoryCode from (
                            select isnull(SUM(wod.WeightSmallPlan),0) as WeightSmallPlan,wo.ProcessFactoryCode from TbWorkOrder wo
                            left join TbWorkOrderDetail wod on wo.OrderCode=wod.OrderCode
                            where (ISNULL(@ProcessFactoryCode,'')='' or wo.ProcessFactoryCode=@ProcessFactoryCode)
                            and CONVERT(varchar(7), wo.DistributionTime, 120)=@month
                            and wod.RevokeStart='正常' and wo.ProcessingState!='ConfirmWork' and wo.ProcessingState!='Finishing'  group by wo.ProcessFactoryCode
                            union all
                            select isnull(sum(opd.NoCompleted),0) as NoCompleted,op.ProcessFactoryCode from TbOrderProgress op
                            left join TbOrderProgressDetail opd on op.OrderCode=opd.OrderCode 
                            where (ISNULL(@ProcessFactoryCode,'')='' or op.ProcessFactoryCode=@ProcessFactoryCode)
                            and CONVERT(varchar(7), op.DistributionTime, 120)=CONVERT(varchar(4),YEAR(DATEADD(MONTH,-1,@month+'-01')))+'-'+Right(100+Month(DATEADD(MONTH,-1,@month+'-01')),2)
                            and opd.RevokeStart='正常'  group by op.ProcessFactoryCode)Tb  group by Tb.ProcessFactoryCode
) Tb1 on cf.ProcessFactoryCode=Tb1.ProcessFactoryCode 
where cf.CapacityMonth=@month
and (ISNULL(@ProcessFactoryCode,'')='' or cf.ProcessFactoryCode=@ProcessFactoryCode)) TbCF where (ISNULL(@ProcessFactoryCode,'')='' or TbCF.ProcessFactoryCode=@ProcessFactoryCode)	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@month[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 09:49:41
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:49:41
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode10) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode11,@WorkAreaCode12))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus13) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth14))) 	
Parameters:
@ProcessFactoryCode10[String] = 6386683729561128960
@WorkAreaCode11[String] = 6372921396045311451
@WorkAreaCode12[String] = 6372921398380745033
@Examinestatus13[String] = 审核完成
@DemandMonth14[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 09:49:42
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 09:49:42
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 09:49:42
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:49:42
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:49:42
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode17) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode18))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState19)) 	
Parameters:
@ProcessFactoryCode17[String] = 6386683729561128960
@SiteCode18[String] = 6372921375874657752
@ProcessingState19[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-13 09:49:42
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-13 09:49:42
Text:	 SELECT   [TbOrderProgress].[ProcessingState],[TbOrderProgress].[OrderCode],[TbOrderProgress].[FinishProcessingDateTime],[TbOrderProgress].[DistributionTime],[TbOrderProgress].[SiteCode] FROM [TbOrderProgress]  WHERE ((([TbOrderProgress].[SiteCode] IN (@SiteCode15)) AND ([TbOrderProgress].[ProcessFactoryCode] = @ProcessFactoryCode16)) AND ((YEAR(DistributionTime)=2020 and MONTH(DistributionTime)=7) or (DistributionTime<'2020/7/1 0:00:00' and (ProcessingState!='Finishing')))) 	
Parameters:
@SiteCode15[String] = 6372921375874657752
@ProcessFactoryCode16[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-13 09:49:42
Text:	 SELECT   * FROM [TbWorkOrderDetail]  WHERE (1=2) AND ([TbWorkOrderDetail].[DaetailWorkStrat] = @DaetailWorkStrat20) 	
Parameters:
@DaetailWorkStrat20[String] = 未加工


-----------------------------------------------------------------------------
2020-07-13 09:49:42
Text:	 SELECT   [TbOrderProgress].[WeightTotal] AS [TotalWeight],[TbCompany].[ParentCompanyCode] FROM [TbOrderProgress] LEFT OUTER JOIN [TbCompany] ON ([TbOrderProgress].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((1=2) AND ([TbOrderProgress].[ProcessingState] <> @ProcessingState21)) AND ((([TbOrderProgress].[FinishProcessingDateTime] is not null ) AND ([TbOrderProgress].[DistributionTime] < [TbOrderProgress].[FinishProcessingDateTime])) OR (([TbOrderProgress].[FinishProcessingDateTime] is null ) AND ([TbOrderProgress].[DistributionTime] < @DistributionTime22)))) 	
Parameters:
@ProcessingState21[String] = Finishing
@DistributionTime22[DateTime] = 2020/7/13 0:00:00


-----------------------------------------------------------------------------
2020-07-13 09:49:42
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:49:42
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode23) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode24))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState25)) 	
Parameters:
@ProcessFactoryCode23[String] = 6386683729561128960
@SiteCode24[String] = 6372921375874657752
@ProcessingState25[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-13 09:49:42
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-13 09:49:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:49:43
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode27) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode28,@WorkAreaCode29))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus30) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth31))) 	
Parameters:
@ProcessFactoryCode27[String] = 6386683729561128960
@WorkAreaCode28[String] = 6372921396045311451
@WorkAreaCode29[String] = 6372921398380745033
@Examinestatus30[String] = 审核完成
@DemandMonth31[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 09:49:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:49:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:49:43
Text:	 SELECT   [TbRawMaterialStockRecord].[MaterialCode],sum([TbRawMaterialStockRecord].[UseCount]) AS [UseCount],sum([TbRawMaterialStockRecord].[LockCount]) AS [LockCount] FROM [TbRawMaterialStockRecord] LEFT OUTER JOIN [TbStorage] ON ([TbRawMaterialStockRecord].[StorageCode] = [TbStorage].[StorageCode]) LEFT OUTER JOIN [TbRawMaterialArchives] ON ([TbRawMaterialStockRecord].[MaterialCode] = [TbRawMaterialArchives].[MaterialCode])  WHERE ((([TbStorage].[ProcessFactoryCode] = @ProcessFactoryCode34) AND ([TbRawMaterialStockRecord].[WorkAreaCode] IN (@WorkAreaCode36,@WorkAreaCode37))) AND ([TbRawMaterialArchives].[RebarType] = @RebarType39)) GROUP BY [TbRawMaterialStockRecord].[MaterialCode] 	
Parameters:
@ProcessFactoryCode34[String] = 6386683729561128960
@WorkAreaCode36[String] = 6372921396045311451
@WorkAreaCode37[String] = 6372921398380745033
@RebarType39[String] = BuildingSteel


-----------------------------------------------------------------------------
2020-07-13 09:49:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:49:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:49:43
Text:	 SELECT   [TbRawMaterialStockRecord].[MaterialCode],sum([TbRawMaterialStockRecord].[UseCount]) AS [UseCount],sum([TbRawMaterialStockRecord].[LockCount]) AS [LockCount] FROM [TbRawMaterialStockRecord] LEFT OUTER JOIN [TbStorage] ON ([TbRawMaterialStockRecord].[StorageCode] = [TbStorage].[StorageCode]) LEFT OUTER JOIN [TbRawMaterialArchives] ON ([TbRawMaterialStockRecord].[MaterialCode] = [TbRawMaterialArchives].[MaterialCode])  WHERE ((([TbStorage].[ProcessFactoryCode] = @ProcessFactoryCode43) AND ([TbRawMaterialStockRecord].[WorkAreaCode] IN (@WorkAreaCode45,@WorkAreaCode46))) AND ([TbRawMaterialArchives].[RebarType] = @RebarType48)) GROUP BY [TbRawMaterialStockRecord].[MaterialCode] 	
Parameters:
@ProcessFactoryCode43[String] = 6386683729561128960
@WorkAreaCode45[String] = 6372921396045311451
@WorkAreaCode46[String] = 6372921398380745033
@RebarType48[String] = SectionSteel


-----------------------------------------------------------------------------
2020-07-13 09:49:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:49:43
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode50) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode51,@WorkAreaCode52))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus53) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth54))) 	
Parameters:
@ProcessFactoryCode50[String] = 6386683729561128960
@WorkAreaCode51[String] = 6372921396045311451
@WorkAreaCode52[String] = 6372921398380745033
@Examinestatus53[String] = 审核完成
@DemandMonth54[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 09:49:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:49:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:49:43
Text:	
                        select fewoi.DataCode as OddNumbers,
                         fewoi.EarlyWarningContent,
                         fewoi.EWFormDataCode,
                         CONVERT(varchar(100), fewoi.EarlyWarningTime, 120) as EarlyWarningTime,
                         EWFormCode,sm.MenuName,fn.FlowNodeName,cp1.CompanyFullName as BranchName,
                         cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,
                         u1.UserName as FlowSpUserName,u2.UserName as FlowYjUserName 
                        FROM (
                        select*
                           FROM ( 
                        		SELECT a.*, row_number()over(partition BY a.FlowCode ORDER BY a.FlowNodeCode,a.EarlyWarningTime desc) as group_idx 
                        		FROM TbFlowEarlyWarningOtherInfo  a
                        		INNER JOIN  TbFlowEarlyWarningInfo b ON a.FlowCode=b.FlowCode 
                        		AND a.EWFormDataCode=b.EWFormDataCode AND a.FlowNodeCode=b.FlowNodeCode 
                        		WHERE YEAR(a.EarlyWarningTime)= @Year and MONTH(a.EarlyWarningTime)= @Month AND b.EarlyWarningStart=0
                           ) ret
                        WHERE ret.group_idx =1
                        ) fewoi
                        left join TbFlowNode fn on fewoi.FlowCode=fn.FlowCode and fewoi.FlowNodeCode=fn.FlowNodeCode
                        left join TbSysMenu sm on fewoi.EWFormCode=sm.MenuCode
                        left join TbCompany cp1 on fewoi.BranchCode=cp1.CompanyCode
                        left join TbCompany cp2 on fewoi.WorkAreaCode=cp2.CompanyCode
                        left join TbCompany cp3 on fewoi.SiteCode=cp3.CompanyCode
                        left join TbCompany cp4 on fewoi.ProcessFactoryCode=cp4.CompanyCode
                        left join TbUser u1 on fewoi.FlowSpUserCode=u1.UserId
                        left join TbUser u2 on fewoi.FlowYjUserCode=u2.UserId where 1=1 and fewoi.ProjectId='6372912251695766465' and fewoi.ProcessFactoryCode='6386683729561128960' and (fewoi.SiteCode in('6372921375874657752') or fewoi.WorkAreaCode in('6372921396045311451','6372921398380745033')) ORDER BY fewoi.EarlyWarningTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 09:49:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:49:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:49:43
Text:	--原材料供货超时
                           select BatchPlanNum,cp1.CompanyFullName as BranchName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,sup.SupplyDate,sup.SupplyCompleteTime,sup.ProjectId,sup.Remarks from TbSupplyList sup
                           left join TbCompany cp1 on cp1.CompanyCode=sup.BranchCode
                           left join TbCompany cp2 on cp2.CompanyCode=sup.WorkAreaCode
                           left join TbCompany cp3 on cp3.CompanyCode=sup.SiteCode
                           left join TbCompany cp4 on cp4.CompanyCode=sup.ProcessFactoryCode
                           where YEAR(sup.SupplyDate)= @Year and MONTH(sup.SupplyDate)= @Month
                           and (sup.SupplyCompleteTime>sup.SupplyDate or (GETDATE()>sup.SupplyDate and sup.SupplyCompleteTime is null))  and sup.ProjectId='6372912251695766465' and sup.ProcessFactoryCode='6386683729561128960' and (sup.SiteCode in('6372921375874657752') or sup.WorkAreaCode in('6372921396045311451','6372921398380745033'))	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 09:49:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:49:43
Text:	--加工进度滞后
                           select op.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,op.DistributionTime,op.FinishProcessingDateTime from TbOrderProgress op 
                           left join TbCompany cp1 on op.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on op.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(op.DistributionTime)= @Year and MONTH(op.DistributionTime)= @Month
                           and (op.FinishProcessingDateTime>op.DistributionTime or (GETDATE()>op.DistributionTime and op.FinishProcessingDateTime is null))  and op.ProjectId='6372912251695766465' and op.ProcessFactoryCode='6386683729561128960' and op.SiteCode in('6372921375874657752') ORDER BY op.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 09:49:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:49:43
Text:	--配送超期
                           select dpi.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,dpi.DistributionTime,dpi.DeliveryCompleteTime,dpi.Remark from TbDistributionPlanInfo dpi
                           left join TbCompany cp1 on dpi.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on dpi.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(dpi.DistributionTime)= @Year and MONTH(dpi.DistributionTime)= @Month
                           and (dpi.DeliveryCompleteTime>dpi.DistributionTime or (GETDATE()>dpi.DistributionTime and dpi.DeliveryCompleteTime is null))  and dpi.ProjectId='6372912251695766465' and dpi.ProcessFactoryCode='6386683729561128960' and dpi.SiteCode in('6372921375874657752') ORDER BY dpi.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 09:49:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:49:43
Text:	select TbYj.*,cp1.CompanyFullName as SiteName,tcr.EnterSpaceTime,tcr.StartDischargeTime,tcr.EndDischargeTime,disEnt.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SiteDischargeCargo' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbTransportCarReport tcr on TbYj.EWFormDataCode=tcr.DisEntOrderId
                           left join TbDistributionEnt disEnt on tcr.DistributionCode=disEnt.DistributionCode
                           left join TbCompany cp on disEnt.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and disEnt.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ORDER BY tcr.EnterSpaceTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 09:49:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:49:43
Text:	select TbYj.*,cp1.CompanyFullName as SiteName,sfs.DistributionCode,sdc.DistributionTime,sfs.SigninTime,sfs.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SemiFinishedSign' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbSemiFinishedSign sfs on TbYj.EWFormDataCode=sfs.ID
                           left join TbSiteDischargeCargo sdc on sfs.DistributionCode=sdc.DistributionCode and sfs.DischargeCargoCode=sdc.DischargeCargoCode
                           left join TbCompany cp on sfs.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month and TbYj.ProjectId='6372912251695766465' and sfs.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752')	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 09:49:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:49:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:49:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:49:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:49:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:49:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:49:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:49:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:49:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:49:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:49:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:49:43
Text:	SELECT 
                            '审批超时' as YjTypeName,COUNT(1) as YjNum
                            FROM (
									SELECT a.*, row_number()over(partition BY a.FlowCode ORDER BY a.FlowNodeCode,a.EarlyWarningTime desc) as group_idx 
									FROM TbFlowEarlyWarningOtherInfo  a
									INNER JOIN  TbFlowEarlyWarningInfo b ON a.FlowCode=b.FlowCode 
									AND a.EWFormDataCode=b.EWFormDataCode AND a.FlowNodeCode=b.FlowNodeCode 
									WHERE  b.EarlyWarningStart=0 AND YEAR(a.EarlyWarningTime)= @Year and MONTH(a.EarlyWarningTime)= @Month  and a.ProjectId='6372912251695766465' and a.ProcessFactoryCode='6386683729561128960' and (a.SiteCode in('6372921375874657752') or a.WorkAreaCode in('6372921396045311451','6372921398380745033'))
							   ) Tb1
                            WHERE Tb1.group_idx =1
                           union all
                            select '未报月度需求计划' as YjTypeName,COUNT(1)as YjNum
                             FROM ( 
                                  SELECT *, row_number()over(partition BY EarlyWarningCode,EWFormDataCode ORDER BY EWNodeCode,EWTime desc) as group_idx 
                                  FROM TbFormEarlyWarningNodeInfo fwqi
                                  WHERE fwqi.MenuCode='RawMonthDemandPlan' AND fwqi.EWStart=0 AND YEAR(fwqi.EWTime)= @Year and MONTH(fwqi.EWTime)= @Month  and fwqi.ProjectId='6372912251695766465' and (fwqi.SiteCode in('6372921375874657752') or fwqi.WorkArea in('6372921396045311451','6372921398380745033'))  
                             ) Tb2
                             WHERE Tb2.group_idx =1
                           union all
                           select '原材料供货超时' as YjTypeName,COUNT(1) as YjNum from (
                           select BatchPlanNum,cp1.CompanyFullName as BranchName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,sup.SupplyDate,sup.SupplyCompleteTime,sup.ProjectId from TbSupplyList sup
                           left join TbCompany cp1 on cp1.CompanyCode=sup.BranchCode
                           left join TbCompany cp2 on cp2.CompanyCode=sup.WorkAreaCode
                           left join TbCompany cp3 on cp3.CompanyCode=sup.SiteCode
                           left join TbCompany cp4 on cp4.CompanyCode=sup.ProcessFactoryCode
                           where (sup.SupplyCompleteTime>sup.SupplyDate or (GETDATE()>sup.SupplyDate and sup.SupplyCompleteTime is null))
						   and YEAR(sup.SupplyDate)= @Year and MONTH(sup.SupplyDate)= @Month  and sup.ProjectId='6372912251695766465' and sup.ProcessFactoryCode='6386683729561128960' and (sup.SiteCode in('6372921375874657752') or sup.WorkAreaCode in('6372921396045311451','6372921398380745033'))) Tb3
                           union all
                           select '加急订单' as YjTypeName,COUNT(1) as YjNum from (--加急订单个数
                           select wo.OrderCode,wo.DistributionTime,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName from TbWorkOrder wo
                           left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on wo.ProcessFactoryCode=cp2.CompanyCode
                           where UrgentDegree='Urgent' 
						   and YEAR(wo.DistributionTime)= @Year and MONTH(wo.DistributionTime)= @Month  and wo.ProjectId='6372912251695766465' and wo.ProcessFactoryCode='6386683729561128960' and wo.SiteCode in('6372921375874657752') ) Tb4
                           union all
                           select '加工进度滞后' as YjTypeName,COUNT(1) as YjNum from (--加工进度滞后
                           select op.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,op.DistributionTime,op.FinishProcessingDateTime from TbOrderProgress op 
                           left join TbCompany cp1 on op.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on op.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(op.DistributionTime)= @Year and MONTH(op.DistributionTime)= @Month
                           and (op.FinishProcessingDateTime>op.DistributionTime or (GETDATE()>op.DistributionTime and op.FinishProcessingDateTime is null))  and op.ProjectId='6372912251695766465' and op.ProcessFactoryCode='6386683729561128960' and op.SiteCode in('6372921375874657752') ) Tb5
                           union all
                           select '接收配送超期' as YjTypeName,COUNT(1) as YjNum from (--配送超期
                           select dpi.OrderCode,cp1.CompanyFullName as SIteName,cp2.CompanyFullName as ProcessFactoryName,dpi.DistributionTime,dpi.DeliveryCompleteTime from TbDistributionPlanInfo dpi
                           left join TbCompany cp1 on dpi.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on dpi.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(dpi.DistributionTime)= @Year and MONTH(dpi.DistributionTime)= @Month
                           and (dpi.DeliveryCompleteTime>dpi.DistributionTime or (GETDATE()>dpi.DistributionTime and dpi.DeliveryCompleteTime is null))  and dpi.ProjectId='6372912251695766465' and dpi.ProcessFactoryCode='6386683729561128960' and dpi.SiteCode in('6372921375874657752') ) Tb6 
                           union all
                           select '卸货超时' as YjTypeName,COUNT(1) as YjNum from(--卸货超时
                           select TbYj.*,cp1.CompanyFullName as SiteName,tcr.EnterSpaceTime,tcr.StartDischargeTime,tcr.EndDischargeTime,disEnt.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SiteDischargeCargo' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbTransportCarReport tcr on TbYj.EWFormDataCode=tcr.DisEntOrderId
                           left join TbDistributionEnt disEnt on tcr.DistributionCode=disEnt.DistributionCode
                           left join TbCompany cp on disEnt.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and disEnt.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ) Tb7
                           union all
                           select '签收超时' as YjTypeName,COUNT(1) as YjNum from (select TbYj.*,cp1.CompanyFullName as SiteName,sfs.DistributionCode,sdc.DistributionTime,sfs.SigninTime,sfs.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SemiFinishedSign' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbSemiFinishedSign sfs on TbYj.EWFormDataCode=sfs.ID
                           left join TbSiteDischargeCargo sdc on sfs.DistributionCode=sdc.DistributionCode and sfs.DischargeCargoCode=sdc.DischargeCargoCode
                           left join TbCompany cp on sfs.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and sfs.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ) Tb8	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 09:49:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:49:43
Text:	--加急订单个数
                           select wo.OrderCode,wo.DistributionTime,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName from TbWorkOrder wo
                           left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on wo.ProcessFactoryCode=cp2.CompanyCode
                           where UrgentDegree='Urgent'
                           and YEAR(wo.DistributionTime)= @Year and MONTH(wo.DistributionTime)= @Month  and wo.ProjectId='6372912251695766465' and wo.ProcessFactoryCode='6386683729561128960' and wo.SiteCode in('6372921375874657752')  ORDER BY wo.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 09:49:44
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:49:44
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode55) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode56,@WorkAreaCode57))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus58) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth59))) 	
Parameters:
@ProcessFactoryCode55[String] = 6386683729561128960
@WorkAreaCode56[String] = 6372921396045311451
@WorkAreaCode57[String] = 6372921398380745033
@Examinestatus58[String] = 审核完成
@DemandMonth59[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 09:49:44
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:49:44
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:49:44
Text:	SELECT sm.MenuName,fwqi.EWContent,fwqi.EWUserCode,u.UserName,fwqi.EWFormDataCode,cp1.CompanyFullName as  FbName,cp2.CompanyFullName as GqName,fwqi.EWTime,sdd.DictionaryText as RebarType  
                   FROM (  
                    select ret.*
                    FROM ( 
                         SELECT *, row_number()over(partition BY EarlyWarningCode,EWFormDataCode ORDER BY EWNodeCode,EWTime desc) as group_idx 
                         FROM TbFormEarlyWarningNodeInfo fwqi
                         WHERE YEAR(fwqi.EWTime)= @Year and MONTH(fwqi.EWTime)= @Month AND fwqi.MenuCode='RawMonthDemandPlan' AND fwqi.EWStart=0
                    ) ret
                    WHERE ret.group_idx = 1
                   ) fwqi
                    left join TbSysMenu sm on fwqi.MenuCode=sm.MenuCode
                            left join TbCompany cp1 on fwqi.CompanyCode=cp1.CompanyCode
                            left join TbCompany cp2 on fwqi.WorkArea=cp2.CompanyCode
                            left join TbCompany cp3 on fwqi.SiteCode=cp3.CompanyCode
                            left join TbUser u on fwqi.EWUserCode=u.UserId
                            left join TbRawMaterialMonthDemandPlan rmp on fwqi.EWFormDataCode=rmp.ID
                            left join TbSysDictionaryData sdd on sdd.DictionaryCode=rmp.RebarType
                    where 1=1 and fwqi.ProjectId='6372912251695766465' and (fwqi.SiteCode in('6372921375874657752') or fwqi.WorkArea in('6372921396045311451','6372921398380745033')) ORDER BY fwqi.EWTime DESC	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 09:49:44
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:49:44
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:49:44
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode62) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode63))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState64)) 	
Parameters:
@ProcessFactoryCode62[String] = 6386683729561128960
@SiteCode63[String] = 6372921375874657752
@ProcessingState64[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-13 09:49:44
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-13 09:49:44
Text:	 SELECT   [TbOrderProgress].[ProcessingState],[TbOrderProgress].[OrderCode],[TbOrderProgress].[FinishProcessingDateTime],[TbOrderProgress].[DistributionTime],[TbOrderProgress].[SiteCode] FROM [TbOrderProgress]  WHERE ((([TbOrderProgress].[SiteCode] IN (@SiteCode60)) AND ([TbOrderProgress].[ProcessFactoryCode] = @ProcessFactoryCode61)) AND ((YEAR(DistributionTime)=2020 and MONTH(DistributionTime)=7) or (DistributionTime<'2020/7/1 0:00:00' and (ProcessingState!='Finishing')))) 	
Parameters:
@SiteCode60[String] = 6372921375874657752
@ProcessFactoryCode61[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-13 09:49:44
Text:	 SELECT   * FROM [TbWorkOrderDetail]  WHERE (1=2) AND ([TbWorkOrderDetail].[DaetailWorkStrat] = @DaetailWorkStrat65) 	
Parameters:
@DaetailWorkStrat65[String] = 未加工


-----------------------------------------------------------------------------
2020-07-13 09:49:44
Text:	 SELECT   [TbOrderProgress].[WeightTotal] AS [TotalWeight],[TbCompany].[ParentCompanyCode] FROM [TbOrderProgress] LEFT OUTER JOIN [TbCompany] ON ([TbOrderProgress].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((1=2) AND ([TbOrderProgress].[ProcessingState] <> @ProcessingState66)) AND ((([TbOrderProgress].[FinishProcessingDateTime] is not null ) AND ([TbOrderProgress].[DistributionTime] < [TbOrderProgress].[FinishProcessingDateTime])) OR (([TbOrderProgress].[FinishProcessingDateTime] is null ) AND ([TbOrderProgress].[DistributionTime] < @DistributionTime67)))) 	
Parameters:
@ProcessingState66[String] = Finishing
@DistributionTime67[DateTime] = 2020/7/13 0:00:00


-----------------------------------------------------------------------------
2020-07-13 09:49:57
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 09:49:57
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-13 09:49:57
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 09:49:57
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 09:49:58
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 09:49:58
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-13 09:49:58
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 09:49:59
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 09:49:59
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:49:59
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:49:59
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 09:49:59
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 09:49:59
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 09:49:59
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:49:59
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:49:59
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 09:50:00
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 09:50:07
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:50:07
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:50:07
Text:	select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 09:50:08
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 09:50:08
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='BuildingSteel'	


-----------------------------------------------------------------------------
2020-07-13 09:50:08
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='SectionSteel'	


-----------------------------------------------------------------------------
2020-07-13 09:50:08
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)	


-----------------------------------------------------------------------------
2020-07-13 09:50:08
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 09:50:08
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)	


-----------------------------------------------------------------------------
2020-07-13 09:50:09
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 09:50:12
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 09:50:12
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-13 09:50:12
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 09:50:12
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 09:50:12
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 09:50:12
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-13 09:50:12
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 09:50:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:50:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:50:12
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 09:50:12
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 09:50:13
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 09:50:13
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:50:13
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:50:13
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 09:50:13
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 09:50:14
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 09:50:49
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:50:49
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:50:49
Text:	select 
                           a.RootNumber,
                           a.SizeSelection,
                           a.MaterialCode,
                           a.WeightSmallPlanN,
                           b.MaterialName,
                           b.SpecificationModel,
                           b.MeasurementUnitZl,
                           c.CompanyFullName StartSiteName,
                           d.CompanyFullName EndSiteName
                           from 
                           (
                           select 
                           a.MaterialCode,
                           a.Size as SizeSelection,
                           a.StartSiteCode,
                           a.EndSiteCode,
                           sum(a.Number) RootNumber,
                           sum(a.Weight) WeightSmallPlanN
                           from TbCloutStockPlace a
                           left join TbRMProductionMaterial rmpm on a.CollarCode=rmpm.CollarCode
                           where a.State=1 
                           and (ISNULL(@ProjectId,'')='' OR a.ProjectId=@ProjectId)
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                            and a.EndSiteCode in('6372921375874657752')
                           group by a.MaterialCode,a.Size,a.StartSiteCode,a.EndSiteCode
                           ) a
                           left join TbRawMaterialArchives b on a.MaterialCode=b.MaterialCode
                           left join TbCompany c on c.CompanyCode=a.StartSiteCode
                           left join TbCompany d on d.CompanyCode=a.EndSiteCode
                           where 1=1 
                           and (ISNULL(@MaterialName,'')='' or b.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or b.SpecificationModel like '%'+@SpecificationModel+'%')	
Parameters:
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 
@BegTime[DateTime] = 
@EndTime[DateTime] = 


-----------------------------------------------------------------------------
2020-07-13 09:50:49
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode asc)AS Row, * from (select 
                           a.RootNumber,
                           a.SizeSelection,
                           a.MaterialCode,
                           a.WeightSmallPlanN,
                           b.MaterialName,
                           b.SpecificationModel,
                           b.MeasurementUnitZl,
                           c.CompanyFullName StartSiteName,
                           d.CompanyFullName EndSiteName
                           from 
                           (
                           select 
                           a.MaterialCode,
                           a.Size as SizeSelection,
                           a.StartSiteCode,
                           a.EndSiteCode,
                           sum(a.Number) RootNumber,
                           sum(a.Weight) WeightSmallPlanN
                           from TbCloutStockPlace a
                           left join TbRMProductionMaterial rmpm on a.CollarCode=rmpm.CollarCode
                           where a.State=1 
                           and (ISNULL(@ProjectId,'')='' OR a.ProjectId=@ProjectId)
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                            and a.EndSiteCode in('6372921375874657752')
                           group by a.MaterialCode,a.Size,a.StartSiteCode,a.EndSiteCode
                           ) a
                           left join TbRawMaterialArchives b on a.MaterialCode=b.MaterialCode
                           left join TbCompany c on c.CompanyCode=a.StartSiteCode
                           left join TbCompany d on d.CompanyCode=a.EndSiteCode
                           where 1=1 
                           and (ISNULL(@MaterialName,'')='' or b.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or b.SpecificationModel like '%'+@SpecificationModel+'%')) as a)  SELECT * FROM temptbl where Row between 1 and 50	
Parameters:
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 
@BegTime[DateTime] = 
@EndTime[DateTime] = 


-----------------------------------------------------------------------------
2020-07-13 09:50:54
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:50:54
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:50:54
Text:	select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 09:50:54
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 09:50:54
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='BuildingSteel'	


-----------------------------------------------------------------------------
2020-07-13 09:50:54
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='SectionSteel'	


-----------------------------------------------------------------------------
2020-07-13 09:50:55
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)	


-----------------------------------------------------------------------------
2020-07-13 09:50:55
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 09:50:55
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)	


-----------------------------------------------------------------------------
2020-07-13 09:50:55
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 09:52:07
Text:	select tsm.* from TbRoleMenu tum
                           left join TbSysMenu tsm on tum.MenuCode=tsm.MenuCode
                           where tsm.IsShow=0 and tsm.MenuType='PC' and tum.RoleCode in('6372919444627396738','6372919451594895243') order by tsm.Sort asc	


-----------------------------------------------------------------------------
2020-07-13 09:52:07
Text:	select 
                        	tsm.*
                        from TbUserMenu tum
                        left join TbSysMenu tsm on tum.MenuCode=tsm.MenuCode
                        where tsm.IsShow=0 and tsm.MenuType='PC' and tum.UserCode=@userCode order by tsm.Sort asc	
Parameters:
@userCode[String] = 6372930471544160074


-----------------------------------------------------------------------------
2020-07-13 09:52:07
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 09:52:07
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 09:52:07
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 09:52:07
Text:	select isnull(sum(TbCF.Capacity),0) as Capacity,isnull(sum(TbCF.WeightSmallPlan),0) as WeightSmallPlan,isnull(cast(sum(TbCF.WeightSmallPlan)/sum(TbCF.Capacity)*100 as decimal(18,2)),0) as ActualLoadNew from (select cf.Capacity,Tb1.WeightSmallPlan,cf.ProcessFactoryCode from TbCapacityFilling cf  
left join(
select SUM(Tb.WeightSmallPlan) as WeightSmallPlan,Tb.ProcessFactoryCode from (
                            select isnull(SUM(wod.WeightSmallPlan),0) as WeightSmallPlan,wo.ProcessFactoryCode from TbWorkOrder wo
                            left join TbWorkOrderDetail wod on wo.OrderCode=wod.OrderCode
                            where (ISNULL(@ProcessFactoryCode,'')='' or wo.ProcessFactoryCode=@ProcessFactoryCode)
                            and CONVERT(varchar(7), wo.DistributionTime, 120)=@month
                            and wod.RevokeStart='正常' and wo.ProcessingState!='ConfirmWork' and wo.ProcessingState!='Finishing'  group by wo.ProcessFactoryCode
                            union all
                            select isnull(sum(opd.NoCompleted),0) as NoCompleted,op.ProcessFactoryCode from TbOrderProgress op
                            left join TbOrderProgressDetail opd on op.OrderCode=opd.OrderCode 
                            where (ISNULL(@ProcessFactoryCode,'')='' or op.ProcessFactoryCode=@ProcessFactoryCode)
                            and CONVERT(varchar(7), op.DistributionTime, 120)=CONVERT(varchar(4),YEAR(DATEADD(MONTH,-1,@month+'-01')))+'-'+Right(100+Month(DATEADD(MONTH,-1,@month+'-01')),2)
                            and opd.RevokeStart='正常'  group by op.ProcessFactoryCode)Tb  group by Tb.ProcessFactoryCode
) Tb1 on cf.ProcessFactoryCode=Tb1.ProcessFactoryCode 
where cf.CapacityMonth=@month
and (ISNULL(@ProcessFactoryCode,'')='' or cf.ProcessFactoryCode=@ProcessFactoryCode)) TbCF where (ISNULL(@ProcessFactoryCode,'')='' or TbCF.ProcessFactoryCode=@ProcessFactoryCode)	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@month[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 09:52:08
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:52:08
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode68) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode69,@WorkAreaCode70))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus71) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth72))) 	
Parameters:
@ProcessFactoryCode68[String] = 6386683729561128960
@WorkAreaCode69[String] = 6372921396045311451
@WorkAreaCode70[String] = 6372921398380745033
@Examinestatus71[String] = 审核完成
@DemandMonth72[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 09:52:08
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 09:52:08
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 09:52:08
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:52:08
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:52:08
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode75) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode76))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState77)) 	
Parameters:
@ProcessFactoryCode75[String] = 6386683729561128960
@SiteCode76[String] = 6372921375874657752
@ProcessingState77[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-13 09:52:08
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-13 09:52:08
Text:	 SELECT   [TbOrderProgress].[ProcessingState],[TbOrderProgress].[OrderCode],[TbOrderProgress].[FinishProcessingDateTime],[TbOrderProgress].[DistributionTime],[TbOrderProgress].[SiteCode] FROM [TbOrderProgress]  WHERE ((([TbOrderProgress].[SiteCode] IN (@SiteCode73)) AND ([TbOrderProgress].[ProcessFactoryCode] = @ProcessFactoryCode74)) AND ((YEAR(DistributionTime)=2020 and MONTH(DistributionTime)=7) or (DistributionTime<'2020/7/1 0:00:00' and (ProcessingState!='Finishing')))) 	
Parameters:
@SiteCode73[String] = 6372921375874657752
@ProcessFactoryCode74[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-13 09:52:08
Text:	 SELECT   * FROM [TbWorkOrderDetail]  WHERE (1=2) AND ([TbWorkOrderDetail].[DaetailWorkStrat] = @DaetailWorkStrat78) 	
Parameters:
@DaetailWorkStrat78[String] = 未加工


-----------------------------------------------------------------------------
2020-07-13 09:52:08
Text:	 SELECT   [TbOrderProgress].[WeightTotal] AS [TotalWeight],[TbCompany].[ParentCompanyCode] FROM [TbOrderProgress] LEFT OUTER JOIN [TbCompany] ON ([TbOrderProgress].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((1=2) AND ([TbOrderProgress].[ProcessingState] <> @ProcessingState79)) AND ((([TbOrderProgress].[FinishProcessingDateTime] is not null ) AND ([TbOrderProgress].[DistributionTime] < [TbOrderProgress].[FinishProcessingDateTime])) OR (([TbOrderProgress].[FinishProcessingDateTime] is null ) AND ([TbOrderProgress].[DistributionTime] < @DistributionTime80)))) 	
Parameters:
@ProcessingState79[String] = Finishing
@DistributionTime80[DateTime] = 2020/7/13 0:00:00


-----------------------------------------------------------------------------
2020-07-13 09:52:08
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:52:08
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode81) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode82))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState83)) 	
Parameters:
@ProcessFactoryCode81[String] = 6386683729561128960
@SiteCode82[String] = 6372921375874657752
@ProcessingState83[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-13 09:52:08
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-13 09:52:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:52:09
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode85) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode86,@WorkAreaCode87))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus88) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth89))) 	
Parameters:
@ProcessFactoryCode85[String] = 6386683729561128960
@WorkAreaCode86[String] = 6372921396045311451
@WorkAreaCode87[String] = 6372921398380745033
@Examinestatus88[String] = 审核完成
@DemandMonth89[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 09:52:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:52:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:52:09
Text:	 SELECT   [TbRawMaterialStockRecord].[MaterialCode],sum([TbRawMaterialStockRecord].[UseCount]) AS [UseCount],sum([TbRawMaterialStockRecord].[LockCount]) AS [LockCount] FROM [TbRawMaterialStockRecord] LEFT OUTER JOIN [TbStorage] ON ([TbRawMaterialStockRecord].[StorageCode] = [TbStorage].[StorageCode]) LEFT OUTER JOIN [TbRawMaterialArchives] ON ([TbRawMaterialStockRecord].[MaterialCode] = [TbRawMaterialArchives].[MaterialCode])  WHERE ((([TbStorage].[ProcessFactoryCode] = @ProcessFactoryCode92) AND ([TbRawMaterialStockRecord].[WorkAreaCode] IN (@WorkAreaCode94,@WorkAreaCode95))) AND ([TbRawMaterialArchives].[RebarType] = @RebarType97)) GROUP BY [TbRawMaterialStockRecord].[MaterialCode] 	
Parameters:
@ProcessFactoryCode92[String] = 6386683729561128960
@WorkAreaCode94[String] = 6372921396045311451
@WorkAreaCode95[String] = 6372921398380745033
@RebarType97[String] = BuildingSteel


-----------------------------------------------------------------------------
2020-07-13 09:52:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:52:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:52:09
Text:	 SELECT   [TbRawMaterialStockRecord].[MaterialCode],sum([TbRawMaterialStockRecord].[UseCount]) AS [UseCount],sum([TbRawMaterialStockRecord].[LockCount]) AS [LockCount] FROM [TbRawMaterialStockRecord] LEFT OUTER JOIN [TbStorage] ON ([TbRawMaterialStockRecord].[StorageCode] = [TbStorage].[StorageCode]) LEFT OUTER JOIN [TbRawMaterialArchives] ON ([TbRawMaterialStockRecord].[MaterialCode] = [TbRawMaterialArchives].[MaterialCode])  WHERE ((([TbStorage].[ProcessFactoryCode] = @ProcessFactoryCode101) AND ([TbRawMaterialStockRecord].[WorkAreaCode] IN (@WorkAreaCode103,@WorkAreaCode104))) AND ([TbRawMaterialArchives].[RebarType] = @RebarType106)) GROUP BY [TbRawMaterialStockRecord].[MaterialCode] 	
Parameters:
@ProcessFactoryCode101[String] = 6386683729561128960
@WorkAreaCode103[String] = 6372921396045311451
@WorkAreaCode104[String] = 6372921398380745033
@RebarType106[String] = SectionSteel


-----------------------------------------------------------------------------
2020-07-13 09:52:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:52:09
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode108) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode109,@WorkAreaCode110))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus111) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth112))) 	
Parameters:
@ProcessFactoryCode108[String] = 6386683729561128960
@WorkAreaCode109[String] = 6372921396045311451
@WorkAreaCode110[String] = 6372921398380745033
@Examinestatus111[String] = 审核完成
@DemandMonth112[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 09:52:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:52:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:52:09
Text:	
                        select fewoi.DataCode as OddNumbers,
                         fewoi.EarlyWarningContent,
                         fewoi.EWFormDataCode,
                         CONVERT(varchar(100), fewoi.EarlyWarningTime, 120) as EarlyWarningTime,
                         EWFormCode,sm.MenuName,fn.FlowNodeName,cp1.CompanyFullName as BranchName,
                         cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,
                         u1.UserName as FlowSpUserName,u2.UserName as FlowYjUserName 
                        FROM (
                        select*
                           FROM ( 
                        		SELECT a.*, row_number()over(partition BY a.FlowCode ORDER BY a.FlowNodeCode,a.EarlyWarningTime desc) as group_idx 
                        		FROM TbFlowEarlyWarningOtherInfo  a
                        		INNER JOIN  TbFlowEarlyWarningInfo b ON a.FlowCode=b.FlowCode 
                        		AND a.EWFormDataCode=b.EWFormDataCode AND a.FlowNodeCode=b.FlowNodeCode 
                        		WHERE YEAR(a.EarlyWarningTime)= @Year and MONTH(a.EarlyWarningTime)= @Month AND b.EarlyWarningStart=0
                           ) ret
                        WHERE ret.group_idx =1
                        ) fewoi
                        left join TbFlowNode fn on fewoi.FlowCode=fn.FlowCode and fewoi.FlowNodeCode=fn.FlowNodeCode
                        left join TbSysMenu sm on fewoi.EWFormCode=sm.MenuCode
                        left join TbCompany cp1 on fewoi.BranchCode=cp1.CompanyCode
                        left join TbCompany cp2 on fewoi.WorkAreaCode=cp2.CompanyCode
                        left join TbCompany cp3 on fewoi.SiteCode=cp3.CompanyCode
                        left join TbCompany cp4 on fewoi.ProcessFactoryCode=cp4.CompanyCode
                        left join TbUser u1 on fewoi.FlowSpUserCode=u1.UserId
                        left join TbUser u2 on fewoi.FlowYjUserCode=u2.UserId where 1=1 and fewoi.ProjectId='6372912251695766465' and fewoi.ProcessFactoryCode='6386683729561128960' and (fewoi.SiteCode in('6372921375874657752') or fewoi.WorkAreaCode in('6372921396045311451','6372921398380745033')) ORDER BY fewoi.EarlyWarningTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 09:52:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:52:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:52:09
Text:	--原材料供货超时
                           select BatchPlanNum,cp1.CompanyFullName as BranchName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,sup.SupplyDate,sup.SupplyCompleteTime,sup.ProjectId,sup.Remarks from TbSupplyList sup
                           left join TbCompany cp1 on cp1.CompanyCode=sup.BranchCode
                           left join TbCompany cp2 on cp2.CompanyCode=sup.WorkAreaCode
                           left join TbCompany cp3 on cp3.CompanyCode=sup.SiteCode
                           left join TbCompany cp4 on cp4.CompanyCode=sup.ProcessFactoryCode
                           where YEAR(sup.SupplyDate)= @Year and MONTH(sup.SupplyDate)= @Month
                           and (sup.SupplyCompleteTime>sup.SupplyDate or (GETDATE()>sup.SupplyDate and sup.SupplyCompleteTime is null))  and sup.ProjectId='6372912251695766465' and sup.ProcessFactoryCode='6386683729561128960' and (sup.SiteCode in('6372921375874657752') or sup.WorkAreaCode in('6372921396045311451','6372921398380745033'))	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 09:52:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:52:09
Text:	--配送超期
                           select dpi.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,dpi.DistributionTime,dpi.DeliveryCompleteTime,dpi.Remark from TbDistributionPlanInfo dpi
                           left join TbCompany cp1 on dpi.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on dpi.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(dpi.DistributionTime)= @Year and MONTH(dpi.DistributionTime)= @Month
                           and (dpi.DeliveryCompleteTime>dpi.DistributionTime or (GETDATE()>dpi.DistributionTime and dpi.DeliveryCompleteTime is null))  and dpi.ProjectId='6372912251695766465' and dpi.ProcessFactoryCode='6386683729561128960' and dpi.SiteCode in('6372921375874657752') ORDER BY dpi.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 09:52:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:52:09
Text:	select TbYj.*,cp1.CompanyFullName as SiteName,tcr.EnterSpaceTime,tcr.StartDischargeTime,tcr.EndDischargeTime,disEnt.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SiteDischargeCargo' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbTransportCarReport tcr on TbYj.EWFormDataCode=tcr.DisEntOrderId
                           left join TbDistributionEnt disEnt on tcr.DistributionCode=disEnt.DistributionCode
                           left join TbCompany cp on disEnt.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and disEnt.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ORDER BY tcr.EnterSpaceTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 09:52:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:52:09
Text:	select TbYj.*,cp1.CompanyFullName as SiteName,sfs.DistributionCode,sdc.DistributionTime,sfs.SigninTime,sfs.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SemiFinishedSign' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbSemiFinishedSign sfs on TbYj.EWFormDataCode=sfs.ID
                           left join TbSiteDischargeCargo sdc on sfs.DistributionCode=sdc.DistributionCode and sfs.DischargeCargoCode=sdc.DischargeCargoCode
                           left join TbCompany cp on sfs.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month and TbYj.ProjectId='6372912251695766465' and sfs.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752')	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 09:52:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:52:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:52:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:52:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:52:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:52:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:52:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:52:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:52:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:52:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:52:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:52:09
Text:	SELECT 
                            '审批超时' as YjTypeName,COUNT(1) as YjNum
                            FROM (
									SELECT a.*, row_number()over(partition BY a.FlowCode ORDER BY a.FlowNodeCode,a.EarlyWarningTime desc) as group_idx 
									FROM TbFlowEarlyWarningOtherInfo  a
									INNER JOIN  TbFlowEarlyWarningInfo b ON a.FlowCode=b.FlowCode 
									AND a.EWFormDataCode=b.EWFormDataCode AND a.FlowNodeCode=b.FlowNodeCode 
									WHERE  b.EarlyWarningStart=0 AND YEAR(a.EarlyWarningTime)= @Year and MONTH(a.EarlyWarningTime)= @Month  and a.ProjectId='6372912251695766465' and a.ProcessFactoryCode='6386683729561128960' and (a.SiteCode in('6372921375874657752') or a.WorkAreaCode in('6372921396045311451','6372921398380745033'))
							   ) Tb1
                            WHERE Tb1.group_idx =1
                           union all
                            select '未报月度需求计划' as YjTypeName,COUNT(1)as YjNum
                             FROM ( 
                                  SELECT *, row_number()over(partition BY EarlyWarningCode,EWFormDataCode ORDER BY EWNodeCode,EWTime desc) as group_idx 
                                  FROM TbFormEarlyWarningNodeInfo fwqi
                                  WHERE fwqi.MenuCode='RawMonthDemandPlan' AND fwqi.EWStart=0 AND YEAR(fwqi.EWTime)= @Year and MONTH(fwqi.EWTime)= @Month  and fwqi.ProjectId='6372912251695766465' and (fwqi.SiteCode in('6372921375874657752') or fwqi.WorkArea in('6372921396045311451','6372921398380745033'))  
                             ) Tb2
                             WHERE Tb2.group_idx =1
                           union all
                           select '原材料供货超时' as YjTypeName,COUNT(1) as YjNum from (
                           select BatchPlanNum,cp1.CompanyFullName as BranchName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,sup.SupplyDate,sup.SupplyCompleteTime,sup.ProjectId from TbSupplyList sup
                           left join TbCompany cp1 on cp1.CompanyCode=sup.BranchCode
                           left join TbCompany cp2 on cp2.CompanyCode=sup.WorkAreaCode
                           left join TbCompany cp3 on cp3.CompanyCode=sup.SiteCode
                           left join TbCompany cp4 on cp4.CompanyCode=sup.ProcessFactoryCode
                           where (sup.SupplyCompleteTime>sup.SupplyDate or (GETDATE()>sup.SupplyDate and sup.SupplyCompleteTime is null))
						   and YEAR(sup.SupplyDate)= @Year and MONTH(sup.SupplyDate)= @Month  and sup.ProjectId='6372912251695766465' and sup.ProcessFactoryCode='6386683729561128960' and (sup.SiteCode in('6372921375874657752') or sup.WorkAreaCode in('6372921396045311451','6372921398380745033'))) Tb3
                           union all
                           select '加急订单' as YjTypeName,COUNT(1) as YjNum from (--加急订单个数
                           select wo.OrderCode,wo.DistributionTime,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName from TbWorkOrder wo
                           left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on wo.ProcessFactoryCode=cp2.CompanyCode
                           where UrgentDegree='Urgent' 
						   and YEAR(wo.DistributionTime)= @Year and MONTH(wo.DistributionTime)= @Month  and wo.ProjectId='6372912251695766465' and wo.ProcessFactoryCode='6386683729561128960' and wo.SiteCode in('6372921375874657752') ) Tb4
                           union all
                           select '加工进度滞后' as YjTypeName,COUNT(1) as YjNum from (--加工进度滞后
                           select op.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,op.DistributionTime,op.FinishProcessingDateTime from TbOrderProgress op 
                           left join TbCompany cp1 on op.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on op.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(op.DistributionTime)= @Year and MONTH(op.DistributionTime)= @Month
                           and (op.FinishProcessingDateTime>op.DistributionTime or (GETDATE()>op.DistributionTime and op.FinishProcessingDateTime is null))  and op.ProjectId='6372912251695766465' and op.ProcessFactoryCode='6386683729561128960' and op.SiteCode in('6372921375874657752') ) Tb5
                           union all
                           select '接收配送超期' as YjTypeName,COUNT(1) as YjNum from (--配送超期
                           select dpi.OrderCode,cp1.CompanyFullName as SIteName,cp2.CompanyFullName as ProcessFactoryName,dpi.DistributionTime,dpi.DeliveryCompleteTime from TbDistributionPlanInfo dpi
                           left join TbCompany cp1 on dpi.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on dpi.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(dpi.DistributionTime)= @Year and MONTH(dpi.DistributionTime)= @Month
                           and (dpi.DeliveryCompleteTime>dpi.DistributionTime or (GETDATE()>dpi.DistributionTime and dpi.DeliveryCompleteTime is null))  and dpi.ProjectId='6372912251695766465' and dpi.ProcessFactoryCode='6386683729561128960' and dpi.SiteCode in('6372921375874657752') ) Tb6 
                           union all
                           select '卸货超时' as YjTypeName,COUNT(1) as YjNum from(--卸货超时
                           select TbYj.*,cp1.CompanyFullName as SiteName,tcr.EnterSpaceTime,tcr.StartDischargeTime,tcr.EndDischargeTime,disEnt.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SiteDischargeCargo' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbTransportCarReport tcr on TbYj.EWFormDataCode=tcr.DisEntOrderId
                           left join TbDistributionEnt disEnt on tcr.DistributionCode=disEnt.DistributionCode
                           left join TbCompany cp on disEnt.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and disEnt.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ) Tb7
                           union all
                           select '签收超时' as YjTypeName,COUNT(1) as YjNum from (select TbYj.*,cp1.CompanyFullName as SiteName,sfs.DistributionCode,sdc.DistributionTime,sfs.SigninTime,sfs.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SemiFinishedSign' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbSemiFinishedSign sfs on TbYj.EWFormDataCode=sfs.ID
                           left join TbSiteDischargeCargo sdc on sfs.DistributionCode=sdc.DistributionCode and sfs.DischargeCargoCode=sdc.DischargeCargoCode
                           left join TbCompany cp on sfs.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and sfs.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ) Tb8	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 09:52:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:52:09
Text:	--加工进度滞后
                           select op.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,op.DistributionTime,op.FinishProcessingDateTime from TbOrderProgress op 
                           left join TbCompany cp1 on op.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on op.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(op.DistributionTime)= @Year and MONTH(op.DistributionTime)= @Month
                           and (op.FinishProcessingDateTime>op.DistributionTime or (GETDATE()>op.DistributionTime and op.FinishProcessingDateTime is null))  and op.ProjectId='6372912251695766465' and op.ProcessFactoryCode='6386683729561128960' and op.SiteCode in('6372921375874657752') ORDER BY op.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 09:52:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:52:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:52:10
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode115) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode116))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState117)) 	
Parameters:
@ProcessFactoryCode115[String] = 6386683729561128960
@SiteCode116[String] = 6372921375874657752
@ProcessingState117[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-13 09:52:10
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-13 09:52:10
Text:	 SELECT   [TbOrderProgress].[ProcessingState],[TbOrderProgress].[OrderCode],[TbOrderProgress].[FinishProcessingDateTime],[TbOrderProgress].[DistributionTime],[TbOrderProgress].[SiteCode] FROM [TbOrderProgress]  WHERE ((([TbOrderProgress].[SiteCode] IN (@SiteCode113)) AND ([TbOrderProgress].[ProcessFactoryCode] = @ProcessFactoryCode114)) AND ((YEAR(DistributionTime)=2020 and MONTH(DistributionTime)=7) or (DistributionTime<'2020/7/1 0:00:00' and (ProcessingState!='Finishing')))) 	
Parameters:
@SiteCode113[String] = 6372921375874657752
@ProcessFactoryCode114[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-13 09:52:10
Text:	 SELECT   * FROM [TbWorkOrderDetail]  WHERE (1=2) AND ([TbWorkOrderDetail].[DaetailWorkStrat] = @DaetailWorkStrat118) 	
Parameters:
@DaetailWorkStrat118[String] = 未加工


-----------------------------------------------------------------------------
2020-07-13 09:52:10
Text:	 SELECT   [TbOrderProgress].[WeightTotal] AS [TotalWeight],[TbCompany].[ParentCompanyCode] FROM [TbOrderProgress] LEFT OUTER JOIN [TbCompany] ON ([TbOrderProgress].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((1=2) AND ([TbOrderProgress].[ProcessingState] <> @ProcessingState119)) AND ((([TbOrderProgress].[FinishProcessingDateTime] is not null ) AND ([TbOrderProgress].[DistributionTime] < [TbOrderProgress].[FinishProcessingDateTime])) OR (([TbOrderProgress].[FinishProcessingDateTime] is null ) AND ([TbOrderProgress].[DistributionTime] < @DistributionTime120)))) 	
Parameters:
@ProcessingState119[String] = Finishing
@DistributionTime120[DateTime] = 2020/7/13 0:00:00


-----------------------------------------------------------------------------
2020-07-13 09:52:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:52:10
Text:	--加急订单个数
                           select wo.OrderCode,wo.DistributionTime,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName from TbWorkOrder wo
                           left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on wo.ProcessFactoryCode=cp2.CompanyCode
                           where UrgentDegree='Urgent'
                           and YEAR(wo.DistributionTime)= @Year and MONTH(wo.DistributionTime)= @Month  and wo.ProjectId='6372912251695766465' and wo.ProcessFactoryCode='6386683729561128960' and wo.SiteCode in('6372921375874657752')  ORDER BY wo.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 09:52:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:52:10
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode121) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode122,@WorkAreaCode123))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus124) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth125))) 	
Parameters:
@ProcessFactoryCode121[String] = 6386683729561128960
@WorkAreaCode122[String] = 6372921396045311451
@WorkAreaCode123[String] = 6372921398380745033
@Examinestatus124[String] = 审核完成
@DemandMonth125[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 09:52:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:52:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:52:10
Text:	SELECT sm.MenuName,fwqi.EWContent,fwqi.EWUserCode,u.UserName,fwqi.EWFormDataCode,cp1.CompanyFullName as  FbName,cp2.CompanyFullName as GqName,fwqi.EWTime,sdd.DictionaryText as RebarType  
                   FROM (  
                    select ret.*
                    FROM ( 
                         SELECT *, row_number()over(partition BY EarlyWarningCode,EWFormDataCode ORDER BY EWNodeCode,EWTime desc) as group_idx 
                         FROM TbFormEarlyWarningNodeInfo fwqi
                         WHERE YEAR(fwqi.EWTime)= @Year and MONTH(fwqi.EWTime)= @Month AND fwqi.MenuCode='RawMonthDemandPlan' AND fwqi.EWStart=0
                    ) ret
                    WHERE ret.group_idx = 1
                   ) fwqi
                    left join TbSysMenu sm on fwqi.MenuCode=sm.MenuCode
                            left join TbCompany cp1 on fwqi.CompanyCode=cp1.CompanyCode
                            left join TbCompany cp2 on fwqi.WorkArea=cp2.CompanyCode
                            left join TbCompany cp3 on fwqi.SiteCode=cp3.CompanyCode
                            left join TbUser u on fwqi.EWUserCode=u.UserId
                            left join TbRawMaterialMonthDemandPlan rmp on fwqi.EWFormDataCode=rmp.ID
                            left join TbSysDictionaryData sdd on sdd.DictionaryCode=rmp.RebarType
                    where 1=1 and fwqi.ProjectId='6372912251695766465' and (fwqi.SiteCode in('6372921375874657752') or fwqi.WorkArea in('6372921396045311451','6372921398380745033')) ORDER BY fwqi.EWTime DESC	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 09:52:14
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 09:52:14
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-13 09:52:14
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 09:52:14
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 09:52:15
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 09:52:15
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-13 09:52:15
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 09:52:15
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:52:15
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:52:15
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 09:52:15
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 09:52:15
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 09:52:15
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:52:15
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:52:15
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 09:52:16
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 09:52:16
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 09:52:21
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:52:21
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:52:21
Text:	select 
                           a.RootNumber,
                           a.SizeSelection,
                           a.MaterialCode,
                           a.WeightSmallPlanN,
                           b.MaterialName,
                           b.SpecificationModel,
                           b.MeasurementUnitZl,
                           c.CompanyFullName StartSiteName,
                           d.CompanyFullName EndSiteName
                           from 
                           (
                           select 
                           a.MaterialCode,
                           a.Size as SizeSelection,
                           a.StartSiteCode,
                           a.EndSiteCode,
                           sum(a.Number) RootNumber,
                           sum(a.Weight) WeightSmallPlanN
                           from TbCloutStockPlace a
                           left join TbRMProductionMaterial rmpm on a.CollarCode=rmpm.CollarCode
                           where a.State=1 
                           and (ISNULL(@ProjectId,'')='' OR a.ProjectId=@ProjectId)
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                            and a.EndSiteCode in('6372921375874657752')
                           group by a.MaterialCode,a.Size,a.StartSiteCode,a.EndSiteCode
                           ) a
                           left join TbRawMaterialArchives b on a.MaterialCode=b.MaterialCode
                           left join TbCompany c on c.CompanyCode=a.StartSiteCode
                           left join TbCompany d on d.CompanyCode=a.EndSiteCode
                           where 1=1 
                           and (ISNULL(@MaterialName,'')='' or b.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or b.SpecificationModel like '%'+@SpecificationModel+'%')	
Parameters:
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 
@BegTime[DateTime] = 
@EndTime[DateTime] = 


-----------------------------------------------------------------------------
2020-07-13 09:52:21
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode asc)AS Row, * from (select 
                           a.RootNumber,
                           a.SizeSelection,
                           a.MaterialCode,
                           a.WeightSmallPlanN,
                           b.MaterialName,
                           b.SpecificationModel,
                           b.MeasurementUnitZl,
                           c.CompanyFullName StartSiteName,
                           d.CompanyFullName EndSiteName
                           from 
                           (
                           select 
                           a.MaterialCode,
                           a.Size as SizeSelection,
                           a.StartSiteCode,
                           a.EndSiteCode,
                           sum(a.Number) RootNumber,
                           sum(a.Weight) WeightSmallPlanN
                           from TbCloutStockPlace a
                           left join TbRMProductionMaterial rmpm on a.CollarCode=rmpm.CollarCode
                           where a.State=1 
                           and (ISNULL(@ProjectId,'')='' OR a.ProjectId=@ProjectId)
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                            and a.EndSiteCode in('6372921375874657752')
                           group by a.MaterialCode,a.Size,a.StartSiteCode,a.EndSiteCode
                           ) a
                           left join TbRawMaterialArchives b on a.MaterialCode=b.MaterialCode
                           left join TbCompany c on c.CompanyCode=a.StartSiteCode
                           left join TbCompany d on d.CompanyCode=a.EndSiteCode
                           where 1=1 
                           and (ISNULL(@MaterialName,'')='' or b.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or b.SpecificationModel like '%'+@SpecificationModel+'%')) as a)  SELECT * FROM temptbl where Row between 1 and 50	
Parameters:
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 
@BegTime[DateTime] = 
@EndTime[DateTime] = 


-----------------------------------------------------------------------------
2020-07-13 09:52:46
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:52:46
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:52:46
Text:	select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 09:52:46
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 09:52:46
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='BuildingSteel'	


-----------------------------------------------------------------------------
2020-07-13 09:52:46
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='SectionSteel'	


-----------------------------------------------------------------------------
2020-07-13 09:52:47
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)	


-----------------------------------------------------------------------------
2020-07-13 09:52:47
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 09:52:47
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)	


-----------------------------------------------------------------------------
2020-07-13 09:52:47
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 09:53:02
Text:	select tsm.* from TbRoleMenu tum
                           left join TbSysMenu tsm on tum.MenuCode=tsm.MenuCode
                           where tsm.IsShow=0 and tsm.MenuType='PC' and tum.RoleCode in('6372919444627396738','6372919451594895243') order by tsm.Sort asc	


-----------------------------------------------------------------------------
2020-07-13 09:53:02
Text:	select 
                        	tsm.*
                        from TbUserMenu tum
                        left join TbSysMenu tsm on tum.MenuCode=tsm.MenuCode
                        where tsm.IsShow=0 and tsm.MenuType='PC' and tum.UserCode=@userCode order by tsm.Sort asc	
Parameters:
@userCode[String] = 6372930471544160074


-----------------------------------------------------------------------------
2020-07-13 09:53:02
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 09:53:02
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 09:53:02
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 09:53:02
Text:	select isnull(sum(TbCF.Capacity),0) as Capacity,isnull(sum(TbCF.WeightSmallPlan),0) as WeightSmallPlan,isnull(cast(sum(TbCF.WeightSmallPlan)/sum(TbCF.Capacity)*100 as decimal(18,2)),0) as ActualLoadNew from (select cf.Capacity,Tb1.WeightSmallPlan,cf.ProcessFactoryCode from TbCapacityFilling cf  
left join(
select SUM(Tb.WeightSmallPlan) as WeightSmallPlan,Tb.ProcessFactoryCode from (
                            select isnull(SUM(wod.WeightSmallPlan),0) as WeightSmallPlan,wo.ProcessFactoryCode from TbWorkOrder wo
                            left join TbWorkOrderDetail wod on wo.OrderCode=wod.OrderCode
                            where (ISNULL(@ProcessFactoryCode,'')='' or wo.ProcessFactoryCode=@ProcessFactoryCode)
                            and CONVERT(varchar(7), wo.DistributionTime, 120)=@month
                            and wod.RevokeStart='正常' and wo.ProcessingState!='ConfirmWork' and wo.ProcessingState!='Finishing'  group by wo.ProcessFactoryCode
                            union all
                            select isnull(sum(opd.NoCompleted),0) as NoCompleted,op.ProcessFactoryCode from TbOrderProgress op
                            left join TbOrderProgressDetail opd on op.OrderCode=opd.OrderCode 
                            where (ISNULL(@ProcessFactoryCode,'')='' or op.ProcessFactoryCode=@ProcessFactoryCode)
                            and CONVERT(varchar(7), op.DistributionTime, 120)=CONVERT(varchar(4),YEAR(DATEADD(MONTH,-1,@month+'-01')))+'-'+Right(100+Month(DATEADD(MONTH,-1,@month+'-01')),2)
                            and opd.RevokeStart='正常'  group by op.ProcessFactoryCode)Tb  group by Tb.ProcessFactoryCode
) Tb1 on cf.ProcessFactoryCode=Tb1.ProcessFactoryCode 
where cf.CapacityMonth=@month
and (ISNULL(@ProcessFactoryCode,'')='' or cf.ProcessFactoryCode=@ProcessFactoryCode)) TbCF where (ISNULL(@ProcessFactoryCode,'')='' or TbCF.ProcessFactoryCode=@ProcessFactoryCode)	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@month[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 09:53:03
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:53:03
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode126) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode127,@WorkAreaCode128))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus129) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth130))) 	
Parameters:
@ProcessFactoryCode126[String] = 6386683729561128960
@WorkAreaCode127[String] = 6372921396045311451
@WorkAreaCode128[String] = 6372921398380745033
@Examinestatus129[String] = 审核完成
@DemandMonth130[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 09:53:03
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 09:53:03
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 09:53:03
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:53:03
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:53:03
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode133) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode134))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState135)) 	
Parameters:
@ProcessFactoryCode133[String] = 6386683729561128960
@SiteCode134[String] = 6372921375874657752
@ProcessingState135[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-13 09:53:03
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-13 09:53:03
Text:	 SELECT   [TbOrderProgress].[ProcessingState],[TbOrderProgress].[OrderCode],[TbOrderProgress].[FinishProcessingDateTime],[TbOrderProgress].[DistributionTime],[TbOrderProgress].[SiteCode] FROM [TbOrderProgress]  WHERE ((([TbOrderProgress].[SiteCode] IN (@SiteCode131)) AND ([TbOrderProgress].[ProcessFactoryCode] = @ProcessFactoryCode132)) AND ((YEAR(DistributionTime)=2020 and MONTH(DistributionTime)=7) or (DistributionTime<'2020/7/1 0:00:00' and (ProcessingState!='Finishing')))) 	
Parameters:
@SiteCode131[String] = 6372921375874657752
@ProcessFactoryCode132[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-13 09:53:03
Text:	 SELECT   * FROM [TbWorkOrderDetail]  WHERE (1=2) AND ([TbWorkOrderDetail].[DaetailWorkStrat] = @DaetailWorkStrat136) 	
Parameters:
@DaetailWorkStrat136[String] = 未加工


-----------------------------------------------------------------------------
2020-07-13 09:53:03
Text:	 SELECT   [TbOrderProgress].[WeightTotal] AS [TotalWeight],[TbCompany].[ParentCompanyCode] FROM [TbOrderProgress] LEFT OUTER JOIN [TbCompany] ON ([TbOrderProgress].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((1=2) AND ([TbOrderProgress].[ProcessingState] <> @ProcessingState137)) AND ((([TbOrderProgress].[FinishProcessingDateTime] is not null ) AND ([TbOrderProgress].[DistributionTime] < [TbOrderProgress].[FinishProcessingDateTime])) OR (([TbOrderProgress].[FinishProcessingDateTime] is null ) AND ([TbOrderProgress].[DistributionTime] < @DistributionTime138)))) 	
Parameters:
@ProcessingState137[String] = Finishing
@DistributionTime138[DateTime] = 2020/7/13 0:00:00


-----------------------------------------------------------------------------
2020-07-13 09:53:03
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:53:03
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode139) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode140))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState141)) 	
Parameters:
@ProcessFactoryCode139[String] = 6386683729561128960
@SiteCode140[String] = 6372921375874657752
@ProcessingState141[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-13 09:53:03
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-13 09:53:04
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:53:04
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode143) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode144,@WorkAreaCode145))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus146) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth147))) 	
Parameters:
@ProcessFactoryCode143[String] = 6386683729561128960
@WorkAreaCode144[String] = 6372921396045311451
@WorkAreaCode145[String] = 6372921398380745033
@Examinestatus146[String] = 审核完成
@DemandMonth147[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 09:53:04
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:53:04
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:53:04
Text:	 SELECT   [TbRawMaterialStockRecord].[MaterialCode],sum([TbRawMaterialStockRecord].[UseCount]) AS [UseCount],sum([TbRawMaterialStockRecord].[LockCount]) AS [LockCount] FROM [TbRawMaterialStockRecord] LEFT OUTER JOIN [TbStorage] ON ([TbRawMaterialStockRecord].[StorageCode] = [TbStorage].[StorageCode]) LEFT OUTER JOIN [TbRawMaterialArchives] ON ([TbRawMaterialStockRecord].[MaterialCode] = [TbRawMaterialArchives].[MaterialCode])  WHERE ((([TbStorage].[ProcessFactoryCode] = @ProcessFactoryCode150) AND ([TbRawMaterialStockRecord].[WorkAreaCode] IN (@WorkAreaCode152,@WorkAreaCode153))) AND ([TbRawMaterialArchives].[RebarType] = @RebarType155)) GROUP BY [TbRawMaterialStockRecord].[MaterialCode] 	
Parameters:
@ProcessFactoryCode150[String] = 6386683729561128960
@WorkAreaCode152[String] = 6372921396045311451
@WorkAreaCode153[String] = 6372921398380745033
@RebarType155[String] = BuildingSteel


-----------------------------------------------------------------------------
2020-07-13 09:53:04
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:53:04
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:53:04
Text:	 SELECT   [TbRawMaterialStockRecord].[MaterialCode],sum([TbRawMaterialStockRecord].[UseCount]) AS [UseCount],sum([TbRawMaterialStockRecord].[LockCount]) AS [LockCount] FROM [TbRawMaterialStockRecord] LEFT OUTER JOIN [TbStorage] ON ([TbRawMaterialStockRecord].[StorageCode] = [TbStorage].[StorageCode]) LEFT OUTER JOIN [TbRawMaterialArchives] ON ([TbRawMaterialStockRecord].[MaterialCode] = [TbRawMaterialArchives].[MaterialCode])  WHERE ((([TbStorage].[ProcessFactoryCode] = @ProcessFactoryCode159) AND ([TbRawMaterialStockRecord].[WorkAreaCode] IN (@WorkAreaCode161,@WorkAreaCode162))) AND ([TbRawMaterialArchives].[RebarType] = @RebarType164)) GROUP BY [TbRawMaterialStockRecord].[MaterialCode] 	
Parameters:
@ProcessFactoryCode159[String] = 6386683729561128960
@WorkAreaCode161[String] = 6372921396045311451
@WorkAreaCode162[String] = 6372921398380745033
@RebarType164[String] = SectionSteel


-----------------------------------------------------------------------------
2020-07-13 09:53:04
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:53:04
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode166) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode167,@WorkAreaCode168))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus169) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth170))) 	
Parameters:
@ProcessFactoryCode166[String] = 6386683729561128960
@WorkAreaCode167[String] = 6372921396045311451
@WorkAreaCode168[String] = 6372921398380745033
@Examinestatus169[String] = 审核完成
@DemandMonth170[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 09:53:04
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:53:04
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:53:04
Text:	
                        select fewoi.DataCode as OddNumbers,
                         fewoi.EarlyWarningContent,
                         fewoi.EWFormDataCode,
                         CONVERT(varchar(100), fewoi.EarlyWarningTime, 120) as EarlyWarningTime,
                         EWFormCode,sm.MenuName,fn.FlowNodeName,cp1.CompanyFullName as BranchName,
                         cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,
                         u1.UserName as FlowSpUserName,u2.UserName as FlowYjUserName 
                        FROM (
                        select*
                           FROM ( 
                        		SELECT a.*, row_number()over(partition BY a.FlowCode ORDER BY a.FlowNodeCode,a.EarlyWarningTime desc) as group_idx 
                        		FROM TbFlowEarlyWarningOtherInfo  a
                        		INNER JOIN  TbFlowEarlyWarningInfo b ON a.FlowCode=b.FlowCode 
                        		AND a.EWFormDataCode=b.EWFormDataCode AND a.FlowNodeCode=b.FlowNodeCode 
                        		WHERE YEAR(a.EarlyWarningTime)= @Year and MONTH(a.EarlyWarningTime)= @Month AND b.EarlyWarningStart=0
                           ) ret
                        WHERE ret.group_idx =1
                        ) fewoi
                        left join TbFlowNode fn on fewoi.FlowCode=fn.FlowCode and fewoi.FlowNodeCode=fn.FlowNodeCode
                        left join TbSysMenu sm on fewoi.EWFormCode=sm.MenuCode
                        left join TbCompany cp1 on fewoi.BranchCode=cp1.CompanyCode
                        left join TbCompany cp2 on fewoi.WorkAreaCode=cp2.CompanyCode
                        left join TbCompany cp3 on fewoi.SiteCode=cp3.CompanyCode
                        left join TbCompany cp4 on fewoi.ProcessFactoryCode=cp4.CompanyCode
                        left join TbUser u1 on fewoi.FlowSpUserCode=u1.UserId
                        left join TbUser u2 on fewoi.FlowYjUserCode=u2.UserId where 1=1 and fewoi.ProjectId='6372912251695766465' and fewoi.ProcessFactoryCode='6386683729561128960' and (fewoi.SiteCode in('6372921375874657752') or fewoi.WorkAreaCode in('6372921396045311451','6372921398380745033')) ORDER BY fewoi.EarlyWarningTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 09:53:04
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:53:04
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:53:04
Text:	--原材料供货超时
                           select BatchPlanNum,cp1.CompanyFullName as BranchName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,sup.SupplyDate,sup.SupplyCompleteTime,sup.ProjectId,sup.Remarks from TbSupplyList sup
                           left join TbCompany cp1 on cp1.CompanyCode=sup.BranchCode
                           left join TbCompany cp2 on cp2.CompanyCode=sup.WorkAreaCode
                           left join TbCompany cp3 on cp3.CompanyCode=sup.SiteCode
                           left join TbCompany cp4 on cp4.CompanyCode=sup.ProcessFactoryCode
                           where YEAR(sup.SupplyDate)= @Year and MONTH(sup.SupplyDate)= @Month
                           and (sup.SupplyCompleteTime>sup.SupplyDate or (GETDATE()>sup.SupplyDate and sup.SupplyCompleteTime is null))  and sup.ProjectId='6372912251695766465' and sup.ProcessFactoryCode='6386683729561128960' and (sup.SiteCode in('6372921375874657752') or sup.WorkAreaCode in('6372921396045311451','6372921398380745033'))	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 09:53:04
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:53:04
Text:	--配送超期
                           select dpi.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,dpi.DistributionTime,dpi.DeliveryCompleteTime,dpi.Remark from TbDistributionPlanInfo dpi
                           left join TbCompany cp1 on dpi.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on dpi.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(dpi.DistributionTime)= @Year and MONTH(dpi.DistributionTime)= @Month
                           and (dpi.DeliveryCompleteTime>dpi.DistributionTime or (GETDATE()>dpi.DistributionTime and dpi.DeliveryCompleteTime is null))  and dpi.ProjectId='6372912251695766465' and dpi.ProcessFactoryCode='6386683729561128960' and dpi.SiteCode in('6372921375874657752') ORDER BY dpi.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 09:53:04
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:53:04
Text:	select TbYj.*,cp1.CompanyFullName as SiteName,tcr.EnterSpaceTime,tcr.StartDischargeTime,tcr.EndDischargeTime,disEnt.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SiteDischargeCargo' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbTransportCarReport tcr on TbYj.EWFormDataCode=tcr.DisEntOrderId
                           left join TbDistributionEnt disEnt on tcr.DistributionCode=disEnt.DistributionCode
                           left join TbCompany cp on disEnt.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and disEnt.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ORDER BY tcr.EnterSpaceTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 09:53:04
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:53:04
Text:	select TbYj.*,cp1.CompanyFullName as SiteName,sfs.DistributionCode,sdc.DistributionTime,sfs.SigninTime,sfs.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SemiFinishedSign' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbSemiFinishedSign sfs on TbYj.EWFormDataCode=sfs.ID
                           left join TbSiteDischargeCargo sdc on sfs.DistributionCode=sdc.DistributionCode and sfs.DischargeCargoCode=sdc.DischargeCargoCode
                           left join TbCompany cp on sfs.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month and TbYj.ProjectId='6372912251695766465' and sfs.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752')	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 09:53:04
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:53:04
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:53:04
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:53:04
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:53:04
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:53:04
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:53:04
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:53:04
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:53:04
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:53:04
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:53:04
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:53:04
Text:	SELECT 
                            '审批超时' as YjTypeName,COUNT(1) as YjNum
                            FROM (
									SELECT a.*, row_number()over(partition BY a.FlowCode ORDER BY a.FlowNodeCode,a.EarlyWarningTime desc) as group_idx 
									FROM TbFlowEarlyWarningOtherInfo  a
									INNER JOIN  TbFlowEarlyWarningInfo b ON a.FlowCode=b.FlowCode 
									AND a.EWFormDataCode=b.EWFormDataCode AND a.FlowNodeCode=b.FlowNodeCode 
									WHERE  b.EarlyWarningStart=0 AND YEAR(a.EarlyWarningTime)= @Year and MONTH(a.EarlyWarningTime)= @Month  and a.ProjectId='6372912251695766465' and a.ProcessFactoryCode='6386683729561128960' and (a.SiteCode in('6372921375874657752') or a.WorkAreaCode in('6372921396045311451','6372921398380745033'))
							   ) Tb1
                            WHERE Tb1.group_idx =1
                           union all
                            select '未报月度需求计划' as YjTypeName,COUNT(1)as YjNum
                             FROM ( 
                                  SELECT *, row_number()over(partition BY EarlyWarningCode,EWFormDataCode ORDER BY EWNodeCode,EWTime desc) as group_idx 
                                  FROM TbFormEarlyWarningNodeInfo fwqi
                                  WHERE fwqi.MenuCode='RawMonthDemandPlan' AND fwqi.EWStart=0 AND YEAR(fwqi.EWTime)= @Year and MONTH(fwqi.EWTime)= @Month  and fwqi.ProjectId='6372912251695766465' and (fwqi.SiteCode in('6372921375874657752') or fwqi.WorkArea in('6372921396045311451','6372921398380745033'))  
                             ) Tb2
                             WHERE Tb2.group_idx =1
                           union all
                           select '原材料供货超时' as YjTypeName,COUNT(1) as YjNum from (
                           select BatchPlanNum,cp1.CompanyFullName as BranchName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,sup.SupplyDate,sup.SupplyCompleteTime,sup.ProjectId from TbSupplyList sup
                           left join TbCompany cp1 on cp1.CompanyCode=sup.BranchCode
                           left join TbCompany cp2 on cp2.CompanyCode=sup.WorkAreaCode
                           left join TbCompany cp3 on cp3.CompanyCode=sup.SiteCode
                           left join TbCompany cp4 on cp4.CompanyCode=sup.ProcessFactoryCode
                           where (sup.SupplyCompleteTime>sup.SupplyDate or (GETDATE()>sup.SupplyDate and sup.SupplyCompleteTime is null))
						   and YEAR(sup.SupplyDate)= @Year and MONTH(sup.SupplyDate)= @Month  and sup.ProjectId='6372912251695766465' and sup.ProcessFactoryCode='6386683729561128960' and (sup.SiteCode in('6372921375874657752') or sup.WorkAreaCode in('6372921396045311451','6372921398380745033'))) Tb3
                           union all
                           select '加急订单' as YjTypeName,COUNT(1) as YjNum from (--加急订单个数
                           select wo.OrderCode,wo.DistributionTime,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName from TbWorkOrder wo
                           left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on wo.ProcessFactoryCode=cp2.CompanyCode
                           where UrgentDegree='Urgent' 
						   and YEAR(wo.DistributionTime)= @Year and MONTH(wo.DistributionTime)= @Month  and wo.ProjectId='6372912251695766465' and wo.ProcessFactoryCode='6386683729561128960' and wo.SiteCode in('6372921375874657752') ) Tb4
                           union all
                           select '加工进度滞后' as YjTypeName,COUNT(1) as YjNum from (--加工进度滞后
                           select op.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,op.DistributionTime,op.FinishProcessingDateTime from TbOrderProgress op 
                           left join TbCompany cp1 on op.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on op.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(op.DistributionTime)= @Year and MONTH(op.DistributionTime)= @Month
                           and (op.FinishProcessingDateTime>op.DistributionTime or (GETDATE()>op.DistributionTime and op.FinishProcessingDateTime is null))  and op.ProjectId='6372912251695766465' and op.ProcessFactoryCode='6386683729561128960' and op.SiteCode in('6372921375874657752') ) Tb5
                           union all
                           select '接收配送超期' as YjTypeName,COUNT(1) as YjNum from (--配送超期
                           select dpi.OrderCode,cp1.CompanyFullName as SIteName,cp2.CompanyFullName as ProcessFactoryName,dpi.DistributionTime,dpi.DeliveryCompleteTime from TbDistributionPlanInfo dpi
                           left join TbCompany cp1 on dpi.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on dpi.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(dpi.DistributionTime)= @Year and MONTH(dpi.DistributionTime)= @Month
                           and (dpi.DeliveryCompleteTime>dpi.DistributionTime or (GETDATE()>dpi.DistributionTime and dpi.DeliveryCompleteTime is null))  and dpi.ProjectId='6372912251695766465' and dpi.ProcessFactoryCode='6386683729561128960' and dpi.SiteCode in('6372921375874657752') ) Tb6 
                           union all
                           select '卸货超时' as YjTypeName,COUNT(1) as YjNum from(--卸货超时
                           select TbYj.*,cp1.CompanyFullName as SiteName,tcr.EnterSpaceTime,tcr.StartDischargeTime,tcr.EndDischargeTime,disEnt.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SiteDischargeCargo' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbTransportCarReport tcr on TbYj.EWFormDataCode=tcr.DisEntOrderId
                           left join TbDistributionEnt disEnt on tcr.DistributionCode=disEnt.DistributionCode
                           left join TbCompany cp on disEnt.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and disEnt.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ) Tb7
                           union all
                           select '签收超时' as YjTypeName,COUNT(1) as YjNum from (select TbYj.*,cp1.CompanyFullName as SiteName,sfs.DistributionCode,sdc.DistributionTime,sfs.SigninTime,sfs.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SemiFinishedSign' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbSemiFinishedSign sfs on TbYj.EWFormDataCode=sfs.ID
                           left join TbSiteDischargeCargo sdc on sfs.DistributionCode=sdc.DistributionCode and sfs.DischargeCargoCode=sdc.DischargeCargoCode
                           left join TbCompany cp on sfs.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and sfs.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ) Tb8	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 09:53:04
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:53:05
Text:	--加急订单个数
                           select wo.OrderCode,wo.DistributionTime,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName from TbWorkOrder wo
                           left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on wo.ProcessFactoryCode=cp2.CompanyCode
                           where UrgentDegree='Urgent'
                           and YEAR(wo.DistributionTime)= @Year and MONTH(wo.DistributionTime)= @Month  and wo.ProjectId='6372912251695766465' and wo.ProcessFactoryCode='6386683729561128960' and wo.SiteCode in('6372921375874657752')  ORDER BY wo.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 09:53:05
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:53:05
Text:	--加工进度滞后
                           select op.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,op.DistributionTime,op.FinishProcessingDateTime from TbOrderProgress op 
                           left join TbCompany cp1 on op.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on op.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(op.DistributionTime)= @Year and MONTH(op.DistributionTime)= @Month
                           and (op.FinishProcessingDateTime>op.DistributionTime or (GETDATE()>op.DistributionTime and op.FinishProcessingDateTime is null))  and op.ProjectId='6372912251695766465' and op.ProcessFactoryCode='6386683729561128960' and op.SiteCode in('6372921375874657752') ORDER BY op.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 09:53:05
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:53:05
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode171) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode172,@WorkAreaCode173))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus174) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth175))) 	
Parameters:
@ProcessFactoryCode171[String] = 6386683729561128960
@WorkAreaCode172[String] = 6372921396045311451
@WorkAreaCode173[String] = 6372921398380745033
@Examinestatus174[String] = 审核完成
@DemandMonth175[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 09:53:05
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:53:05
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:53:05
Text:	SELECT sm.MenuName,fwqi.EWContent,fwqi.EWUserCode,u.UserName,fwqi.EWFormDataCode,cp1.CompanyFullName as  FbName,cp2.CompanyFullName as GqName,fwqi.EWTime,sdd.DictionaryText as RebarType  
                   FROM (  
                    select ret.*
                    FROM ( 
                         SELECT *, row_number()over(partition BY EarlyWarningCode,EWFormDataCode ORDER BY EWNodeCode,EWTime desc) as group_idx 
                         FROM TbFormEarlyWarningNodeInfo fwqi
                         WHERE YEAR(fwqi.EWTime)= @Year and MONTH(fwqi.EWTime)= @Month AND fwqi.MenuCode='RawMonthDemandPlan' AND fwqi.EWStart=0
                    ) ret
                    WHERE ret.group_idx = 1
                   ) fwqi
                    left join TbSysMenu sm on fwqi.MenuCode=sm.MenuCode
                            left join TbCompany cp1 on fwqi.CompanyCode=cp1.CompanyCode
                            left join TbCompany cp2 on fwqi.WorkArea=cp2.CompanyCode
                            left join TbCompany cp3 on fwqi.SiteCode=cp3.CompanyCode
                            left join TbUser u on fwqi.EWUserCode=u.UserId
                            left join TbRawMaterialMonthDemandPlan rmp on fwqi.EWFormDataCode=rmp.ID
                            left join TbSysDictionaryData sdd on sdd.DictionaryCode=rmp.RebarType
                    where 1=1 and fwqi.ProjectId='6372912251695766465' and (fwqi.SiteCode in('6372921375874657752') or fwqi.WorkArea in('6372921396045311451','6372921398380745033')) ORDER BY fwqi.EWTime DESC	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 09:53:05
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:53:05
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:53:05
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode178) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode179))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState180)) 	
Parameters:
@ProcessFactoryCode178[String] = 6386683729561128960
@SiteCode179[String] = 6372921375874657752
@ProcessingState180[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-13 09:53:05
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-13 09:53:05
Text:	 SELECT   [TbOrderProgress].[ProcessingState],[TbOrderProgress].[OrderCode],[TbOrderProgress].[FinishProcessingDateTime],[TbOrderProgress].[DistributionTime],[TbOrderProgress].[SiteCode] FROM [TbOrderProgress]  WHERE ((([TbOrderProgress].[SiteCode] IN (@SiteCode176)) AND ([TbOrderProgress].[ProcessFactoryCode] = @ProcessFactoryCode177)) AND ((YEAR(DistributionTime)=2020 and MONTH(DistributionTime)=7) or (DistributionTime<'2020/7/1 0:00:00' and (ProcessingState!='Finishing')))) 	
Parameters:
@SiteCode176[String] = 6372921375874657752
@ProcessFactoryCode177[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-13 09:53:06
Text:	 SELECT   * FROM [TbWorkOrderDetail]  WHERE (1=2) AND ([TbWorkOrderDetail].[DaetailWorkStrat] = @DaetailWorkStrat181) 	
Parameters:
@DaetailWorkStrat181[String] = 未加工


-----------------------------------------------------------------------------
2020-07-13 09:53:06
Text:	 SELECT   [TbOrderProgress].[WeightTotal] AS [TotalWeight],[TbCompany].[ParentCompanyCode] FROM [TbOrderProgress] LEFT OUTER JOIN [TbCompany] ON ([TbOrderProgress].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((1=2) AND ([TbOrderProgress].[ProcessingState] <> @ProcessingState182)) AND ((([TbOrderProgress].[FinishProcessingDateTime] is not null ) AND ([TbOrderProgress].[DistributionTime] < [TbOrderProgress].[FinishProcessingDateTime])) OR (([TbOrderProgress].[FinishProcessingDateTime] is null ) AND ([TbOrderProgress].[DistributionTime] < @DistributionTime183)))) 	
Parameters:
@ProcessingState182[String] = Finishing
@DistributionTime183[DateTime] = 2020/7/13 0:00:00


-----------------------------------------------------------------------------
2020-07-13 09:53:08
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 09:53:08
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-13 09:53:08
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 09:53:08
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 09:53:09
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 09:53:09
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-13 09:53:09
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 09:53:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:53:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:53:09
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 09:53:09
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 09:53:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:53:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:53:09
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 09:53:09
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 09:53:10
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 09:53:10
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 09:53:16
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:53:16
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:53:16
Text:	select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 09:53:16
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 09:53:16
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='BuildingSteel'	


-----------------------------------------------------------------------------
2020-07-13 09:53:16
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='SectionSteel'	


-----------------------------------------------------------------------------
2020-07-13 09:53:17
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)	


-----------------------------------------------------------------------------
2020-07-13 09:53:17
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 09:53:17
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)	


-----------------------------------------------------------------------------
2020-07-13 09:53:17
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 09:53:31
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:53:31
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:53:31
Text:	select 
                           a.RootNumber,
                           a.SizeSelection,
                           a.MaterialCode,
                           a.WeightSmallPlanN,
                           b.MaterialName,
                           b.SpecificationModel,
                           b.MeasurementUnitZl,
                           c.CompanyFullName StartSiteName,
                           d.CompanyFullName EndSiteName
                           from 
                           (
                           select 
                           a.MaterialCode,
                           a.Size as SizeSelection,
                           a.StartSiteCode,
                           a.EndSiteCode,
                           sum(a.Number) RootNumber,
                           sum(a.Weight) WeightSmallPlanN
                           from TbCloutStockPlace a
                           left join TbRMProductionMaterial rmpm on a.CollarCode=rmpm.CollarCode
                           where a.State=1 
                           and (ISNULL(@ProjectId,'')='' OR a.ProjectId=@ProjectId)
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                            and a.EndSiteCode in('6372921375874657752')
                           group by a.MaterialCode,a.Size,a.StartSiteCode,a.EndSiteCode
                           ) a
                           left join TbRawMaterialArchives b on a.MaterialCode=b.MaterialCode
                           left join TbCompany c on c.CompanyCode=a.StartSiteCode
                           left join TbCompany d on d.CompanyCode=a.EndSiteCode
                           where 1=1 
                           and (ISNULL(@MaterialName,'')='' or b.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or b.SpecificationModel like '%'+@SpecificationModel+'%')	
Parameters:
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 
@BegTime[DateTime] = 
@EndTime[DateTime] = 


-----------------------------------------------------------------------------
2020-07-13 09:53:31
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode asc)AS Row, * from (select 
                           a.RootNumber,
                           a.SizeSelection,
                           a.MaterialCode,
                           a.WeightSmallPlanN,
                           b.MaterialName,
                           b.SpecificationModel,
                           b.MeasurementUnitZl,
                           c.CompanyFullName StartSiteName,
                           d.CompanyFullName EndSiteName
                           from 
                           (
                           select 
                           a.MaterialCode,
                           a.Size as SizeSelection,
                           a.StartSiteCode,
                           a.EndSiteCode,
                           sum(a.Number) RootNumber,
                           sum(a.Weight) WeightSmallPlanN
                           from TbCloutStockPlace a
                           left join TbRMProductionMaterial rmpm on a.CollarCode=rmpm.CollarCode
                           where a.State=1 
                           and (ISNULL(@ProjectId,'')='' OR a.ProjectId=@ProjectId)
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                            and a.EndSiteCode in('6372921375874657752')
                           group by a.MaterialCode,a.Size,a.StartSiteCode,a.EndSiteCode
                           ) a
                           left join TbRawMaterialArchives b on a.MaterialCode=b.MaterialCode
                           left join TbCompany c on c.CompanyCode=a.StartSiteCode
                           left join TbCompany d on d.CompanyCode=a.EndSiteCode
                           where 1=1 
                           and (ISNULL(@MaterialName,'')='' or b.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or b.SpecificationModel like '%'+@SpecificationModel+'%')) as a)  SELECT * FROM temptbl where Row between 1 and 50	
Parameters:
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 
@BegTime[DateTime] = 
@EndTime[DateTime] = 


-----------------------------------------------------------------------------
2020-07-13 09:56:02
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 09:58:45
Text:	select tsm.* from TbRoleMenu tum
                           left join TbSysMenu tsm on tum.MenuCode=tsm.MenuCode
                           where tsm.IsShow=0 and tsm.MenuType='PC' and tum.RoleCode in('6372919444627396738','6372919451594895243') order by tsm.Sort asc	


-----------------------------------------------------------------------------
2020-07-13 09:58:45
Text:	select 
                        	tsm.*
                        from TbUserMenu tum
                        left join TbSysMenu tsm on tum.MenuCode=tsm.MenuCode
                        where tsm.IsShow=0 and tsm.MenuType='PC' and tum.UserCode=@userCode order by tsm.Sort asc	
Parameters:
@userCode[String] = 6372930471544160074


-----------------------------------------------------------------------------
2020-07-13 09:58:45
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 09:58:45
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 09:58:45
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 09:58:45
Text:	select isnull(sum(TbCF.Capacity),0) as Capacity,isnull(sum(TbCF.WeightSmallPlan),0) as WeightSmallPlan,isnull(cast(sum(TbCF.WeightSmallPlan)/sum(TbCF.Capacity)*100 as decimal(18,2)),0) as ActualLoadNew from (select cf.Capacity,Tb1.WeightSmallPlan,cf.ProcessFactoryCode from TbCapacityFilling cf  
left join(
select SUM(Tb.WeightSmallPlan) as WeightSmallPlan,Tb.ProcessFactoryCode from (
                            select isnull(SUM(wod.WeightSmallPlan),0) as WeightSmallPlan,wo.ProcessFactoryCode from TbWorkOrder wo
                            left join TbWorkOrderDetail wod on wo.OrderCode=wod.OrderCode
                            where (ISNULL(@ProcessFactoryCode,'')='' or wo.ProcessFactoryCode=@ProcessFactoryCode)
                            and CONVERT(varchar(7), wo.DistributionTime, 120)=@month
                            and wod.RevokeStart='正常' and wo.ProcessingState!='ConfirmWork' and wo.ProcessingState!='Finishing'  group by wo.ProcessFactoryCode
                            union all
                            select isnull(sum(opd.NoCompleted),0) as NoCompleted,op.ProcessFactoryCode from TbOrderProgress op
                            left join TbOrderProgressDetail opd on op.OrderCode=opd.OrderCode 
                            where (ISNULL(@ProcessFactoryCode,'')='' or op.ProcessFactoryCode=@ProcessFactoryCode)
                            and CONVERT(varchar(7), op.DistributionTime, 120)=CONVERT(varchar(4),YEAR(DATEADD(MONTH,-1,@month+'-01')))+'-'+Right(100+Month(DATEADD(MONTH,-1,@month+'-01')),2)
                            and opd.RevokeStart='正常'  group by op.ProcessFactoryCode)Tb  group by Tb.ProcessFactoryCode
) Tb1 on cf.ProcessFactoryCode=Tb1.ProcessFactoryCode 
where cf.CapacityMonth=@month
and (ISNULL(@ProcessFactoryCode,'')='' or cf.ProcessFactoryCode=@ProcessFactoryCode)) TbCF where (ISNULL(@ProcessFactoryCode,'')='' or TbCF.ProcessFactoryCode=@ProcessFactoryCode)	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@month[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 09:58:46
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:58:46
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode184) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode185,@WorkAreaCode186))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus187) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth188))) 	
Parameters:
@ProcessFactoryCode184[String] = 6386683729561128960
@WorkAreaCode185[String] = 6372921396045311451
@WorkAreaCode186[String] = 6372921398380745033
@Examinestatus187[String] = 审核完成
@DemandMonth188[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 09:58:46
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 09:58:46
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 09:58:46
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:58:46
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:58:46
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode191) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode192))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState193)) 	
Parameters:
@ProcessFactoryCode191[String] = 6386683729561128960
@SiteCode192[String] = 6372921375874657752
@ProcessingState193[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-13 09:58:46
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-13 09:58:46
Text:	 SELECT   [TbOrderProgress].[ProcessingState],[TbOrderProgress].[OrderCode],[TbOrderProgress].[FinishProcessingDateTime],[TbOrderProgress].[DistributionTime],[TbOrderProgress].[SiteCode] FROM [TbOrderProgress]  WHERE ((([TbOrderProgress].[SiteCode] IN (@SiteCode189)) AND ([TbOrderProgress].[ProcessFactoryCode] = @ProcessFactoryCode190)) AND ((YEAR(DistributionTime)=2020 and MONTH(DistributionTime)=7) or (DistributionTime<'2020/7/1 0:00:00' and (ProcessingState!='Finishing')))) 	
Parameters:
@SiteCode189[String] = 6372921375874657752
@ProcessFactoryCode190[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-13 09:58:46
Text:	 SELECT   * FROM [TbWorkOrderDetail]  WHERE (1=2) AND ([TbWorkOrderDetail].[DaetailWorkStrat] = @DaetailWorkStrat194) 	
Parameters:
@DaetailWorkStrat194[String] = 未加工


-----------------------------------------------------------------------------
2020-07-13 09:58:46
Text:	 SELECT   [TbOrderProgress].[WeightTotal] AS [TotalWeight],[TbCompany].[ParentCompanyCode] FROM [TbOrderProgress] LEFT OUTER JOIN [TbCompany] ON ([TbOrderProgress].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((1=2) AND ([TbOrderProgress].[ProcessingState] <> @ProcessingState195)) AND ((([TbOrderProgress].[FinishProcessingDateTime] is not null ) AND ([TbOrderProgress].[DistributionTime] < [TbOrderProgress].[FinishProcessingDateTime])) OR (([TbOrderProgress].[FinishProcessingDateTime] is null ) AND ([TbOrderProgress].[DistributionTime] < @DistributionTime196)))) 	
Parameters:
@ProcessingState195[String] = Finishing
@DistributionTime196[DateTime] = 2020/7/13 0:00:00


-----------------------------------------------------------------------------
2020-07-13 09:58:46
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:58:46
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode197) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode198))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState199)) 	
Parameters:
@ProcessFactoryCode197[String] = 6386683729561128960
@SiteCode198[String] = 6372921375874657752
@ProcessingState199[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-13 09:58:46
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-13 09:58:47
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:58:47
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode201) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode202,@WorkAreaCode203))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus204) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth205))) 	
Parameters:
@ProcessFactoryCode201[String] = 6386683729561128960
@WorkAreaCode202[String] = 6372921396045311451
@WorkAreaCode203[String] = 6372921398380745033
@Examinestatus204[String] = 审核完成
@DemandMonth205[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 09:58:47
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:58:47
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:58:47
Text:	 SELECT   [TbRawMaterialStockRecord].[MaterialCode],sum([TbRawMaterialStockRecord].[UseCount]) AS [UseCount],sum([TbRawMaterialStockRecord].[LockCount]) AS [LockCount] FROM [TbRawMaterialStockRecord] LEFT OUTER JOIN [TbStorage] ON ([TbRawMaterialStockRecord].[StorageCode] = [TbStorage].[StorageCode]) LEFT OUTER JOIN [TbRawMaterialArchives] ON ([TbRawMaterialStockRecord].[MaterialCode] = [TbRawMaterialArchives].[MaterialCode])  WHERE ((([TbStorage].[ProcessFactoryCode] = @ProcessFactoryCode208) AND ([TbRawMaterialStockRecord].[WorkAreaCode] IN (@WorkAreaCode210,@WorkAreaCode211))) AND ([TbRawMaterialArchives].[RebarType] = @RebarType213)) GROUP BY [TbRawMaterialStockRecord].[MaterialCode] 	
Parameters:
@ProcessFactoryCode208[String] = 6386683729561128960
@WorkAreaCode210[String] = 6372921396045311451
@WorkAreaCode211[String] = 6372921398380745033
@RebarType213[String] = BuildingSteel


-----------------------------------------------------------------------------
2020-07-13 09:58:47
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:58:47
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:58:47
Text:	 SELECT   [TbRawMaterialStockRecord].[MaterialCode],sum([TbRawMaterialStockRecord].[UseCount]) AS [UseCount],sum([TbRawMaterialStockRecord].[LockCount]) AS [LockCount] FROM [TbRawMaterialStockRecord] LEFT OUTER JOIN [TbStorage] ON ([TbRawMaterialStockRecord].[StorageCode] = [TbStorage].[StorageCode]) LEFT OUTER JOIN [TbRawMaterialArchives] ON ([TbRawMaterialStockRecord].[MaterialCode] = [TbRawMaterialArchives].[MaterialCode])  WHERE ((([TbStorage].[ProcessFactoryCode] = @ProcessFactoryCode217) AND ([TbRawMaterialStockRecord].[WorkAreaCode] IN (@WorkAreaCode219,@WorkAreaCode220))) AND ([TbRawMaterialArchives].[RebarType] = @RebarType222)) GROUP BY [TbRawMaterialStockRecord].[MaterialCode] 	
Parameters:
@ProcessFactoryCode217[String] = 6386683729561128960
@WorkAreaCode219[String] = 6372921396045311451
@WorkAreaCode220[String] = 6372921398380745033
@RebarType222[String] = SectionSteel


-----------------------------------------------------------------------------
2020-07-13 09:58:47
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:58:47
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:58:47
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode226) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode227))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState228)) 	
Parameters:
@ProcessFactoryCode226[String] = 6386683729561128960
@SiteCode227[String] = 6372921375874657752
@ProcessingState228[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-13 09:58:47
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-13 09:58:47
Text:	 SELECT   [TbOrderProgress].[ProcessingState],[TbOrderProgress].[OrderCode],[TbOrderProgress].[FinishProcessingDateTime],[TbOrderProgress].[DistributionTime],[TbOrderProgress].[SiteCode] FROM [TbOrderProgress]  WHERE ((([TbOrderProgress].[SiteCode] IN (@SiteCode224)) AND ([TbOrderProgress].[ProcessFactoryCode] = @ProcessFactoryCode225)) AND ((YEAR(DistributionTime)=2020 and MONTH(DistributionTime)=7) or (DistributionTime<'2020/7/1 0:00:00' and (ProcessingState!='Finishing')))) 	
Parameters:
@SiteCode224[String] = 6372921375874657752
@ProcessFactoryCode225[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-13 09:58:47
Text:	 SELECT   * FROM [TbWorkOrderDetail]  WHERE (1=2) AND ([TbWorkOrderDetail].[DaetailWorkStrat] = @DaetailWorkStrat229) 	
Parameters:
@DaetailWorkStrat229[String] = 未加工


-----------------------------------------------------------------------------
2020-07-13 09:58:47
Text:	 SELECT   [TbOrderProgress].[WeightTotal] AS [TotalWeight],[TbCompany].[ParentCompanyCode] FROM [TbOrderProgress] LEFT OUTER JOIN [TbCompany] ON ([TbOrderProgress].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((1=2) AND ([TbOrderProgress].[ProcessingState] <> @ProcessingState230)) AND ((([TbOrderProgress].[FinishProcessingDateTime] is not null ) AND ([TbOrderProgress].[DistributionTime] < [TbOrderProgress].[FinishProcessingDateTime])) OR (([TbOrderProgress].[FinishProcessingDateTime] is null ) AND ([TbOrderProgress].[DistributionTime] < @DistributionTime231)))) 	
Parameters:
@ProcessingState230[String] = Finishing
@DistributionTime231[DateTime] = 2020/7/13 0:00:00


-----------------------------------------------------------------------------
2020-07-13 09:58:47
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:58:47
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:58:47
Text:	--原材料供货超时
                           select BatchPlanNum,cp1.CompanyFullName as BranchName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,sup.SupplyDate,sup.SupplyCompleteTime,sup.ProjectId,sup.Remarks from TbSupplyList sup
                           left join TbCompany cp1 on cp1.CompanyCode=sup.BranchCode
                           left join TbCompany cp2 on cp2.CompanyCode=sup.WorkAreaCode
                           left join TbCompany cp3 on cp3.CompanyCode=sup.SiteCode
                           left join TbCompany cp4 on cp4.CompanyCode=sup.ProcessFactoryCode
                           where YEAR(sup.SupplyDate)= @Year and MONTH(sup.SupplyDate)= @Month
                           and (sup.SupplyCompleteTime>sup.SupplyDate or (GETDATE()>sup.SupplyDate and sup.SupplyCompleteTime is null))  and sup.ProjectId='6372912251695766465' and sup.ProcessFactoryCode='6386683729561128960' and (sup.SiteCode in('6372921375874657752') or sup.WorkAreaCode in('6372921396045311451','6372921398380745033'))	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 09:58:47
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:58:47
Text:	--加急订单个数
                           select wo.OrderCode,wo.DistributionTime,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName from TbWorkOrder wo
                           left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on wo.ProcessFactoryCode=cp2.CompanyCode
                           where UrgentDegree='Urgent'
                           and YEAR(wo.DistributionTime)= @Year and MONTH(wo.DistributionTime)= @Month  and wo.ProjectId='6372912251695766465' and wo.ProcessFactoryCode='6386683729561128960' and wo.SiteCode in('6372921375874657752')  ORDER BY wo.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 09:58:47
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:58:47
Text:	--加工进度滞后
                           select op.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,op.DistributionTime,op.FinishProcessingDateTime from TbOrderProgress op 
                           left join TbCompany cp1 on op.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on op.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(op.DistributionTime)= @Year and MONTH(op.DistributionTime)= @Month
                           and (op.FinishProcessingDateTime>op.DistributionTime or (GETDATE()>op.DistributionTime and op.FinishProcessingDateTime is null))  and op.ProjectId='6372912251695766465' and op.ProcessFactoryCode='6386683729561128960' and op.SiteCode in('6372921375874657752') ORDER BY op.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 09:58:47
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:58:47
Text:	--配送超期
                           select dpi.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,dpi.DistributionTime,dpi.DeliveryCompleteTime,dpi.Remark from TbDistributionPlanInfo dpi
                           left join TbCompany cp1 on dpi.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on dpi.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(dpi.DistributionTime)= @Year and MONTH(dpi.DistributionTime)= @Month
                           and (dpi.DeliveryCompleteTime>dpi.DistributionTime or (GETDATE()>dpi.DistributionTime and dpi.DeliveryCompleteTime is null))  and dpi.ProjectId='6372912251695766465' and dpi.ProcessFactoryCode='6386683729561128960' and dpi.SiteCode in('6372921375874657752') ORDER BY dpi.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 09:58:47
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:58:47
Text:	select TbYj.*,cp1.CompanyFullName as SiteName,tcr.EnterSpaceTime,tcr.StartDischargeTime,tcr.EndDischargeTime,disEnt.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SiteDischargeCargo' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbTransportCarReport tcr on TbYj.EWFormDataCode=tcr.DisEntOrderId
                           left join TbDistributionEnt disEnt on tcr.DistributionCode=disEnt.DistributionCode
                           left join TbCompany cp on disEnt.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and disEnt.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ORDER BY tcr.EnterSpaceTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 09:58:47
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:58:47
Text:	select TbYj.*,cp1.CompanyFullName as SiteName,sfs.DistributionCode,sdc.DistributionTime,sfs.SigninTime,sfs.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SemiFinishedSign' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbSemiFinishedSign sfs on TbYj.EWFormDataCode=sfs.ID
                           left join TbSiteDischargeCargo sdc on sfs.DistributionCode=sdc.DistributionCode and sfs.DischargeCargoCode=sdc.DischargeCargoCode
                           left join TbCompany cp on sfs.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month and TbYj.ProjectId='6372912251695766465' and sfs.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752')	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 09:58:48
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:58:48
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:58:48
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:58:48
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:58:48
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:58:48
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:58:48
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:58:48
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:58:48
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:58:48
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:58:48
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:58:48
Text:	SELECT 
                            '审批超时' as YjTypeName,COUNT(1) as YjNum
                            FROM (
									SELECT a.*, row_number()over(partition BY a.FlowCode ORDER BY a.FlowNodeCode,a.EarlyWarningTime desc) as group_idx 
									FROM TbFlowEarlyWarningOtherInfo  a
									INNER JOIN  TbFlowEarlyWarningInfo b ON a.FlowCode=b.FlowCode 
									AND a.EWFormDataCode=b.EWFormDataCode AND a.FlowNodeCode=b.FlowNodeCode 
									WHERE  b.EarlyWarningStart=0 AND YEAR(a.EarlyWarningTime)= @Year and MONTH(a.EarlyWarningTime)= @Month  and a.ProjectId='6372912251695766465' and a.ProcessFactoryCode='6386683729561128960' and (a.SiteCode in('6372921375874657752') or a.WorkAreaCode in('6372921396045311451','6372921398380745033'))
							   ) Tb1
                            WHERE Tb1.group_idx =1
                           union all
                            select '未报月度需求计划' as YjTypeName,COUNT(1)as YjNum
                             FROM ( 
                                  SELECT *, row_number()over(partition BY EarlyWarningCode,EWFormDataCode ORDER BY EWNodeCode,EWTime desc) as group_idx 
                                  FROM TbFormEarlyWarningNodeInfo fwqi
                                  WHERE fwqi.MenuCode='RawMonthDemandPlan' AND fwqi.EWStart=0 AND YEAR(fwqi.EWTime)= @Year and MONTH(fwqi.EWTime)= @Month  and fwqi.ProjectId='6372912251695766465' and (fwqi.SiteCode in('6372921375874657752') or fwqi.WorkArea in('6372921396045311451','6372921398380745033'))  
                             ) Tb2
                             WHERE Tb2.group_idx =1
                           union all
                           select '原材料供货超时' as YjTypeName,COUNT(1) as YjNum from (
                           select BatchPlanNum,cp1.CompanyFullName as BranchName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,sup.SupplyDate,sup.SupplyCompleteTime,sup.ProjectId from TbSupplyList sup
                           left join TbCompany cp1 on cp1.CompanyCode=sup.BranchCode
                           left join TbCompany cp2 on cp2.CompanyCode=sup.WorkAreaCode
                           left join TbCompany cp3 on cp3.CompanyCode=sup.SiteCode
                           left join TbCompany cp4 on cp4.CompanyCode=sup.ProcessFactoryCode
                           where (sup.SupplyCompleteTime>sup.SupplyDate or (GETDATE()>sup.SupplyDate and sup.SupplyCompleteTime is null))
						   and YEAR(sup.SupplyDate)= @Year and MONTH(sup.SupplyDate)= @Month  and sup.ProjectId='6372912251695766465' and sup.ProcessFactoryCode='6386683729561128960' and (sup.SiteCode in('6372921375874657752') or sup.WorkAreaCode in('6372921396045311451','6372921398380745033'))) Tb3
                           union all
                           select '加急订单' as YjTypeName,COUNT(1) as YjNum from (--加急订单个数
                           select wo.OrderCode,wo.DistributionTime,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName from TbWorkOrder wo
                           left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on wo.ProcessFactoryCode=cp2.CompanyCode
                           where UrgentDegree='Urgent' 
						   and YEAR(wo.DistributionTime)= @Year and MONTH(wo.DistributionTime)= @Month  and wo.ProjectId='6372912251695766465' and wo.ProcessFactoryCode='6386683729561128960' and wo.SiteCode in('6372921375874657752') ) Tb4
                           union all
                           select '加工进度滞后' as YjTypeName,COUNT(1) as YjNum from (--加工进度滞后
                           select op.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,op.DistributionTime,op.FinishProcessingDateTime from TbOrderProgress op 
                           left join TbCompany cp1 on op.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on op.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(op.DistributionTime)= @Year and MONTH(op.DistributionTime)= @Month
                           and (op.FinishProcessingDateTime>op.DistributionTime or (GETDATE()>op.DistributionTime and op.FinishProcessingDateTime is null))  and op.ProjectId='6372912251695766465' and op.ProcessFactoryCode='6386683729561128960' and op.SiteCode in('6372921375874657752') ) Tb5
                           union all
                           select '接收配送超期' as YjTypeName,COUNT(1) as YjNum from (--配送超期
                           select dpi.OrderCode,cp1.CompanyFullName as SIteName,cp2.CompanyFullName as ProcessFactoryName,dpi.DistributionTime,dpi.DeliveryCompleteTime from TbDistributionPlanInfo dpi
                           left join TbCompany cp1 on dpi.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on dpi.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(dpi.DistributionTime)= @Year and MONTH(dpi.DistributionTime)= @Month
                           and (dpi.DeliveryCompleteTime>dpi.DistributionTime or (GETDATE()>dpi.DistributionTime and dpi.DeliveryCompleteTime is null))  and dpi.ProjectId='6372912251695766465' and dpi.ProcessFactoryCode='6386683729561128960' and dpi.SiteCode in('6372921375874657752') ) Tb6 
                           union all
                           select '卸货超时' as YjTypeName,COUNT(1) as YjNum from(--卸货超时
                           select TbYj.*,cp1.CompanyFullName as SiteName,tcr.EnterSpaceTime,tcr.StartDischargeTime,tcr.EndDischargeTime,disEnt.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SiteDischargeCargo' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbTransportCarReport tcr on TbYj.EWFormDataCode=tcr.DisEntOrderId
                           left join TbDistributionEnt disEnt on tcr.DistributionCode=disEnt.DistributionCode
                           left join TbCompany cp on disEnt.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and disEnt.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ) Tb7
                           union all
                           select '签收超时' as YjTypeName,COUNT(1) as YjNum from (select TbYj.*,cp1.CompanyFullName as SiteName,sfs.DistributionCode,sdc.DistributionTime,sfs.SigninTime,sfs.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SemiFinishedSign' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbSemiFinishedSign sfs on TbYj.EWFormDataCode=sfs.ID
                           left join TbSiteDischargeCargo sdc on sfs.DistributionCode=sdc.DistributionCode and sfs.DischargeCargoCode=sdc.DischargeCargoCode
                           left join TbCompany cp on sfs.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and sfs.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ) Tb8	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 09:58:48
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:58:48
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:58:48
Text:	
                        select fewoi.DataCode as OddNumbers,
                         fewoi.EarlyWarningContent,
                         fewoi.EWFormDataCode,
                         CONVERT(varchar(100), fewoi.EarlyWarningTime, 120) as EarlyWarningTime,
                         EWFormCode,sm.MenuName,fn.FlowNodeName,cp1.CompanyFullName as BranchName,
                         cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,
                         u1.UserName as FlowSpUserName,u2.UserName as FlowYjUserName 
                        FROM (
                        select*
                           FROM ( 
                        		SELECT a.*, row_number()over(partition BY a.FlowCode ORDER BY a.FlowNodeCode,a.EarlyWarningTime desc) as group_idx 
                        		FROM TbFlowEarlyWarningOtherInfo  a
                        		INNER JOIN  TbFlowEarlyWarningInfo b ON a.FlowCode=b.FlowCode 
                        		AND a.EWFormDataCode=b.EWFormDataCode AND a.FlowNodeCode=b.FlowNodeCode 
                        		WHERE YEAR(a.EarlyWarningTime)= @Year and MONTH(a.EarlyWarningTime)= @Month AND b.EarlyWarningStart=0
                           ) ret
                        WHERE ret.group_idx =1
                        ) fewoi
                        left join TbFlowNode fn on fewoi.FlowCode=fn.FlowCode and fewoi.FlowNodeCode=fn.FlowNodeCode
                        left join TbSysMenu sm on fewoi.EWFormCode=sm.MenuCode
                        left join TbCompany cp1 on fewoi.BranchCode=cp1.CompanyCode
                        left join TbCompany cp2 on fewoi.WorkAreaCode=cp2.CompanyCode
                        left join TbCompany cp3 on fewoi.SiteCode=cp3.CompanyCode
                        left join TbCompany cp4 on fewoi.ProcessFactoryCode=cp4.CompanyCode
                        left join TbUser u1 on fewoi.FlowSpUserCode=u1.UserId
                        left join TbUser u2 on fewoi.FlowYjUserCode=u2.UserId where 1=1 and fewoi.ProjectId='6372912251695766465' and fewoi.ProcessFactoryCode='6386683729561128960' and (fewoi.SiteCode in('6372921375874657752') or fewoi.WorkAreaCode in('6372921396045311451','6372921398380745033')) ORDER BY fewoi.EarlyWarningTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 09:58:48
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:58:48
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:58:48
Text:	SELECT sm.MenuName,fwqi.EWContent,fwqi.EWUserCode,u.UserName,fwqi.EWFormDataCode,cp1.CompanyFullName as  FbName,cp2.CompanyFullName as GqName,fwqi.EWTime,sdd.DictionaryText as RebarType  
                   FROM (  
                    select ret.*
                    FROM ( 
                         SELECT *, row_number()over(partition BY EarlyWarningCode,EWFormDataCode ORDER BY EWNodeCode,EWTime desc) as group_idx 
                         FROM TbFormEarlyWarningNodeInfo fwqi
                         WHERE YEAR(fwqi.EWTime)= @Year and MONTH(fwqi.EWTime)= @Month AND fwqi.MenuCode='RawMonthDemandPlan' AND fwqi.EWStart=0
                    ) ret
                    WHERE ret.group_idx = 1
                   ) fwqi
                    left join TbSysMenu sm on fwqi.MenuCode=sm.MenuCode
                            left join TbCompany cp1 on fwqi.CompanyCode=cp1.CompanyCode
                            left join TbCompany cp2 on fwqi.WorkArea=cp2.CompanyCode
                            left join TbCompany cp3 on fwqi.SiteCode=cp3.CompanyCode
                            left join TbUser u on fwqi.EWUserCode=u.UserId
                            left join TbRawMaterialMonthDemandPlan rmp on fwqi.EWFormDataCode=rmp.ID
                            left join TbSysDictionaryData sdd on sdd.DictionaryCode=rmp.RebarType
                    where 1=1 and fwqi.ProjectId='6372912251695766465' and (fwqi.SiteCode in('6372921375874657752') or fwqi.WorkArea in('6372921396045311451','6372921398380745033')) ORDER BY fwqi.EWTime DESC	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 09:58:49
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:58:49
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode232) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode233,@WorkAreaCode234))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus235) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth236))) 	
Parameters:
@ProcessFactoryCode232[String] = 6386683729561128960
@WorkAreaCode233[String] = 6372921396045311451
@WorkAreaCode234[String] = 6372921398380745033
@Examinestatus235[String] = 审核完成
@DemandMonth236[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 09:58:49
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:58:49
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode237) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode238,@WorkAreaCode239))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus240) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth241))) 	
Parameters:
@ProcessFactoryCode237[String] = 6386683729561128960
@WorkAreaCode238[String] = 6372921396045311451
@WorkAreaCode239[String] = 6372921398380745033
@Examinestatus240[String] = 审核完成
@DemandMonth241[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 09:58:52
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 09:58:52
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-13 09:58:52
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 09:58:52
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 09:58:53
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 09:58:53
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-13 09:58:53
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 09:58:53
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:58:53
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:58:53
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 09:58:53
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 09:58:53
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 09:58:53
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:58:53
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:58:53
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 09:58:54
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 09:58:54
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 09:58:59
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:58:59
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:58:59
Text:	select 
                           a.RootNumber,
                           a.SizeSelection,
                           a.MaterialCode,
                           a.WeightSmallPlanN,
                           b.MaterialName,
                           b.SpecificationModel,
                           b.MeasurementUnitZl,
                           c.CompanyFullName StartSiteName,
                           d.CompanyFullName EndSiteName
                           from 
                           (
                           select 
                           a.MaterialCode,
                           a.Size as SizeSelection,
                           a.StartSiteCode,
                           a.EndSiteCode,
                           sum(a.Number) RootNumber,
                           sum(a.Weight) WeightSmallPlanN
                           from TbCloutStockPlace a
                           left join TbRMProductionMaterial rmpm on a.CollarCode=rmpm.CollarCode
                           where a.State=1 
                           and (ISNULL(@ProjectId,'')='' OR a.ProjectId=@ProjectId)
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                            and a.EndSiteCode in('6372921375874657752')
                           group by a.MaterialCode,a.Size,a.StartSiteCode,a.EndSiteCode
                           ) a
                           left join TbRawMaterialArchives b on a.MaterialCode=b.MaterialCode
                           left join TbCompany c on c.CompanyCode=a.StartSiteCode
                           left join TbCompany d on d.CompanyCode=a.EndSiteCode
                           where 1=1 
                           and (ISNULL(@MaterialName,'')='' or b.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or b.SpecificationModel like '%'+@SpecificationModel+'%')	
Parameters:
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 
@BegTime[DateTime] = 
@EndTime[DateTime] = 


-----------------------------------------------------------------------------
2020-07-13 09:58:59
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode asc)AS Row, * from (select 
                           a.RootNumber,
                           a.SizeSelection,
                           a.MaterialCode,
                           a.WeightSmallPlanN,
                           b.MaterialName,
                           b.SpecificationModel,
                           b.MeasurementUnitZl,
                           c.CompanyFullName StartSiteName,
                           d.CompanyFullName EndSiteName
                           from 
                           (
                           select 
                           a.MaterialCode,
                           a.Size as SizeSelection,
                           a.StartSiteCode,
                           a.EndSiteCode,
                           sum(a.Number) RootNumber,
                           sum(a.Weight) WeightSmallPlanN
                           from TbCloutStockPlace a
                           left join TbRMProductionMaterial rmpm on a.CollarCode=rmpm.CollarCode
                           where a.State=1 
                           and (ISNULL(@ProjectId,'')='' OR a.ProjectId=@ProjectId)
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                            and a.EndSiteCode in('6372921375874657752')
                           group by a.MaterialCode,a.Size,a.StartSiteCode,a.EndSiteCode
                           ) a
                           left join TbRawMaterialArchives b on a.MaterialCode=b.MaterialCode
                           left join TbCompany c on c.CompanyCode=a.StartSiteCode
                           left join TbCompany d on d.CompanyCode=a.EndSiteCode
                           where 1=1 
                           and (ISNULL(@MaterialName,'')='' or b.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or b.SpecificationModel like '%'+@SpecificationModel+'%')) as a)  SELECT * FROM temptbl where Row between 1 and 50	
Parameters:
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 
@BegTime[DateTime] = 
@EndTime[DateTime] = 


-----------------------------------------------------------------------------
2020-07-13 09:59:04
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 09:59:04
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 09:59:04
Text:	select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 09:59:04
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 09:59:04
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='BuildingSteel'	


-----------------------------------------------------------------------------
2020-07-13 09:59:04
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='SectionSteel'	


-----------------------------------------------------------------------------
2020-07-13 09:59:04
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)	


-----------------------------------------------------------------------------
2020-07-13 09:59:04
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 09:59:05
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)	


-----------------------------------------------------------------------------
2020-07-13 09:59:05
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 10:01:45
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:03:47
Text:	select tsm.* from TbRoleMenu tum
                           left join TbSysMenu tsm on tum.MenuCode=tsm.MenuCode
                           where tsm.IsShow=0 and tsm.MenuType='PC' and tum.RoleCode in('6372919444627396738','6372919451594895243') order by tsm.Sort asc	


-----------------------------------------------------------------------------
2020-07-13 10:03:47
Text:	select 
                        	tsm.*
                        from TbUserMenu tum
                        left join TbSysMenu tsm on tum.MenuCode=tsm.MenuCode
                        where tsm.IsShow=0 and tsm.MenuType='PC' and tum.UserCode=@userCode order by tsm.Sort asc	
Parameters:
@userCode[String] = 6372930471544160074


-----------------------------------------------------------------------------
2020-07-13 10:03:47
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:03:47
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 10:03:47
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 10:03:47
Text:	select isnull(sum(TbCF.Capacity),0) as Capacity,isnull(sum(TbCF.WeightSmallPlan),0) as WeightSmallPlan,isnull(cast(sum(TbCF.WeightSmallPlan)/sum(TbCF.Capacity)*100 as decimal(18,2)),0) as ActualLoadNew from (select cf.Capacity,Tb1.WeightSmallPlan,cf.ProcessFactoryCode from TbCapacityFilling cf  
left join(
select SUM(Tb.WeightSmallPlan) as WeightSmallPlan,Tb.ProcessFactoryCode from (
                            select isnull(SUM(wod.WeightSmallPlan),0) as WeightSmallPlan,wo.ProcessFactoryCode from TbWorkOrder wo
                            left join TbWorkOrderDetail wod on wo.OrderCode=wod.OrderCode
                            where (ISNULL(@ProcessFactoryCode,'')='' or wo.ProcessFactoryCode=@ProcessFactoryCode)
                            and CONVERT(varchar(7), wo.DistributionTime, 120)=@month
                            and wod.RevokeStart='正常' and wo.ProcessingState!='ConfirmWork' and wo.ProcessingState!='Finishing'  group by wo.ProcessFactoryCode
                            union all
                            select isnull(sum(opd.NoCompleted),0) as NoCompleted,op.ProcessFactoryCode from TbOrderProgress op
                            left join TbOrderProgressDetail opd on op.OrderCode=opd.OrderCode 
                            where (ISNULL(@ProcessFactoryCode,'')='' or op.ProcessFactoryCode=@ProcessFactoryCode)
                            and CONVERT(varchar(7), op.DistributionTime, 120)=CONVERT(varchar(4),YEAR(DATEADD(MONTH,-1,@month+'-01')))+'-'+Right(100+Month(DATEADD(MONTH,-1,@month+'-01')),2)
                            and opd.RevokeStart='正常'  group by op.ProcessFactoryCode)Tb  group by Tb.ProcessFactoryCode
) Tb1 on cf.ProcessFactoryCode=Tb1.ProcessFactoryCode 
where cf.CapacityMonth=@month
and (ISNULL(@ProcessFactoryCode,'')='' or cf.ProcessFactoryCode=@ProcessFactoryCode)) TbCF where (ISNULL(@ProcessFactoryCode,'')='' or TbCF.ProcessFactoryCode=@ProcessFactoryCode)	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@month[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 10:03:47
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:03:47
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode242) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode243,@WorkAreaCode244))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus245) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth246))) 	
Parameters:
@ProcessFactoryCode242[String] = 6386683729561128960
@WorkAreaCode243[String] = 6372921396045311451
@WorkAreaCode244[String] = 6372921398380745033
@Examinestatus245[String] = 审核完成
@DemandMonth246[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 10:03:47
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:03:47
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:03:48
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:03:48
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:03:48
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode249) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode250))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState251)) 	
Parameters:
@ProcessFactoryCode249[String] = 6386683729561128960
@SiteCode250[String] = 6372921375874657752
@ProcessingState251[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-13 10:03:48
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-13 10:03:48
Text:	 SELECT   [TbOrderProgress].[ProcessingState],[TbOrderProgress].[OrderCode],[TbOrderProgress].[FinishProcessingDateTime],[TbOrderProgress].[DistributionTime],[TbOrderProgress].[SiteCode] FROM [TbOrderProgress]  WHERE ((([TbOrderProgress].[SiteCode] IN (@SiteCode247)) AND ([TbOrderProgress].[ProcessFactoryCode] = @ProcessFactoryCode248)) AND ((YEAR(DistributionTime)=2020 and MONTH(DistributionTime)=7) or (DistributionTime<'2020/7/1 0:00:00' and (ProcessingState!='Finishing')))) 	
Parameters:
@SiteCode247[String] = 6372921375874657752
@ProcessFactoryCode248[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-13 10:03:48
Text:	 SELECT   * FROM [TbWorkOrderDetail]  WHERE (1=2) AND ([TbWorkOrderDetail].[DaetailWorkStrat] = @DaetailWorkStrat252) 	
Parameters:
@DaetailWorkStrat252[String] = 未加工


-----------------------------------------------------------------------------
2020-07-13 10:03:48
Text:	 SELECT   [TbOrderProgress].[WeightTotal] AS [TotalWeight],[TbCompany].[ParentCompanyCode] FROM [TbOrderProgress] LEFT OUTER JOIN [TbCompany] ON ([TbOrderProgress].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((1=2) AND ([TbOrderProgress].[ProcessingState] <> @ProcessingState253)) AND ((([TbOrderProgress].[FinishProcessingDateTime] is not null ) AND ([TbOrderProgress].[DistributionTime] < [TbOrderProgress].[FinishProcessingDateTime])) OR (([TbOrderProgress].[FinishProcessingDateTime] is null ) AND ([TbOrderProgress].[DistributionTime] < @DistributionTime254)))) 	
Parameters:
@ProcessingState253[String] = Finishing
@DistributionTime254[DateTime] = 2020/7/13 0:00:00


-----------------------------------------------------------------------------
2020-07-13 10:03:48
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:03:48
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode255) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode256))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState257)) 	
Parameters:
@ProcessFactoryCode255[String] = 6386683729561128960
@SiteCode256[String] = 6372921375874657752
@ProcessingState257[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-13 10:03:48
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-13 10:03:48
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:03:49
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode259) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode260,@WorkAreaCode261))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus262) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth263))) 	
Parameters:
@ProcessFactoryCode259[String] = 6386683729561128960
@WorkAreaCode260[String] = 6372921396045311451
@WorkAreaCode261[String] = 6372921398380745033
@Examinestatus262[String] = 审核完成
@DemandMonth263[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 10:03:49
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:03:49
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:03:49
Text:	 SELECT   [TbRawMaterialStockRecord].[MaterialCode],sum([TbRawMaterialStockRecord].[UseCount]) AS [UseCount],sum([TbRawMaterialStockRecord].[LockCount]) AS [LockCount] FROM [TbRawMaterialStockRecord] LEFT OUTER JOIN [TbStorage] ON ([TbRawMaterialStockRecord].[StorageCode] = [TbStorage].[StorageCode]) LEFT OUTER JOIN [TbRawMaterialArchives] ON ([TbRawMaterialStockRecord].[MaterialCode] = [TbRawMaterialArchives].[MaterialCode])  WHERE ((([TbStorage].[ProcessFactoryCode] = @ProcessFactoryCode266) AND ([TbRawMaterialStockRecord].[WorkAreaCode] IN (@WorkAreaCode268,@WorkAreaCode269))) AND ([TbRawMaterialArchives].[RebarType] = @RebarType271)) GROUP BY [TbRawMaterialStockRecord].[MaterialCode] 	
Parameters:
@ProcessFactoryCode266[String] = 6386683729561128960
@WorkAreaCode268[String] = 6372921396045311451
@WorkAreaCode269[String] = 6372921398380745033
@RebarType271[String] = BuildingSteel


-----------------------------------------------------------------------------
2020-07-13 10:03:49
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:03:49
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:03:49
Text:	 SELECT   [TbRawMaterialStockRecord].[MaterialCode],sum([TbRawMaterialStockRecord].[UseCount]) AS [UseCount],sum([TbRawMaterialStockRecord].[LockCount]) AS [LockCount] FROM [TbRawMaterialStockRecord] LEFT OUTER JOIN [TbStorage] ON ([TbRawMaterialStockRecord].[StorageCode] = [TbStorage].[StorageCode]) LEFT OUTER JOIN [TbRawMaterialArchives] ON ([TbRawMaterialStockRecord].[MaterialCode] = [TbRawMaterialArchives].[MaterialCode])  WHERE ((([TbStorage].[ProcessFactoryCode] = @ProcessFactoryCode275) AND ([TbRawMaterialStockRecord].[WorkAreaCode] IN (@WorkAreaCode277,@WorkAreaCode278))) AND ([TbRawMaterialArchives].[RebarType] = @RebarType280)) GROUP BY [TbRawMaterialStockRecord].[MaterialCode] 	
Parameters:
@ProcessFactoryCode275[String] = 6386683729561128960
@WorkAreaCode277[String] = 6372921396045311451
@WorkAreaCode278[String] = 6372921398380745033
@RebarType280[String] = SectionSteel


-----------------------------------------------------------------------------
2020-07-13 10:03:49
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:03:49
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode282) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode283,@WorkAreaCode284))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus285) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth286))) 	
Parameters:
@ProcessFactoryCode282[String] = 6386683729561128960
@WorkAreaCode283[String] = 6372921396045311451
@WorkAreaCode284[String] = 6372921398380745033
@Examinestatus285[String] = 审核完成
@DemandMonth286[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 10:03:49
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:03:49
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:03:49
Text:	
                        select fewoi.DataCode as OddNumbers,
                         fewoi.EarlyWarningContent,
                         fewoi.EWFormDataCode,
                         CONVERT(varchar(100), fewoi.EarlyWarningTime, 120) as EarlyWarningTime,
                         EWFormCode,sm.MenuName,fn.FlowNodeName,cp1.CompanyFullName as BranchName,
                         cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,
                         u1.UserName as FlowSpUserName,u2.UserName as FlowYjUserName 
                        FROM (
                        select*
                           FROM ( 
                        		SELECT a.*, row_number()over(partition BY a.FlowCode ORDER BY a.FlowNodeCode,a.EarlyWarningTime desc) as group_idx 
                        		FROM TbFlowEarlyWarningOtherInfo  a
                        		INNER JOIN  TbFlowEarlyWarningInfo b ON a.FlowCode=b.FlowCode 
                        		AND a.EWFormDataCode=b.EWFormDataCode AND a.FlowNodeCode=b.FlowNodeCode 
                        		WHERE YEAR(a.EarlyWarningTime)= @Year and MONTH(a.EarlyWarningTime)= @Month AND b.EarlyWarningStart=0
                           ) ret
                        WHERE ret.group_idx =1
                        ) fewoi
                        left join TbFlowNode fn on fewoi.FlowCode=fn.FlowCode and fewoi.FlowNodeCode=fn.FlowNodeCode
                        left join TbSysMenu sm on fewoi.EWFormCode=sm.MenuCode
                        left join TbCompany cp1 on fewoi.BranchCode=cp1.CompanyCode
                        left join TbCompany cp2 on fewoi.WorkAreaCode=cp2.CompanyCode
                        left join TbCompany cp3 on fewoi.SiteCode=cp3.CompanyCode
                        left join TbCompany cp4 on fewoi.ProcessFactoryCode=cp4.CompanyCode
                        left join TbUser u1 on fewoi.FlowSpUserCode=u1.UserId
                        left join TbUser u2 on fewoi.FlowYjUserCode=u2.UserId where 1=1 and fewoi.ProjectId='6372912251695766465' and fewoi.ProcessFactoryCode='6386683729561128960' and (fewoi.SiteCode in('6372921375874657752') or fewoi.WorkAreaCode in('6372921396045311451','6372921398380745033')) ORDER BY fewoi.EarlyWarningTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 10:03:49
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:03:49
Text:	--加急订单个数
                           select wo.OrderCode,wo.DistributionTime,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName from TbWorkOrder wo
                           left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on wo.ProcessFactoryCode=cp2.CompanyCode
                           where UrgentDegree='Urgent'
                           and YEAR(wo.DistributionTime)= @Year and MONTH(wo.DistributionTime)= @Month  and wo.ProjectId='6372912251695766465' and wo.ProcessFactoryCode='6386683729561128960' and wo.SiteCode in('6372921375874657752')  ORDER BY wo.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 10:03:49
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:03:49
Text:	--加工进度滞后
                           select op.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,op.DistributionTime,op.FinishProcessingDateTime from TbOrderProgress op 
                           left join TbCompany cp1 on op.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on op.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(op.DistributionTime)= @Year and MONTH(op.DistributionTime)= @Month
                           and (op.FinishProcessingDateTime>op.DistributionTime or (GETDATE()>op.DistributionTime and op.FinishProcessingDateTime is null))  and op.ProjectId='6372912251695766465' and op.ProcessFactoryCode='6386683729561128960' and op.SiteCode in('6372921375874657752') ORDER BY op.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 10:03:49
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:03:49
Text:	--配送超期
                           select dpi.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,dpi.DistributionTime,dpi.DeliveryCompleteTime,dpi.Remark from TbDistributionPlanInfo dpi
                           left join TbCompany cp1 on dpi.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on dpi.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(dpi.DistributionTime)= @Year and MONTH(dpi.DistributionTime)= @Month
                           and (dpi.DeliveryCompleteTime>dpi.DistributionTime or (GETDATE()>dpi.DistributionTime and dpi.DeliveryCompleteTime is null))  and dpi.ProjectId='6372912251695766465' and dpi.ProcessFactoryCode='6386683729561128960' and dpi.SiteCode in('6372921375874657752') ORDER BY dpi.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 10:03:49
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:03:49
Text:	select TbYj.*,cp1.CompanyFullName as SiteName,tcr.EnterSpaceTime,tcr.StartDischargeTime,tcr.EndDischargeTime,disEnt.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SiteDischargeCargo' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbTransportCarReport tcr on TbYj.EWFormDataCode=tcr.DisEntOrderId
                           left join TbDistributionEnt disEnt on tcr.DistributionCode=disEnt.DistributionCode
                           left join TbCompany cp on disEnt.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and disEnt.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ORDER BY tcr.EnterSpaceTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 10:03:49
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:03:49
Text:	select TbYj.*,cp1.CompanyFullName as SiteName,sfs.DistributionCode,sdc.DistributionTime,sfs.SigninTime,sfs.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SemiFinishedSign' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbSemiFinishedSign sfs on TbYj.EWFormDataCode=sfs.ID
                           left join TbSiteDischargeCargo sdc on sfs.DistributionCode=sdc.DistributionCode and sfs.DischargeCargoCode=sdc.DischargeCargoCode
                           left join TbCompany cp on sfs.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month and TbYj.ProjectId='6372912251695766465' and sfs.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752')	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 10:03:49
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:03:49
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:03:49
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode289) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode290))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState291)) 	
Parameters:
@ProcessFactoryCode289[String] = 6386683729561128960
@SiteCode290[String] = 6372921375874657752
@ProcessingState291[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-13 10:03:49
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-13 10:03:49
Text:	 SELECT   [TbOrderProgress].[ProcessingState],[TbOrderProgress].[OrderCode],[TbOrderProgress].[FinishProcessingDateTime],[TbOrderProgress].[DistributionTime],[TbOrderProgress].[SiteCode] FROM [TbOrderProgress]  WHERE ((([TbOrderProgress].[SiteCode] IN (@SiteCode287)) AND ([TbOrderProgress].[ProcessFactoryCode] = @ProcessFactoryCode288)) AND ((YEAR(DistributionTime)=2020 and MONTH(DistributionTime)=7) or (DistributionTime<'2020/7/1 0:00:00' and (ProcessingState!='Finishing')))) 	
Parameters:
@SiteCode287[String] = 6372921375874657752
@ProcessFactoryCode288[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-13 10:03:49
Text:	 SELECT   * FROM [TbWorkOrderDetail]  WHERE (1=2) AND ([TbWorkOrderDetail].[DaetailWorkStrat] = @DaetailWorkStrat292) 	
Parameters:
@DaetailWorkStrat292[String] = 未加工


-----------------------------------------------------------------------------
2020-07-13 10:03:49
Text:	 SELECT   [TbOrderProgress].[WeightTotal] AS [TotalWeight],[TbCompany].[ParentCompanyCode] FROM [TbOrderProgress] LEFT OUTER JOIN [TbCompany] ON ([TbOrderProgress].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((1=2) AND ([TbOrderProgress].[ProcessingState] <> @ProcessingState293)) AND ((([TbOrderProgress].[FinishProcessingDateTime] is not null ) AND ([TbOrderProgress].[DistributionTime] < [TbOrderProgress].[FinishProcessingDateTime])) OR (([TbOrderProgress].[FinishProcessingDateTime] is null ) AND ([TbOrderProgress].[DistributionTime] < @DistributionTime294)))) 	
Parameters:
@ProcessingState293[String] = Finishing
@DistributionTime294[DateTime] = 2020/7/13 0:00:00


-----------------------------------------------------------------------------
2020-07-13 10:03:50
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:03:50
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:03:50
Text:	SELECT sm.MenuName,fwqi.EWContent,fwqi.EWUserCode,u.UserName,fwqi.EWFormDataCode,cp1.CompanyFullName as  FbName,cp2.CompanyFullName as GqName,fwqi.EWTime,sdd.DictionaryText as RebarType  
                   FROM (  
                    select ret.*
                    FROM ( 
                         SELECT *, row_number()over(partition BY EarlyWarningCode,EWFormDataCode ORDER BY EWNodeCode,EWTime desc) as group_idx 
                         FROM TbFormEarlyWarningNodeInfo fwqi
                         WHERE YEAR(fwqi.EWTime)= @Year and MONTH(fwqi.EWTime)= @Month AND fwqi.MenuCode='RawMonthDemandPlan' AND fwqi.EWStart=0
                    ) ret
                    WHERE ret.group_idx = 1
                   ) fwqi
                    left join TbSysMenu sm on fwqi.MenuCode=sm.MenuCode
                            left join TbCompany cp1 on fwqi.CompanyCode=cp1.CompanyCode
                            left join TbCompany cp2 on fwqi.WorkArea=cp2.CompanyCode
                            left join TbCompany cp3 on fwqi.SiteCode=cp3.CompanyCode
                            left join TbUser u on fwqi.EWUserCode=u.UserId
                            left join TbRawMaterialMonthDemandPlan rmp on fwqi.EWFormDataCode=rmp.ID
                            left join TbSysDictionaryData sdd on sdd.DictionaryCode=rmp.RebarType
                    where 1=1 and fwqi.ProjectId='6372912251695766465' and (fwqi.SiteCode in('6372921375874657752') or fwqi.WorkArea in('6372921396045311451','6372921398380745033')) ORDER BY fwqi.EWTime DESC	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 10:03:50
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:03:50
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:03:50
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:03:50
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:03:50
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:03:50
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:03:50
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:03:50
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:03:50
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:03:50
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:03:50
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:03:50
Text:	SELECT 
                            '审批超时' as YjTypeName,COUNT(1) as YjNum
                            FROM (
									SELECT a.*, row_number()over(partition BY a.FlowCode ORDER BY a.FlowNodeCode,a.EarlyWarningTime desc) as group_idx 
									FROM TbFlowEarlyWarningOtherInfo  a
									INNER JOIN  TbFlowEarlyWarningInfo b ON a.FlowCode=b.FlowCode 
									AND a.EWFormDataCode=b.EWFormDataCode AND a.FlowNodeCode=b.FlowNodeCode 
									WHERE  b.EarlyWarningStart=0 AND YEAR(a.EarlyWarningTime)= @Year and MONTH(a.EarlyWarningTime)= @Month  and a.ProjectId='6372912251695766465' and a.ProcessFactoryCode='6386683729561128960' and (a.SiteCode in('6372921375874657752') or a.WorkAreaCode in('6372921396045311451','6372921398380745033'))
							   ) Tb1
                            WHERE Tb1.group_idx =1
                           union all
                            select '未报月度需求计划' as YjTypeName,COUNT(1)as YjNum
                             FROM ( 
                                  SELECT *, row_number()over(partition BY EarlyWarningCode,EWFormDataCode ORDER BY EWNodeCode,EWTime desc) as group_idx 
                                  FROM TbFormEarlyWarningNodeInfo fwqi
                                  WHERE fwqi.MenuCode='RawMonthDemandPlan' AND fwqi.EWStart=0 AND YEAR(fwqi.EWTime)= @Year and MONTH(fwqi.EWTime)= @Month  and fwqi.ProjectId='6372912251695766465' and (fwqi.SiteCode in('6372921375874657752') or fwqi.WorkArea in('6372921396045311451','6372921398380745033'))  
                             ) Tb2
                             WHERE Tb2.group_idx =1
                           union all
                           select '原材料供货超时' as YjTypeName,COUNT(1) as YjNum from (
                           select BatchPlanNum,cp1.CompanyFullName as BranchName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,sup.SupplyDate,sup.SupplyCompleteTime,sup.ProjectId from TbSupplyList sup
                           left join TbCompany cp1 on cp1.CompanyCode=sup.BranchCode
                           left join TbCompany cp2 on cp2.CompanyCode=sup.WorkAreaCode
                           left join TbCompany cp3 on cp3.CompanyCode=sup.SiteCode
                           left join TbCompany cp4 on cp4.CompanyCode=sup.ProcessFactoryCode
                           where (sup.SupplyCompleteTime>sup.SupplyDate or (GETDATE()>sup.SupplyDate and sup.SupplyCompleteTime is null))
						   and YEAR(sup.SupplyDate)= @Year and MONTH(sup.SupplyDate)= @Month  and sup.ProjectId='6372912251695766465' and sup.ProcessFactoryCode='6386683729561128960' and (sup.SiteCode in('6372921375874657752') or sup.WorkAreaCode in('6372921396045311451','6372921398380745033'))) Tb3
                           union all
                           select '加急订单' as YjTypeName,COUNT(1) as YjNum from (--加急订单个数
                           select wo.OrderCode,wo.DistributionTime,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName from TbWorkOrder wo
                           left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on wo.ProcessFactoryCode=cp2.CompanyCode
                           where UrgentDegree='Urgent' 
						   and YEAR(wo.DistributionTime)= @Year and MONTH(wo.DistributionTime)= @Month  and wo.ProjectId='6372912251695766465' and wo.ProcessFactoryCode='6386683729561128960' and wo.SiteCode in('6372921375874657752') ) Tb4
                           union all
                           select '加工进度滞后' as YjTypeName,COUNT(1) as YjNum from (--加工进度滞后
                           select op.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,op.DistributionTime,op.FinishProcessingDateTime from TbOrderProgress op 
                           left join TbCompany cp1 on op.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on op.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(op.DistributionTime)= @Year and MONTH(op.DistributionTime)= @Month
                           and (op.FinishProcessingDateTime>op.DistributionTime or (GETDATE()>op.DistributionTime and op.FinishProcessingDateTime is null))  and op.ProjectId='6372912251695766465' and op.ProcessFactoryCode='6386683729561128960' and op.SiteCode in('6372921375874657752') ) Tb5
                           union all
                           select '接收配送超期' as YjTypeName,COUNT(1) as YjNum from (--配送超期
                           select dpi.OrderCode,cp1.CompanyFullName as SIteName,cp2.CompanyFullName as ProcessFactoryName,dpi.DistributionTime,dpi.DeliveryCompleteTime from TbDistributionPlanInfo dpi
                           left join TbCompany cp1 on dpi.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on dpi.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(dpi.DistributionTime)= @Year and MONTH(dpi.DistributionTime)= @Month
                           and (dpi.DeliveryCompleteTime>dpi.DistributionTime or (GETDATE()>dpi.DistributionTime and dpi.DeliveryCompleteTime is null))  and dpi.ProjectId='6372912251695766465' and dpi.ProcessFactoryCode='6386683729561128960' and dpi.SiteCode in('6372921375874657752') ) Tb6 
                           union all
                           select '卸货超时' as YjTypeName,COUNT(1) as YjNum from(--卸货超时
                           select TbYj.*,cp1.CompanyFullName as SiteName,tcr.EnterSpaceTime,tcr.StartDischargeTime,tcr.EndDischargeTime,disEnt.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SiteDischargeCargo' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbTransportCarReport tcr on TbYj.EWFormDataCode=tcr.DisEntOrderId
                           left join TbDistributionEnt disEnt on tcr.DistributionCode=disEnt.DistributionCode
                           left join TbCompany cp on disEnt.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and disEnt.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ) Tb7
                           union all
                           select '签收超时' as YjTypeName,COUNT(1) as YjNum from (select TbYj.*,cp1.CompanyFullName as SiteName,sfs.DistributionCode,sdc.DistributionTime,sfs.SigninTime,sfs.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SemiFinishedSign' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbSemiFinishedSign sfs on TbYj.EWFormDataCode=sfs.ID
                           left join TbSiteDischargeCargo sdc on sfs.DistributionCode=sdc.DistributionCode and sfs.DischargeCargoCode=sdc.DischargeCargoCode
                           left join TbCompany cp on sfs.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and sfs.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ) Tb8	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 10:03:51
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:03:51
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:03:51
Text:	--原材料供货超时
                           select BatchPlanNum,cp1.CompanyFullName as BranchName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,sup.SupplyDate,sup.SupplyCompleteTime,sup.ProjectId,sup.Remarks from TbSupplyList sup
                           left join TbCompany cp1 on cp1.CompanyCode=sup.BranchCode
                           left join TbCompany cp2 on cp2.CompanyCode=sup.WorkAreaCode
                           left join TbCompany cp3 on cp3.CompanyCode=sup.SiteCode
                           left join TbCompany cp4 on cp4.CompanyCode=sup.ProcessFactoryCode
                           where YEAR(sup.SupplyDate)= @Year and MONTH(sup.SupplyDate)= @Month
                           and (sup.SupplyCompleteTime>sup.SupplyDate or (GETDATE()>sup.SupplyDate and sup.SupplyCompleteTime is null))  and sup.ProjectId='6372912251695766465' and sup.ProcessFactoryCode='6386683729561128960' and (sup.SiteCode in('6372921375874657752') or sup.WorkAreaCode in('6372921396045311451','6372921398380745033'))	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 10:03:51
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:03:51
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode295) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode296,@WorkAreaCode297))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus298) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth299))) 	
Parameters:
@ProcessFactoryCode295[String] = 6386683729561128960
@WorkAreaCode296[String] = 6372921396045311451
@WorkAreaCode297[String] = 6372921398380745033
@Examinestatus298[String] = 审核完成
@DemandMonth299[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 10:03:57
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 10:03:57
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-13 10:03:57
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:03:57
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:03:58
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 10:03:58
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-13 10:03:58
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 10:03:58
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:03:58
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:03:58
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 10:03:58
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 10:03:58
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 10:03:58
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:03:58
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:03:58
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 10:03:59
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 10:03:59
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 10:04:13
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:04:13
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:04:13
Text:	select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 10:04:13
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 10:04:13
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='BuildingSteel'	


-----------------------------------------------------------------------------
2020-07-13 10:04:13
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='SectionSteel'	


-----------------------------------------------------------------------------
2020-07-13 10:04:13
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)	


-----------------------------------------------------------------------------
2020-07-13 10:04:13
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 10:04:14
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)	


-----------------------------------------------------------------------------
2020-07-13 10:04:14
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 10:04:22
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:04:22
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:04:22
Text:	select 
                           a.RootNumber,
                           a.SizeSelection,
                           a.MaterialCode,
                           a.WeightSmallPlanN,
                           b.MaterialName,
                           b.SpecificationModel,
                           b.MeasurementUnitZl,
                           c.CompanyFullName StartSiteName,
                           d.CompanyFullName EndSiteName
                           from 
                           (
                           select 
                           a.MaterialCode,
                           a.Size as SizeSelection,
                           a.StartSiteCode,
                           a.EndSiteCode,
                           sum(a.Number) RootNumber,
                           sum(a.Weight) WeightSmallPlanN
                           from TbCloutStockPlace a
                           left join TbRMProductionMaterial rmpm on a.CollarCode=rmpm.CollarCode
                           where a.State=1 
                           and (ISNULL(@ProjectId,'')='' OR a.ProjectId=@ProjectId)
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                            and a.EndSiteCode in('6372921375874657752')
                           group by a.MaterialCode,a.Size,a.StartSiteCode,a.EndSiteCode
                           ) a
                           left join TbRawMaterialArchives b on a.MaterialCode=b.MaterialCode
                           left join TbCompany c on c.CompanyCode=a.StartSiteCode
                           left join TbCompany d on d.CompanyCode=a.EndSiteCode
                           where 1=1 
                           and (ISNULL(@MaterialName,'')='' or b.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or b.SpecificationModel like '%'+@SpecificationModel+'%')	
Parameters:
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 
@BegTime[DateTime] = 
@EndTime[DateTime] = 


-----------------------------------------------------------------------------
2020-07-13 10:04:22
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode asc)AS Row, * from (select 
                           a.RootNumber,
                           a.SizeSelection,
                           a.MaterialCode,
                           a.WeightSmallPlanN,
                           b.MaterialName,
                           b.SpecificationModel,
                           b.MeasurementUnitZl,
                           c.CompanyFullName StartSiteName,
                           d.CompanyFullName EndSiteName
                           from 
                           (
                           select 
                           a.MaterialCode,
                           a.Size as SizeSelection,
                           a.StartSiteCode,
                           a.EndSiteCode,
                           sum(a.Number) RootNumber,
                           sum(a.Weight) WeightSmallPlanN
                           from TbCloutStockPlace a
                           left join TbRMProductionMaterial rmpm on a.CollarCode=rmpm.CollarCode
                           where a.State=1 
                           and (ISNULL(@ProjectId,'')='' OR a.ProjectId=@ProjectId)
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                            and a.EndSiteCode in('6372921375874657752')
                           group by a.MaterialCode,a.Size,a.StartSiteCode,a.EndSiteCode
                           ) a
                           left join TbRawMaterialArchives b on a.MaterialCode=b.MaterialCode
                           left join TbCompany c on c.CompanyCode=a.StartSiteCode
                           left join TbCompany d on d.CompanyCode=a.EndSiteCode
                           where 1=1 
                           and (ISNULL(@MaterialName,'')='' or b.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or b.SpecificationModel like '%'+@SpecificationModel+'%')) as a)  SELECT * FROM temptbl where Row between 1 and 50	
Parameters:
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 
@BegTime[DateTime] = 
@EndTime[DateTime] = 


-----------------------------------------------------------------------------
2020-07-13 10:06:47
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:09:47
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:12:47
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:15:47
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:18:47
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:18:52
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 10:18:52
Text:	select a.*,a.FullCode as ProjectId,b.CompanyFullName as ParentCompanyName from TbCompany a
left join TbCompany b on a.ParentCompanyCode=b.CompanyCode 
where a.OrgType!=1  order by a.id asc	


-----------------------------------------------------------------------------
2020-07-13 10:18:56
Text:	 SELECT   [TbCompany].* FROM [TbCompany]  	


-----------------------------------------------------------------------------
2020-07-13 10:18:56
Text:	select * from TbSysDictionaryData where 1=1 and FDictionaryCode=@name order by DictionaryOrder asc	
Parameters:
@name[String] = OrgType


-----------------------------------------------------------------------------
2020-07-13 10:19:31
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:19:31
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:19:31
Text:	select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 10:19:31
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 10:19:31
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='BuildingSteel'	


-----------------------------------------------------------------------------
2020-07-13 10:19:31
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='SectionSteel'	


-----------------------------------------------------------------------------
2020-07-13 10:19:31
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:19:31
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:19:31
Text:	select a.*,a.FullCode as ProjectId,b.CompanyFullName as ParentCompanyName from TbCompany a
left join TbCompany b on a.ParentCompanyCode=b.CompanyCode 
where a.OrgType!=1  order by a.id asc	


-----------------------------------------------------------------------------
2020-07-13 10:19:36
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 10:19:36
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 10:19:36
Text:	select isnull(sum(TbCF.Capacity),0) as Capacity,isnull(sum(TbCF.WeightSmallPlan),0) as WeightSmallPlan,isnull(cast(sum(TbCF.WeightSmallPlan)/sum(TbCF.Capacity)*100 as decimal(18,2)),0) as ActualLoadNew from (select cf.Capacity,Tb1.WeightSmallPlan,cf.ProcessFactoryCode from TbCapacityFilling cf  
left join(
select SUM(Tb.WeightSmallPlan) as WeightSmallPlan,Tb.ProcessFactoryCode from (
                            select isnull(SUM(wod.WeightSmallPlan),0) as WeightSmallPlan,wo.ProcessFactoryCode from TbWorkOrder wo
                            left join TbWorkOrderDetail wod on wo.OrderCode=wod.OrderCode
                            where (ISNULL(@ProcessFactoryCode,'')='' or wo.ProcessFactoryCode=@ProcessFactoryCode)
                            and CONVERT(varchar(7), wo.DistributionTime, 120)=@month
                            and wod.RevokeStart='正常' and wo.ProcessingState!='ConfirmWork' and wo.ProcessingState!='Finishing'  group by wo.ProcessFactoryCode
                            union all
                            select isnull(sum(opd.NoCompleted),0) as NoCompleted,op.ProcessFactoryCode from TbOrderProgress op
                            left join TbOrderProgressDetail opd on op.OrderCode=opd.OrderCode 
                            where (ISNULL(@ProcessFactoryCode,'')='' or op.ProcessFactoryCode=@ProcessFactoryCode)
                            and CONVERT(varchar(7), op.DistributionTime, 120)=CONVERT(varchar(4),YEAR(DATEADD(MONTH,-1,@month+'-01')))+'-'+Right(100+Month(DATEADD(MONTH,-1,@month+'-01')),2)
                            and opd.RevokeStart='正常'  group by op.ProcessFactoryCode)Tb  group by Tb.ProcessFactoryCode
) Tb1 on cf.ProcessFactoryCode=Tb1.ProcessFactoryCode 
where cf.CapacityMonth=@month
and (ISNULL(@ProcessFactoryCode,'')='' or cf.ProcessFactoryCode=@ProcessFactoryCode)) TbCF where (ISNULL(@ProcessFactoryCode,'')='' or TbCF.ProcessFactoryCode=@ProcessFactoryCode)	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@month[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 10:19:36
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:19:36
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode300) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode301,@WorkAreaCode302))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus303) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth304))) 	
Parameters:
@ProcessFactoryCode300[String] = 6386683729561128960
@WorkAreaCode301[String] = 6372921396045311451
@WorkAreaCode302[String] = 6372921398380745033
@Examinestatus303[String] = 审核完成
@DemandMonth304[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 10:19:36
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:19:36
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:19:37
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:19:37
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:19:37
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode307) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode308))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState309)) 	
Parameters:
@ProcessFactoryCode307[String] = 6386683729561128960
@SiteCode308[String] = 6372921375874657752
@ProcessingState309[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-13 10:19:37
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-13 10:19:37
Text:	 SELECT   [TbOrderProgress].[ProcessingState],[TbOrderProgress].[OrderCode],[TbOrderProgress].[FinishProcessingDateTime],[TbOrderProgress].[DistributionTime],[TbOrderProgress].[SiteCode] FROM [TbOrderProgress]  WHERE ((([TbOrderProgress].[SiteCode] IN (@SiteCode305)) AND ([TbOrderProgress].[ProcessFactoryCode] = @ProcessFactoryCode306)) AND ((YEAR(DistributionTime)=2020 and MONTH(DistributionTime)=7) or (DistributionTime<'2020/7/1 0:00:00' and (ProcessingState!='Finishing')))) 	
Parameters:
@SiteCode305[String] = 6372921375874657752
@ProcessFactoryCode306[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-13 10:19:37
Text:	 SELECT   * FROM [TbWorkOrderDetail]  WHERE (1=2) AND ([TbWorkOrderDetail].[DaetailWorkStrat] = @DaetailWorkStrat310) 	
Parameters:
@DaetailWorkStrat310[String] = 未加工


-----------------------------------------------------------------------------
2020-07-13 10:19:37
Text:	 SELECT   [TbOrderProgress].[WeightTotal] AS [TotalWeight],[TbCompany].[ParentCompanyCode] FROM [TbOrderProgress] LEFT OUTER JOIN [TbCompany] ON ([TbOrderProgress].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((1=2) AND ([TbOrderProgress].[ProcessingState] <> @ProcessingState311)) AND ((([TbOrderProgress].[FinishProcessingDateTime] is not null ) AND ([TbOrderProgress].[DistributionTime] < [TbOrderProgress].[FinishProcessingDateTime])) OR (([TbOrderProgress].[FinishProcessingDateTime] is null ) AND ([TbOrderProgress].[DistributionTime] < @DistributionTime312)))) 	
Parameters:
@ProcessingState311[String] = Finishing
@DistributionTime312[DateTime] = 2020/7/13 0:00:00


-----------------------------------------------------------------------------
2020-07-13 10:19:37
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:19:37
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode313) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode314))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState315)) 	
Parameters:
@ProcessFactoryCode313[String] = 6386683729561128960
@SiteCode314[String] = 6372921375874657752
@ProcessingState315[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-13 10:19:37
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-13 10:19:37
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:19:37
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode317) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode318,@WorkAreaCode319))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus320) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth321))) 	
Parameters:
@ProcessFactoryCode317[String] = 6386683729561128960
@WorkAreaCode318[String] = 6372921396045311451
@WorkAreaCode319[String] = 6372921398380745033
@Examinestatus320[String] = 审核完成
@DemandMonth321[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 10:19:37
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:19:37
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:19:37
Text:	 SELECT   [TbRawMaterialStockRecord].[MaterialCode],sum([TbRawMaterialStockRecord].[UseCount]) AS [UseCount],sum([TbRawMaterialStockRecord].[LockCount]) AS [LockCount] FROM [TbRawMaterialStockRecord] LEFT OUTER JOIN [TbStorage] ON ([TbRawMaterialStockRecord].[StorageCode] = [TbStorage].[StorageCode]) LEFT OUTER JOIN [TbRawMaterialArchives] ON ([TbRawMaterialStockRecord].[MaterialCode] = [TbRawMaterialArchives].[MaterialCode])  WHERE ((([TbStorage].[ProcessFactoryCode] = @ProcessFactoryCode324) AND ([TbRawMaterialStockRecord].[WorkAreaCode] IN (@WorkAreaCode326,@WorkAreaCode327))) AND ([TbRawMaterialArchives].[RebarType] = @RebarType329)) GROUP BY [TbRawMaterialStockRecord].[MaterialCode] 	
Parameters:
@ProcessFactoryCode324[String] = 6386683729561128960
@WorkAreaCode326[String] = 6372921396045311451
@WorkAreaCode327[String] = 6372921398380745033
@RebarType329[String] = BuildingSteel


-----------------------------------------------------------------------------
2020-07-13 10:19:38
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:19:38
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:19:38
Text:	 SELECT   [TbRawMaterialStockRecord].[MaterialCode],sum([TbRawMaterialStockRecord].[UseCount]) AS [UseCount],sum([TbRawMaterialStockRecord].[LockCount]) AS [LockCount] FROM [TbRawMaterialStockRecord] LEFT OUTER JOIN [TbStorage] ON ([TbRawMaterialStockRecord].[StorageCode] = [TbStorage].[StorageCode]) LEFT OUTER JOIN [TbRawMaterialArchives] ON ([TbRawMaterialStockRecord].[MaterialCode] = [TbRawMaterialArchives].[MaterialCode])  WHERE ((([TbStorage].[ProcessFactoryCode] = @ProcessFactoryCode333) AND ([TbRawMaterialStockRecord].[WorkAreaCode] IN (@WorkAreaCode335,@WorkAreaCode336))) AND ([TbRawMaterialArchives].[RebarType] = @RebarType338)) GROUP BY [TbRawMaterialStockRecord].[MaterialCode] 	
Parameters:
@ProcessFactoryCode333[String] = 6386683729561128960
@WorkAreaCode335[String] = 6372921396045311451
@WorkAreaCode336[String] = 6372921398380745033
@RebarType338[String] = SectionSteel


-----------------------------------------------------------------------------
2020-07-13 10:19:38
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:19:38
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:19:38
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode342) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode343))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState344)) 	
Parameters:
@ProcessFactoryCode342[String] = 6386683729561128960
@SiteCode343[String] = 6372921375874657752
@ProcessingState344[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-13 10:19:38
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-13 10:19:38
Text:	 SELECT   [TbOrderProgress].[ProcessingState],[TbOrderProgress].[OrderCode],[TbOrderProgress].[FinishProcessingDateTime],[TbOrderProgress].[DistributionTime],[TbOrderProgress].[SiteCode] FROM [TbOrderProgress]  WHERE ((([TbOrderProgress].[SiteCode] IN (@SiteCode340)) AND ([TbOrderProgress].[ProcessFactoryCode] = @ProcessFactoryCode341)) AND ((YEAR(DistributionTime)=2020 and MONTH(DistributionTime)=7) or (DistributionTime<'2020/7/1 0:00:00' and (ProcessingState!='Finishing')))) 	
Parameters:
@SiteCode340[String] = 6372921375874657752
@ProcessFactoryCode341[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-13 10:19:38
Text:	 SELECT   * FROM [TbWorkOrderDetail]  WHERE (1=2) AND ([TbWorkOrderDetail].[DaetailWorkStrat] = @DaetailWorkStrat345) 	
Parameters:
@DaetailWorkStrat345[String] = 未加工


-----------------------------------------------------------------------------
2020-07-13 10:19:38
Text:	 SELECT   [TbOrderProgress].[WeightTotal] AS [TotalWeight],[TbCompany].[ParentCompanyCode] FROM [TbOrderProgress] LEFT OUTER JOIN [TbCompany] ON ([TbOrderProgress].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((1=2) AND ([TbOrderProgress].[ProcessingState] <> @ProcessingState346)) AND ((([TbOrderProgress].[FinishProcessingDateTime] is not null ) AND ([TbOrderProgress].[DistributionTime] < [TbOrderProgress].[FinishProcessingDateTime])) OR (([TbOrderProgress].[FinishProcessingDateTime] is null ) AND ([TbOrderProgress].[DistributionTime] < @DistributionTime347)))) 	
Parameters:
@ProcessingState346[String] = Finishing
@DistributionTime347[DateTime] = 2020/7/13 0:00:00


-----------------------------------------------------------------------------
2020-07-13 10:19:38
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:19:38
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:19:38
Text:	--原材料供货超时
                           select BatchPlanNum,cp1.CompanyFullName as BranchName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,sup.SupplyDate,sup.SupplyCompleteTime,sup.ProjectId,sup.Remarks from TbSupplyList sup
                           left join TbCompany cp1 on cp1.CompanyCode=sup.BranchCode
                           left join TbCompany cp2 on cp2.CompanyCode=sup.WorkAreaCode
                           left join TbCompany cp3 on cp3.CompanyCode=sup.SiteCode
                           left join TbCompany cp4 on cp4.CompanyCode=sup.ProcessFactoryCode
                           where YEAR(sup.SupplyDate)= @Year and MONTH(sup.SupplyDate)= @Month
                           and (sup.SupplyCompleteTime>sup.SupplyDate or (GETDATE()>sup.SupplyDate and sup.SupplyCompleteTime is null))  and sup.ProjectId='6372912251695766465' and sup.ProcessFactoryCode='6386683729561128960' and (sup.SiteCode in('6372921375874657752') or sup.WorkAreaCode in('6372921396045311451','6372921398380745033'))	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 10:19:38
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:19:38
Text:	--加急订单个数
                           select wo.OrderCode,wo.DistributionTime,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName from TbWorkOrder wo
                           left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on wo.ProcessFactoryCode=cp2.CompanyCode
                           where UrgentDegree='Urgent'
                           and YEAR(wo.DistributionTime)= @Year and MONTH(wo.DistributionTime)= @Month  and wo.ProjectId='6372912251695766465' and wo.ProcessFactoryCode='6386683729561128960' and wo.SiteCode in('6372921375874657752')  ORDER BY wo.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 10:19:38
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:19:38
Text:	--加工进度滞后
                           select op.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,op.DistributionTime,op.FinishProcessingDateTime from TbOrderProgress op 
                           left join TbCompany cp1 on op.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on op.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(op.DistributionTime)= @Year and MONTH(op.DistributionTime)= @Month
                           and (op.FinishProcessingDateTime>op.DistributionTime or (GETDATE()>op.DistributionTime and op.FinishProcessingDateTime is null))  and op.ProjectId='6372912251695766465' and op.ProcessFactoryCode='6386683729561128960' and op.SiteCode in('6372921375874657752') ORDER BY op.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 10:19:38
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:19:38
Text:	--配送超期
                           select dpi.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,dpi.DistributionTime,dpi.DeliveryCompleteTime,dpi.Remark from TbDistributionPlanInfo dpi
                           left join TbCompany cp1 on dpi.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on dpi.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(dpi.DistributionTime)= @Year and MONTH(dpi.DistributionTime)= @Month
                           and (dpi.DeliveryCompleteTime>dpi.DistributionTime or (GETDATE()>dpi.DistributionTime and dpi.DeliveryCompleteTime is null))  and dpi.ProjectId='6372912251695766465' and dpi.ProcessFactoryCode='6386683729561128960' and dpi.SiteCode in('6372921375874657752') ORDER BY dpi.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 10:19:38
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:19:38
Text:	select TbYj.*,cp1.CompanyFullName as SiteName,tcr.EnterSpaceTime,tcr.StartDischargeTime,tcr.EndDischargeTime,disEnt.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SiteDischargeCargo' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbTransportCarReport tcr on TbYj.EWFormDataCode=tcr.DisEntOrderId
                           left join TbDistributionEnt disEnt on tcr.DistributionCode=disEnt.DistributionCode
                           left join TbCompany cp on disEnt.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and disEnt.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ORDER BY tcr.EnterSpaceTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 10:19:38
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:19:38
Text:	select TbYj.*,cp1.CompanyFullName as SiteName,sfs.DistributionCode,sdc.DistributionTime,sfs.SigninTime,sfs.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SemiFinishedSign' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbSemiFinishedSign sfs on TbYj.EWFormDataCode=sfs.ID
                           left join TbSiteDischargeCargo sdc on sfs.DistributionCode=sdc.DistributionCode and sfs.DischargeCargoCode=sdc.DischargeCargoCode
                           left join TbCompany cp on sfs.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month and TbYj.ProjectId='6372912251695766465' and sfs.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752')	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 10:19:38
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:19:38
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode348) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode349,@WorkAreaCode350))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus351) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth352))) 	
Parameters:
@ProcessFactoryCode348[String] = 6386683729561128960
@WorkAreaCode349[String] = 6372921396045311451
@WorkAreaCode350[String] = 6372921398380745033
@Examinestatus351[String] = 审核完成
@DemandMonth352[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 10:19:38
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:19:38
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:19:38
Text:	SELECT sm.MenuName,fwqi.EWContent,fwqi.EWUserCode,u.UserName,fwqi.EWFormDataCode,cp1.CompanyFullName as  FbName,cp2.CompanyFullName as GqName,fwqi.EWTime,sdd.DictionaryText as RebarType  
                   FROM (  
                    select ret.*
                    FROM ( 
                         SELECT *, row_number()over(partition BY EarlyWarningCode,EWFormDataCode ORDER BY EWNodeCode,EWTime desc) as group_idx 
                         FROM TbFormEarlyWarningNodeInfo fwqi
                         WHERE YEAR(fwqi.EWTime)= @Year and MONTH(fwqi.EWTime)= @Month AND fwqi.MenuCode='RawMonthDemandPlan' AND fwqi.EWStart=0
                    ) ret
                    WHERE ret.group_idx = 1
                   ) fwqi
                    left join TbSysMenu sm on fwqi.MenuCode=sm.MenuCode
                            left join TbCompany cp1 on fwqi.CompanyCode=cp1.CompanyCode
                            left join TbCompany cp2 on fwqi.WorkArea=cp2.CompanyCode
                            left join TbCompany cp3 on fwqi.SiteCode=cp3.CompanyCode
                            left join TbUser u on fwqi.EWUserCode=u.UserId
                            left join TbRawMaterialMonthDemandPlan rmp on fwqi.EWFormDataCode=rmp.ID
                            left join TbSysDictionaryData sdd on sdd.DictionaryCode=rmp.RebarType
                    where 1=1 and fwqi.ProjectId='6372912251695766465' and (fwqi.SiteCode in('6372921375874657752') or fwqi.WorkArea in('6372921396045311451','6372921398380745033')) ORDER BY fwqi.EWTime DESC	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 10:19:39
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:19:39
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:19:39
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:19:39
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:19:39
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:19:39
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:19:39
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:19:39
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:19:39
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:19:39
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:19:39
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:19:39
Text:	SELECT 
                            '审批超时' as YjTypeName,COUNT(1) as YjNum
                            FROM (
									SELECT a.*, row_number()over(partition BY a.FlowCode ORDER BY a.FlowNodeCode,a.EarlyWarningTime desc) as group_idx 
									FROM TbFlowEarlyWarningOtherInfo  a
									INNER JOIN  TbFlowEarlyWarningInfo b ON a.FlowCode=b.FlowCode 
									AND a.EWFormDataCode=b.EWFormDataCode AND a.FlowNodeCode=b.FlowNodeCode 
									WHERE  b.EarlyWarningStart=0 AND YEAR(a.EarlyWarningTime)= @Year and MONTH(a.EarlyWarningTime)= @Month  and a.ProjectId='6372912251695766465' and a.ProcessFactoryCode='6386683729561128960' and (a.SiteCode in('6372921375874657752') or a.WorkAreaCode in('6372921396045311451','6372921398380745033'))
							   ) Tb1
                            WHERE Tb1.group_idx =1
                           union all
                            select '未报月度需求计划' as YjTypeName,COUNT(1)as YjNum
                             FROM ( 
                                  SELECT *, row_number()over(partition BY EarlyWarningCode,EWFormDataCode ORDER BY EWNodeCode,EWTime desc) as group_idx 
                                  FROM TbFormEarlyWarningNodeInfo fwqi
                                  WHERE fwqi.MenuCode='RawMonthDemandPlan' AND fwqi.EWStart=0 AND YEAR(fwqi.EWTime)= @Year and MONTH(fwqi.EWTime)= @Month  and fwqi.ProjectId='6372912251695766465' and (fwqi.SiteCode in('6372921375874657752') or fwqi.WorkArea in('6372921396045311451','6372921398380745033'))  
                             ) Tb2
                             WHERE Tb2.group_idx =1
                           union all
                           select '原材料供货超时' as YjTypeName,COUNT(1) as YjNum from (
                           select BatchPlanNum,cp1.CompanyFullName as BranchName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,sup.SupplyDate,sup.SupplyCompleteTime,sup.ProjectId from TbSupplyList sup
                           left join TbCompany cp1 on cp1.CompanyCode=sup.BranchCode
                           left join TbCompany cp2 on cp2.CompanyCode=sup.WorkAreaCode
                           left join TbCompany cp3 on cp3.CompanyCode=sup.SiteCode
                           left join TbCompany cp4 on cp4.CompanyCode=sup.ProcessFactoryCode
                           where (sup.SupplyCompleteTime>sup.SupplyDate or (GETDATE()>sup.SupplyDate and sup.SupplyCompleteTime is null))
						   and YEAR(sup.SupplyDate)= @Year and MONTH(sup.SupplyDate)= @Month  and sup.ProjectId='6372912251695766465' and sup.ProcessFactoryCode='6386683729561128960' and (sup.SiteCode in('6372921375874657752') or sup.WorkAreaCode in('6372921396045311451','6372921398380745033'))) Tb3
                           union all
                           select '加急订单' as YjTypeName,COUNT(1) as YjNum from (--加急订单个数
                           select wo.OrderCode,wo.DistributionTime,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName from TbWorkOrder wo
                           left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on wo.ProcessFactoryCode=cp2.CompanyCode
                           where UrgentDegree='Urgent' 
						   and YEAR(wo.DistributionTime)= @Year and MONTH(wo.DistributionTime)= @Month  and wo.ProjectId='6372912251695766465' and wo.ProcessFactoryCode='6386683729561128960' and wo.SiteCode in('6372921375874657752') ) Tb4
                           union all
                           select '加工进度滞后' as YjTypeName,COUNT(1) as YjNum from (--加工进度滞后
                           select op.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,op.DistributionTime,op.FinishProcessingDateTime from TbOrderProgress op 
                           left join TbCompany cp1 on op.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on op.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(op.DistributionTime)= @Year and MONTH(op.DistributionTime)= @Month
                           and (op.FinishProcessingDateTime>op.DistributionTime or (GETDATE()>op.DistributionTime and op.FinishProcessingDateTime is null))  and op.ProjectId='6372912251695766465' and op.ProcessFactoryCode='6386683729561128960' and op.SiteCode in('6372921375874657752') ) Tb5
                           union all
                           select '接收配送超期' as YjTypeName,COUNT(1) as YjNum from (--配送超期
                           select dpi.OrderCode,cp1.CompanyFullName as SIteName,cp2.CompanyFullName as ProcessFactoryName,dpi.DistributionTime,dpi.DeliveryCompleteTime from TbDistributionPlanInfo dpi
                           left join TbCompany cp1 on dpi.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on dpi.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(dpi.DistributionTime)= @Year and MONTH(dpi.DistributionTime)= @Month
                           and (dpi.DeliveryCompleteTime>dpi.DistributionTime or (GETDATE()>dpi.DistributionTime and dpi.DeliveryCompleteTime is null))  and dpi.ProjectId='6372912251695766465' and dpi.ProcessFactoryCode='6386683729561128960' and dpi.SiteCode in('6372921375874657752') ) Tb6 
                           union all
                           select '卸货超时' as YjTypeName,COUNT(1) as YjNum from(--卸货超时
                           select TbYj.*,cp1.CompanyFullName as SiteName,tcr.EnterSpaceTime,tcr.StartDischargeTime,tcr.EndDischargeTime,disEnt.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SiteDischargeCargo' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbTransportCarReport tcr on TbYj.EWFormDataCode=tcr.DisEntOrderId
                           left join TbDistributionEnt disEnt on tcr.DistributionCode=disEnt.DistributionCode
                           left join TbCompany cp on disEnt.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and disEnt.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ) Tb7
                           union all
                           select '签收超时' as YjTypeName,COUNT(1) as YjNum from (select TbYj.*,cp1.CompanyFullName as SiteName,sfs.DistributionCode,sdc.DistributionTime,sfs.SigninTime,sfs.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SemiFinishedSign' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbSemiFinishedSign sfs on TbYj.EWFormDataCode=sfs.ID
                           left join TbSiteDischargeCargo sdc on sfs.DistributionCode=sdc.DistributionCode and sfs.DischargeCargoCode=sdc.DischargeCargoCode
                           left join TbCompany cp on sfs.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and sfs.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ) Tb8	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 10:19:39
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:19:39
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:19:39
Text:	
                        select fewoi.DataCode as OddNumbers,
                         fewoi.EarlyWarningContent,
                         fewoi.EWFormDataCode,
                         CONVERT(varchar(100), fewoi.EarlyWarningTime, 120) as EarlyWarningTime,
                         EWFormCode,sm.MenuName,fn.FlowNodeName,cp1.CompanyFullName as BranchName,
                         cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,
                         u1.UserName as FlowSpUserName,u2.UserName as FlowYjUserName 
                        FROM (
                        select*
                           FROM ( 
                        		SELECT a.*, row_number()over(partition BY a.FlowCode ORDER BY a.FlowNodeCode,a.EarlyWarningTime desc) as group_idx 
                        		FROM TbFlowEarlyWarningOtherInfo  a
                        		INNER JOIN  TbFlowEarlyWarningInfo b ON a.FlowCode=b.FlowCode 
                        		AND a.EWFormDataCode=b.EWFormDataCode AND a.FlowNodeCode=b.FlowNodeCode 
                        		WHERE YEAR(a.EarlyWarningTime)= @Year and MONTH(a.EarlyWarningTime)= @Month AND b.EarlyWarningStart=0
                           ) ret
                        WHERE ret.group_idx =1
                        ) fewoi
                        left join TbFlowNode fn on fewoi.FlowCode=fn.FlowCode and fewoi.FlowNodeCode=fn.FlowNodeCode
                        left join TbSysMenu sm on fewoi.EWFormCode=sm.MenuCode
                        left join TbCompany cp1 on fewoi.BranchCode=cp1.CompanyCode
                        left join TbCompany cp2 on fewoi.WorkAreaCode=cp2.CompanyCode
                        left join TbCompany cp3 on fewoi.SiteCode=cp3.CompanyCode
                        left join TbCompany cp4 on fewoi.ProcessFactoryCode=cp4.CompanyCode
                        left join TbUser u1 on fewoi.FlowSpUserCode=u1.UserId
                        left join TbUser u2 on fewoi.FlowYjUserCode=u2.UserId where 1=1 and fewoi.ProjectId='6372912251695766465' and fewoi.ProcessFactoryCode='6386683729561128960' and (fewoi.SiteCode in('6372921375874657752') or fewoi.WorkAreaCode in('6372921396045311451','6372921398380745033')) ORDER BY fewoi.EarlyWarningTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 10:19:40
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:19:40
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode353) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode354,@WorkAreaCode355))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus356) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth357))) 	
Parameters:
@ProcessFactoryCode353[String] = 6386683729561128960
@WorkAreaCode354[String] = 6372921396045311451
@WorkAreaCode355[String] = 6372921398380745033
@Examinestatus356[String] = 审核完成
@DemandMonth357[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 10:19:50
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 10:19:50
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-13 10:19:50
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:19:50
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:19:50
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 10:19:50
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-13 10:19:50
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 10:19:50
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:19:50
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:19:50
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 10:19:50
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 10:19:50
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:19:50
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:19:50
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 10:19:51
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 10:19:51
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 10:19:52
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 10:19:52
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:19:52
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:19:52
Text:	select 
                           a.RootNumber,
                           a.SizeSelection,
                           a.MaterialCode,
                           a.WeightSmallPlanN,
                           b.MaterialName,
                           b.SpecificationModel,
                           b.MeasurementUnitZl,
                           c.CompanyFullName StartSiteName,
                           d.CompanyFullName EndSiteName
                           from 
                           (
                           select 
                           a.MaterialCode,
                           a.Size as SizeSelection,
                           a.StartSiteCode,
                           a.EndSiteCode,
                           sum(a.Number) RootNumber,
                           sum(a.Weight) WeightSmallPlanN
                           from TbCloutStockPlace a
                           left join TbRMProductionMaterial rmpm on a.CollarCode=rmpm.CollarCode
                           where a.State=1 
                           and (ISNULL(@ProjectId,'')='' OR a.ProjectId=@ProjectId)
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                            and a.EndSiteCode in('6372921375874657752')
                           group by a.MaterialCode,a.Size,a.StartSiteCode,a.EndSiteCode
                           ) a
                           left join TbRawMaterialArchives b on a.MaterialCode=b.MaterialCode
                           left join TbCompany c on c.CompanyCode=a.StartSiteCode
                           left join TbCompany d on d.CompanyCode=a.EndSiteCode
                           where 1=1 
                           and (ISNULL(@MaterialName,'')='' or b.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or b.SpecificationModel like '%'+@SpecificationModel+'%')	
Parameters:
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 
@BegTime[DateTime] = 
@EndTime[DateTime] = 


-----------------------------------------------------------------------------
2020-07-13 10:19:52
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode asc)AS Row, * from (select 
                           a.RootNumber,
                           a.SizeSelection,
                           a.MaterialCode,
                           a.WeightSmallPlanN,
                           b.MaterialName,
                           b.SpecificationModel,
                           b.MeasurementUnitZl,
                           c.CompanyFullName StartSiteName,
                           d.CompanyFullName EndSiteName
                           from 
                           (
                           select 
                           a.MaterialCode,
                           a.Size as SizeSelection,
                           a.StartSiteCode,
                           a.EndSiteCode,
                           sum(a.Number) RootNumber,
                           sum(a.Weight) WeightSmallPlanN
                           from TbCloutStockPlace a
                           left join TbRMProductionMaterial rmpm on a.CollarCode=rmpm.CollarCode
                           where a.State=1 
                           and (ISNULL(@ProjectId,'')='' OR a.ProjectId=@ProjectId)
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                            and a.EndSiteCode in('6372921375874657752')
                           group by a.MaterialCode,a.Size,a.StartSiteCode,a.EndSiteCode
                           ) a
                           left join TbRawMaterialArchives b on a.MaterialCode=b.MaterialCode
                           left join TbCompany c on c.CompanyCode=a.StartSiteCode
                           left join TbCompany d on d.CompanyCode=a.EndSiteCode
                           where 1=1 
                           and (ISNULL(@MaterialName,'')='' or b.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or b.SpecificationModel like '%'+@SpecificationModel+'%')) as a)  SELECT * FROM temptbl where Row between 1 and 50	
Parameters:
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 
@BegTime[DateTime] = 
@EndTime[DateTime] = 


-----------------------------------------------------------------------------
2020-07-13 10:19:56
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:19:56
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:19:56
Text:	select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 10:19:56
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 10:19:56
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='BuildingSteel'	


-----------------------------------------------------------------------------
2020-07-13 10:19:56
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='SectionSteel'	


-----------------------------------------------------------------------------
2020-07-13 10:19:57
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)	


-----------------------------------------------------------------------------
2020-07-13 10:19:57
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 10:19:57
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)	


-----------------------------------------------------------------------------
2020-07-13 10:19:57
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 10:19:59
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:19:59
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:19:59
Text:	select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 10:19:59
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 10:19:59
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='BuildingSteel'	


-----------------------------------------------------------------------------
2020-07-13 10:19:59
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='SectionSteel'	


-----------------------------------------------------------------------------
2020-07-13 10:19:59
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:19:59
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:20:57
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:20:57
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:20:57
Text:	select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 10:20:57
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 10:20:57
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='BuildingSteel'	


-----------------------------------------------------------------------------
2020-07-13 10:20:57
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='SectionSteel'	


-----------------------------------------------------------------------------
2020-07-13 10:20:57
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:20:57
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:21:47
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:22:32
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 10:22:32
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-13 10:22:32
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:22:32
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:22:33
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 10:22:33
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-13 10:22:33
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 10:22:33
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 10:22:33
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:22:33
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:22:33
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 10:22:33
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 10:22:33
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:22:33
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:22:33
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 10:22:33
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 10:22:34
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 10:22:36
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:22:36
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:22:36
Text:	select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 10:22:36
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 10:22:36
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='BuildingSteel'	


-----------------------------------------------------------------------------
2020-07-13 10:22:36
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='SectionSteel'	


-----------------------------------------------------------------------------
2020-07-13 10:22:36
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)	


-----------------------------------------------------------------------------
2020-07-13 10:22:36
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 10:22:37
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)	


-----------------------------------------------------------------------------
2020-07-13 10:22:37
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 10:22:48
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:22:48
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:22:48
Text:	select 
                           a.RootNumber,
                           a.SizeSelection,
                           a.MaterialCode,
                           a.WeightSmallPlanN,
                           b.MaterialName,
                           b.SpecificationModel,
                           b.MeasurementUnitZl,
                           c.CompanyFullName StartSiteName,
                           d.CompanyFullName EndSiteName
                           from 
                           (
                           select 
                           a.MaterialCode,
                           a.Size as SizeSelection,
                           a.StartSiteCode,
                           a.EndSiteCode,
                           sum(a.Number) RootNumber,
                           sum(a.Weight) WeightSmallPlanN
                           from TbCloutStockPlace a
                           left join TbRMProductionMaterial rmpm on a.CollarCode=rmpm.CollarCode
                           where a.State=1 
                           and (ISNULL(@ProjectId,'')='' OR a.ProjectId=@ProjectId)
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                            and a.EndSiteCode in('6372921375874657752')
                           group by a.MaterialCode,a.Size,a.StartSiteCode,a.EndSiteCode
                           ) a
                           left join TbRawMaterialArchives b on a.MaterialCode=b.MaterialCode
                           left join TbCompany c on c.CompanyCode=a.StartSiteCode
                           left join TbCompany d on d.CompanyCode=a.EndSiteCode
                           where 1=1 
                           and (ISNULL(@MaterialName,'')='' or b.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or b.SpecificationModel like '%'+@SpecificationModel+'%')	
Parameters:
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 
@BegTime[DateTime] = 
@EndTime[DateTime] = 


-----------------------------------------------------------------------------
2020-07-13 10:22:48
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode asc)AS Row, * from (select 
                           a.RootNumber,
                           a.SizeSelection,
                           a.MaterialCode,
                           a.WeightSmallPlanN,
                           b.MaterialName,
                           b.SpecificationModel,
                           b.MeasurementUnitZl,
                           c.CompanyFullName StartSiteName,
                           d.CompanyFullName EndSiteName
                           from 
                           (
                           select 
                           a.MaterialCode,
                           a.Size as SizeSelection,
                           a.StartSiteCode,
                           a.EndSiteCode,
                           sum(a.Number) RootNumber,
                           sum(a.Weight) WeightSmallPlanN
                           from TbCloutStockPlace a
                           left join TbRMProductionMaterial rmpm on a.CollarCode=rmpm.CollarCode
                           where a.State=1 
                           and (ISNULL(@ProjectId,'')='' OR a.ProjectId=@ProjectId)
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                            and a.EndSiteCode in('6372921375874657752')
                           group by a.MaterialCode,a.Size,a.StartSiteCode,a.EndSiteCode
                           ) a
                           left join TbRawMaterialArchives b on a.MaterialCode=b.MaterialCode
                           left join TbCompany c on c.CompanyCode=a.StartSiteCode
                           left join TbCompany d on d.CompanyCode=a.EndSiteCode
                           where 1=1 
                           and (ISNULL(@MaterialName,'')='' or b.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or b.SpecificationModel like '%'+@SpecificationModel+'%')) as a)  SELECT * FROM temptbl where Row between 1 and 50	
Parameters:
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 
@BegTime[DateTime] = 
@EndTime[DateTime] = 


-----------------------------------------------------------------------------
2020-07-13 10:24:47
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:27:47
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:29:17
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:29:17
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:29:17
Text:	select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 10:29:17
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 10:29:17
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='BuildingSteel'	


-----------------------------------------------------------------------------
2020-07-13 10:29:17
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='SectionSteel'	


-----------------------------------------------------------------------------
2020-07-13 10:29:18
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:29:18
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:30:47
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:33:47
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:36:47
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:38:34
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:38:34
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:38:34
Text:	select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 10:38:34
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 10:38:34
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='BuildingSteel'	


-----------------------------------------------------------------------------
2020-07-13 10:38:34
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='SectionSteel'	


-----------------------------------------------------------------------------
2020-07-13 10:38:34
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:38:34
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:38:36
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:38:36
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:38:36
Text:	select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 10:38:36
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 10:38:36
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='BuildingSteel'	


-----------------------------------------------------------------------------
2020-07-13 10:38:36
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='SectionSteel'	


-----------------------------------------------------------------------------
2020-07-13 10:38:36
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:38:36
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:39:47
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:42:47
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:45:42
Text:	select tsm.* from TbRoleMenu tum
                           left join TbSysMenu tsm on tum.MenuCode=tsm.MenuCode
                           where tsm.IsShow=0 and tsm.MenuType='PC' and tum.RoleCode in('6372919444627396738','6372919451594895243') order by tsm.Sort asc	


-----------------------------------------------------------------------------
2020-07-13 10:45:42
Text:	select 
                        	tsm.*
                        from TbUserMenu tum
                        left join TbSysMenu tsm on tum.MenuCode=tsm.MenuCode
                        where tsm.IsShow=0 and tsm.MenuType='PC' and tum.UserCode=@userCode order by tsm.Sort asc	
Parameters:
@userCode[String] = 6372930471544160074


-----------------------------------------------------------------------------
2020-07-13 10:45:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:45:42
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 10:45:42
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 10:45:42
Text:	select isnull(sum(TbCF.Capacity),0) as Capacity,isnull(sum(TbCF.WeightSmallPlan),0) as WeightSmallPlan,isnull(cast(sum(TbCF.WeightSmallPlan)/sum(TbCF.Capacity)*100 as decimal(18,2)),0) as ActualLoadNew from (select cf.Capacity,Tb1.WeightSmallPlan,cf.ProcessFactoryCode from TbCapacityFilling cf  
left join(
select SUM(Tb.WeightSmallPlan) as WeightSmallPlan,Tb.ProcessFactoryCode from (
                            select isnull(SUM(wod.WeightSmallPlan),0) as WeightSmallPlan,wo.ProcessFactoryCode from TbWorkOrder wo
                            left join TbWorkOrderDetail wod on wo.OrderCode=wod.OrderCode
                            where (ISNULL(@ProcessFactoryCode,'')='' or wo.ProcessFactoryCode=@ProcessFactoryCode)
                            and CONVERT(varchar(7), wo.DistributionTime, 120)=@month
                            and wod.RevokeStart='正常' and wo.ProcessingState!='ConfirmWork' and wo.ProcessingState!='Finishing'  group by wo.ProcessFactoryCode
                            union all
                            select isnull(sum(opd.NoCompleted),0) as NoCompleted,op.ProcessFactoryCode from TbOrderProgress op
                            left join TbOrderProgressDetail opd on op.OrderCode=opd.OrderCode 
                            where (ISNULL(@ProcessFactoryCode,'')='' or op.ProcessFactoryCode=@ProcessFactoryCode)
                            and CONVERT(varchar(7), op.DistributionTime, 120)=CONVERT(varchar(4),YEAR(DATEADD(MONTH,-1,@month+'-01')))+'-'+Right(100+Month(DATEADD(MONTH,-1,@month+'-01')),2)
                            and opd.RevokeStart='正常'  group by op.ProcessFactoryCode)Tb  group by Tb.ProcessFactoryCode
) Tb1 on cf.ProcessFactoryCode=Tb1.ProcessFactoryCode 
where cf.CapacityMonth=@month
and (ISNULL(@ProcessFactoryCode,'')='' or cf.ProcessFactoryCode=@ProcessFactoryCode)) TbCF where (ISNULL(@ProcessFactoryCode,'')='' or TbCF.ProcessFactoryCode=@ProcessFactoryCode)	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@month[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 10:45:42
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:45:42
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode358) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode359,@WorkAreaCode360))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus361) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth362))) 	
Parameters:
@ProcessFactoryCode358[String] = 6386683729561128960
@WorkAreaCode359[String] = 6372921396045311451
@WorkAreaCode360[String] = 6372921398380745033
@Examinestatus361[String] = 审核完成
@DemandMonth362[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 10:45:43
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:45:43
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:45:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:45:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:45:43
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode365) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode366))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState367)) 	
Parameters:
@ProcessFactoryCode365[String] = 6386683729561128960
@SiteCode366[String] = 6372921375874657752
@ProcessingState367[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-13 10:45:43
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-13 10:45:43
Text:	 SELECT   [TbOrderProgress].[ProcessingState],[TbOrderProgress].[OrderCode],[TbOrderProgress].[FinishProcessingDateTime],[TbOrderProgress].[DistributionTime],[TbOrderProgress].[SiteCode] FROM [TbOrderProgress]  WHERE ((([TbOrderProgress].[SiteCode] IN (@SiteCode363)) AND ([TbOrderProgress].[ProcessFactoryCode] = @ProcessFactoryCode364)) AND ((YEAR(DistributionTime)=2020 and MONTH(DistributionTime)=7) or (DistributionTime<'2020/7/1 0:00:00' and (ProcessingState!='Finishing')))) 	
Parameters:
@SiteCode363[String] = 6372921375874657752
@ProcessFactoryCode364[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-13 10:45:43
Text:	 SELECT   * FROM [TbWorkOrderDetail]  WHERE (1=2) AND ([TbWorkOrderDetail].[DaetailWorkStrat] = @DaetailWorkStrat368) 	
Parameters:
@DaetailWorkStrat368[String] = 未加工


-----------------------------------------------------------------------------
2020-07-13 10:45:43
Text:	 SELECT   [TbOrderProgress].[WeightTotal] AS [TotalWeight],[TbCompany].[ParentCompanyCode] FROM [TbOrderProgress] LEFT OUTER JOIN [TbCompany] ON ([TbOrderProgress].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((1=2) AND ([TbOrderProgress].[ProcessingState] <> @ProcessingState369)) AND ((([TbOrderProgress].[FinishProcessingDateTime] is not null ) AND ([TbOrderProgress].[DistributionTime] < [TbOrderProgress].[FinishProcessingDateTime])) OR (([TbOrderProgress].[FinishProcessingDateTime] is null ) AND ([TbOrderProgress].[DistributionTime] < @DistributionTime370)))) 	
Parameters:
@ProcessingState369[String] = Finishing
@DistributionTime370[DateTime] = 2020/7/13 0:00:00


-----------------------------------------------------------------------------
2020-07-13 10:45:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:45:43
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode371) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode372))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState373)) 	
Parameters:
@ProcessFactoryCode371[String] = 6386683729561128960
@SiteCode372[String] = 6372921375874657752
@ProcessingState373[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-13 10:45:43
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-13 10:45:44
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:45:44
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode375) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode376,@WorkAreaCode377))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus378) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth379))) 	
Parameters:
@ProcessFactoryCode375[String] = 6386683729561128960
@WorkAreaCode376[String] = 6372921396045311451
@WorkAreaCode377[String] = 6372921398380745033
@Examinestatus378[String] = 审核完成
@DemandMonth379[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 10:45:44
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:45:44
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:45:44
Text:	 SELECT   [TbRawMaterialStockRecord].[MaterialCode],sum([TbRawMaterialStockRecord].[UseCount]) AS [UseCount],sum([TbRawMaterialStockRecord].[LockCount]) AS [LockCount] FROM [TbRawMaterialStockRecord] LEFT OUTER JOIN [TbStorage] ON ([TbRawMaterialStockRecord].[StorageCode] = [TbStorage].[StorageCode]) LEFT OUTER JOIN [TbRawMaterialArchives] ON ([TbRawMaterialStockRecord].[MaterialCode] = [TbRawMaterialArchives].[MaterialCode])  WHERE ((([TbStorage].[ProcessFactoryCode] = @ProcessFactoryCode382) AND ([TbRawMaterialStockRecord].[WorkAreaCode] IN (@WorkAreaCode384,@WorkAreaCode385))) AND ([TbRawMaterialArchives].[RebarType] = @RebarType387)) GROUP BY [TbRawMaterialStockRecord].[MaterialCode] 	
Parameters:
@ProcessFactoryCode382[String] = 6386683729561128960
@WorkAreaCode384[String] = 6372921396045311451
@WorkAreaCode385[String] = 6372921398380745033
@RebarType387[String] = BuildingSteel


-----------------------------------------------------------------------------
2020-07-13 10:45:44
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:45:44
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:45:44
Text:	 SELECT   [TbRawMaterialStockRecord].[MaterialCode],sum([TbRawMaterialStockRecord].[UseCount]) AS [UseCount],sum([TbRawMaterialStockRecord].[LockCount]) AS [LockCount] FROM [TbRawMaterialStockRecord] LEFT OUTER JOIN [TbStorage] ON ([TbRawMaterialStockRecord].[StorageCode] = [TbStorage].[StorageCode]) LEFT OUTER JOIN [TbRawMaterialArchives] ON ([TbRawMaterialStockRecord].[MaterialCode] = [TbRawMaterialArchives].[MaterialCode])  WHERE ((([TbStorage].[ProcessFactoryCode] = @ProcessFactoryCode391) AND ([TbRawMaterialStockRecord].[WorkAreaCode] IN (@WorkAreaCode393,@WorkAreaCode394))) AND ([TbRawMaterialArchives].[RebarType] = @RebarType396)) GROUP BY [TbRawMaterialStockRecord].[MaterialCode] 	
Parameters:
@ProcessFactoryCode391[String] = 6386683729561128960
@WorkAreaCode393[String] = 6372921396045311451
@WorkAreaCode394[String] = 6372921398380745033
@RebarType396[String] = SectionSteel


-----------------------------------------------------------------------------
2020-07-13 10:45:44
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:45:44
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode398) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode399,@WorkAreaCode400))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus401) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth402))) 	
Parameters:
@ProcessFactoryCode398[String] = 6386683729561128960
@WorkAreaCode399[String] = 6372921396045311451
@WorkAreaCode400[String] = 6372921398380745033
@Examinestatus401[String] = 审核完成
@DemandMonth402[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 10:45:44
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:45:44
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:45:44
Text:	
                        select fewoi.DataCode as OddNumbers,
                         fewoi.EarlyWarningContent,
                         fewoi.EWFormDataCode,
                         CONVERT(varchar(100), fewoi.EarlyWarningTime, 120) as EarlyWarningTime,
                         EWFormCode,sm.MenuName,fn.FlowNodeName,cp1.CompanyFullName as BranchName,
                         cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,
                         u1.UserName as FlowSpUserName,u2.UserName as FlowYjUserName 
                        FROM (
                        select*
                           FROM ( 
                        		SELECT a.*, row_number()over(partition BY a.FlowCode ORDER BY a.FlowNodeCode,a.EarlyWarningTime desc) as group_idx 
                        		FROM TbFlowEarlyWarningOtherInfo  a
                        		INNER JOIN  TbFlowEarlyWarningInfo b ON a.FlowCode=b.FlowCode 
                        		AND a.EWFormDataCode=b.EWFormDataCode AND a.FlowNodeCode=b.FlowNodeCode 
                        		WHERE YEAR(a.EarlyWarningTime)= @Year and MONTH(a.EarlyWarningTime)= @Month AND b.EarlyWarningStart=0
                           ) ret
                        WHERE ret.group_idx =1
                        ) fewoi
                        left join TbFlowNode fn on fewoi.FlowCode=fn.FlowCode and fewoi.FlowNodeCode=fn.FlowNodeCode
                        left join TbSysMenu sm on fewoi.EWFormCode=sm.MenuCode
                        left join TbCompany cp1 on fewoi.BranchCode=cp1.CompanyCode
                        left join TbCompany cp2 on fewoi.WorkAreaCode=cp2.CompanyCode
                        left join TbCompany cp3 on fewoi.SiteCode=cp3.CompanyCode
                        left join TbCompany cp4 on fewoi.ProcessFactoryCode=cp4.CompanyCode
                        left join TbUser u1 on fewoi.FlowSpUserCode=u1.UserId
                        left join TbUser u2 on fewoi.FlowYjUserCode=u2.UserId where 1=1 and fewoi.ProjectId='6372912251695766465' and fewoi.ProcessFactoryCode='6386683729561128960' and (fewoi.SiteCode in('6372921375874657752') or fewoi.WorkAreaCode in('6372921396045311451','6372921398380745033')) ORDER BY fewoi.EarlyWarningTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 10:45:44
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:45:44
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:45:44
Text:	--原材料供货超时
                           select BatchPlanNum,cp1.CompanyFullName as BranchName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,sup.SupplyDate,sup.SupplyCompleteTime,sup.ProjectId,sup.Remarks from TbSupplyList sup
                           left join TbCompany cp1 on cp1.CompanyCode=sup.BranchCode
                           left join TbCompany cp2 on cp2.CompanyCode=sup.WorkAreaCode
                           left join TbCompany cp3 on cp3.CompanyCode=sup.SiteCode
                           left join TbCompany cp4 on cp4.CompanyCode=sup.ProcessFactoryCode
                           where YEAR(sup.SupplyDate)= @Year and MONTH(sup.SupplyDate)= @Month
                           and (sup.SupplyCompleteTime>sup.SupplyDate or (GETDATE()>sup.SupplyDate and sup.SupplyCompleteTime is null))  and sup.ProjectId='6372912251695766465' and sup.ProcessFactoryCode='6386683729561128960' and (sup.SiteCode in('6372921375874657752') or sup.WorkAreaCode in('6372921396045311451','6372921398380745033'))	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 10:45:44
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:45:44
Text:	--加工进度滞后
                           select op.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,op.DistributionTime,op.FinishProcessingDateTime from TbOrderProgress op 
                           left join TbCompany cp1 on op.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on op.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(op.DistributionTime)= @Year and MONTH(op.DistributionTime)= @Month
                           and (op.FinishProcessingDateTime>op.DistributionTime or (GETDATE()>op.DistributionTime and op.FinishProcessingDateTime is null))  and op.ProjectId='6372912251695766465' and op.ProcessFactoryCode='6386683729561128960' and op.SiteCode in('6372921375874657752') ORDER BY op.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 10:45:44
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:45:44
Text:	--配送超期
                           select dpi.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,dpi.DistributionTime,dpi.DeliveryCompleteTime,dpi.Remark from TbDistributionPlanInfo dpi
                           left join TbCompany cp1 on dpi.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on dpi.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(dpi.DistributionTime)= @Year and MONTH(dpi.DistributionTime)= @Month
                           and (dpi.DeliveryCompleteTime>dpi.DistributionTime or (GETDATE()>dpi.DistributionTime and dpi.DeliveryCompleteTime is null))  and dpi.ProjectId='6372912251695766465' and dpi.ProcessFactoryCode='6386683729561128960' and dpi.SiteCode in('6372921375874657752') ORDER BY dpi.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 10:45:44
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:45:44
Text:	select TbYj.*,cp1.CompanyFullName as SiteName,tcr.EnterSpaceTime,tcr.StartDischargeTime,tcr.EndDischargeTime,disEnt.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SiteDischargeCargo' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbTransportCarReport tcr on TbYj.EWFormDataCode=tcr.DisEntOrderId
                           left join TbDistributionEnt disEnt on tcr.DistributionCode=disEnt.DistributionCode
                           left join TbCompany cp on disEnt.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and disEnt.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ORDER BY tcr.EnterSpaceTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 10:45:44
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:45:44
Text:	select TbYj.*,cp1.CompanyFullName as SiteName,sfs.DistributionCode,sdc.DistributionTime,sfs.SigninTime,sfs.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SemiFinishedSign' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbSemiFinishedSign sfs on TbYj.EWFormDataCode=sfs.ID
                           left join TbSiteDischargeCargo sdc on sfs.DistributionCode=sdc.DistributionCode and sfs.DischargeCargoCode=sdc.DischargeCargoCode
                           left join TbCompany cp on sfs.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month and TbYj.ProjectId='6372912251695766465' and sfs.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752')	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 10:45:44
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:45:44
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode403) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode404,@WorkAreaCode405))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus406) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth407))) 	
Parameters:
@ProcessFactoryCode403[String] = 6386683729561128960
@WorkAreaCode404[String] = 6372921396045311451
@WorkAreaCode405[String] = 6372921398380745033
@Examinestatus406[String] = 审核完成
@DemandMonth407[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 10:45:44
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:45:44
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:45:44
Text:	SELECT sm.MenuName,fwqi.EWContent,fwqi.EWUserCode,u.UserName,fwqi.EWFormDataCode,cp1.CompanyFullName as  FbName,cp2.CompanyFullName as GqName,fwqi.EWTime,sdd.DictionaryText as RebarType  
                   FROM (  
                    select ret.*
                    FROM ( 
                         SELECT *, row_number()over(partition BY EarlyWarningCode,EWFormDataCode ORDER BY EWNodeCode,EWTime desc) as group_idx 
                         FROM TbFormEarlyWarningNodeInfo fwqi
                         WHERE YEAR(fwqi.EWTime)= @Year and MONTH(fwqi.EWTime)= @Month AND fwqi.MenuCode='RawMonthDemandPlan' AND fwqi.EWStart=0
                    ) ret
                    WHERE ret.group_idx = 1
                   ) fwqi
                    left join TbSysMenu sm on fwqi.MenuCode=sm.MenuCode
                            left join TbCompany cp1 on fwqi.CompanyCode=cp1.CompanyCode
                            left join TbCompany cp2 on fwqi.WorkArea=cp2.CompanyCode
                            left join TbCompany cp3 on fwqi.SiteCode=cp3.CompanyCode
                            left join TbUser u on fwqi.EWUserCode=u.UserId
                            left join TbRawMaterialMonthDemandPlan rmp on fwqi.EWFormDataCode=rmp.ID
                            left join TbSysDictionaryData sdd on sdd.DictionaryCode=rmp.RebarType
                    where 1=1 and fwqi.ProjectId='6372912251695766465' and (fwqi.SiteCode in('6372921375874657752') or fwqi.WorkArea in('6372921396045311451','6372921398380745033')) ORDER BY fwqi.EWTime DESC	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 10:45:45
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:45:45
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:45:45
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:45:45
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:45:45
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:45:45
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:45:45
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:45:45
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:45:45
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:45:45
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:45:45
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:45:45
Text:	SELECT 
                            '审批超时' as YjTypeName,COUNT(1) as YjNum
                            FROM (
									SELECT a.*, row_number()over(partition BY a.FlowCode ORDER BY a.FlowNodeCode,a.EarlyWarningTime desc) as group_idx 
									FROM TbFlowEarlyWarningOtherInfo  a
									INNER JOIN  TbFlowEarlyWarningInfo b ON a.FlowCode=b.FlowCode 
									AND a.EWFormDataCode=b.EWFormDataCode AND a.FlowNodeCode=b.FlowNodeCode 
									WHERE  b.EarlyWarningStart=0 AND YEAR(a.EarlyWarningTime)= @Year and MONTH(a.EarlyWarningTime)= @Month  and a.ProjectId='6372912251695766465' and a.ProcessFactoryCode='6386683729561128960' and (a.SiteCode in('6372921375874657752') or a.WorkAreaCode in('6372921396045311451','6372921398380745033'))
							   ) Tb1
                            WHERE Tb1.group_idx =1
                           union all
                            select '未报月度需求计划' as YjTypeName,COUNT(1)as YjNum
                             FROM ( 
                                  SELECT *, row_number()over(partition BY EarlyWarningCode,EWFormDataCode ORDER BY EWNodeCode,EWTime desc) as group_idx 
                                  FROM TbFormEarlyWarningNodeInfo fwqi
                                  WHERE fwqi.MenuCode='RawMonthDemandPlan' AND fwqi.EWStart=0 AND YEAR(fwqi.EWTime)= @Year and MONTH(fwqi.EWTime)= @Month  and fwqi.ProjectId='6372912251695766465' and (fwqi.SiteCode in('6372921375874657752') or fwqi.WorkArea in('6372921396045311451','6372921398380745033'))  
                             ) Tb2
                             WHERE Tb2.group_idx =1
                           union all
                           select '原材料供货超时' as YjTypeName,COUNT(1) as YjNum from (
                           select BatchPlanNum,cp1.CompanyFullName as BranchName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,sup.SupplyDate,sup.SupplyCompleteTime,sup.ProjectId from TbSupplyList sup
                           left join TbCompany cp1 on cp1.CompanyCode=sup.BranchCode
                           left join TbCompany cp2 on cp2.CompanyCode=sup.WorkAreaCode
                           left join TbCompany cp3 on cp3.CompanyCode=sup.SiteCode
                           left join TbCompany cp4 on cp4.CompanyCode=sup.ProcessFactoryCode
                           where (sup.SupplyCompleteTime>sup.SupplyDate or (GETDATE()>sup.SupplyDate and sup.SupplyCompleteTime is null))
						   and YEAR(sup.SupplyDate)= @Year and MONTH(sup.SupplyDate)= @Month  and sup.ProjectId='6372912251695766465' and sup.ProcessFactoryCode='6386683729561128960' and (sup.SiteCode in('6372921375874657752') or sup.WorkAreaCode in('6372921396045311451','6372921398380745033'))) Tb3
                           union all
                           select '加急订单' as YjTypeName,COUNT(1) as YjNum from (--加急订单个数
                           select wo.OrderCode,wo.DistributionTime,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName from TbWorkOrder wo
                           left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on wo.ProcessFactoryCode=cp2.CompanyCode
                           where UrgentDegree='Urgent' 
						   and YEAR(wo.DistributionTime)= @Year and MONTH(wo.DistributionTime)= @Month  and wo.ProjectId='6372912251695766465' and wo.ProcessFactoryCode='6386683729561128960' and wo.SiteCode in('6372921375874657752') ) Tb4
                           union all
                           select '加工进度滞后' as YjTypeName,COUNT(1) as YjNum from (--加工进度滞后
                           select op.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,op.DistributionTime,op.FinishProcessingDateTime from TbOrderProgress op 
                           left join TbCompany cp1 on op.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on op.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(op.DistributionTime)= @Year and MONTH(op.DistributionTime)= @Month
                           and (op.FinishProcessingDateTime>op.DistributionTime or (GETDATE()>op.DistributionTime and op.FinishProcessingDateTime is null))  and op.ProjectId='6372912251695766465' and op.ProcessFactoryCode='6386683729561128960' and op.SiteCode in('6372921375874657752') ) Tb5
                           union all
                           select '接收配送超期' as YjTypeName,COUNT(1) as YjNum from (--配送超期
                           select dpi.OrderCode,cp1.CompanyFullName as SIteName,cp2.CompanyFullName as ProcessFactoryName,dpi.DistributionTime,dpi.DeliveryCompleteTime from TbDistributionPlanInfo dpi
                           left join TbCompany cp1 on dpi.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on dpi.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(dpi.DistributionTime)= @Year and MONTH(dpi.DistributionTime)= @Month
                           and (dpi.DeliveryCompleteTime>dpi.DistributionTime or (GETDATE()>dpi.DistributionTime and dpi.DeliveryCompleteTime is null))  and dpi.ProjectId='6372912251695766465' and dpi.ProcessFactoryCode='6386683729561128960' and dpi.SiteCode in('6372921375874657752') ) Tb6 
                           union all
                           select '卸货超时' as YjTypeName,COUNT(1) as YjNum from(--卸货超时
                           select TbYj.*,cp1.CompanyFullName as SiteName,tcr.EnterSpaceTime,tcr.StartDischargeTime,tcr.EndDischargeTime,disEnt.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SiteDischargeCargo' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbTransportCarReport tcr on TbYj.EWFormDataCode=tcr.DisEntOrderId
                           left join TbDistributionEnt disEnt on tcr.DistributionCode=disEnt.DistributionCode
                           left join TbCompany cp on disEnt.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and disEnt.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ) Tb7
                           union all
                           select '签收超时' as YjTypeName,COUNT(1) as YjNum from (select TbYj.*,cp1.CompanyFullName as SiteName,sfs.DistributionCode,sdc.DistributionTime,sfs.SigninTime,sfs.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SemiFinishedSign' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbSemiFinishedSign sfs on TbYj.EWFormDataCode=sfs.ID
                           left join TbSiteDischargeCargo sdc on sfs.DistributionCode=sdc.DistributionCode and sfs.DischargeCargoCode=sdc.DischargeCargoCode
                           left join TbCompany cp on sfs.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and sfs.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ) Tb8	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 10:45:45
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:45:45
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:45:45
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode410) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode411))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState412)) 	
Parameters:
@ProcessFactoryCode410[String] = 6386683729561128960
@SiteCode411[String] = 6372921375874657752
@ProcessingState412[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-13 10:45:45
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-13 10:45:45
Text:	 SELECT   [TbOrderProgress].[ProcessingState],[TbOrderProgress].[OrderCode],[TbOrderProgress].[FinishProcessingDateTime],[TbOrderProgress].[DistributionTime],[TbOrderProgress].[SiteCode] FROM [TbOrderProgress]  WHERE ((([TbOrderProgress].[SiteCode] IN (@SiteCode408)) AND ([TbOrderProgress].[ProcessFactoryCode] = @ProcessFactoryCode409)) AND ((YEAR(DistributionTime)=2020 and MONTH(DistributionTime)=7) or (DistributionTime<'2020/7/1 0:00:00' and (ProcessingState!='Finishing')))) 	
Parameters:
@SiteCode408[String] = 6372921375874657752
@ProcessFactoryCode409[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-13 10:45:45
Text:	 SELECT   * FROM [TbWorkOrderDetail]  WHERE (1=2) AND ([TbWorkOrderDetail].[DaetailWorkStrat] = @DaetailWorkStrat413) 	
Parameters:
@DaetailWorkStrat413[String] = 未加工


-----------------------------------------------------------------------------
2020-07-13 10:45:45
Text:	 SELECT   [TbOrderProgress].[WeightTotal] AS [TotalWeight],[TbCompany].[ParentCompanyCode] FROM [TbOrderProgress] LEFT OUTER JOIN [TbCompany] ON ([TbOrderProgress].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((1=2) AND ([TbOrderProgress].[ProcessingState] <> @ProcessingState414)) AND ((([TbOrderProgress].[FinishProcessingDateTime] is not null ) AND ([TbOrderProgress].[DistributionTime] < [TbOrderProgress].[FinishProcessingDateTime])) OR (([TbOrderProgress].[FinishProcessingDateTime] is null ) AND ([TbOrderProgress].[DistributionTime] < @DistributionTime415)))) 	
Parameters:
@ProcessingState414[String] = Finishing
@DistributionTime415[DateTime] = 2020/7/13 0:00:00


-----------------------------------------------------------------------------
2020-07-13 10:45:46
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:45:46
Text:	--加急订单个数
                           select wo.OrderCode,wo.DistributionTime,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName from TbWorkOrder wo
                           left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on wo.ProcessFactoryCode=cp2.CompanyCode
                           where UrgentDegree='Urgent'
                           and YEAR(wo.DistributionTime)= @Year and MONTH(wo.DistributionTime)= @Month  and wo.ProjectId='6372912251695766465' and wo.ProcessFactoryCode='6386683729561128960' and wo.SiteCode in('6372921375874657752')  ORDER BY wo.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 10:45:49
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 10:45:49
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-13 10:45:49
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:45:49
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:45:50
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 10:45:50
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-13 10:45:50
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 10:45:50
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:45:50
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:45:50
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 10:45:50
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 10:45:50
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 10:45:50
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:45:50
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:45:50
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 10:45:51
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 10:45:51
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 10:46:04
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:46:04
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:46:04
Text:	select 
                           a.RootNumber,
                           a.SizeSelection,
                           a.MaterialCode,
                           a.WeightSmallPlanN,
                           b.MaterialName,
                           b.SpecificationModel,
                           b.MeasurementUnitZl,
                           c.CompanyFullName StartSiteName,
                           d.CompanyFullName EndSiteName
                           from 
                           (
                           select 
                           a.MaterialCode,
                           a.Size as SizeSelection,
                           a.StartSiteCode,
                           a.EndSiteCode,
                           sum(a.Number) RootNumber,
                           sum(a.Weight) WeightSmallPlanN
                           from TbCloutStockPlace a
                           left join TbRMProductionMaterial rmpm on a.CollarCode=rmpm.CollarCode
                           where a.State=1 
                           and (ISNULL(@ProjectId,'')='' OR a.ProjectId=@ProjectId)
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                            and a.EndSiteCode in('6372921375874657752')
                           group by a.MaterialCode,a.Size,a.StartSiteCode,a.EndSiteCode
                           ) a
                           left join TbRawMaterialArchives b on a.MaterialCode=b.MaterialCode
                           left join TbCompany c on c.CompanyCode=a.StartSiteCode
                           left join TbCompany d on d.CompanyCode=a.EndSiteCode
                           where 1=1 
                           and (ISNULL(@MaterialName,'')='' or b.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or b.SpecificationModel like '%'+@SpecificationModel+'%')	
Parameters:
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 
@BegTime[DateTime] = 
@EndTime[DateTime] = 


-----------------------------------------------------------------------------
2020-07-13 10:46:04
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode asc)AS Row, * from (select 
                           a.RootNumber,
                           a.SizeSelection,
                           a.MaterialCode,
                           a.WeightSmallPlanN,
                           b.MaterialName,
                           b.SpecificationModel,
                           b.MeasurementUnitZl,
                           c.CompanyFullName StartSiteName,
                           d.CompanyFullName EndSiteName
                           from 
                           (
                           select 
                           a.MaterialCode,
                           a.Size as SizeSelection,
                           a.StartSiteCode,
                           a.EndSiteCode,
                           sum(a.Number) RootNumber,
                           sum(a.Weight) WeightSmallPlanN
                           from TbCloutStockPlace a
                           left join TbRMProductionMaterial rmpm on a.CollarCode=rmpm.CollarCode
                           where a.State=1 
                           and (ISNULL(@ProjectId,'')='' OR a.ProjectId=@ProjectId)
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                            and a.EndSiteCode in('6372921375874657752')
                           group by a.MaterialCode,a.Size,a.StartSiteCode,a.EndSiteCode
                           ) a
                           left join TbRawMaterialArchives b on a.MaterialCode=b.MaterialCode
                           left join TbCompany c on c.CompanyCode=a.StartSiteCode
                           left join TbCompany d on d.CompanyCode=a.EndSiteCode
                           where 1=1 
                           and (ISNULL(@MaterialName,'')='' or b.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or b.SpecificationModel like '%'+@SpecificationModel+'%')) as a)  SELECT * FROM temptbl where Row between 1 and 50	
Parameters:
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 
@BegTime[DateTime] = 
@EndTime[DateTime] = 


-----------------------------------------------------------------------------
2020-07-13 10:46:07
Text:	select tsm.* from TbRoleMenu tum
                           left join TbSysMenu tsm on tum.MenuCode=tsm.MenuCode
                           where tsm.IsShow=0 and tsm.MenuType='PC' and tum.RoleCode in('6372919444627396738','6372919451594895243') order by tsm.Sort asc	


-----------------------------------------------------------------------------
2020-07-13 10:46:07
Text:	select 
                        	tsm.*
                        from TbUserMenu tum
                        left join TbSysMenu tsm on tum.MenuCode=tsm.MenuCode
                        where tsm.IsShow=0 and tsm.MenuType='PC' and tum.UserCode=@userCode order by tsm.Sort asc	
Parameters:
@userCode[String] = 6372930471544160074


-----------------------------------------------------------------------------
2020-07-13 10:46:07
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:46:07
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 10:46:07
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 10:46:08
Text:	select isnull(sum(TbCF.Capacity),0) as Capacity,isnull(sum(TbCF.WeightSmallPlan),0) as WeightSmallPlan,isnull(cast(sum(TbCF.WeightSmallPlan)/sum(TbCF.Capacity)*100 as decimal(18,2)),0) as ActualLoadNew from (select cf.Capacity,Tb1.WeightSmallPlan,cf.ProcessFactoryCode from TbCapacityFilling cf  
left join(
select SUM(Tb.WeightSmallPlan) as WeightSmallPlan,Tb.ProcessFactoryCode from (
                            select isnull(SUM(wod.WeightSmallPlan),0) as WeightSmallPlan,wo.ProcessFactoryCode from TbWorkOrder wo
                            left join TbWorkOrderDetail wod on wo.OrderCode=wod.OrderCode
                            where (ISNULL(@ProcessFactoryCode,'')='' or wo.ProcessFactoryCode=@ProcessFactoryCode)
                            and CONVERT(varchar(7), wo.DistributionTime, 120)=@month
                            and wod.RevokeStart='正常' and wo.ProcessingState!='ConfirmWork' and wo.ProcessingState!='Finishing'  group by wo.ProcessFactoryCode
                            union all
                            select isnull(sum(opd.NoCompleted),0) as NoCompleted,op.ProcessFactoryCode from TbOrderProgress op
                            left join TbOrderProgressDetail opd on op.OrderCode=opd.OrderCode 
                            where (ISNULL(@ProcessFactoryCode,'')='' or op.ProcessFactoryCode=@ProcessFactoryCode)
                            and CONVERT(varchar(7), op.DistributionTime, 120)=CONVERT(varchar(4),YEAR(DATEADD(MONTH,-1,@month+'-01')))+'-'+Right(100+Month(DATEADD(MONTH,-1,@month+'-01')),2)
                            and opd.RevokeStart='正常'  group by op.ProcessFactoryCode)Tb  group by Tb.ProcessFactoryCode
) Tb1 on cf.ProcessFactoryCode=Tb1.ProcessFactoryCode 
where cf.CapacityMonth=@month
and (ISNULL(@ProcessFactoryCode,'')='' or cf.ProcessFactoryCode=@ProcessFactoryCode)) TbCF where (ISNULL(@ProcessFactoryCode,'')='' or TbCF.ProcessFactoryCode=@ProcessFactoryCode)	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@month[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 10:46:08
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:46:08
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode416) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode417,@WorkAreaCode418))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus419) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth420))) 	
Parameters:
@ProcessFactoryCode416[String] = 6386683729561128960
@WorkAreaCode417[String] = 6372921396045311451
@WorkAreaCode418[String] = 6372921398380745033
@Examinestatus419[String] = 审核完成
@DemandMonth420[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 10:46:08
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:46:08
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:46:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:46:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:46:09
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode423) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode424))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState425)) 	
Parameters:
@ProcessFactoryCode423[String] = 6386683729561128960
@SiteCode424[String] = 6372921375874657752
@ProcessingState425[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-13 10:46:09
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-13 10:46:09
Text:	 SELECT   [TbOrderProgress].[ProcessingState],[TbOrderProgress].[OrderCode],[TbOrderProgress].[FinishProcessingDateTime],[TbOrderProgress].[DistributionTime],[TbOrderProgress].[SiteCode] FROM [TbOrderProgress]  WHERE ((([TbOrderProgress].[SiteCode] IN (@SiteCode421)) AND ([TbOrderProgress].[ProcessFactoryCode] = @ProcessFactoryCode422)) AND ((YEAR(DistributionTime)=2020 and MONTH(DistributionTime)=7) or (DistributionTime<'2020/7/1 0:00:00' and (ProcessingState!='Finishing')))) 	
Parameters:
@SiteCode421[String] = 6372921375874657752
@ProcessFactoryCode422[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-13 10:46:09
Text:	 SELECT   * FROM [TbWorkOrderDetail]  WHERE (1=2) AND ([TbWorkOrderDetail].[DaetailWorkStrat] = @DaetailWorkStrat426) 	
Parameters:
@DaetailWorkStrat426[String] = 未加工


-----------------------------------------------------------------------------
2020-07-13 10:46:09
Text:	 SELECT   [TbOrderProgress].[WeightTotal] AS [TotalWeight],[TbCompany].[ParentCompanyCode] FROM [TbOrderProgress] LEFT OUTER JOIN [TbCompany] ON ([TbOrderProgress].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((1=2) AND ([TbOrderProgress].[ProcessingState] <> @ProcessingState427)) AND ((([TbOrderProgress].[FinishProcessingDateTime] is not null ) AND ([TbOrderProgress].[DistributionTime] < [TbOrderProgress].[FinishProcessingDateTime])) OR (([TbOrderProgress].[FinishProcessingDateTime] is null ) AND ([TbOrderProgress].[DistributionTime] < @DistributionTime428)))) 	
Parameters:
@ProcessingState427[String] = Finishing
@DistributionTime428[DateTime] = 2020/7/13 0:00:00


-----------------------------------------------------------------------------
2020-07-13 10:46:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:46:09
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode429) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode430))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState431)) 	
Parameters:
@ProcessFactoryCode429[String] = 6386683729561128960
@SiteCode430[String] = 6372921375874657752
@ProcessingState431[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-13 10:46:09
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-13 10:46:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:46:09
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode433) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode434,@WorkAreaCode435))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus436) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth437))) 	
Parameters:
@ProcessFactoryCode433[String] = 6386683729561128960
@WorkAreaCode434[String] = 6372921396045311451
@WorkAreaCode435[String] = 6372921398380745033
@Examinestatus436[String] = 审核完成
@DemandMonth437[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 10:46:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:46:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:46:09
Text:	 SELECT   [TbRawMaterialStockRecord].[MaterialCode],sum([TbRawMaterialStockRecord].[UseCount]) AS [UseCount],sum([TbRawMaterialStockRecord].[LockCount]) AS [LockCount] FROM [TbRawMaterialStockRecord] LEFT OUTER JOIN [TbStorage] ON ([TbRawMaterialStockRecord].[StorageCode] = [TbStorage].[StorageCode]) LEFT OUTER JOIN [TbRawMaterialArchives] ON ([TbRawMaterialStockRecord].[MaterialCode] = [TbRawMaterialArchives].[MaterialCode])  WHERE ((([TbStorage].[ProcessFactoryCode] = @ProcessFactoryCode440) AND ([TbRawMaterialStockRecord].[WorkAreaCode] IN (@WorkAreaCode442,@WorkAreaCode443))) AND ([TbRawMaterialArchives].[RebarType] = @RebarType445)) GROUP BY [TbRawMaterialStockRecord].[MaterialCode] 	
Parameters:
@ProcessFactoryCode440[String] = 6386683729561128960
@WorkAreaCode442[String] = 6372921396045311451
@WorkAreaCode443[String] = 6372921398380745033
@RebarType445[String] = BuildingSteel


-----------------------------------------------------------------------------
2020-07-13 10:46:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:46:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:46:09
Text:	 SELECT   [TbRawMaterialStockRecord].[MaterialCode],sum([TbRawMaterialStockRecord].[UseCount]) AS [UseCount],sum([TbRawMaterialStockRecord].[LockCount]) AS [LockCount] FROM [TbRawMaterialStockRecord] LEFT OUTER JOIN [TbStorage] ON ([TbRawMaterialStockRecord].[StorageCode] = [TbStorage].[StorageCode]) LEFT OUTER JOIN [TbRawMaterialArchives] ON ([TbRawMaterialStockRecord].[MaterialCode] = [TbRawMaterialArchives].[MaterialCode])  WHERE ((([TbStorage].[ProcessFactoryCode] = @ProcessFactoryCode449) AND ([TbRawMaterialStockRecord].[WorkAreaCode] IN (@WorkAreaCode451,@WorkAreaCode452))) AND ([TbRawMaterialArchives].[RebarType] = @RebarType454)) GROUP BY [TbRawMaterialStockRecord].[MaterialCode] 	
Parameters:
@ProcessFactoryCode449[String] = 6386683729561128960
@WorkAreaCode451[String] = 6372921396045311451
@WorkAreaCode452[String] = 6372921398380745033
@RebarType454[String] = SectionSteel


-----------------------------------------------------------------------------
2020-07-13 10:46:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:46:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:46:09
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode458) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode459))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState460)) 	
Parameters:
@ProcessFactoryCode458[String] = 6386683729561128960
@SiteCode459[String] = 6372921375874657752
@ProcessingState460[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-13 10:46:09
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-13 10:46:09
Text:	 SELECT   [TbOrderProgress].[ProcessingState],[TbOrderProgress].[OrderCode],[TbOrderProgress].[FinishProcessingDateTime],[TbOrderProgress].[DistributionTime],[TbOrderProgress].[SiteCode] FROM [TbOrderProgress]  WHERE ((([TbOrderProgress].[SiteCode] IN (@SiteCode456)) AND ([TbOrderProgress].[ProcessFactoryCode] = @ProcessFactoryCode457)) AND ((YEAR(DistributionTime)=2020 and MONTH(DistributionTime)=7) or (DistributionTime<'2020/7/1 0:00:00' and (ProcessingState!='Finishing')))) 	
Parameters:
@SiteCode456[String] = 6372921375874657752
@ProcessFactoryCode457[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-13 10:46:09
Text:	 SELECT   * FROM [TbWorkOrderDetail]  WHERE (1=2) AND ([TbWorkOrderDetail].[DaetailWorkStrat] = @DaetailWorkStrat461) 	
Parameters:
@DaetailWorkStrat461[String] = 未加工


-----------------------------------------------------------------------------
2020-07-13 10:46:09
Text:	 SELECT   [TbOrderProgress].[WeightTotal] AS [TotalWeight],[TbCompany].[ParentCompanyCode] FROM [TbOrderProgress] LEFT OUTER JOIN [TbCompany] ON ([TbOrderProgress].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((1=2) AND ([TbOrderProgress].[ProcessingState] <> @ProcessingState462)) AND ((([TbOrderProgress].[FinishProcessingDateTime] is not null ) AND ([TbOrderProgress].[DistributionTime] < [TbOrderProgress].[FinishProcessingDateTime])) OR (([TbOrderProgress].[FinishProcessingDateTime] is null ) AND ([TbOrderProgress].[DistributionTime] < @DistributionTime463)))) 	
Parameters:
@ProcessingState462[String] = Finishing
@DistributionTime463[DateTime] = 2020/7/13 0:00:00


-----------------------------------------------------------------------------
2020-07-13 10:46:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:46:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:46:09
Text:	--原材料供货超时
                           select BatchPlanNum,cp1.CompanyFullName as BranchName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,sup.SupplyDate,sup.SupplyCompleteTime,sup.ProjectId,sup.Remarks from TbSupplyList sup
                           left join TbCompany cp1 on cp1.CompanyCode=sup.BranchCode
                           left join TbCompany cp2 on cp2.CompanyCode=sup.WorkAreaCode
                           left join TbCompany cp3 on cp3.CompanyCode=sup.SiteCode
                           left join TbCompany cp4 on cp4.CompanyCode=sup.ProcessFactoryCode
                           where YEAR(sup.SupplyDate)= @Year and MONTH(sup.SupplyDate)= @Month
                           and (sup.SupplyCompleteTime>sup.SupplyDate or (GETDATE()>sup.SupplyDate and sup.SupplyCompleteTime is null))  and sup.ProjectId='6372912251695766465' and sup.ProcessFactoryCode='6386683729561128960' and (sup.SiteCode in('6372921375874657752') or sup.WorkAreaCode in('6372921396045311451','6372921398380745033'))	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 10:46:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:46:09
Text:	--加急订单个数
                           select wo.OrderCode,wo.DistributionTime,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName from TbWorkOrder wo
                           left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on wo.ProcessFactoryCode=cp2.CompanyCode
                           where UrgentDegree='Urgent'
                           and YEAR(wo.DistributionTime)= @Year and MONTH(wo.DistributionTime)= @Month  and wo.ProjectId='6372912251695766465' and wo.ProcessFactoryCode='6386683729561128960' and wo.SiteCode in('6372921375874657752')  ORDER BY wo.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 10:46:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:46:09
Text:	--加工进度滞后
                           select op.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,op.DistributionTime,op.FinishProcessingDateTime from TbOrderProgress op 
                           left join TbCompany cp1 on op.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on op.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(op.DistributionTime)= @Year and MONTH(op.DistributionTime)= @Month
                           and (op.FinishProcessingDateTime>op.DistributionTime or (GETDATE()>op.DistributionTime and op.FinishProcessingDateTime is null))  and op.ProjectId='6372912251695766465' and op.ProcessFactoryCode='6386683729561128960' and op.SiteCode in('6372921375874657752') ORDER BY op.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 10:46:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:46:09
Text:	--配送超期
                           select dpi.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,dpi.DistributionTime,dpi.DeliveryCompleteTime,dpi.Remark from TbDistributionPlanInfo dpi
                           left join TbCompany cp1 on dpi.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on dpi.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(dpi.DistributionTime)= @Year and MONTH(dpi.DistributionTime)= @Month
                           and (dpi.DeliveryCompleteTime>dpi.DistributionTime or (GETDATE()>dpi.DistributionTime and dpi.DeliveryCompleteTime is null))  and dpi.ProjectId='6372912251695766465' and dpi.ProcessFactoryCode='6386683729561128960' and dpi.SiteCode in('6372921375874657752') ORDER BY dpi.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 10:46:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:46:09
Text:	select TbYj.*,cp1.CompanyFullName as SiteName,tcr.EnterSpaceTime,tcr.StartDischargeTime,tcr.EndDischargeTime,disEnt.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SiteDischargeCargo' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbTransportCarReport tcr on TbYj.EWFormDataCode=tcr.DisEntOrderId
                           left join TbDistributionEnt disEnt on tcr.DistributionCode=disEnt.DistributionCode
                           left join TbCompany cp on disEnt.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and disEnt.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ORDER BY tcr.EnterSpaceTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 10:46:09
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:46:09
Text:	select TbYj.*,cp1.CompanyFullName as SiteName,sfs.DistributionCode,sdc.DistributionTime,sfs.SigninTime,sfs.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SemiFinishedSign' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbSemiFinishedSign sfs on TbYj.EWFormDataCode=sfs.ID
                           left join TbSiteDischargeCargo sdc on sfs.DistributionCode=sdc.DistributionCode and sfs.DischargeCargoCode=sdc.DischargeCargoCode
                           left join TbCompany cp on sfs.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month and TbYj.ProjectId='6372912251695766465' and sfs.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752')	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 10:46:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:46:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:46:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:46:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:46:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:46:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:46:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:46:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:46:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:46:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:46:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:46:10
Text:	SELECT 
                            '审批超时' as YjTypeName,COUNT(1) as YjNum
                            FROM (
									SELECT a.*, row_number()over(partition BY a.FlowCode ORDER BY a.FlowNodeCode,a.EarlyWarningTime desc) as group_idx 
									FROM TbFlowEarlyWarningOtherInfo  a
									INNER JOIN  TbFlowEarlyWarningInfo b ON a.FlowCode=b.FlowCode 
									AND a.EWFormDataCode=b.EWFormDataCode AND a.FlowNodeCode=b.FlowNodeCode 
									WHERE  b.EarlyWarningStart=0 AND YEAR(a.EarlyWarningTime)= @Year and MONTH(a.EarlyWarningTime)= @Month  and a.ProjectId='6372912251695766465' and a.ProcessFactoryCode='6386683729561128960' and (a.SiteCode in('6372921375874657752') or a.WorkAreaCode in('6372921396045311451','6372921398380745033'))
							   ) Tb1
                            WHERE Tb1.group_idx =1
                           union all
                            select '未报月度需求计划' as YjTypeName,COUNT(1)as YjNum
                             FROM ( 
                                  SELECT *, row_number()over(partition BY EarlyWarningCode,EWFormDataCode ORDER BY EWNodeCode,EWTime desc) as group_idx 
                                  FROM TbFormEarlyWarningNodeInfo fwqi
                                  WHERE fwqi.MenuCode='RawMonthDemandPlan' AND fwqi.EWStart=0 AND YEAR(fwqi.EWTime)= @Year and MONTH(fwqi.EWTime)= @Month  and fwqi.ProjectId='6372912251695766465' and (fwqi.SiteCode in('6372921375874657752') or fwqi.WorkArea in('6372921396045311451','6372921398380745033'))  
                             ) Tb2
                             WHERE Tb2.group_idx =1
                           union all
                           select '原材料供货超时' as YjTypeName,COUNT(1) as YjNum from (
                           select BatchPlanNum,cp1.CompanyFullName as BranchName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,sup.SupplyDate,sup.SupplyCompleteTime,sup.ProjectId from TbSupplyList sup
                           left join TbCompany cp1 on cp1.CompanyCode=sup.BranchCode
                           left join TbCompany cp2 on cp2.CompanyCode=sup.WorkAreaCode
                           left join TbCompany cp3 on cp3.CompanyCode=sup.SiteCode
                           left join TbCompany cp4 on cp4.CompanyCode=sup.ProcessFactoryCode
                           where (sup.SupplyCompleteTime>sup.SupplyDate or (GETDATE()>sup.SupplyDate and sup.SupplyCompleteTime is null))
						   and YEAR(sup.SupplyDate)= @Year and MONTH(sup.SupplyDate)= @Month  and sup.ProjectId='6372912251695766465' and sup.ProcessFactoryCode='6386683729561128960' and (sup.SiteCode in('6372921375874657752') or sup.WorkAreaCode in('6372921396045311451','6372921398380745033'))) Tb3
                           union all
                           select '加急订单' as YjTypeName,COUNT(1) as YjNum from (--加急订单个数
                           select wo.OrderCode,wo.DistributionTime,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName from TbWorkOrder wo
                           left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on wo.ProcessFactoryCode=cp2.CompanyCode
                           where UrgentDegree='Urgent' 
						   and YEAR(wo.DistributionTime)= @Year and MONTH(wo.DistributionTime)= @Month  and wo.ProjectId='6372912251695766465' and wo.ProcessFactoryCode='6386683729561128960' and wo.SiteCode in('6372921375874657752') ) Tb4
                           union all
                           select '加工进度滞后' as YjTypeName,COUNT(1) as YjNum from (--加工进度滞后
                           select op.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,op.DistributionTime,op.FinishProcessingDateTime from TbOrderProgress op 
                           left join TbCompany cp1 on op.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on op.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(op.DistributionTime)= @Year and MONTH(op.DistributionTime)= @Month
                           and (op.FinishProcessingDateTime>op.DistributionTime or (GETDATE()>op.DistributionTime and op.FinishProcessingDateTime is null))  and op.ProjectId='6372912251695766465' and op.ProcessFactoryCode='6386683729561128960' and op.SiteCode in('6372921375874657752') ) Tb5
                           union all
                           select '接收配送超期' as YjTypeName,COUNT(1) as YjNum from (--配送超期
                           select dpi.OrderCode,cp1.CompanyFullName as SIteName,cp2.CompanyFullName as ProcessFactoryName,dpi.DistributionTime,dpi.DeliveryCompleteTime from TbDistributionPlanInfo dpi
                           left join TbCompany cp1 on dpi.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on dpi.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(dpi.DistributionTime)= @Year and MONTH(dpi.DistributionTime)= @Month
                           and (dpi.DeliveryCompleteTime>dpi.DistributionTime or (GETDATE()>dpi.DistributionTime and dpi.DeliveryCompleteTime is null))  and dpi.ProjectId='6372912251695766465' and dpi.ProcessFactoryCode='6386683729561128960' and dpi.SiteCode in('6372921375874657752') ) Tb6 
                           union all
                           select '卸货超时' as YjTypeName,COUNT(1) as YjNum from(--卸货超时
                           select TbYj.*,cp1.CompanyFullName as SiteName,tcr.EnterSpaceTime,tcr.StartDischargeTime,tcr.EndDischargeTime,disEnt.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SiteDischargeCargo' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbTransportCarReport tcr on TbYj.EWFormDataCode=tcr.DisEntOrderId
                           left join TbDistributionEnt disEnt on tcr.DistributionCode=disEnt.DistributionCode
                           left join TbCompany cp on disEnt.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and disEnt.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ) Tb7
                           union all
                           select '签收超时' as YjTypeName,COUNT(1) as YjNum from (select TbYj.*,cp1.CompanyFullName as SiteName,sfs.DistributionCode,sdc.DistributionTime,sfs.SigninTime,sfs.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SemiFinishedSign' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbSemiFinishedSign sfs on TbYj.EWFormDataCode=sfs.ID
                           left join TbSiteDischargeCargo sdc on sfs.DistributionCode=sdc.DistributionCode and sfs.DischargeCargoCode=sdc.DischargeCargoCode
                           left join TbCompany cp on sfs.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and sfs.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ) Tb8	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 10:46:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:46:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:46:10
Text:	
                        select fewoi.DataCode as OddNumbers,
                         fewoi.EarlyWarningContent,
                         fewoi.EWFormDataCode,
                         CONVERT(varchar(100), fewoi.EarlyWarningTime, 120) as EarlyWarningTime,
                         EWFormCode,sm.MenuName,fn.FlowNodeName,cp1.CompanyFullName as BranchName,
                         cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,
                         u1.UserName as FlowSpUserName,u2.UserName as FlowYjUserName 
                        FROM (
                        select*
                           FROM ( 
                        		SELECT a.*, row_number()over(partition BY a.FlowCode ORDER BY a.FlowNodeCode,a.EarlyWarningTime desc) as group_idx 
                        		FROM TbFlowEarlyWarningOtherInfo  a
                        		INNER JOIN  TbFlowEarlyWarningInfo b ON a.FlowCode=b.FlowCode 
                        		AND a.EWFormDataCode=b.EWFormDataCode AND a.FlowNodeCode=b.FlowNodeCode 
                        		WHERE YEAR(a.EarlyWarningTime)= @Year and MONTH(a.EarlyWarningTime)= @Month AND b.EarlyWarningStart=0
                           ) ret
                        WHERE ret.group_idx =1
                        ) fewoi
                        left join TbFlowNode fn on fewoi.FlowCode=fn.FlowCode and fewoi.FlowNodeCode=fn.FlowNodeCode
                        left join TbSysMenu sm on fewoi.EWFormCode=sm.MenuCode
                        left join TbCompany cp1 on fewoi.BranchCode=cp1.CompanyCode
                        left join TbCompany cp2 on fewoi.WorkAreaCode=cp2.CompanyCode
                        left join TbCompany cp3 on fewoi.SiteCode=cp3.CompanyCode
                        left join TbCompany cp4 on fewoi.ProcessFactoryCode=cp4.CompanyCode
                        left join TbUser u1 on fewoi.FlowSpUserCode=u1.UserId
                        left join TbUser u2 on fewoi.FlowYjUserCode=u2.UserId where 1=1 and fewoi.ProjectId='6372912251695766465' and fewoi.ProcessFactoryCode='6386683729561128960' and (fewoi.SiteCode in('6372921375874657752') or fewoi.WorkAreaCode in('6372921396045311451','6372921398380745033')) ORDER BY fewoi.EarlyWarningTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 10:46:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:46:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:46:10
Text:	SELECT sm.MenuName,fwqi.EWContent,fwqi.EWUserCode,u.UserName,fwqi.EWFormDataCode,cp1.CompanyFullName as  FbName,cp2.CompanyFullName as GqName,fwqi.EWTime,sdd.DictionaryText as RebarType  
                   FROM (  
                    select ret.*
                    FROM ( 
                         SELECT *, row_number()over(partition BY EarlyWarningCode,EWFormDataCode ORDER BY EWNodeCode,EWTime desc) as group_idx 
                         FROM TbFormEarlyWarningNodeInfo fwqi
                         WHERE YEAR(fwqi.EWTime)= @Year and MONTH(fwqi.EWTime)= @Month AND fwqi.MenuCode='RawMonthDemandPlan' AND fwqi.EWStart=0
                    ) ret
                    WHERE ret.group_idx = 1
                   ) fwqi
                    left join TbSysMenu sm on fwqi.MenuCode=sm.MenuCode
                            left join TbCompany cp1 on fwqi.CompanyCode=cp1.CompanyCode
                            left join TbCompany cp2 on fwqi.WorkArea=cp2.CompanyCode
                            left join TbCompany cp3 on fwqi.SiteCode=cp3.CompanyCode
                            left join TbUser u on fwqi.EWUserCode=u.UserId
                            left join TbRawMaterialMonthDemandPlan rmp on fwqi.EWFormDataCode=rmp.ID
                            left join TbSysDictionaryData sdd on sdd.DictionaryCode=rmp.RebarType
                    where 1=1 and fwqi.ProjectId='6372912251695766465' and (fwqi.SiteCode in('6372921375874657752') or fwqi.WorkArea in('6372921396045311451','6372921398380745033')) ORDER BY fwqi.EWTime DESC	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 10:46:11
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:46:11
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode464) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode465,@WorkAreaCode466))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus467) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth468))) 	
Parameters:
@ProcessFactoryCode464[String] = 6386683729561128960
@WorkAreaCode465[String] = 6372921396045311451
@WorkAreaCode466[String] = 6372921398380745033
@Examinestatus467[String] = 审核完成
@DemandMonth468[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 10:46:11
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:46:11
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode469) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode470,@WorkAreaCode471))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus472) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth473))) 	
Parameters:
@ProcessFactoryCode469[String] = 6386683729561128960
@WorkAreaCode470[String] = 6372921396045311451
@WorkAreaCode471[String] = 6372921398380745033
@Examinestatus472[String] = 审核完成
@DemandMonth473[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 10:46:16
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 10:46:16
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-13 10:46:16
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:46:16
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:46:16
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 10:46:16
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-13 10:46:16
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 10:46:16
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:46:16
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:46:16
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 10:46:16
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 10:46:16
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:46:16
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:46:16
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 10:46:17
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 10:46:17
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 10:46:18
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 10:47:15
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 10:47:15
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-13 10:47:15
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:47:15
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:47:16
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 10:47:16
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-13 10:47:16
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 10:47:16
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 10:47:16
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:47:16
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:47:16
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 10:47:16
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 10:47:16
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 10:47:17
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:47:17
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:47:17
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 10:47:17
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 10:47:49
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:47:49
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:47:49
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:47:49
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:47:52
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 10:47:52
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-13 10:47:52
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:47:52
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:47:52
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 10:47:52
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-13 10:47:52
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 10:47:52
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:47:52
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:47:52
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 10:47:52
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 10:47:52
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:47:52
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:47:52
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 10:47:53
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 10:47:53
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 10:47:54
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 10:47:55
Text:	select tsm.* from TbRoleMenu tum
                           left join TbSysMenu tsm on tum.MenuCode=tsm.MenuCode
                           where tsm.IsShow=0 and tsm.MenuType='PC' and tum.RoleCode in('6372919444627396738','6372919451594895243') order by tsm.Sort asc	


-----------------------------------------------------------------------------
2020-07-13 10:47:55
Text:	select 
                        	tsm.*
                        from TbUserMenu tum
                        left join TbSysMenu tsm on tum.MenuCode=tsm.MenuCode
                        where tsm.IsShow=0 and tsm.MenuType='PC' and tum.UserCode=@userCode order by tsm.Sort asc	
Parameters:
@userCode[String] = 6372930471544160074


-----------------------------------------------------------------------------
2020-07-13 10:47:55
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:47:55
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 10:47:55
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 10:47:55
Text:	select isnull(sum(TbCF.Capacity),0) as Capacity,isnull(sum(TbCF.WeightSmallPlan),0) as WeightSmallPlan,isnull(cast(sum(TbCF.WeightSmallPlan)/sum(TbCF.Capacity)*100 as decimal(18,2)),0) as ActualLoadNew from (select cf.Capacity,Tb1.WeightSmallPlan,cf.ProcessFactoryCode from TbCapacityFilling cf  
left join(
select SUM(Tb.WeightSmallPlan) as WeightSmallPlan,Tb.ProcessFactoryCode from (
                            select isnull(SUM(wod.WeightSmallPlan),0) as WeightSmallPlan,wo.ProcessFactoryCode from TbWorkOrder wo
                            left join TbWorkOrderDetail wod on wo.OrderCode=wod.OrderCode
                            where (ISNULL(@ProcessFactoryCode,'')='' or wo.ProcessFactoryCode=@ProcessFactoryCode)
                            and CONVERT(varchar(7), wo.DistributionTime, 120)=@month
                            and wod.RevokeStart='正常' and wo.ProcessingState!='ConfirmWork' and wo.ProcessingState!='Finishing'  group by wo.ProcessFactoryCode
                            union all
                            select isnull(sum(opd.NoCompleted),0) as NoCompleted,op.ProcessFactoryCode from TbOrderProgress op
                            left join TbOrderProgressDetail opd on op.OrderCode=opd.OrderCode 
                            where (ISNULL(@ProcessFactoryCode,'')='' or op.ProcessFactoryCode=@ProcessFactoryCode)
                            and CONVERT(varchar(7), op.DistributionTime, 120)=CONVERT(varchar(4),YEAR(DATEADD(MONTH,-1,@month+'-01')))+'-'+Right(100+Month(DATEADD(MONTH,-1,@month+'-01')),2)
                            and opd.RevokeStart='正常'  group by op.ProcessFactoryCode)Tb  group by Tb.ProcessFactoryCode
) Tb1 on cf.ProcessFactoryCode=Tb1.ProcessFactoryCode 
where cf.CapacityMonth=@month
and (ISNULL(@ProcessFactoryCode,'')='' or cf.ProcessFactoryCode=@ProcessFactoryCode)) TbCF where (ISNULL(@ProcessFactoryCode,'')='' or TbCF.ProcessFactoryCode=@ProcessFactoryCode)	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@month[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 10:47:55
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:47:55
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode474) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode475,@WorkAreaCode476))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus477) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth478))) 	
Parameters:
@ProcessFactoryCode474[String] = 6386683729561128960
@WorkAreaCode475[String] = 6372921396045311451
@WorkAreaCode476[String] = 6372921398380745033
@Examinestatus477[String] = 审核完成
@DemandMonth478[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 10:47:55
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:47:55
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:47:56
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:47:56
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:47:56
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode481) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode482))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState483)) 	
Parameters:
@ProcessFactoryCode481[String] = 6386683729561128960
@SiteCode482[String] = 6372921375874657752
@ProcessingState483[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-13 10:47:56
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-13 10:47:56
Text:	 SELECT   [TbOrderProgress].[ProcessingState],[TbOrderProgress].[OrderCode],[TbOrderProgress].[FinishProcessingDateTime],[TbOrderProgress].[DistributionTime],[TbOrderProgress].[SiteCode] FROM [TbOrderProgress]  WHERE ((([TbOrderProgress].[SiteCode] IN (@SiteCode479)) AND ([TbOrderProgress].[ProcessFactoryCode] = @ProcessFactoryCode480)) AND ((YEAR(DistributionTime)=2020 and MONTH(DistributionTime)=7) or (DistributionTime<'2020/7/1 0:00:00' and (ProcessingState!='Finishing')))) 	
Parameters:
@SiteCode479[String] = 6372921375874657752
@ProcessFactoryCode480[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-13 10:47:56
Text:	 SELECT   * FROM [TbWorkOrderDetail]  WHERE (1=2) AND ([TbWorkOrderDetail].[DaetailWorkStrat] = @DaetailWorkStrat484) 	
Parameters:
@DaetailWorkStrat484[String] = 未加工


-----------------------------------------------------------------------------
2020-07-13 10:47:56
Text:	 SELECT   [TbOrderProgress].[WeightTotal] AS [TotalWeight],[TbCompany].[ParentCompanyCode] FROM [TbOrderProgress] LEFT OUTER JOIN [TbCompany] ON ([TbOrderProgress].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((1=2) AND ([TbOrderProgress].[ProcessingState] <> @ProcessingState485)) AND ((([TbOrderProgress].[FinishProcessingDateTime] is not null ) AND ([TbOrderProgress].[DistributionTime] < [TbOrderProgress].[FinishProcessingDateTime])) OR (([TbOrderProgress].[FinishProcessingDateTime] is null ) AND ([TbOrderProgress].[DistributionTime] < @DistributionTime486)))) 	
Parameters:
@ProcessingState485[String] = Finishing
@DistributionTime486[DateTime] = 2020/7/13 0:00:00


-----------------------------------------------------------------------------
2020-07-13 10:47:56
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:47:56
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode487) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode488))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState489)) 	
Parameters:
@ProcessFactoryCode487[String] = 6386683729561128960
@SiteCode488[String] = 6372921375874657752
@ProcessingState489[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-13 10:47:56
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-13 10:47:56
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:47:56
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode491) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode492,@WorkAreaCode493))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus494) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth495))) 	
Parameters:
@ProcessFactoryCode491[String] = 6386683729561128960
@WorkAreaCode492[String] = 6372921396045311451
@WorkAreaCode493[String] = 6372921398380745033
@Examinestatus494[String] = 审核完成
@DemandMonth495[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 10:47:56
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:47:56
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:47:56
Text:	 SELECT   [TbRawMaterialStockRecord].[MaterialCode],sum([TbRawMaterialStockRecord].[UseCount]) AS [UseCount],sum([TbRawMaterialStockRecord].[LockCount]) AS [LockCount] FROM [TbRawMaterialStockRecord] LEFT OUTER JOIN [TbStorage] ON ([TbRawMaterialStockRecord].[StorageCode] = [TbStorage].[StorageCode]) LEFT OUTER JOIN [TbRawMaterialArchives] ON ([TbRawMaterialStockRecord].[MaterialCode] = [TbRawMaterialArchives].[MaterialCode])  WHERE ((([TbStorage].[ProcessFactoryCode] = @ProcessFactoryCode498) AND ([TbRawMaterialStockRecord].[WorkAreaCode] IN (@WorkAreaCode500,@WorkAreaCode501))) AND ([TbRawMaterialArchives].[RebarType] = @RebarType503)) GROUP BY [TbRawMaterialStockRecord].[MaterialCode] 	
Parameters:
@ProcessFactoryCode498[String] = 6386683729561128960
@WorkAreaCode500[String] = 6372921396045311451
@WorkAreaCode501[String] = 6372921398380745033
@RebarType503[String] = BuildingSteel


-----------------------------------------------------------------------------
2020-07-13 10:47:56
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:47:56
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:47:56
Text:	 SELECT   [TbRawMaterialStockRecord].[MaterialCode],sum([TbRawMaterialStockRecord].[UseCount]) AS [UseCount],sum([TbRawMaterialStockRecord].[LockCount]) AS [LockCount] FROM [TbRawMaterialStockRecord] LEFT OUTER JOIN [TbStorage] ON ([TbRawMaterialStockRecord].[StorageCode] = [TbStorage].[StorageCode]) LEFT OUTER JOIN [TbRawMaterialArchives] ON ([TbRawMaterialStockRecord].[MaterialCode] = [TbRawMaterialArchives].[MaterialCode])  WHERE ((([TbStorage].[ProcessFactoryCode] = @ProcessFactoryCode507) AND ([TbRawMaterialStockRecord].[WorkAreaCode] IN (@WorkAreaCode509,@WorkAreaCode510))) AND ([TbRawMaterialArchives].[RebarType] = @RebarType512)) GROUP BY [TbRawMaterialStockRecord].[MaterialCode] 	
Parameters:
@ProcessFactoryCode507[String] = 6386683729561128960
@WorkAreaCode509[String] = 6372921396045311451
@WorkAreaCode510[String] = 6372921398380745033
@RebarType512[String] = SectionSteel


-----------------------------------------------------------------------------
2020-07-13 10:47:56
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:47:56
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode514) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode515,@WorkAreaCode516))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus517) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth518))) 	
Parameters:
@ProcessFactoryCode514[String] = 6386683729561128960
@WorkAreaCode515[String] = 6372921396045311451
@WorkAreaCode516[String] = 6372921398380745033
@Examinestatus517[String] = 审核完成
@DemandMonth518[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 10:47:57
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:47:57
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:47:57
Text:	
                        select fewoi.DataCode as OddNumbers,
                         fewoi.EarlyWarningContent,
                         fewoi.EWFormDataCode,
                         CONVERT(varchar(100), fewoi.EarlyWarningTime, 120) as EarlyWarningTime,
                         EWFormCode,sm.MenuName,fn.FlowNodeName,cp1.CompanyFullName as BranchName,
                         cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,
                         u1.UserName as FlowSpUserName,u2.UserName as FlowYjUserName 
                        FROM (
                        select*
                           FROM ( 
                        		SELECT a.*, row_number()over(partition BY a.FlowCode ORDER BY a.FlowNodeCode,a.EarlyWarningTime desc) as group_idx 
                        		FROM TbFlowEarlyWarningOtherInfo  a
                        		INNER JOIN  TbFlowEarlyWarningInfo b ON a.FlowCode=b.FlowCode 
                        		AND a.EWFormDataCode=b.EWFormDataCode AND a.FlowNodeCode=b.FlowNodeCode 
                        		WHERE YEAR(a.EarlyWarningTime)= @Year and MONTH(a.EarlyWarningTime)= @Month AND b.EarlyWarningStart=0
                           ) ret
                        WHERE ret.group_idx =1
                        ) fewoi
                        left join TbFlowNode fn on fewoi.FlowCode=fn.FlowCode and fewoi.FlowNodeCode=fn.FlowNodeCode
                        left join TbSysMenu sm on fewoi.EWFormCode=sm.MenuCode
                        left join TbCompany cp1 on fewoi.BranchCode=cp1.CompanyCode
                        left join TbCompany cp2 on fewoi.WorkAreaCode=cp2.CompanyCode
                        left join TbCompany cp3 on fewoi.SiteCode=cp3.CompanyCode
                        left join TbCompany cp4 on fewoi.ProcessFactoryCode=cp4.CompanyCode
                        left join TbUser u1 on fewoi.FlowSpUserCode=u1.UserId
                        left join TbUser u2 on fewoi.FlowYjUserCode=u2.UserId where 1=1 and fewoi.ProjectId='6372912251695766465' and fewoi.ProcessFactoryCode='6386683729561128960' and (fewoi.SiteCode in('6372921375874657752') or fewoi.WorkAreaCode in('6372921396045311451','6372921398380745033')) ORDER BY fewoi.EarlyWarningTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 10:47:57
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:47:57
Text:	--加急订单个数
                           select wo.OrderCode,wo.DistributionTime,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName from TbWorkOrder wo
                           left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on wo.ProcessFactoryCode=cp2.CompanyCode
                           where UrgentDegree='Urgent'
                           and YEAR(wo.DistributionTime)= @Year and MONTH(wo.DistributionTime)= @Month  and wo.ProjectId='6372912251695766465' and wo.ProcessFactoryCode='6386683729561128960' and wo.SiteCode in('6372921375874657752')  ORDER BY wo.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 10:47:57
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:47:57
Text:	--加工进度滞后
                           select op.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,op.DistributionTime,op.FinishProcessingDateTime from TbOrderProgress op 
                           left join TbCompany cp1 on op.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on op.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(op.DistributionTime)= @Year and MONTH(op.DistributionTime)= @Month
                           and (op.FinishProcessingDateTime>op.DistributionTime or (GETDATE()>op.DistributionTime and op.FinishProcessingDateTime is null))  and op.ProjectId='6372912251695766465' and op.ProcessFactoryCode='6386683729561128960' and op.SiteCode in('6372921375874657752') ORDER BY op.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 10:47:57
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:47:57
Text:	--配送超期
                           select dpi.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,dpi.DistributionTime,dpi.DeliveryCompleteTime,dpi.Remark from TbDistributionPlanInfo dpi
                           left join TbCompany cp1 on dpi.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on dpi.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(dpi.DistributionTime)= @Year and MONTH(dpi.DistributionTime)= @Month
                           and (dpi.DeliveryCompleteTime>dpi.DistributionTime or (GETDATE()>dpi.DistributionTime and dpi.DeliveryCompleteTime is null))  and dpi.ProjectId='6372912251695766465' and dpi.ProcessFactoryCode='6386683729561128960' and dpi.SiteCode in('6372921375874657752') ORDER BY dpi.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 10:47:57
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:47:57
Text:	select TbYj.*,cp1.CompanyFullName as SiteName,tcr.EnterSpaceTime,tcr.StartDischargeTime,tcr.EndDischargeTime,disEnt.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SiteDischargeCargo' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbTransportCarReport tcr on TbYj.EWFormDataCode=tcr.DisEntOrderId
                           left join TbDistributionEnt disEnt on tcr.DistributionCode=disEnt.DistributionCode
                           left join TbCompany cp on disEnt.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and disEnt.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ORDER BY tcr.EnterSpaceTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 10:47:57
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:47:57
Text:	select TbYj.*,cp1.CompanyFullName as SiteName,sfs.DistributionCode,sdc.DistributionTime,sfs.SigninTime,sfs.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SemiFinishedSign' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbSemiFinishedSign sfs on TbYj.EWFormDataCode=sfs.ID
                           left join TbSiteDischargeCargo sdc on sfs.DistributionCode=sdc.DistributionCode and sfs.DischargeCargoCode=sdc.DischargeCargoCode
                           left join TbCompany cp on sfs.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month and TbYj.ProjectId='6372912251695766465' and sfs.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752')	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 10:47:57
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:47:57
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:47:57
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:47:57
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:47:57
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:47:57
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:47:57
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:47:57
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:47:57
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:47:57
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:47:57
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:47:57
Text:	SELECT 
                            '审批超时' as YjTypeName,COUNT(1) as YjNum
                            FROM (
									SELECT a.*, row_number()over(partition BY a.FlowCode ORDER BY a.FlowNodeCode,a.EarlyWarningTime desc) as group_idx 
									FROM TbFlowEarlyWarningOtherInfo  a
									INNER JOIN  TbFlowEarlyWarningInfo b ON a.FlowCode=b.FlowCode 
									AND a.EWFormDataCode=b.EWFormDataCode AND a.FlowNodeCode=b.FlowNodeCode 
									WHERE  b.EarlyWarningStart=0 AND YEAR(a.EarlyWarningTime)= @Year and MONTH(a.EarlyWarningTime)= @Month  and a.ProjectId='6372912251695766465' and a.ProcessFactoryCode='6386683729561128960' and (a.SiteCode in('6372921375874657752') or a.WorkAreaCode in('6372921396045311451','6372921398380745033'))
							   ) Tb1
                            WHERE Tb1.group_idx =1
                           union all
                            select '未报月度需求计划' as YjTypeName,COUNT(1)as YjNum
                             FROM ( 
                                  SELECT *, row_number()over(partition BY EarlyWarningCode,EWFormDataCode ORDER BY EWNodeCode,EWTime desc) as group_idx 
                                  FROM TbFormEarlyWarningNodeInfo fwqi
                                  WHERE fwqi.MenuCode='RawMonthDemandPlan' AND fwqi.EWStart=0 AND YEAR(fwqi.EWTime)= @Year and MONTH(fwqi.EWTime)= @Month  and fwqi.ProjectId='6372912251695766465' and (fwqi.SiteCode in('6372921375874657752') or fwqi.WorkArea in('6372921396045311451','6372921398380745033'))  
                             ) Tb2
                             WHERE Tb2.group_idx =1
                           union all
                           select '原材料供货超时' as YjTypeName,COUNT(1) as YjNum from (
                           select BatchPlanNum,cp1.CompanyFullName as BranchName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,sup.SupplyDate,sup.SupplyCompleteTime,sup.ProjectId from TbSupplyList sup
                           left join TbCompany cp1 on cp1.CompanyCode=sup.BranchCode
                           left join TbCompany cp2 on cp2.CompanyCode=sup.WorkAreaCode
                           left join TbCompany cp3 on cp3.CompanyCode=sup.SiteCode
                           left join TbCompany cp4 on cp4.CompanyCode=sup.ProcessFactoryCode
                           where (sup.SupplyCompleteTime>sup.SupplyDate or (GETDATE()>sup.SupplyDate and sup.SupplyCompleteTime is null))
						   and YEAR(sup.SupplyDate)= @Year and MONTH(sup.SupplyDate)= @Month  and sup.ProjectId='6372912251695766465' and sup.ProcessFactoryCode='6386683729561128960' and (sup.SiteCode in('6372921375874657752') or sup.WorkAreaCode in('6372921396045311451','6372921398380745033'))) Tb3
                           union all
                           select '加急订单' as YjTypeName,COUNT(1) as YjNum from (--加急订单个数
                           select wo.OrderCode,wo.DistributionTime,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName from TbWorkOrder wo
                           left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on wo.ProcessFactoryCode=cp2.CompanyCode
                           where UrgentDegree='Urgent' 
						   and YEAR(wo.DistributionTime)= @Year and MONTH(wo.DistributionTime)= @Month  and wo.ProjectId='6372912251695766465' and wo.ProcessFactoryCode='6386683729561128960' and wo.SiteCode in('6372921375874657752') ) Tb4
                           union all
                           select '加工进度滞后' as YjTypeName,COUNT(1) as YjNum from (--加工进度滞后
                           select op.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,op.DistributionTime,op.FinishProcessingDateTime from TbOrderProgress op 
                           left join TbCompany cp1 on op.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on op.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(op.DistributionTime)= @Year and MONTH(op.DistributionTime)= @Month
                           and (op.FinishProcessingDateTime>op.DistributionTime or (GETDATE()>op.DistributionTime and op.FinishProcessingDateTime is null))  and op.ProjectId='6372912251695766465' and op.ProcessFactoryCode='6386683729561128960' and op.SiteCode in('6372921375874657752') ) Tb5
                           union all
                           select '接收配送超期' as YjTypeName,COUNT(1) as YjNum from (--配送超期
                           select dpi.OrderCode,cp1.CompanyFullName as SIteName,cp2.CompanyFullName as ProcessFactoryName,dpi.DistributionTime,dpi.DeliveryCompleteTime from TbDistributionPlanInfo dpi
                           left join TbCompany cp1 on dpi.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on dpi.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(dpi.DistributionTime)= @Year and MONTH(dpi.DistributionTime)= @Month
                           and (dpi.DeliveryCompleteTime>dpi.DistributionTime or (GETDATE()>dpi.DistributionTime and dpi.DeliveryCompleteTime is null))  and dpi.ProjectId='6372912251695766465' and dpi.ProcessFactoryCode='6386683729561128960' and dpi.SiteCode in('6372921375874657752') ) Tb6 
                           union all
                           select '卸货超时' as YjTypeName,COUNT(1) as YjNum from(--卸货超时
                           select TbYj.*,cp1.CompanyFullName as SiteName,tcr.EnterSpaceTime,tcr.StartDischargeTime,tcr.EndDischargeTime,disEnt.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SiteDischargeCargo' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbTransportCarReport tcr on TbYj.EWFormDataCode=tcr.DisEntOrderId
                           left join TbDistributionEnt disEnt on tcr.DistributionCode=disEnt.DistributionCode
                           left join TbCompany cp on disEnt.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and disEnt.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ) Tb7
                           union all
                           select '签收超时' as YjTypeName,COUNT(1) as YjNum from (select TbYj.*,cp1.CompanyFullName as SiteName,sfs.DistributionCode,sdc.DistributionTime,sfs.SigninTime,sfs.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SemiFinishedSign' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbSemiFinishedSign sfs on TbYj.EWFormDataCode=sfs.ID
                           left join TbSiteDischargeCargo sdc on sfs.DistributionCode=sdc.DistributionCode and sfs.DischargeCargoCode=sdc.DischargeCargoCode
                           left join TbCompany cp on sfs.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and sfs.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ) Tb8	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 10:47:57
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:47:57
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:47:57
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode521) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode522))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState523)) 	
Parameters:
@ProcessFactoryCode521[String] = 6386683729561128960
@SiteCode522[String] = 6372921375874657752
@ProcessingState523[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-13 10:47:58
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-13 10:47:58
Text:	 SELECT   [TbOrderProgress].[ProcessingState],[TbOrderProgress].[OrderCode],[TbOrderProgress].[FinishProcessingDateTime],[TbOrderProgress].[DistributionTime],[TbOrderProgress].[SiteCode] FROM [TbOrderProgress]  WHERE ((([TbOrderProgress].[SiteCode] IN (@SiteCode519)) AND ([TbOrderProgress].[ProcessFactoryCode] = @ProcessFactoryCode520)) AND ((YEAR(DistributionTime)=2020 and MONTH(DistributionTime)=7) or (DistributionTime<'2020/7/1 0:00:00' and (ProcessingState!='Finishing')))) 	
Parameters:
@SiteCode519[String] = 6372921375874657752
@ProcessFactoryCode520[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-13 10:47:58
Text:	 SELECT   * FROM [TbWorkOrderDetail]  WHERE (1=2) AND ([TbWorkOrderDetail].[DaetailWorkStrat] = @DaetailWorkStrat524) 	
Parameters:
@DaetailWorkStrat524[String] = 未加工


-----------------------------------------------------------------------------
2020-07-13 10:47:58
Text:	 SELECT   [TbOrderProgress].[WeightTotal] AS [TotalWeight],[TbCompany].[ParentCompanyCode] FROM [TbOrderProgress] LEFT OUTER JOIN [TbCompany] ON ([TbOrderProgress].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((1=2) AND ([TbOrderProgress].[ProcessingState] <> @ProcessingState525)) AND ((([TbOrderProgress].[FinishProcessingDateTime] is not null ) AND ([TbOrderProgress].[DistributionTime] < [TbOrderProgress].[FinishProcessingDateTime])) OR (([TbOrderProgress].[FinishProcessingDateTime] is null ) AND ([TbOrderProgress].[DistributionTime] < @DistributionTime526)))) 	
Parameters:
@ProcessingState525[String] = Finishing
@DistributionTime526[DateTime] = 2020/7/13 0:00:00


-----------------------------------------------------------------------------
2020-07-13 10:47:58
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:47:58
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode527) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode528,@WorkAreaCode529))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus530) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth531))) 	
Parameters:
@ProcessFactoryCode527[String] = 6386683729561128960
@WorkAreaCode528[String] = 6372921396045311451
@WorkAreaCode529[String] = 6372921398380745033
@Examinestatus530[String] = 审核完成
@DemandMonth531[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 10:47:58
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:47:58
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:47:58
Text:	--原材料供货超时
                           select BatchPlanNum,cp1.CompanyFullName as BranchName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,sup.SupplyDate,sup.SupplyCompleteTime,sup.ProjectId,sup.Remarks from TbSupplyList sup
                           left join TbCompany cp1 on cp1.CompanyCode=sup.BranchCode
                           left join TbCompany cp2 on cp2.CompanyCode=sup.WorkAreaCode
                           left join TbCompany cp3 on cp3.CompanyCode=sup.SiteCode
                           left join TbCompany cp4 on cp4.CompanyCode=sup.ProcessFactoryCode
                           where YEAR(sup.SupplyDate)= @Year and MONTH(sup.SupplyDate)= @Month
                           and (sup.SupplyCompleteTime>sup.SupplyDate or (GETDATE()>sup.SupplyDate and sup.SupplyCompleteTime is null))  and sup.ProjectId='6372912251695766465' and sup.ProcessFactoryCode='6386683729561128960' and (sup.SiteCode in('6372921375874657752') or sup.WorkAreaCode in('6372921396045311451','6372921398380745033'))	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 10:47:59
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:47:59
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:47:59
Text:	SELECT sm.MenuName,fwqi.EWContent,fwqi.EWUserCode,u.UserName,fwqi.EWFormDataCode,cp1.CompanyFullName as  FbName,cp2.CompanyFullName as GqName,fwqi.EWTime,sdd.DictionaryText as RebarType  
                   FROM (  
                    select ret.*
                    FROM ( 
                         SELECT *, row_number()over(partition BY EarlyWarningCode,EWFormDataCode ORDER BY EWNodeCode,EWTime desc) as group_idx 
                         FROM TbFormEarlyWarningNodeInfo fwqi
                         WHERE YEAR(fwqi.EWTime)= @Year and MONTH(fwqi.EWTime)= @Month AND fwqi.MenuCode='RawMonthDemandPlan' AND fwqi.EWStart=0
                    ) ret
                    WHERE ret.group_idx = 1
                   ) fwqi
                    left join TbSysMenu sm on fwqi.MenuCode=sm.MenuCode
                            left join TbCompany cp1 on fwqi.CompanyCode=cp1.CompanyCode
                            left join TbCompany cp2 on fwqi.WorkArea=cp2.CompanyCode
                            left join TbCompany cp3 on fwqi.SiteCode=cp3.CompanyCode
                            left join TbUser u on fwqi.EWUserCode=u.UserId
                            left join TbRawMaterialMonthDemandPlan rmp on fwqi.EWFormDataCode=rmp.ID
                            left join TbSysDictionaryData sdd on sdd.DictionaryCode=rmp.RebarType
                    where 1=1 and fwqi.ProjectId='6372912251695766465' and (fwqi.SiteCode in('6372921375874657752') or fwqi.WorkArea in('6372921396045311451','6372921398380745033')) ORDER BY fwqi.EWTime DESC	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 10:48:04
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 10:48:04
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-13 10:48:04
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:48:04
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:48:05
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 10:48:05
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-13 10:48:05
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 10:48:05
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:48:05
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:48:05
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 10:48:05
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 10:48:05
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 10:48:05
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:48:05
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:48:05
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 10:48:06
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 10:48:06
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 10:48:20
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 10:48:20
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 10:48:20
Text:	select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 10:48:20
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 10:48:20
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='BuildingSteel'	


-----------------------------------------------------------------------------
2020-07-13 10:48:20
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='SectionSteel'	


-----------------------------------------------------------------------------
2020-07-13 10:48:21
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)	


-----------------------------------------------------------------------------
2020-07-13 10:48:21
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 10:48:21
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)	


-----------------------------------------------------------------------------
2020-07-13 10:48:21
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 10:50:55
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:53:55
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:56:55
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 10:59:55
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:02:55
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:05:55
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:07:07
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:07:07
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:07:07
Text:	select 
                           a.RootNumber,
                           a.SizeSelection,
                           a.MaterialCode,
                           a.WeightSmallPlanN,
                           b.MaterialName,
                           b.SpecificationModel,
                           b.MeasurementUnitZl,
                           c.CompanyFullName StartSiteName,
                           d.CompanyFullName EndSiteName
                           from 
                           (
                           select 
                           a.MaterialCode,
                           a.Size as SizeSelection,
                           a.StartSiteCode,
                           a.EndSiteCode,
                           sum(a.Number) RootNumber,
                           sum(a.Weight) WeightSmallPlanN
                           from TbCloutStockPlace a
                           left join TbRMProductionMaterial rmpm on a.CollarCode=rmpm.CollarCode
                           where a.State=1 
                           and (ISNULL(@ProjectId,'')='' OR a.ProjectId=@ProjectId)
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                            and a.EndSiteCode in('6372921375874657752')
                           group by a.MaterialCode,a.Size,a.StartSiteCode,a.EndSiteCode
                           ) a
                           left join TbRawMaterialArchives b on a.MaterialCode=b.MaterialCode
                           left join TbCompany c on c.CompanyCode=a.StartSiteCode
                           left join TbCompany d on d.CompanyCode=a.EndSiteCode
                           where 1=1 
                           and (ISNULL(@MaterialName,'')='' or b.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or b.SpecificationModel like '%'+@SpecificationModel+'%')	
Parameters:
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 
@BegTime[DateTime] = 
@EndTime[DateTime] = 


-----------------------------------------------------------------------------
2020-07-13 11:07:07
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode asc)AS Row, * from (select 
                           a.RootNumber,
                           a.SizeSelection,
                           a.MaterialCode,
                           a.WeightSmallPlanN,
                           b.MaterialName,
                           b.SpecificationModel,
                           b.MeasurementUnitZl,
                           c.CompanyFullName StartSiteName,
                           d.CompanyFullName EndSiteName
                           from 
                           (
                           select 
                           a.MaterialCode,
                           a.Size as SizeSelection,
                           a.StartSiteCode,
                           a.EndSiteCode,
                           sum(a.Number) RootNumber,
                           sum(a.Weight) WeightSmallPlanN
                           from TbCloutStockPlace a
                           left join TbRMProductionMaterial rmpm on a.CollarCode=rmpm.CollarCode
                           where a.State=1 
                           and (ISNULL(@ProjectId,'')='' OR a.ProjectId=@ProjectId)
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                            and a.EndSiteCode in('6372921375874657752')
                           group by a.MaterialCode,a.Size,a.StartSiteCode,a.EndSiteCode
                           ) a
                           left join TbRawMaterialArchives b on a.MaterialCode=b.MaterialCode
                           left join TbCompany c on c.CompanyCode=a.StartSiteCode
                           left join TbCompany d on d.CompanyCode=a.EndSiteCode
                           where 1=1 
                           and (ISNULL(@MaterialName,'')='' or b.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or b.SpecificationModel like '%'+@SpecificationModel+'%')) as a)  SELECT * FROM temptbl where Row between 1 and 50	
Parameters:
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 
@BegTime[DateTime] = 
@EndTime[DateTime] = 


-----------------------------------------------------------------------------
2020-07-13 11:07:09
Text:	select tsm.* from TbRoleMenu tum
                           left join TbSysMenu tsm on tum.MenuCode=tsm.MenuCode
                           where tsm.IsShow=0 and tsm.MenuType='PC' and tum.RoleCode in('6372919444627396738','6372919451594895243') order by tsm.Sort asc	


-----------------------------------------------------------------------------
2020-07-13 11:07:09
Text:	select 
                        	tsm.*
                        from TbUserMenu tum
                        left join TbSysMenu tsm on tum.MenuCode=tsm.MenuCode
                        where tsm.IsShow=0 and tsm.MenuType='PC' and tum.UserCode=@userCode order by tsm.Sort asc	
Parameters:
@userCode[String] = 6372930471544160074


-----------------------------------------------------------------------------
2020-07-13 11:07:09
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:07:09
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 11:07:09
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 11:07:09
Text:	select isnull(sum(TbCF.Capacity),0) as Capacity,isnull(sum(TbCF.WeightSmallPlan),0) as WeightSmallPlan,isnull(cast(sum(TbCF.WeightSmallPlan)/sum(TbCF.Capacity)*100 as decimal(18,2)),0) as ActualLoadNew from (select cf.Capacity,Tb1.WeightSmallPlan,cf.ProcessFactoryCode from TbCapacityFilling cf  
left join(
select SUM(Tb.WeightSmallPlan) as WeightSmallPlan,Tb.ProcessFactoryCode from (
                            select isnull(SUM(wod.WeightSmallPlan),0) as WeightSmallPlan,wo.ProcessFactoryCode from TbWorkOrder wo
                            left join TbWorkOrderDetail wod on wo.OrderCode=wod.OrderCode
                            where (ISNULL(@ProcessFactoryCode,'')='' or wo.ProcessFactoryCode=@ProcessFactoryCode)
                            and CONVERT(varchar(7), wo.DistributionTime, 120)=@month
                            and wod.RevokeStart='正常' and wo.ProcessingState!='ConfirmWork' and wo.ProcessingState!='Finishing'  group by wo.ProcessFactoryCode
                            union all
                            select isnull(sum(opd.NoCompleted),0) as NoCompleted,op.ProcessFactoryCode from TbOrderProgress op
                            left join TbOrderProgressDetail opd on op.OrderCode=opd.OrderCode 
                            where (ISNULL(@ProcessFactoryCode,'')='' or op.ProcessFactoryCode=@ProcessFactoryCode)
                            and CONVERT(varchar(7), op.DistributionTime, 120)=CONVERT(varchar(4),YEAR(DATEADD(MONTH,-1,@month+'-01')))+'-'+Right(100+Month(DATEADD(MONTH,-1,@month+'-01')),2)
                            and opd.RevokeStart='正常'  group by op.ProcessFactoryCode)Tb  group by Tb.ProcessFactoryCode
) Tb1 on cf.ProcessFactoryCode=Tb1.ProcessFactoryCode 
where cf.CapacityMonth=@month
and (ISNULL(@ProcessFactoryCode,'')='' or cf.ProcessFactoryCode=@ProcessFactoryCode)) TbCF where (ISNULL(@ProcessFactoryCode,'')='' or TbCF.ProcessFactoryCode=@ProcessFactoryCode)	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@month[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 11:07:10
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:07:10
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode532) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode533,@WorkAreaCode534))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus535) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth536))) 	
Parameters:
@ProcessFactoryCode532[String] = 6386683729561128960
@WorkAreaCode533[String] = 6372921396045311451
@WorkAreaCode534[String] = 6372921398380745033
@Examinestatus535[String] = 审核完成
@DemandMonth536[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 11:07:10
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:07:10
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:07:11
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:07:11
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:07:11
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode539) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode540))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState541)) 	
Parameters:
@ProcessFactoryCode539[String] = 6386683729561128960
@SiteCode540[String] = 6372921375874657752
@ProcessingState541[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-13 11:07:11
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-13 11:07:11
Text:	 SELECT   [TbOrderProgress].[ProcessingState],[TbOrderProgress].[OrderCode],[TbOrderProgress].[FinishProcessingDateTime],[TbOrderProgress].[DistributionTime],[TbOrderProgress].[SiteCode] FROM [TbOrderProgress]  WHERE ((([TbOrderProgress].[SiteCode] IN (@SiteCode537)) AND ([TbOrderProgress].[ProcessFactoryCode] = @ProcessFactoryCode538)) AND ((YEAR(DistributionTime)=2020 and MONTH(DistributionTime)=7) or (DistributionTime<'2020/7/1 0:00:00' and (ProcessingState!='Finishing')))) 	
Parameters:
@SiteCode537[String] = 6372921375874657752
@ProcessFactoryCode538[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-13 11:07:11
Text:	 SELECT   * FROM [TbWorkOrderDetail]  WHERE (1=2) AND ([TbWorkOrderDetail].[DaetailWorkStrat] = @DaetailWorkStrat542) 	
Parameters:
@DaetailWorkStrat542[String] = 未加工


-----------------------------------------------------------------------------
2020-07-13 11:07:11
Text:	 SELECT   [TbOrderProgress].[WeightTotal] AS [TotalWeight],[TbCompany].[ParentCompanyCode] FROM [TbOrderProgress] LEFT OUTER JOIN [TbCompany] ON ([TbOrderProgress].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((1=2) AND ([TbOrderProgress].[ProcessingState] <> @ProcessingState543)) AND ((([TbOrderProgress].[FinishProcessingDateTime] is not null ) AND ([TbOrderProgress].[DistributionTime] < [TbOrderProgress].[FinishProcessingDateTime])) OR (([TbOrderProgress].[FinishProcessingDateTime] is null ) AND ([TbOrderProgress].[DistributionTime] < @DistributionTime544)))) 	
Parameters:
@ProcessingState543[String] = Finishing
@DistributionTime544[DateTime] = 2020/7/13 0:00:00


-----------------------------------------------------------------------------
2020-07-13 11:07:11
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:07:11
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode545) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode546))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState547)) 	
Parameters:
@ProcessFactoryCode545[String] = 6386683729561128960
@SiteCode546[String] = 6372921375874657752
@ProcessingState547[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-13 11:07:11
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-13 11:07:11
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:07:11
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode549) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode550,@WorkAreaCode551))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus552) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth553))) 	
Parameters:
@ProcessFactoryCode549[String] = 6386683729561128960
@WorkAreaCode550[String] = 6372921396045311451
@WorkAreaCode551[String] = 6372921398380745033
@Examinestatus552[String] = 审核完成
@DemandMonth553[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 11:07:11
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:07:11
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:07:11
Text:	 SELECT   [TbRawMaterialStockRecord].[MaterialCode],sum([TbRawMaterialStockRecord].[UseCount]) AS [UseCount],sum([TbRawMaterialStockRecord].[LockCount]) AS [LockCount] FROM [TbRawMaterialStockRecord] LEFT OUTER JOIN [TbStorage] ON ([TbRawMaterialStockRecord].[StorageCode] = [TbStorage].[StorageCode]) LEFT OUTER JOIN [TbRawMaterialArchives] ON ([TbRawMaterialStockRecord].[MaterialCode] = [TbRawMaterialArchives].[MaterialCode])  WHERE ((([TbStorage].[ProcessFactoryCode] = @ProcessFactoryCode556) AND ([TbRawMaterialStockRecord].[WorkAreaCode] IN (@WorkAreaCode558,@WorkAreaCode559))) AND ([TbRawMaterialArchives].[RebarType] = @RebarType561)) GROUP BY [TbRawMaterialStockRecord].[MaterialCode] 	
Parameters:
@ProcessFactoryCode556[String] = 6386683729561128960
@WorkAreaCode558[String] = 6372921396045311451
@WorkAreaCode559[String] = 6372921398380745033
@RebarType561[String] = BuildingSteel


-----------------------------------------------------------------------------
2020-07-13 11:07:11
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:07:11
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:07:11
Text:	 SELECT   [TbRawMaterialStockRecord].[MaterialCode],sum([TbRawMaterialStockRecord].[UseCount]) AS [UseCount],sum([TbRawMaterialStockRecord].[LockCount]) AS [LockCount] FROM [TbRawMaterialStockRecord] LEFT OUTER JOIN [TbStorage] ON ([TbRawMaterialStockRecord].[StorageCode] = [TbStorage].[StorageCode]) LEFT OUTER JOIN [TbRawMaterialArchives] ON ([TbRawMaterialStockRecord].[MaterialCode] = [TbRawMaterialArchives].[MaterialCode])  WHERE ((([TbStorage].[ProcessFactoryCode] = @ProcessFactoryCode565) AND ([TbRawMaterialStockRecord].[WorkAreaCode] IN (@WorkAreaCode567,@WorkAreaCode568))) AND ([TbRawMaterialArchives].[RebarType] = @RebarType570)) GROUP BY [TbRawMaterialStockRecord].[MaterialCode] 	
Parameters:
@ProcessFactoryCode565[String] = 6386683729561128960
@WorkAreaCode567[String] = 6372921396045311451
@WorkAreaCode568[String] = 6372921398380745033
@RebarType570[String] = SectionSteel


-----------------------------------------------------------------------------
2020-07-13 11:07:11
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:07:11
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:07:11
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode574) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode575))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState576)) 	
Parameters:
@ProcessFactoryCode574[String] = 6386683729561128960
@SiteCode575[String] = 6372921375874657752
@ProcessingState576[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-13 11:07:11
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-13 11:07:11
Text:	 SELECT   [TbOrderProgress].[ProcessingState],[TbOrderProgress].[OrderCode],[TbOrderProgress].[FinishProcessingDateTime],[TbOrderProgress].[DistributionTime],[TbOrderProgress].[SiteCode] FROM [TbOrderProgress]  WHERE ((([TbOrderProgress].[SiteCode] IN (@SiteCode572)) AND ([TbOrderProgress].[ProcessFactoryCode] = @ProcessFactoryCode573)) AND ((YEAR(DistributionTime)=2020 and MONTH(DistributionTime)=7) or (DistributionTime<'2020/7/1 0:00:00' and (ProcessingState!='Finishing')))) 	
Parameters:
@SiteCode572[String] = 6372921375874657752
@ProcessFactoryCode573[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-13 11:07:11
Text:	 SELECT   * FROM [TbWorkOrderDetail]  WHERE (1=2) AND ([TbWorkOrderDetail].[DaetailWorkStrat] = @DaetailWorkStrat577) 	
Parameters:
@DaetailWorkStrat577[String] = 未加工


-----------------------------------------------------------------------------
2020-07-13 11:07:11
Text:	 SELECT   [TbOrderProgress].[WeightTotal] AS [TotalWeight],[TbCompany].[ParentCompanyCode] FROM [TbOrderProgress] LEFT OUTER JOIN [TbCompany] ON ([TbOrderProgress].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((1=2) AND ([TbOrderProgress].[ProcessingState] <> @ProcessingState578)) AND ((([TbOrderProgress].[FinishProcessingDateTime] is not null ) AND ([TbOrderProgress].[DistributionTime] < [TbOrderProgress].[FinishProcessingDateTime])) OR (([TbOrderProgress].[FinishProcessingDateTime] is null ) AND ([TbOrderProgress].[DistributionTime] < @DistributionTime579)))) 	
Parameters:
@ProcessingState578[String] = Finishing
@DistributionTime579[DateTime] = 2020/7/13 0:00:00


-----------------------------------------------------------------------------
2020-07-13 11:07:11
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:07:11
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:07:11
Text:	--原材料供货超时
                           select BatchPlanNum,cp1.CompanyFullName as BranchName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,sup.SupplyDate,sup.SupplyCompleteTime,sup.ProjectId,sup.Remarks from TbSupplyList sup
                           left join TbCompany cp1 on cp1.CompanyCode=sup.BranchCode
                           left join TbCompany cp2 on cp2.CompanyCode=sup.WorkAreaCode
                           left join TbCompany cp3 on cp3.CompanyCode=sup.SiteCode
                           left join TbCompany cp4 on cp4.CompanyCode=sup.ProcessFactoryCode
                           where YEAR(sup.SupplyDate)= @Year and MONTH(sup.SupplyDate)= @Month
                           and (sup.SupplyCompleteTime>sup.SupplyDate or (GETDATE()>sup.SupplyDate and sup.SupplyCompleteTime is null))  and sup.ProjectId='6372912251695766465' and sup.ProcessFactoryCode='6386683729561128960' and (sup.SiteCode in('6372921375874657752') or sup.WorkAreaCode in('6372921396045311451','6372921398380745033'))	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 11:07:11
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:07:11
Text:	--加急订单个数
                           select wo.OrderCode,wo.DistributionTime,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName from TbWorkOrder wo
                           left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on wo.ProcessFactoryCode=cp2.CompanyCode
                           where UrgentDegree='Urgent'
                           and YEAR(wo.DistributionTime)= @Year and MONTH(wo.DistributionTime)= @Month  and wo.ProjectId='6372912251695766465' and wo.ProcessFactoryCode='6386683729561128960' and wo.SiteCode in('6372921375874657752')  ORDER BY wo.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 11:07:11
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:07:11
Text:	--加工进度滞后
                           select op.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,op.DistributionTime,op.FinishProcessingDateTime from TbOrderProgress op 
                           left join TbCompany cp1 on op.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on op.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(op.DistributionTime)= @Year and MONTH(op.DistributionTime)= @Month
                           and (op.FinishProcessingDateTime>op.DistributionTime or (GETDATE()>op.DistributionTime and op.FinishProcessingDateTime is null))  and op.ProjectId='6372912251695766465' and op.ProcessFactoryCode='6386683729561128960' and op.SiteCode in('6372921375874657752') ORDER BY op.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 11:07:11
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:07:11
Text:	--配送超期
                           select dpi.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,dpi.DistributionTime,dpi.DeliveryCompleteTime,dpi.Remark from TbDistributionPlanInfo dpi
                           left join TbCompany cp1 on dpi.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on dpi.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(dpi.DistributionTime)= @Year and MONTH(dpi.DistributionTime)= @Month
                           and (dpi.DeliveryCompleteTime>dpi.DistributionTime or (GETDATE()>dpi.DistributionTime and dpi.DeliveryCompleteTime is null))  and dpi.ProjectId='6372912251695766465' and dpi.ProcessFactoryCode='6386683729561128960' and dpi.SiteCode in('6372921375874657752') ORDER BY dpi.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 11:07:11
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:07:11
Text:	select TbYj.*,cp1.CompanyFullName as SiteName,tcr.EnterSpaceTime,tcr.StartDischargeTime,tcr.EndDischargeTime,disEnt.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SiteDischargeCargo' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbTransportCarReport tcr on TbYj.EWFormDataCode=tcr.DisEntOrderId
                           left join TbDistributionEnt disEnt on tcr.DistributionCode=disEnt.DistributionCode
                           left join TbCompany cp on disEnt.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and disEnt.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ORDER BY tcr.EnterSpaceTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 11:07:11
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:07:11
Text:	select TbYj.*,cp1.CompanyFullName as SiteName,sfs.DistributionCode,sdc.DistributionTime,sfs.SigninTime,sfs.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SemiFinishedSign' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbSemiFinishedSign sfs on TbYj.EWFormDataCode=sfs.ID
                           left join TbSiteDischargeCargo sdc on sfs.DistributionCode=sdc.DistributionCode and sfs.DischargeCargoCode=sdc.DischargeCargoCode
                           left join TbCompany cp on sfs.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month and TbYj.ProjectId='6372912251695766465' and sfs.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752')	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 11:07:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:07:12
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode580) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode581,@WorkAreaCode582))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus583) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth584))) 	
Parameters:
@ProcessFactoryCode580[String] = 6386683729561128960
@WorkAreaCode581[String] = 6372921396045311451
@WorkAreaCode582[String] = 6372921398380745033
@Examinestatus583[String] = 审核完成
@DemandMonth584[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 11:07:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:07:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:07:12
Text:	
                        select fewoi.DataCode as OddNumbers,
                         fewoi.EarlyWarningContent,
                         fewoi.EWFormDataCode,
                         CONVERT(varchar(100), fewoi.EarlyWarningTime, 120) as EarlyWarningTime,
                         EWFormCode,sm.MenuName,fn.FlowNodeName,cp1.CompanyFullName as BranchName,
                         cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,
                         u1.UserName as FlowSpUserName,u2.UserName as FlowYjUserName 
                        FROM (
                        select*
                           FROM ( 
                        		SELECT a.*, row_number()over(partition BY a.FlowCode ORDER BY a.FlowNodeCode,a.EarlyWarningTime desc) as group_idx 
                        		FROM TbFlowEarlyWarningOtherInfo  a
                        		INNER JOIN  TbFlowEarlyWarningInfo b ON a.FlowCode=b.FlowCode 
                        		AND a.EWFormDataCode=b.EWFormDataCode AND a.FlowNodeCode=b.FlowNodeCode 
                        		WHERE YEAR(a.EarlyWarningTime)= @Year and MONTH(a.EarlyWarningTime)= @Month AND b.EarlyWarningStart=0
                           ) ret
                        WHERE ret.group_idx =1
                        ) fewoi
                        left join TbFlowNode fn on fewoi.FlowCode=fn.FlowCode and fewoi.FlowNodeCode=fn.FlowNodeCode
                        left join TbSysMenu sm on fewoi.EWFormCode=sm.MenuCode
                        left join TbCompany cp1 on fewoi.BranchCode=cp1.CompanyCode
                        left join TbCompany cp2 on fewoi.WorkAreaCode=cp2.CompanyCode
                        left join TbCompany cp3 on fewoi.SiteCode=cp3.CompanyCode
                        left join TbCompany cp4 on fewoi.ProcessFactoryCode=cp4.CompanyCode
                        left join TbUser u1 on fewoi.FlowSpUserCode=u1.UserId
                        left join TbUser u2 on fewoi.FlowYjUserCode=u2.UserId where 1=1 and fewoi.ProjectId='6372912251695766465' and fewoi.ProcessFactoryCode='6386683729561128960' and (fewoi.SiteCode in('6372921375874657752') or fewoi.WorkAreaCode in('6372921396045311451','6372921398380745033')) ORDER BY fewoi.EarlyWarningTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 11:07:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:07:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:07:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:07:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:07:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:07:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:07:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:07:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:07:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:07:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:07:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:07:12
Text:	SELECT 
                            '审批超时' as YjTypeName,COUNT(1) as YjNum
                            FROM (
									SELECT a.*, row_number()over(partition BY a.FlowCode ORDER BY a.FlowNodeCode,a.EarlyWarningTime desc) as group_idx 
									FROM TbFlowEarlyWarningOtherInfo  a
									INNER JOIN  TbFlowEarlyWarningInfo b ON a.FlowCode=b.FlowCode 
									AND a.EWFormDataCode=b.EWFormDataCode AND a.FlowNodeCode=b.FlowNodeCode 
									WHERE  b.EarlyWarningStart=0 AND YEAR(a.EarlyWarningTime)= @Year and MONTH(a.EarlyWarningTime)= @Month  and a.ProjectId='6372912251695766465' and a.ProcessFactoryCode='6386683729561128960' and (a.SiteCode in('6372921375874657752') or a.WorkAreaCode in('6372921396045311451','6372921398380745033'))
							   ) Tb1
                            WHERE Tb1.group_idx =1
                           union all
                            select '未报月度需求计划' as YjTypeName,COUNT(1)as YjNum
                             FROM ( 
                                  SELECT *, row_number()over(partition BY EarlyWarningCode,EWFormDataCode ORDER BY EWNodeCode,EWTime desc) as group_idx 
                                  FROM TbFormEarlyWarningNodeInfo fwqi
                                  WHERE fwqi.MenuCode='RawMonthDemandPlan' AND fwqi.EWStart=0 AND YEAR(fwqi.EWTime)= @Year and MONTH(fwqi.EWTime)= @Month  and fwqi.ProjectId='6372912251695766465' and (fwqi.SiteCode in('6372921375874657752') or fwqi.WorkArea in('6372921396045311451','6372921398380745033'))  
                             ) Tb2
                             WHERE Tb2.group_idx =1
                           union all
                           select '原材料供货超时' as YjTypeName,COUNT(1) as YjNum from (
                           select BatchPlanNum,cp1.CompanyFullName as BranchName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,sup.SupplyDate,sup.SupplyCompleteTime,sup.ProjectId from TbSupplyList sup
                           left join TbCompany cp1 on cp1.CompanyCode=sup.BranchCode
                           left join TbCompany cp2 on cp2.CompanyCode=sup.WorkAreaCode
                           left join TbCompany cp3 on cp3.CompanyCode=sup.SiteCode
                           left join TbCompany cp4 on cp4.CompanyCode=sup.ProcessFactoryCode
                           where (sup.SupplyCompleteTime>sup.SupplyDate or (GETDATE()>sup.SupplyDate and sup.SupplyCompleteTime is null))
						   and YEAR(sup.SupplyDate)= @Year and MONTH(sup.SupplyDate)= @Month  and sup.ProjectId='6372912251695766465' and sup.ProcessFactoryCode='6386683729561128960' and (sup.SiteCode in('6372921375874657752') or sup.WorkAreaCode in('6372921396045311451','6372921398380745033'))) Tb3
                           union all
                           select '加急订单' as YjTypeName,COUNT(1) as YjNum from (--加急订单个数
                           select wo.OrderCode,wo.DistributionTime,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName from TbWorkOrder wo
                           left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on wo.ProcessFactoryCode=cp2.CompanyCode
                           where UrgentDegree='Urgent' 
						   and YEAR(wo.DistributionTime)= @Year and MONTH(wo.DistributionTime)= @Month  and wo.ProjectId='6372912251695766465' and wo.ProcessFactoryCode='6386683729561128960' and wo.SiteCode in('6372921375874657752') ) Tb4
                           union all
                           select '加工进度滞后' as YjTypeName,COUNT(1) as YjNum from (--加工进度滞后
                           select op.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,op.DistributionTime,op.FinishProcessingDateTime from TbOrderProgress op 
                           left join TbCompany cp1 on op.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on op.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(op.DistributionTime)= @Year and MONTH(op.DistributionTime)= @Month
                           and (op.FinishProcessingDateTime>op.DistributionTime or (GETDATE()>op.DistributionTime and op.FinishProcessingDateTime is null))  and op.ProjectId='6372912251695766465' and op.ProcessFactoryCode='6386683729561128960' and op.SiteCode in('6372921375874657752') ) Tb5
                           union all
                           select '接收配送超期' as YjTypeName,COUNT(1) as YjNum from (--配送超期
                           select dpi.OrderCode,cp1.CompanyFullName as SIteName,cp2.CompanyFullName as ProcessFactoryName,dpi.DistributionTime,dpi.DeliveryCompleteTime from TbDistributionPlanInfo dpi
                           left join TbCompany cp1 on dpi.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on dpi.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(dpi.DistributionTime)= @Year and MONTH(dpi.DistributionTime)= @Month
                           and (dpi.DeliveryCompleteTime>dpi.DistributionTime or (GETDATE()>dpi.DistributionTime and dpi.DeliveryCompleteTime is null))  and dpi.ProjectId='6372912251695766465' and dpi.ProcessFactoryCode='6386683729561128960' and dpi.SiteCode in('6372921375874657752') ) Tb6 
                           union all
                           select '卸货超时' as YjTypeName,COUNT(1) as YjNum from(--卸货超时
                           select TbYj.*,cp1.CompanyFullName as SiteName,tcr.EnterSpaceTime,tcr.StartDischargeTime,tcr.EndDischargeTime,disEnt.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SiteDischargeCargo' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbTransportCarReport tcr on TbYj.EWFormDataCode=tcr.DisEntOrderId
                           left join TbDistributionEnt disEnt on tcr.DistributionCode=disEnt.DistributionCode
                           left join TbCompany cp on disEnt.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and disEnt.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ) Tb7
                           union all
                           select '签收超时' as YjTypeName,COUNT(1) as YjNum from (select TbYj.*,cp1.CompanyFullName as SiteName,sfs.DistributionCode,sdc.DistributionTime,sfs.SigninTime,sfs.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SemiFinishedSign' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbSemiFinishedSign sfs on TbYj.EWFormDataCode=sfs.ID
                           left join TbSiteDischargeCargo sdc on sfs.DistributionCode=sdc.DistributionCode and sfs.DischargeCargoCode=sdc.DischargeCargoCode
                           left join TbCompany cp on sfs.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and sfs.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ) Tb8	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 11:07:13
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:07:13
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode585) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode586,@WorkAreaCode587))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus588) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth589))) 	
Parameters:
@ProcessFactoryCode585[String] = 6386683729561128960
@WorkAreaCode586[String] = 6372921396045311451
@WorkAreaCode587[String] = 6372921398380745033
@Examinestatus588[String] = 审核完成
@DemandMonth589[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 11:07:13
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:07:13
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:07:13
Text:	SELECT sm.MenuName,fwqi.EWContent,fwqi.EWUserCode,u.UserName,fwqi.EWFormDataCode,cp1.CompanyFullName as  FbName,cp2.CompanyFullName as GqName,fwqi.EWTime,sdd.DictionaryText as RebarType  
                   FROM (  
                    select ret.*
                    FROM ( 
                         SELECT *, row_number()over(partition BY EarlyWarningCode,EWFormDataCode ORDER BY EWNodeCode,EWTime desc) as group_idx 
                         FROM TbFormEarlyWarningNodeInfo fwqi
                         WHERE YEAR(fwqi.EWTime)= @Year and MONTH(fwqi.EWTime)= @Month AND fwqi.MenuCode='RawMonthDemandPlan' AND fwqi.EWStart=0
                    ) ret
                    WHERE ret.group_idx = 1
                   ) fwqi
                    left join TbSysMenu sm on fwqi.MenuCode=sm.MenuCode
                            left join TbCompany cp1 on fwqi.CompanyCode=cp1.CompanyCode
                            left join TbCompany cp2 on fwqi.WorkArea=cp2.CompanyCode
                            left join TbCompany cp3 on fwqi.SiteCode=cp3.CompanyCode
                            left join TbUser u on fwqi.EWUserCode=u.UserId
                            left join TbRawMaterialMonthDemandPlan rmp on fwqi.EWFormDataCode=rmp.ID
                            left join TbSysDictionaryData sdd on sdd.DictionaryCode=rmp.RebarType
                    where 1=1 and fwqi.ProjectId='6372912251695766465' and (fwqi.SiteCode in('6372921375874657752') or fwqi.WorkArea in('6372921396045311451','6372921398380745033')) ORDER BY fwqi.EWTime DESC	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 11:10:09
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:12:48
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 11:12:48
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-13 11:12:48
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:12:48
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:12:49
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 11:12:49
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-13 11:12:49
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 11:12:49
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:12:49
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:12:49
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 11:12:49
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 11:12:49
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:12:49
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:12:49
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 11:12:49
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 11:12:50
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 11:12:50
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 11:13:09
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:13:57
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 11:13:57
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-13 11:13:57
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:13:57
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:13:58
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 11:13:58
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-13 11:13:58
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 11:13:58
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:13:58
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:13:58
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 11:13:58
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 11:13:58
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 11:13:58
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:13:58
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:13:58
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 11:13:59
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 11:13:59
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 11:14:10
Text:	select tsm.* from TbRoleMenu tum
                           left join TbSysMenu tsm on tum.MenuCode=tsm.MenuCode
                           where tsm.IsShow=0 and tsm.MenuType='PC' and tum.RoleCode in('6372919444627396738','6372919451594895243') order by tsm.Sort asc	


-----------------------------------------------------------------------------
2020-07-13 11:14:10
Text:	select 
                        	tsm.*
                        from TbUserMenu tum
                        left join TbSysMenu tsm on tum.MenuCode=tsm.MenuCode
                        where tsm.IsShow=0 and tsm.MenuType='PC' and tum.UserCode=@userCode order by tsm.Sort asc	
Parameters:
@userCode[String] = 6372930471544160074


-----------------------------------------------------------------------------
2020-07-13 11:14:10
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:14:10
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 11:14:10
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 11:14:10
Text:	select isnull(sum(TbCF.Capacity),0) as Capacity,isnull(sum(TbCF.WeightSmallPlan),0) as WeightSmallPlan,isnull(cast(sum(TbCF.WeightSmallPlan)/sum(TbCF.Capacity)*100 as decimal(18,2)),0) as ActualLoadNew from (select cf.Capacity,Tb1.WeightSmallPlan,cf.ProcessFactoryCode from TbCapacityFilling cf  
left join(
select SUM(Tb.WeightSmallPlan) as WeightSmallPlan,Tb.ProcessFactoryCode from (
                            select isnull(SUM(wod.WeightSmallPlan),0) as WeightSmallPlan,wo.ProcessFactoryCode from TbWorkOrder wo
                            left join TbWorkOrderDetail wod on wo.OrderCode=wod.OrderCode
                            where (ISNULL(@ProcessFactoryCode,'')='' or wo.ProcessFactoryCode=@ProcessFactoryCode)
                            and CONVERT(varchar(7), wo.DistributionTime, 120)=@month
                            and wod.RevokeStart='正常' and wo.ProcessingState!='ConfirmWork' and wo.ProcessingState!='Finishing'  group by wo.ProcessFactoryCode
                            union all
                            select isnull(sum(opd.NoCompleted),0) as NoCompleted,op.ProcessFactoryCode from TbOrderProgress op
                            left join TbOrderProgressDetail opd on op.OrderCode=opd.OrderCode 
                            where (ISNULL(@ProcessFactoryCode,'')='' or op.ProcessFactoryCode=@ProcessFactoryCode)
                            and CONVERT(varchar(7), op.DistributionTime, 120)=CONVERT(varchar(4),YEAR(DATEADD(MONTH,-1,@month+'-01')))+'-'+Right(100+Month(DATEADD(MONTH,-1,@month+'-01')),2)
                            and opd.RevokeStart='正常'  group by op.ProcessFactoryCode)Tb  group by Tb.ProcessFactoryCode
) Tb1 on cf.ProcessFactoryCode=Tb1.ProcessFactoryCode 
where cf.CapacityMonth=@month
and (ISNULL(@ProcessFactoryCode,'')='' or cf.ProcessFactoryCode=@ProcessFactoryCode)) TbCF where (ISNULL(@ProcessFactoryCode,'')='' or TbCF.ProcessFactoryCode=@ProcessFactoryCode)	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@month[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 11:14:11
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:14:11
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode590) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode591,@WorkAreaCode592))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus593) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth594))) 	
Parameters:
@ProcessFactoryCode590[String] = 6386683729561128960
@WorkAreaCode591[String] = 6372921396045311451
@WorkAreaCode592[String] = 6372921398380745033
@Examinestatus593[String] = 审核完成
@DemandMonth594[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 11:14:11
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:14:11
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:14:11
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:14:11
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:14:11
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode597) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode598))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState599)) 	
Parameters:
@ProcessFactoryCode597[String] = 6386683729561128960
@SiteCode598[String] = 6372921375874657752
@ProcessingState599[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-13 11:14:11
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-13 11:14:11
Text:	 SELECT   [TbOrderProgress].[ProcessingState],[TbOrderProgress].[OrderCode],[TbOrderProgress].[FinishProcessingDateTime],[TbOrderProgress].[DistributionTime],[TbOrderProgress].[SiteCode] FROM [TbOrderProgress]  WHERE ((([TbOrderProgress].[SiteCode] IN (@SiteCode595)) AND ([TbOrderProgress].[ProcessFactoryCode] = @ProcessFactoryCode596)) AND ((YEAR(DistributionTime)=2020 and MONTH(DistributionTime)=7) or (DistributionTime<'2020/7/1 0:00:00' and (ProcessingState!='Finishing')))) 	
Parameters:
@SiteCode595[String] = 6372921375874657752
@ProcessFactoryCode596[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-13 11:14:11
Text:	 SELECT   * FROM [TbWorkOrderDetail]  WHERE (1=2) AND ([TbWorkOrderDetail].[DaetailWorkStrat] = @DaetailWorkStrat600) 	
Parameters:
@DaetailWorkStrat600[String] = 未加工


-----------------------------------------------------------------------------
2020-07-13 11:14:11
Text:	 SELECT   [TbOrderProgress].[WeightTotal] AS [TotalWeight],[TbCompany].[ParentCompanyCode] FROM [TbOrderProgress] LEFT OUTER JOIN [TbCompany] ON ([TbOrderProgress].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((1=2) AND ([TbOrderProgress].[ProcessingState] <> @ProcessingState601)) AND ((([TbOrderProgress].[FinishProcessingDateTime] is not null ) AND ([TbOrderProgress].[DistributionTime] < [TbOrderProgress].[FinishProcessingDateTime])) OR (([TbOrderProgress].[FinishProcessingDateTime] is null ) AND ([TbOrderProgress].[DistributionTime] < @DistributionTime602)))) 	
Parameters:
@ProcessingState601[String] = Finishing
@DistributionTime602[DateTime] = 2020/7/13 0:00:00


-----------------------------------------------------------------------------
2020-07-13 11:14:11
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:14:11
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode603) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode604))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState605)) 	
Parameters:
@ProcessFactoryCode603[String] = 6386683729561128960
@SiteCode604[String] = 6372921375874657752
@ProcessingState605[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-13 11:14:11
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-13 11:14:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:14:12
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode607) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode608,@WorkAreaCode609))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus610) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth611))) 	
Parameters:
@ProcessFactoryCode607[String] = 6386683729561128960
@WorkAreaCode608[String] = 6372921396045311451
@WorkAreaCode609[String] = 6372921398380745033
@Examinestatus610[String] = 审核完成
@DemandMonth611[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 11:14:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:14:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:14:12
Text:	 SELECT   [TbRawMaterialStockRecord].[MaterialCode],sum([TbRawMaterialStockRecord].[UseCount]) AS [UseCount],sum([TbRawMaterialStockRecord].[LockCount]) AS [LockCount] FROM [TbRawMaterialStockRecord] LEFT OUTER JOIN [TbStorage] ON ([TbRawMaterialStockRecord].[StorageCode] = [TbStorage].[StorageCode]) LEFT OUTER JOIN [TbRawMaterialArchives] ON ([TbRawMaterialStockRecord].[MaterialCode] = [TbRawMaterialArchives].[MaterialCode])  WHERE ((([TbStorage].[ProcessFactoryCode] = @ProcessFactoryCode614) AND ([TbRawMaterialStockRecord].[WorkAreaCode] IN (@WorkAreaCode616,@WorkAreaCode617))) AND ([TbRawMaterialArchives].[RebarType] = @RebarType619)) GROUP BY [TbRawMaterialStockRecord].[MaterialCode] 	
Parameters:
@ProcessFactoryCode614[String] = 6386683729561128960
@WorkAreaCode616[String] = 6372921396045311451
@WorkAreaCode617[String] = 6372921398380745033
@RebarType619[String] = BuildingSteel


-----------------------------------------------------------------------------
2020-07-13 11:14:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:14:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:14:12
Text:	 SELECT   [TbRawMaterialStockRecord].[MaterialCode],sum([TbRawMaterialStockRecord].[UseCount]) AS [UseCount],sum([TbRawMaterialStockRecord].[LockCount]) AS [LockCount] FROM [TbRawMaterialStockRecord] LEFT OUTER JOIN [TbStorage] ON ([TbRawMaterialStockRecord].[StorageCode] = [TbStorage].[StorageCode]) LEFT OUTER JOIN [TbRawMaterialArchives] ON ([TbRawMaterialStockRecord].[MaterialCode] = [TbRawMaterialArchives].[MaterialCode])  WHERE ((([TbStorage].[ProcessFactoryCode] = @ProcessFactoryCode623) AND ([TbRawMaterialStockRecord].[WorkAreaCode] IN (@WorkAreaCode625,@WorkAreaCode626))) AND ([TbRawMaterialArchives].[RebarType] = @RebarType628)) GROUP BY [TbRawMaterialStockRecord].[MaterialCode] 	
Parameters:
@ProcessFactoryCode623[String] = 6386683729561128960
@WorkAreaCode625[String] = 6372921396045311451
@WorkAreaCode626[String] = 6372921398380745033
@RebarType628[String] = SectionSteel


-----------------------------------------------------------------------------
2020-07-13 11:14:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:14:12
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode630) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode631,@WorkAreaCode632))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus633) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth634))) 	
Parameters:
@ProcessFactoryCode630[String] = 6386683729561128960
@WorkAreaCode631[String] = 6372921396045311451
@WorkAreaCode632[String] = 6372921398380745033
@Examinestatus633[String] = 审核完成
@DemandMonth634[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 11:14:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:14:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:14:12
Text:	SELECT sm.MenuName,fwqi.EWContent,fwqi.EWUserCode,u.UserName,fwqi.EWFormDataCode,cp1.CompanyFullName as  FbName,cp2.CompanyFullName as GqName,fwqi.EWTime,sdd.DictionaryText as RebarType  
                   FROM (  
                    select ret.*
                    FROM ( 
                         SELECT *, row_number()over(partition BY EarlyWarningCode,EWFormDataCode ORDER BY EWNodeCode,EWTime desc) as group_idx 
                         FROM TbFormEarlyWarningNodeInfo fwqi
                         WHERE YEAR(fwqi.EWTime)= @Year and MONTH(fwqi.EWTime)= @Month AND fwqi.MenuCode='RawMonthDemandPlan' AND fwqi.EWStart=0
                    ) ret
                    WHERE ret.group_idx = 1
                   ) fwqi
                    left join TbSysMenu sm on fwqi.MenuCode=sm.MenuCode
                            left join TbCompany cp1 on fwqi.CompanyCode=cp1.CompanyCode
                            left join TbCompany cp2 on fwqi.WorkArea=cp2.CompanyCode
                            left join TbCompany cp3 on fwqi.SiteCode=cp3.CompanyCode
                            left join TbUser u on fwqi.EWUserCode=u.UserId
                            left join TbRawMaterialMonthDemandPlan rmp on fwqi.EWFormDataCode=rmp.ID
                            left join TbSysDictionaryData sdd on sdd.DictionaryCode=rmp.RebarType
                    where 1=1 and fwqi.ProjectId='6372912251695766465' and (fwqi.SiteCode in('6372921375874657752') or fwqi.WorkArea in('6372921396045311451','6372921398380745033')) ORDER BY fwqi.EWTime DESC	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 11:14:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:14:12
Text:	--加急订单个数
                           select wo.OrderCode,wo.DistributionTime,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName from TbWorkOrder wo
                           left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on wo.ProcessFactoryCode=cp2.CompanyCode
                           where UrgentDegree='Urgent'
                           and YEAR(wo.DistributionTime)= @Year and MONTH(wo.DistributionTime)= @Month  and wo.ProjectId='6372912251695766465' and wo.ProcessFactoryCode='6386683729561128960' and wo.SiteCode in('6372921375874657752')  ORDER BY wo.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 11:14:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:14:12
Text:	--加工进度滞后
                           select op.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,op.DistributionTime,op.FinishProcessingDateTime from TbOrderProgress op 
                           left join TbCompany cp1 on op.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on op.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(op.DistributionTime)= @Year and MONTH(op.DistributionTime)= @Month
                           and (op.FinishProcessingDateTime>op.DistributionTime or (GETDATE()>op.DistributionTime and op.FinishProcessingDateTime is null))  and op.ProjectId='6372912251695766465' and op.ProcessFactoryCode='6386683729561128960' and op.SiteCode in('6372921375874657752') ORDER BY op.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 11:14:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:14:12
Text:	--配送超期
                           select dpi.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,dpi.DistributionTime,dpi.DeliveryCompleteTime,dpi.Remark from TbDistributionPlanInfo dpi
                           left join TbCompany cp1 on dpi.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on dpi.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(dpi.DistributionTime)= @Year and MONTH(dpi.DistributionTime)= @Month
                           and (dpi.DeliveryCompleteTime>dpi.DistributionTime or (GETDATE()>dpi.DistributionTime and dpi.DeliveryCompleteTime is null))  and dpi.ProjectId='6372912251695766465' and dpi.ProcessFactoryCode='6386683729561128960' and dpi.SiteCode in('6372921375874657752') ORDER BY dpi.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 11:14:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:14:12
Text:	select TbYj.*,cp1.CompanyFullName as SiteName,tcr.EnterSpaceTime,tcr.StartDischargeTime,tcr.EndDischargeTime,disEnt.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SiteDischargeCargo' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbTransportCarReport tcr on TbYj.EWFormDataCode=tcr.DisEntOrderId
                           left join TbDistributionEnt disEnt on tcr.DistributionCode=disEnt.DistributionCode
                           left join TbCompany cp on disEnt.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and disEnt.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ORDER BY tcr.EnterSpaceTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 11:14:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:14:12
Text:	select TbYj.*,cp1.CompanyFullName as SiteName,sfs.DistributionCode,sdc.DistributionTime,sfs.SigninTime,sfs.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SemiFinishedSign' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbSemiFinishedSign sfs on TbYj.EWFormDataCode=sfs.ID
                           left join TbSiteDischargeCargo sdc on sfs.DistributionCode=sdc.DistributionCode and sfs.DischargeCargoCode=sdc.DischargeCargoCode
                           left join TbCompany cp on sfs.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month and TbYj.ProjectId='6372912251695766465' and sfs.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752')	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 11:14:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:14:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:14:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:14:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:14:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:14:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:14:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:14:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:14:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:14:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:14:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:14:12
Text:	SELECT 
                            '审批超时' as YjTypeName,COUNT(1) as YjNum
                            FROM (
									SELECT a.*, row_number()over(partition BY a.FlowCode ORDER BY a.FlowNodeCode,a.EarlyWarningTime desc) as group_idx 
									FROM TbFlowEarlyWarningOtherInfo  a
									INNER JOIN  TbFlowEarlyWarningInfo b ON a.FlowCode=b.FlowCode 
									AND a.EWFormDataCode=b.EWFormDataCode AND a.FlowNodeCode=b.FlowNodeCode 
									WHERE  b.EarlyWarningStart=0 AND YEAR(a.EarlyWarningTime)= @Year and MONTH(a.EarlyWarningTime)= @Month  and a.ProjectId='6372912251695766465' and a.ProcessFactoryCode='6386683729561128960' and (a.SiteCode in('6372921375874657752') or a.WorkAreaCode in('6372921396045311451','6372921398380745033'))
							   ) Tb1
                            WHERE Tb1.group_idx =1
                           union all
                            select '未报月度需求计划' as YjTypeName,COUNT(1)as YjNum
                             FROM ( 
                                  SELECT *, row_number()over(partition BY EarlyWarningCode,EWFormDataCode ORDER BY EWNodeCode,EWTime desc) as group_idx 
                                  FROM TbFormEarlyWarningNodeInfo fwqi
                                  WHERE fwqi.MenuCode='RawMonthDemandPlan' AND fwqi.EWStart=0 AND YEAR(fwqi.EWTime)= @Year and MONTH(fwqi.EWTime)= @Month  and fwqi.ProjectId='6372912251695766465' and (fwqi.SiteCode in('6372921375874657752') or fwqi.WorkArea in('6372921396045311451','6372921398380745033'))  
                             ) Tb2
                             WHERE Tb2.group_idx =1
                           union all
                           select '原材料供货超时' as YjTypeName,COUNT(1) as YjNum from (
                           select BatchPlanNum,cp1.CompanyFullName as BranchName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,sup.SupplyDate,sup.SupplyCompleteTime,sup.ProjectId from TbSupplyList sup
                           left join TbCompany cp1 on cp1.CompanyCode=sup.BranchCode
                           left join TbCompany cp2 on cp2.CompanyCode=sup.WorkAreaCode
                           left join TbCompany cp3 on cp3.CompanyCode=sup.SiteCode
                           left join TbCompany cp4 on cp4.CompanyCode=sup.ProcessFactoryCode
                           where (sup.SupplyCompleteTime>sup.SupplyDate or (GETDATE()>sup.SupplyDate and sup.SupplyCompleteTime is null))
						   and YEAR(sup.SupplyDate)= @Year and MONTH(sup.SupplyDate)= @Month  and sup.ProjectId='6372912251695766465' and sup.ProcessFactoryCode='6386683729561128960' and (sup.SiteCode in('6372921375874657752') or sup.WorkAreaCode in('6372921396045311451','6372921398380745033'))) Tb3
                           union all
                           select '加急订单' as YjTypeName,COUNT(1) as YjNum from (--加急订单个数
                           select wo.OrderCode,wo.DistributionTime,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName from TbWorkOrder wo
                           left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on wo.ProcessFactoryCode=cp2.CompanyCode
                           where UrgentDegree='Urgent' 
						   and YEAR(wo.DistributionTime)= @Year and MONTH(wo.DistributionTime)= @Month  and wo.ProjectId='6372912251695766465' and wo.ProcessFactoryCode='6386683729561128960' and wo.SiteCode in('6372921375874657752') ) Tb4
                           union all
                           select '加工进度滞后' as YjTypeName,COUNT(1) as YjNum from (--加工进度滞后
                           select op.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,op.DistributionTime,op.FinishProcessingDateTime from TbOrderProgress op 
                           left join TbCompany cp1 on op.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on op.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(op.DistributionTime)= @Year and MONTH(op.DistributionTime)= @Month
                           and (op.FinishProcessingDateTime>op.DistributionTime or (GETDATE()>op.DistributionTime and op.FinishProcessingDateTime is null))  and op.ProjectId='6372912251695766465' and op.ProcessFactoryCode='6386683729561128960' and op.SiteCode in('6372921375874657752') ) Tb5
                           union all
                           select '接收配送超期' as YjTypeName,COUNT(1) as YjNum from (--配送超期
                           select dpi.OrderCode,cp1.CompanyFullName as SIteName,cp2.CompanyFullName as ProcessFactoryName,dpi.DistributionTime,dpi.DeliveryCompleteTime from TbDistributionPlanInfo dpi
                           left join TbCompany cp1 on dpi.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on dpi.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(dpi.DistributionTime)= @Year and MONTH(dpi.DistributionTime)= @Month
                           and (dpi.DeliveryCompleteTime>dpi.DistributionTime or (GETDATE()>dpi.DistributionTime and dpi.DeliveryCompleteTime is null))  and dpi.ProjectId='6372912251695766465' and dpi.ProcessFactoryCode='6386683729561128960' and dpi.SiteCode in('6372921375874657752') ) Tb6 
                           union all
                           select '卸货超时' as YjTypeName,COUNT(1) as YjNum from(--卸货超时
                           select TbYj.*,cp1.CompanyFullName as SiteName,tcr.EnterSpaceTime,tcr.StartDischargeTime,tcr.EndDischargeTime,disEnt.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SiteDischargeCargo' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbTransportCarReport tcr on TbYj.EWFormDataCode=tcr.DisEntOrderId
                           left join TbDistributionEnt disEnt on tcr.DistributionCode=disEnt.DistributionCode
                           left join TbCompany cp on disEnt.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and disEnt.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ) Tb7
                           union all
                           select '签收超时' as YjTypeName,COUNT(1) as YjNum from (select TbYj.*,cp1.CompanyFullName as SiteName,sfs.DistributionCode,sdc.DistributionTime,sfs.SigninTime,sfs.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SemiFinishedSign' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbSemiFinishedSign sfs on TbYj.EWFormDataCode=sfs.ID
                           left join TbSiteDischargeCargo sdc on sfs.DistributionCode=sdc.DistributionCode and sfs.DischargeCargoCode=sdc.DischargeCargoCode
                           left join TbCompany cp on sfs.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and sfs.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ) Tb8	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 11:14:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:14:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:14:12
Text:	--原材料供货超时
                           select BatchPlanNum,cp1.CompanyFullName as BranchName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,sup.SupplyDate,sup.SupplyCompleteTime,sup.ProjectId,sup.Remarks from TbSupplyList sup
                           left join TbCompany cp1 on cp1.CompanyCode=sup.BranchCode
                           left join TbCompany cp2 on cp2.CompanyCode=sup.WorkAreaCode
                           left join TbCompany cp3 on cp3.CompanyCode=sup.SiteCode
                           left join TbCompany cp4 on cp4.CompanyCode=sup.ProcessFactoryCode
                           where YEAR(sup.SupplyDate)= @Year and MONTH(sup.SupplyDate)= @Month
                           and (sup.SupplyCompleteTime>sup.SupplyDate or (GETDATE()>sup.SupplyDate and sup.SupplyCompleteTime is null))  and sup.ProjectId='6372912251695766465' and sup.ProcessFactoryCode='6386683729561128960' and (sup.SiteCode in('6372921375874657752') or sup.WorkAreaCode in('6372921396045311451','6372921398380745033'))	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 11:14:13
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:14:13
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode635) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode636,@WorkAreaCode637))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus638) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth639))) 	
Parameters:
@ProcessFactoryCode635[String] = 6386683729561128960
@WorkAreaCode636[String] = 6372921396045311451
@WorkAreaCode637[String] = 6372921398380745033
@Examinestatus638[String] = 审核完成
@DemandMonth639[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 11:14:13
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:14:13
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:14:13
Text:	
                        select fewoi.DataCode as OddNumbers,
                         fewoi.EarlyWarningContent,
                         fewoi.EWFormDataCode,
                         CONVERT(varchar(100), fewoi.EarlyWarningTime, 120) as EarlyWarningTime,
                         EWFormCode,sm.MenuName,fn.FlowNodeName,cp1.CompanyFullName as BranchName,
                         cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,
                         u1.UserName as FlowSpUserName,u2.UserName as FlowYjUserName 
                        FROM (
                        select*
                           FROM ( 
                        		SELECT a.*, row_number()over(partition BY a.FlowCode ORDER BY a.FlowNodeCode,a.EarlyWarningTime desc) as group_idx 
                        		FROM TbFlowEarlyWarningOtherInfo  a
                        		INNER JOIN  TbFlowEarlyWarningInfo b ON a.FlowCode=b.FlowCode 
                        		AND a.EWFormDataCode=b.EWFormDataCode AND a.FlowNodeCode=b.FlowNodeCode 
                        		WHERE YEAR(a.EarlyWarningTime)= @Year and MONTH(a.EarlyWarningTime)= @Month AND b.EarlyWarningStart=0
                           ) ret
                        WHERE ret.group_idx =1
                        ) fewoi
                        left join TbFlowNode fn on fewoi.FlowCode=fn.FlowCode and fewoi.FlowNodeCode=fn.FlowNodeCode
                        left join TbSysMenu sm on fewoi.EWFormCode=sm.MenuCode
                        left join TbCompany cp1 on fewoi.BranchCode=cp1.CompanyCode
                        left join TbCompany cp2 on fewoi.WorkAreaCode=cp2.CompanyCode
                        left join TbCompany cp3 on fewoi.SiteCode=cp3.CompanyCode
                        left join TbCompany cp4 on fewoi.ProcessFactoryCode=cp4.CompanyCode
                        left join TbUser u1 on fewoi.FlowSpUserCode=u1.UserId
                        left join TbUser u2 on fewoi.FlowYjUserCode=u2.UserId where 1=1 and fewoi.ProjectId='6372912251695766465' and fewoi.ProcessFactoryCode='6386683729561128960' and (fewoi.SiteCode in('6372921375874657752') or fewoi.WorkAreaCode in('6372921396045311451','6372921398380745033')) ORDER BY fewoi.EarlyWarningTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 11:14:13
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:14:13
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:14:13
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode642) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode643))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState644)) 	
Parameters:
@ProcessFactoryCode642[String] = 6386683729561128960
@SiteCode643[String] = 6372921375874657752
@ProcessingState644[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-13 11:14:13
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-13 11:14:13
Text:	 SELECT   [TbOrderProgress].[ProcessingState],[TbOrderProgress].[OrderCode],[TbOrderProgress].[FinishProcessingDateTime],[TbOrderProgress].[DistributionTime],[TbOrderProgress].[SiteCode] FROM [TbOrderProgress]  WHERE ((([TbOrderProgress].[SiteCode] IN (@SiteCode640)) AND ([TbOrderProgress].[ProcessFactoryCode] = @ProcessFactoryCode641)) AND ((YEAR(DistributionTime)=2020 and MONTH(DistributionTime)=7) or (DistributionTime<'2020/7/1 0:00:00' and (ProcessingState!='Finishing')))) 	
Parameters:
@SiteCode640[String] = 6372921375874657752
@ProcessFactoryCode641[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-13 11:14:13
Text:	 SELECT   * FROM [TbWorkOrderDetail]  WHERE (1=2) AND ([TbWorkOrderDetail].[DaetailWorkStrat] = @DaetailWorkStrat645) 	
Parameters:
@DaetailWorkStrat645[String] = 未加工


-----------------------------------------------------------------------------
2020-07-13 11:14:13
Text:	 SELECT   [TbOrderProgress].[WeightTotal] AS [TotalWeight],[TbCompany].[ParentCompanyCode] FROM [TbOrderProgress] LEFT OUTER JOIN [TbCompany] ON ([TbOrderProgress].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((1=2) AND ([TbOrderProgress].[ProcessingState] <> @ProcessingState646)) AND ((([TbOrderProgress].[FinishProcessingDateTime] is not null ) AND ([TbOrderProgress].[DistributionTime] < [TbOrderProgress].[FinishProcessingDateTime])) OR (([TbOrderProgress].[FinishProcessingDateTime] is null ) AND ([TbOrderProgress].[DistributionTime] < @DistributionTime647)))) 	
Parameters:
@ProcessingState646[String] = Finishing
@DistributionTime647[DateTime] = 2020/7/13 0:00:00


-----------------------------------------------------------------------------
2020-07-13 11:14:18
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 11:14:18
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-13 11:14:18
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:14:18
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:14:18
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 11:14:18
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-13 11:14:18
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 11:14:18
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:14:18
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:14:18
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 11:14:18
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 11:14:19
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 11:14:19
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:14:19
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:14:19
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 11:14:19
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 11:14:20
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 11:14:36
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 11:14:36
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-13 11:14:37
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:14:37
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:14:37
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 11:14:37
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-13 11:14:37
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 11:14:37
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:14:37
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:14:37
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 11:14:37
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 11:14:38
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 11:14:38
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:14:38
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:14:38
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 11:14:38
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 11:14:39
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 11:14:46
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:14:46
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:14:46
Text:	select 
                           a.RootNumber,
                           a.SizeSelection,
                           a.MaterialCode,
                           a.WeightSmallPlanN,
                           b.MaterialName,
                           b.SpecificationModel,
                           b.MeasurementUnitZl,
                           c.CompanyFullName StartSiteName,
                           d.CompanyFullName EndSiteName
                           from 
                           (
                           select 
                           a.MaterialCode,
                           a.Size as SizeSelection,
                           a.StartSiteCode,
                           a.EndSiteCode,
                           sum(a.Number) RootNumber,
                           sum(a.Weight) WeightSmallPlanN
                           from TbCloutStockPlace a
                           left join TbRMProductionMaterial rmpm on a.CollarCode=rmpm.CollarCode
                           where a.State=1 
                           and (ISNULL(@ProjectId,'')='' OR a.ProjectId=@ProjectId)
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                            and a.EndSiteCode in('6372921375874657752')
                           group by a.MaterialCode,a.Size,a.StartSiteCode,a.EndSiteCode
                           ) a
                           left join TbRawMaterialArchives b on a.MaterialCode=b.MaterialCode
                           left join TbCompany c on c.CompanyCode=a.StartSiteCode
                           left join TbCompany d on d.CompanyCode=a.EndSiteCode
                           where 1=1 
                           and (ISNULL(@MaterialName,'')='' or b.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or b.SpecificationModel like '%'+@SpecificationModel+'%')	
Parameters:
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 
@BegTime[DateTime] = 
@EndTime[DateTime] = 


-----------------------------------------------------------------------------
2020-07-13 11:14:46
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode asc)AS Row, * from (select 
                           a.RootNumber,
                           a.SizeSelection,
                           a.MaterialCode,
                           a.WeightSmallPlanN,
                           b.MaterialName,
                           b.SpecificationModel,
                           b.MeasurementUnitZl,
                           c.CompanyFullName StartSiteName,
                           d.CompanyFullName EndSiteName
                           from 
                           (
                           select 
                           a.MaterialCode,
                           a.Size as SizeSelection,
                           a.StartSiteCode,
                           a.EndSiteCode,
                           sum(a.Number) RootNumber,
                           sum(a.Weight) WeightSmallPlanN
                           from TbCloutStockPlace a
                           left join TbRMProductionMaterial rmpm on a.CollarCode=rmpm.CollarCode
                           where a.State=1 
                           and (ISNULL(@ProjectId,'')='' OR a.ProjectId=@ProjectId)
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                            and a.EndSiteCode in('6372921375874657752')
                           group by a.MaterialCode,a.Size,a.StartSiteCode,a.EndSiteCode
                           ) a
                           left join TbRawMaterialArchives b on a.MaterialCode=b.MaterialCode
                           left join TbCompany c on c.CompanyCode=a.StartSiteCode
                           left join TbCompany d on d.CompanyCode=a.EndSiteCode
                           where 1=1 
                           and (ISNULL(@MaterialName,'')='' or b.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or b.SpecificationModel like '%'+@SpecificationModel+'%')) as a)  SELECT * FROM temptbl where Row between 1 and 50	
Parameters:
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 
@BegTime[DateTime] = 
@EndTime[DateTime] = 


-----------------------------------------------------------------------------
2020-07-13 11:14:58
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:14:58
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:14:58
Text:	select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 11:14:58
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 11:14:58
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='BuildingSteel'	


-----------------------------------------------------------------------------
2020-07-13 11:14:58
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='SectionSteel'	


-----------------------------------------------------------------------------
2020-07-13 11:14:59
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)	


-----------------------------------------------------------------------------
2020-07-13 11:14:59
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 11:14:59
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)	


-----------------------------------------------------------------------------
2020-07-13 11:14:59
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 11:16:04
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 11:16:04
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-13 11:16:04
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:16:04
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:16:04
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 11:16:04
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-13 11:16:04
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 11:16:04
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:16:04
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:16:04
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 11:16:04
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 11:16:04
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:16:04
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:16:04
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 11:16:05
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 11:16:05
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 11:16:06
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 11:16:07
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:16:07
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:16:07
Text:	select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 11:16:07
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 11:16:07
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='BuildingSteel'	


-----------------------------------------------------------------------------
2020-07-13 11:16:07
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='SectionSteel'	


-----------------------------------------------------------------------------
2020-07-13 11:16:08
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)	


-----------------------------------------------------------------------------
2020-07-13 11:16:08
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 11:16:08
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)	


-----------------------------------------------------------------------------
2020-07-13 11:16:08
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 11:16:39
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 11:16:39
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-13 11:16:40
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:16:40
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:16:40
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 11:16:40
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-13 11:16:40
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 11:16:40
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:16:40
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:16:40
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 11:16:40
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 11:16:40
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:16:40
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:16:40
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 11:16:41
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 11:16:41
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 11:16:42
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 11:17:10
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:18:39
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)	


-----------------------------------------------------------------------------
2020-07-13 11:18:39
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 11:18:40
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:18:40
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:18:40
Text:	select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 11:18:40
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 11:18:40
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='BuildingSteel'	


-----------------------------------------------------------------------------
2020-07-13 11:18:40
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='SectionSteel'	


-----------------------------------------------------------------------------
2020-07-13 11:18:40
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)	


-----------------------------------------------------------------------------
2020-07-13 11:18:40
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 11:19:41
Text:	select tsm.* from TbRoleMenu tum
                           left join TbSysMenu tsm on tum.MenuCode=tsm.MenuCode
                           where tsm.IsShow=0 and tsm.MenuType='PC' and tum.RoleCode in('6372919444627396738','6372919451594895243') order by tsm.Sort asc	


-----------------------------------------------------------------------------
2020-07-13 11:19:41
Text:	select 
                        	tsm.*
                        from TbUserMenu tum
                        left join TbSysMenu tsm on tum.MenuCode=tsm.MenuCode
                        where tsm.IsShow=0 and tsm.MenuType='PC' and tum.UserCode=@userCode order by tsm.Sort asc	
Parameters:
@userCode[String] = 6372930471544160074


-----------------------------------------------------------------------------
2020-07-13 11:19:41
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:19:41
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 11:19:41
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 11:19:41
Text:	select isnull(sum(TbCF.Capacity),0) as Capacity,isnull(sum(TbCF.WeightSmallPlan),0) as WeightSmallPlan,isnull(cast(sum(TbCF.WeightSmallPlan)/sum(TbCF.Capacity)*100 as decimal(18,2)),0) as ActualLoadNew from (select cf.Capacity,Tb1.WeightSmallPlan,cf.ProcessFactoryCode from TbCapacityFilling cf  
left join(
select SUM(Tb.WeightSmallPlan) as WeightSmallPlan,Tb.ProcessFactoryCode from (
                            select isnull(SUM(wod.WeightSmallPlan),0) as WeightSmallPlan,wo.ProcessFactoryCode from TbWorkOrder wo
                            left join TbWorkOrderDetail wod on wo.OrderCode=wod.OrderCode
                            where (ISNULL(@ProcessFactoryCode,'')='' or wo.ProcessFactoryCode=@ProcessFactoryCode)
                            and CONVERT(varchar(7), wo.DistributionTime, 120)=@month
                            and wod.RevokeStart='正常' and wo.ProcessingState!='ConfirmWork' and wo.ProcessingState!='Finishing'  group by wo.ProcessFactoryCode
                            union all
                            select isnull(sum(opd.NoCompleted),0) as NoCompleted,op.ProcessFactoryCode from TbOrderProgress op
                            left join TbOrderProgressDetail opd on op.OrderCode=opd.OrderCode 
                            where (ISNULL(@ProcessFactoryCode,'')='' or op.ProcessFactoryCode=@ProcessFactoryCode)
                            and CONVERT(varchar(7), op.DistributionTime, 120)=CONVERT(varchar(4),YEAR(DATEADD(MONTH,-1,@month+'-01')))+'-'+Right(100+Month(DATEADD(MONTH,-1,@month+'-01')),2)
                            and opd.RevokeStart='正常'  group by op.ProcessFactoryCode)Tb  group by Tb.ProcessFactoryCode
) Tb1 on cf.ProcessFactoryCode=Tb1.ProcessFactoryCode 
where cf.CapacityMonth=@month
and (ISNULL(@ProcessFactoryCode,'')='' or cf.ProcessFactoryCode=@ProcessFactoryCode)) TbCF where (ISNULL(@ProcessFactoryCode,'')='' or TbCF.ProcessFactoryCode=@ProcessFactoryCode)	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@month[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 11:19:42
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:19:42
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode648) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode649,@WorkAreaCode650))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus651) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth652))) 	
Parameters:
@ProcessFactoryCode648[String] = 6386683729561128960
@WorkAreaCode649[String] = 6372921396045311451
@WorkAreaCode650[String] = 6372921398380745033
@Examinestatus651[String] = 审核完成
@DemandMonth652[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 11:19:42
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:19:42
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:19:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:19:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:19:43
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode655) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode656))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState657)) 	
Parameters:
@ProcessFactoryCode655[String] = 6386683729561128960
@SiteCode656[String] = 6372921375874657752
@ProcessingState657[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-13 11:19:43
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-13 11:19:43
Text:	 SELECT   [TbOrderProgress].[ProcessingState],[TbOrderProgress].[OrderCode],[TbOrderProgress].[FinishProcessingDateTime],[TbOrderProgress].[DistributionTime],[TbOrderProgress].[SiteCode] FROM [TbOrderProgress]  WHERE ((([TbOrderProgress].[SiteCode] IN (@SiteCode653)) AND ([TbOrderProgress].[ProcessFactoryCode] = @ProcessFactoryCode654)) AND ((YEAR(DistributionTime)=2020 and MONTH(DistributionTime)=7) or (DistributionTime<'2020/7/1 0:00:00' and (ProcessingState!='Finishing')))) 	
Parameters:
@SiteCode653[String] = 6372921375874657752
@ProcessFactoryCode654[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-13 11:19:43
Text:	 SELECT   * FROM [TbWorkOrderDetail]  WHERE (1=2) AND ([TbWorkOrderDetail].[DaetailWorkStrat] = @DaetailWorkStrat658) 	
Parameters:
@DaetailWorkStrat658[String] = 未加工


-----------------------------------------------------------------------------
2020-07-13 11:19:43
Text:	 SELECT   [TbOrderProgress].[WeightTotal] AS [TotalWeight],[TbCompany].[ParentCompanyCode] FROM [TbOrderProgress] LEFT OUTER JOIN [TbCompany] ON ([TbOrderProgress].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((1=2) AND ([TbOrderProgress].[ProcessingState] <> @ProcessingState659)) AND ((([TbOrderProgress].[FinishProcessingDateTime] is not null ) AND ([TbOrderProgress].[DistributionTime] < [TbOrderProgress].[FinishProcessingDateTime])) OR (([TbOrderProgress].[FinishProcessingDateTime] is null ) AND ([TbOrderProgress].[DistributionTime] < @DistributionTime660)))) 	
Parameters:
@ProcessingState659[String] = Finishing
@DistributionTime660[DateTime] = 2020/7/13 0:00:00


-----------------------------------------------------------------------------
2020-07-13 11:19:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:19:43
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode661) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode662))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState663)) 	
Parameters:
@ProcessFactoryCode661[String] = 6386683729561128960
@SiteCode662[String] = 6372921375874657752
@ProcessingState663[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-13 11:19:43
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-13 11:19:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:19:43
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode665) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode666,@WorkAreaCode667))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus668) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth669))) 	
Parameters:
@ProcessFactoryCode665[String] = 6386683729561128960
@WorkAreaCode666[String] = 6372921396045311451
@WorkAreaCode667[String] = 6372921398380745033
@Examinestatus668[String] = 审核完成
@DemandMonth669[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 11:19:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:19:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:19:43
Text:	 SELECT   [TbRawMaterialStockRecord].[MaterialCode],sum([TbRawMaterialStockRecord].[UseCount]) AS [UseCount],sum([TbRawMaterialStockRecord].[LockCount]) AS [LockCount] FROM [TbRawMaterialStockRecord] LEFT OUTER JOIN [TbStorage] ON ([TbRawMaterialStockRecord].[StorageCode] = [TbStorage].[StorageCode]) LEFT OUTER JOIN [TbRawMaterialArchives] ON ([TbRawMaterialStockRecord].[MaterialCode] = [TbRawMaterialArchives].[MaterialCode])  WHERE ((([TbStorage].[ProcessFactoryCode] = @ProcessFactoryCode672) AND ([TbRawMaterialStockRecord].[WorkAreaCode] IN (@WorkAreaCode674,@WorkAreaCode675))) AND ([TbRawMaterialArchives].[RebarType] = @RebarType677)) GROUP BY [TbRawMaterialStockRecord].[MaterialCode] 	
Parameters:
@ProcessFactoryCode672[String] = 6386683729561128960
@WorkAreaCode674[String] = 6372921396045311451
@WorkAreaCode675[String] = 6372921398380745033
@RebarType677[String] = BuildingSteel


-----------------------------------------------------------------------------
2020-07-13 11:19:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:19:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:19:43
Text:	 SELECT   [TbRawMaterialStockRecord].[MaterialCode],sum([TbRawMaterialStockRecord].[UseCount]) AS [UseCount],sum([TbRawMaterialStockRecord].[LockCount]) AS [LockCount] FROM [TbRawMaterialStockRecord] LEFT OUTER JOIN [TbStorage] ON ([TbRawMaterialStockRecord].[StorageCode] = [TbStorage].[StorageCode]) LEFT OUTER JOIN [TbRawMaterialArchives] ON ([TbRawMaterialStockRecord].[MaterialCode] = [TbRawMaterialArchives].[MaterialCode])  WHERE ((([TbStorage].[ProcessFactoryCode] = @ProcessFactoryCode681) AND ([TbRawMaterialStockRecord].[WorkAreaCode] IN (@WorkAreaCode683,@WorkAreaCode684))) AND ([TbRawMaterialArchives].[RebarType] = @RebarType686)) GROUP BY [TbRawMaterialStockRecord].[MaterialCode] 	
Parameters:
@ProcessFactoryCode681[String] = 6386683729561128960
@WorkAreaCode683[String] = 6372921396045311451
@WorkAreaCode684[String] = 6372921398380745033
@RebarType686[String] = SectionSteel


-----------------------------------------------------------------------------
2020-07-13 11:19:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:19:43
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode688) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode689,@WorkAreaCode690))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus691) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth692))) 	
Parameters:
@ProcessFactoryCode688[String] = 6386683729561128960
@WorkAreaCode689[String] = 6372921396045311451
@WorkAreaCode690[String] = 6372921398380745033
@Examinestatus691[String] = 审核完成
@DemandMonth692[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 11:19:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:19:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:19:43
Text:	
                        select fewoi.DataCode as OddNumbers,
                         fewoi.EarlyWarningContent,
                         fewoi.EWFormDataCode,
                         CONVERT(varchar(100), fewoi.EarlyWarningTime, 120) as EarlyWarningTime,
                         EWFormCode,sm.MenuName,fn.FlowNodeName,cp1.CompanyFullName as BranchName,
                         cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,
                         u1.UserName as FlowSpUserName,u2.UserName as FlowYjUserName 
                        FROM (
                        select*
                           FROM ( 
                        		SELECT a.*, row_number()over(partition BY a.FlowCode ORDER BY a.FlowNodeCode,a.EarlyWarningTime desc) as group_idx 
                        		FROM TbFlowEarlyWarningOtherInfo  a
                        		INNER JOIN  TbFlowEarlyWarningInfo b ON a.FlowCode=b.FlowCode 
                        		AND a.EWFormDataCode=b.EWFormDataCode AND a.FlowNodeCode=b.FlowNodeCode 
                        		WHERE YEAR(a.EarlyWarningTime)= @Year and MONTH(a.EarlyWarningTime)= @Month AND b.EarlyWarningStart=0
                           ) ret
                        WHERE ret.group_idx =1
                        ) fewoi
                        left join TbFlowNode fn on fewoi.FlowCode=fn.FlowCode and fewoi.FlowNodeCode=fn.FlowNodeCode
                        left join TbSysMenu sm on fewoi.EWFormCode=sm.MenuCode
                        left join TbCompany cp1 on fewoi.BranchCode=cp1.CompanyCode
                        left join TbCompany cp2 on fewoi.WorkAreaCode=cp2.CompanyCode
                        left join TbCompany cp3 on fewoi.SiteCode=cp3.CompanyCode
                        left join TbCompany cp4 on fewoi.ProcessFactoryCode=cp4.CompanyCode
                        left join TbUser u1 on fewoi.FlowSpUserCode=u1.UserId
                        left join TbUser u2 on fewoi.FlowYjUserCode=u2.UserId where 1=1 and fewoi.ProjectId='6372912251695766465' and fewoi.ProcessFactoryCode='6386683729561128960' and (fewoi.SiteCode in('6372921375874657752') or fewoi.WorkAreaCode in('6372921396045311451','6372921398380745033')) ORDER BY fewoi.EarlyWarningTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 11:19:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:19:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:19:43
Text:	--原材料供货超时
                           select BatchPlanNum,cp1.CompanyFullName as BranchName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,sup.SupplyDate,sup.SupplyCompleteTime,sup.ProjectId,sup.Remarks from TbSupplyList sup
                           left join TbCompany cp1 on cp1.CompanyCode=sup.BranchCode
                           left join TbCompany cp2 on cp2.CompanyCode=sup.WorkAreaCode
                           left join TbCompany cp3 on cp3.CompanyCode=sup.SiteCode
                           left join TbCompany cp4 on cp4.CompanyCode=sup.ProcessFactoryCode
                           where YEAR(sup.SupplyDate)= @Year and MONTH(sup.SupplyDate)= @Month
                           and (sup.SupplyCompleteTime>sup.SupplyDate or (GETDATE()>sup.SupplyDate and sup.SupplyCompleteTime is null))  and sup.ProjectId='6372912251695766465' and sup.ProcessFactoryCode='6386683729561128960' and (sup.SiteCode in('6372921375874657752') or sup.WorkAreaCode in('6372921396045311451','6372921398380745033'))	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 11:19:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:19:43
Text:	--加工进度滞后
                           select op.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,op.DistributionTime,op.FinishProcessingDateTime from TbOrderProgress op 
                           left join TbCompany cp1 on op.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on op.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(op.DistributionTime)= @Year and MONTH(op.DistributionTime)= @Month
                           and (op.FinishProcessingDateTime>op.DistributionTime or (GETDATE()>op.DistributionTime and op.FinishProcessingDateTime is null))  and op.ProjectId='6372912251695766465' and op.ProcessFactoryCode='6386683729561128960' and op.SiteCode in('6372921375874657752') ORDER BY op.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 11:19:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:19:43
Text:	--配送超期
                           select dpi.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,dpi.DistributionTime,dpi.DeliveryCompleteTime,dpi.Remark from TbDistributionPlanInfo dpi
                           left join TbCompany cp1 on dpi.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on dpi.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(dpi.DistributionTime)= @Year and MONTH(dpi.DistributionTime)= @Month
                           and (dpi.DeliveryCompleteTime>dpi.DistributionTime or (GETDATE()>dpi.DistributionTime and dpi.DeliveryCompleteTime is null))  and dpi.ProjectId='6372912251695766465' and dpi.ProcessFactoryCode='6386683729561128960' and dpi.SiteCode in('6372921375874657752') ORDER BY dpi.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 11:19:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:19:43
Text:	select TbYj.*,cp1.CompanyFullName as SiteName,tcr.EnterSpaceTime,tcr.StartDischargeTime,tcr.EndDischargeTime,disEnt.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SiteDischargeCargo' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbTransportCarReport tcr on TbYj.EWFormDataCode=tcr.DisEntOrderId
                           left join TbDistributionEnt disEnt on tcr.DistributionCode=disEnt.DistributionCode
                           left join TbCompany cp on disEnt.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and disEnt.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ORDER BY tcr.EnterSpaceTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 11:19:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:19:43
Text:	select TbYj.*,cp1.CompanyFullName as SiteName,sfs.DistributionCode,sdc.DistributionTime,sfs.SigninTime,sfs.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SemiFinishedSign' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbSemiFinishedSign sfs on TbYj.EWFormDataCode=sfs.ID
                           left join TbSiteDischargeCargo sdc on sfs.DistributionCode=sdc.DistributionCode and sfs.DischargeCargoCode=sdc.DischargeCargoCode
                           left join TbCompany cp on sfs.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month and TbYj.ProjectId='6372912251695766465' and sfs.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752')	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 11:19:44
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:19:44
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:19:44
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:19:44
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:19:44
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:19:44
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:19:44
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:19:44
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:19:44
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:19:44
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:19:44
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:19:44
Text:	SELECT 
                            '审批超时' as YjTypeName,COUNT(1) as YjNum
                            FROM (
									SELECT a.*, row_number()over(partition BY a.FlowCode ORDER BY a.FlowNodeCode,a.EarlyWarningTime desc) as group_idx 
									FROM TbFlowEarlyWarningOtherInfo  a
									INNER JOIN  TbFlowEarlyWarningInfo b ON a.FlowCode=b.FlowCode 
									AND a.EWFormDataCode=b.EWFormDataCode AND a.FlowNodeCode=b.FlowNodeCode 
									WHERE  b.EarlyWarningStart=0 AND YEAR(a.EarlyWarningTime)= @Year and MONTH(a.EarlyWarningTime)= @Month  and a.ProjectId='6372912251695766465' and a.ProcessFactoryCode='6386683729561128960' and (a.SiteCode in('6372921375874657752') or a.WorkAreaCode in('6372921396045311451','6372921398380745033'))
							   ) Tb1
                            WHERE Tb1.group_idx =1
                           union all
                            select '未报月度需求计划' as YjTypeName,COUNT(1)as YjNum
                             FROM ( 
                                  SELECT *, row_number()over(partition BY EarlyWarningCode,EWFormDataCode ORDER BY EWNodeCode,EWTime desc) as group_idx 
                                  FROM TbFormEarlyWarningNodeInfo fwqi
                                  WHERE fwqi.MenuCode='RawMonthDemandPlan' AND fwqi.EWStart=0 AND YEAR(fwqi.EWTime)= @Year and MONTH(fwqi.EWTime)= @Month  and fwqi.ProjectId='6372912251695766465' and (fwqi.SiteCode in('6372921375874657752') or fwqi.WorkArea in('6372921396045311451','6372921398380745033'))  
                             ) Tb2
                             WHERE Tb2.group_idx =1
                           union all
                           select '原材料供货超时' as YjTypeName,COUNT(1) as YjNum from (
                           select BatchPlanNum,cp1.CompanyFullName as BranchName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,sup.SupplyDate,sup.SupplyCompleteTime,sup.ProjectId from TbSupplyList sup
                           left join TbCompany cp1 on cp1.CompanyCode=sup.BranchCode
                           left join TbCompany cp2 on cp2.CompanyCode=sup.WorkAreaCode
                           left join TbCompany cp3 on cp3.CompanyCode=sup.SiteCode
                           left join TbCompany cp4 on cp4.CompanyCode=sup.ProcessFactoryCode
                           where (sup.SupplyCompleteTime>sup.SupplyDate or (GETDATE()>sup.SupplyDate and sup.SupplyCompleteTime is null))
						   and YEAR(sup.SupplyDate)= @Year and MONTH(sup.SupplyDate)= @Month  and sup.ProjectId='6372912251695766465' and sup.ProcessFactoryCode='6386683729561128960' and (sup.SiteCode in('6372921375874657752') or sup.WorkAreaCode in('6372921396045311451','6372921398380745033'))) Tb3
                           union all
                           select '加急订单' as YjTypeName,COUNT(1) as YjNum from (--加急订单个数
                           select wo.OrderCode,wo.DistributionTime,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName from TbWorkOrder wo
                           left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on wo.ProcessFactoryCode=cp2.CompanyCode
                           where UrgentDegree='Urgent' 
						   and YEAR(wo.DistributionTime)= @Year and MONTH(wo.DistributionTime)= @Month  and wo.ProjectId='6372912251695766465' and wo.ProcessFactoryCode='6386683729561128960' and wo.SiteCode in('6372921375874657752') ) Tb4
                           union all
                           select '加工进度滞后' as YjTypeName,COUNT(1) as YjNum from (--加工进度滞后
                           select op.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,op.DistributionTime,op.FinishProcessingDateTime from TbOrderProgress op 
                           left join TbCompany cp1 on op.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on op.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(op.DistributionTime)= @Year and MONTH(op.DistributionTime)= @Month
                           and (op.FinishProcessingDateTime>op.DistributionTime or (GETDATE()>op.DistributionTime and op.FinishProcessingDateTime is null))  and op.ProjectId='6372912251695766465' and op.ProcessFactoryCode='6386683729561128960' and op.SiteCode in('6372921375874657752') ) Tb5
                           union all
                           select '接收配送超期' as YjTypeName,COUNT(1) as YjNum from (--配送超期
                           select dpi.OrderCode,cp1.CompanyFullName as SIteName,cp2.CompanyFullName as ProcessFactoryName,dpi.DistributionTime,dpi.DeliveryCompleteTime from TbDistributionPlanInfo dpi
                           left join TbCompany cp1 on dpi.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on dpi.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(dpi.DistributionTime)= @Year and MONTH(dpi.DistributionTime)= @Month
                           and (dpi.DeliveryCompleteTime>dpi.DistributionTime or (GETDATE()>dpi.DistributionTime and dpi.DeliveryCompleteTime is null))  and dpi.ProjectId='6372912251695766465' and dpi.ProcessFactoryCode='6386683729561128960' and dpi.SiteCode in('6372921375874657752') ) Tb6 
                           union all
                           select '卸货超时' as YjTypeName,COUNT(1) as YjNum from(--卸货超时
                           select TbYj.*,cp1.CompanyFullName as SiteName,tcr.EnterSpaceTime,tcr.StartDischargeTime,tcr.EndDischargeTime,disEnt.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SiteDischargeCargo' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbTransportCarReport tcr on TbYj.EWFormDataCode=tcr.DisEntOrderId
                           left join TbDistributionEnt disEnt on tcr.DistributionCode=disEnt.DistributionCode
                           left join TbCompany cp on disEnt.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and disEnt.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ) Tb7
                           union all
                           select '签收超时' as YjTypeName,COUNT(1) as YjNum from (select TbYj.*,cp1.CompanyFullName as SiteName,sfs.DistributionCode,sdc.DistributionTime,sfs.SigninTime,sfs.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SemiFinishedSign' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbSemiFinishedSign sfs on TbYj.EWFormDataCode=sfs.ID
                           left join TbSiteDischargeCargo sdc on sfs.DistributionCode=sdc.DistributionCode and sfs.DischargeCargoCode=sdc.DischargeCargoCode
                           left join TbCompany cp on sfs.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and sfs.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ) Tb8	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 11:19:44
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:19:44
Text:	--加急订单个数
                           select wo.OrderCode,wo.DistributionTime,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName from TbWorkOrder wo
                           left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on wo.ProcessFactoryCode=cp2.CompanyCode
                           where UrgentDegree='Urgent'
                           and YEAR(wo.DistributionTime)= @Year and MONTH(wo.DistributionTime)= @Month  and wo.ProjectId='6372912251695766465' and wo.ProcessFactoryCode='6386683729561128960' and wo.SiteCode in('6372921375874657752')  ORDER BY wo.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 11:19:44
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:19:44
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode693) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode694,@WorkAreaCode695))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus696) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth697))) 	
Parameters:
@ProcessFactoryCode693[String] = 6386683729561128960
@WorkAreaCode694[String] = 6372921396045311451
@WorkAreaCode695[String] = 6372921398380745033
@Examinestatus696[String] = 审核完成
@DemandMonth697[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 11:19:44
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:19:44
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:19:44
Text:	SELECT sm.MenuName,fwqi.EWContent,fwqi.EWUserCode,u.UserName,fwqi.EWFormDataCode,cp1.CompanyFullName as  FbName,cp2.CompanyFullName as GqName,fwqi.EWTime,sdd.DictionaryText as RebarType  
                   FROM (  
                    select ret.*
                    FROM ( 
                         SELECT *, row_number()over(partition BY EarlyWarningCode,EWFormDataCode ORDER BY EWNodeCode,EWTime desc) as group_idx 
                         FROM TbFormEarlyWarningNodeInfo fwqi
                         WHERE YEAR(fwqi.EWTime)= @Year and MONTH(fwqi.EWTime)= @Month AND fwqi.MenuCode='RawMonthDemandPlan' AND fwqi.EWStart=0
                    ) ret
                    WHERE ret.group_idx = 1
                   ) fwqi
                    left join TbSysMenu sm on fwqi.MenuCode=sm.MenuCode
                            left join TbCompany cp1 on fwqi.CompanyCode=cp1.CompanyCode
                            left join TbCompany cp2 on fwqi.WorkArea=cp2.CompanyCode
                            left join TbCompany cp3 on fwqi.SiteCode=cp3.CompanyCode
                            left join TbUser u on fwqi.EWUserCode=u.UserId
                            left join TbRawMaterialMonthDemandPlan rmp on fwqi.EWFormDataCode=rmp.ID
                            left join TbSysDictionaryData sdd on sdd.DictionaryCode=rmp.RebarType
                    where 1=1 and fwqi.ProjectId='6372912251695766465' and (fwqi.SiteCode in('6372921375874657752') or fwqi.WorkArea in('6372921396045311451','6372921398380745033')) ORDER BY fwqi.EWTime DESC	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 11:19:45
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:19:45
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:19:45
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode700) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode701))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState702)) 	
Parameters:
@ProcessFactoryCode700[String] = 6386683729561128960
@SiteCode701[String] = 6372921375874657752
@ProcessingState702[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-13 11:19:45
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-13 11:19:45
Text:	 SELECT   [TbOrderProgress].[ProcessingState],[TbOrderProgress].[OrderCode],[TbOrderProgress].[FinishProcessingDateTime],[TbOrderProgress].[DistributionTime],[TbOrderProgress].[SiteCode] FROM [TbOrderProgress]  WHERE ((([TbOrderProgress].[SiteCode] IN (@SiteCode698)) AND ([TbOrderProgress].[ProcessFactoryCode] = @ProcessFactoryCode699)) AND ((YEAR(DistributionTime)=2020 and MONTH(DistributionTime)=7) or (DistributionTime<'2020/7/1 0:00:00' and (ProcessingState!='Finishing')))) 	
Parameters:
@SiteCode698[String] = 6372921375874657752
@ProcessFactoryCode699[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-13 11:19:45
Text:	 SELECT   * FROM [TbWorkOrderDetail]  WHERE (1=2) AND ([TbWorkOrderDetail].[DaetailWorkStrat] = @DaetailWorkStrat703) 	
Parameters:
@DaetailWorkStrat703[String] = 未加工


-----------------------------------------------------------------------------
2020-07-13 11:19:45
Text:	 SELECT   [TbOrderProgress].[WeightTotal] AS [TotalWeight],[TbCompany].[ParentCompanyCode] FROM [TbOrderProgress] LEFT OUTER JOIN [TbCompany] ON ([TbOrderProgress].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((1=2) AND ([TbOrderProgress].[ProcessingState] <> @ProcessingState704)) AND ((([TbOrderProgress].[FinishProcessingDateTime] is not null ) AND ([TbOrderProgress].[DistributionTime] < [TbOrderProgress].[FinishProcessingDateTime])) OR (([TbOrderProgress].[FinishProcessingDateTime] is null ) AND ([TbOrderProgress].[DistributionTime] < @DistributionTime705)))) 	
Parameters:
@ProcessingState704[String] = Finishing
@DistributionTime705[DateTime] = 2020/7/13 0:00:00


-----------------------------------------------------------------------------
2020-07-13 11:19:47
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 11:19:47
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-13 11:19:47
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:19:47
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:19:48
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 11:19:48
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-13 11:19:48
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 11:19:48
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:19:48
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:19:48
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 11:19:48
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 11:19:48
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 11:19:48
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:19:48
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:19:48
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 11:19:49
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 11:19:49
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 11:20:21
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:20:21
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:20:23
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 11:20:23
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-13 11:20:23
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:20:23
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:20:24
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 11:20:24
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-13 11:20:24
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 11:20:24
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:20:24
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:20:24
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 11:20:24
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 11:20:24
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 11:20:24
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:20:24
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:20:24
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 11:20:25
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 11:20:25
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 11:20:34
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 11:20:34
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-13 11:20:35
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:20:35
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:20:35
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 11:20:35
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-13 11:20:35
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 11:20:35
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:20:35
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:20:35
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 11:20:35
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 11:20:35
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:20:35
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:20:35
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 11:20:36
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 11:20:36
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 11:20:37
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 11:20:41
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:20:41
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:20:41
Text:	select 
                           a.RootNumber,
                           a.SizeSelection,
                           a.MaterialCode,
                           a.WeightSmallPlanN,
                           b.MaterialName,
                           b.SpecificationModel,
                           b.MeasurementUnitZl,
                           c.CompanyFullName StartSiteName,
                           d.CompanyFullName EndSiteName
                           from 
                           (
                           select 
                           a.MaterialCode,
                           a.Size as SizeSelection,
                           a.StartSiteCode,
                           a.EndSiteCode,
                           sum(a.Number) RootNumber,
                           sum(a.Weight) WeightSmallPlanN
                           from TbCloutStockPlace a
                           left join TbRMProductionMaterial rmpm on a.CollarCode=rmpm.CollarCode
                           where a.State=1 
                           and (ISNULL(@ProjectId,'')='' OR a.ProjectId=@ProjectId)
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                            and a.EndSiteCode in('6372921375874657752')
                           group by a.MaterialCode,a.Size,a.StartSiteCode,a.EndSiteCode
                           ) a
                           left join TbRawMaterialArchives b on a.MaterialCode=b.MaterialCode
                           left join TbCompany c on c.CompanyCode=a.StartSiteCode
                           left join TbCompany d on d.CompanyCode=a.EndSiteCode
                           where 1=1 
                           and (ISNULL(@MaterialName,'')='' or b.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or b.SpecificationModel like '%'+@SpecificationModel+'%')	
Parameters:
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 
@BegTime[DateTime] = 
@EndTime[DateTime] = 


-----------------------------------------------------------------------------
2020-07-13 11:20:41
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode asc)AS Row, * from (select 
                           a.RootNumber,
                           a.SizeSelection,
                           a.MaterialCode,
                           a.WeightSmallPlanN,
                           b.MaterialName,
                           b.SpecificationModel,
                           b.MeasurementUnitZl,
                           c.CompanyFullName StartSiteName,
                           d.CompanyFullName EndSiteName
                           from 
                           (
                           select 
                           a.MaterialCode,
                           a.Size as SizeSelection,
                           a.StartSiteCode,
                           a.EndSiteCode,
                           sum(a.Number) RootNumber,
                           sum(a.Weight) WeightSmallPlanN
                           from TbCloutStockPlace a
                           left join TbRMProductionMaterial rmpm on a.CollarCode=rmpm.CollarCode
                           where a.State=1 
                           and (ISNULL(@ProjectId,'')='' OR a.ProjectId=@ProjectId)
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                            and a.EndSiteCode in('6372921375874657752')
                           group by a.MaterialCode,a.Size,a.StartSiteCode,a.EndSiteCode
                           ) a
                           left join TbRawMaterialArchives b on a.MaterialCode=b.MaterialCode
                           left join TbCompany c on c.CompanyCode=a.StartSiteCode
                           left join TbCompany d on d.CompanyCode=a.EndSiteCode
                           where 1=1 
                           and (ISNULL(@MaterialName,'')='' or b.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or b.SpecificationModel like '%'+@SpecificationModel+'%')) as a)  SELECT * FROM temptbl where Row between 1 and 50	
Parameters:
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 
@BegTime[DateTime] = 
@EndTime[DateTime] = 


-----------------------------------------------------------------------------
2020-07-13 11:20:42
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)	


-----------------------------------------------------------------------------
2020-07-13 11:20:42
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 11:20:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:20:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:20:43
Text:	select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 11:20:43
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 11:20:43
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='BuildingSteel'	


-----------------------------------------------------------------------------
2020-07-13 11:20:43
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='SectionSteel'	


-----------------------------------------------------------------------------
2020-07-13 11:20:43
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)	


-----------------------------------------------------------------------------
2020-07-13 11:20:43
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 11:20:56
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 11:20:56
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-13 11:20:56
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:20:56
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:20:56
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 11:20:56
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-13 11:20:56
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 11:20:56
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:20:56
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:20:56
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 11:20:56
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 11:20:57
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 11:20:57
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:20:57
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:20:57
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 11:20:57
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 11:20:58
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 11:21:08
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:21:08
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:21:08
Text:	select 
                           a.RootNumber,
                           a.SizeSelection,
                           a.MaterialCode,
                           a.WeightSmallPlanN,
                           b.MaterialName,
                           b.SpecificationModel,
                           b.MeasurementUnitZl,
                           c.CompanyFullName StartSiteName,
                           d.CompanyFullName EndSiteName
                           from 
                           (
                           select 
                           a.MaterialCode,
                           a.Size as SizeSelection,
                           a.StartSiteCode,
                           a.EndSiteCode,
                           sum(a.Number) RootNumber,
                           sum(a.Weight) WeightSmallPlanN
                           from TbCloutStockPlace a
                           left join TbRMProductionMaterial rmpm on a.CollarCode=rmpm.CollarCode
                           where a.State=1 
                           and (ISNULL(@ProjectId,'')='' OR a.ProjectId=@ProjectId)
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                            and a.EndSiteCode in('6372921375874657752')
                           group by a.MaterialCode,a.Size,a.StartSiteCode,a.EndSiteCode
                           ) a
                           left join TbRawMaterialArchives b on a.MaterialCode=b.MaterialCode
                           left join TbCompany c on c.CompanyCode=a.StartSiteCode
                           left join TbCompany d on d.CompanyCode=a.EndSiteCode
                           where 1=1 
                           and (ISNULL(@MaterialName,'')='' or b.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or b.SpecificationModel like '%'+@SpecificationModel+'%')	
Parameters:
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 
@BegTime[DateTime] = 
@EndTime[DateTime] = 


-----------------------------------------------------------------------------
2020-07-13 11:21:08
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode asc)AS Row, * from (select 
                           a.RootNumber,
                           a.SizeSelection,
                           a.MaterialCode,
                           a.WeightSmallPlanN,
                           b.MaterialName,
                           b.SpecificationModel,
                           b.MeasurementUnitZl,
                           c.CompanyFullName StartSiteName,
                           d.CompanyFullName EndSiteName
                           from 
                           (
                           select 
                           a.MaterialCode,
                           a.Size as SizeSelection,
                           a.StartSiteCode,
                           a.EndSiteCode,
                           sum(a.Number) RootNumber,
                           sum(a.Weight) WeightSmallPlanN
                           from TbCloutStockPlace a
                           left join TbRMProductionMaterial rmpm on a.CollarCode=rmpm.CollarCode
                           where a.State=1 
                           and (ISNULL(@ProjectId,'')='' OR a.ProjectId=@ProjectId)
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                            and a.EndSiteCode in('6372921375874657752')
                           group by a.MaterialCode,a.Size,a.StartSiteCode,a.EndSiteCode
                           ) a
                           left join TbRawMaterialArchives b on a.MaterialCode=b.MaterialCode
                           left join TbCompany c on c.CompanyCode=a.StartSiteCode
                           left join TbCompany d on d.CompanyCode=a.EndSiteCode
                           where 1=1 
                           and (ISNULL(@MaterialName,'')='' or b.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or b.SpecificationModel like '%'+@SpecificationModel+'%')) as a)  SELECT * FROM temptbl where Row between 1 and 50	
Parameters:
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 
@BegTime[DateTime] = 
@EndTime[DateTime] = 


-----------------------------------------------------------------------------
2020-07-13 11:22:41
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:23:40
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:23:40
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:23:40
Text:	select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 11:23:40
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 11:23:40
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='BuildingSteel'	


-----------------------------------------------------------------------------
2020-07-13 11:23:40
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='SectionSteel'	


-----------------------------------------------------------------------------
2020-07-13 11:23:41
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)	


-----------------------------------------------------------------------------
2020-07-13 11:23:41
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 11:23:41
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)	


-----------------------------------------------------------------------------
2020-07-13 11:23:41
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 11:25:41
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:26:51
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 11:26:51
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-13 11:26:51
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:26:51
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:26:51
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 11:26:51
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-13 11:26:51
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 11:26:52
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:26:52
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:26:52
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 11:26:52
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 11:26:52
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 11:26:52
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 11:26:52
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:26:52
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:26:52
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 11:26:53
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 11:27:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:27:43
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:27:43
Text:	select 
                           a.RootNumber,
                           a.SizeSelection,
                           a.MaterialCode,
                           a.WeightSmallPlanN,
                           b.MaterialName,
                           b.SpecificationModel,
                           b.MeasurementUnitZl,
                           c.CompanyFullName StartSiteName,
                           d.CompanyFullName EndSiteName
                           from 
                           (
                           select 
                           a.MaterialCode,
                           a.Size as SizeSelection,
                           a.StartSiteCode,
                           a.EndSiteCode,
                           sum(a.Number) RootNumber,
                           sum(a.Weight) WeightSmallPlanN
                           from TbCloutStockPlace a
                           left join TbRMProductionMaterial rmpm on a.CollarCode=rmpm.CollarCode
                           where a.State=1 
                           and (ISNULL(@ProjectId,'')='' OR a.ProjectId=@ProjectId)
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                            and a.EndSiteCode in('6372921375874657752')
                           group by a.MaterialCode,a.Size,a.StartSiteCode,a.EndSiteCode
                           ) a
                           left join TbRawMaterialArchives b on a.MaterialCode=b.MaterialCode
                           left join TbCompany c on c.CompanyCode=a.StartSiteCode
                           left join TbCompany d on d.CompanyCode=a.EndSiteCode
                           where 1=1 
                           and (ISNULL(@MaterialName,'')='' or b.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or b.SpecificationModel like '%'+@SpecificationModel+'%')	
Parameters:
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 
@BegTime[DateTime] = 
@EndTime[DateTime] = 


-----------------------------------------------------------------------------
2020-07-13 11:27:43
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode asc)AS Row, * from (select 
                           a.RootNumber,
                           a.SizeSelection,
                           a.MaterialCode,
                           a.WeightSmallPlanN,
                           b.MaterialName,
                           b.SpecificationModel,
                           b.MeasurementUnitZl,
                           c.CompanyFullName StartSiteName,
                           d.CompanyFullName EndSiteName
                           from 
                           (
                           select 
                           a.MaterialCode,
                           a.Size as SizeSelection,
                           a.StartSiteCode,
                           a.EndSiteCode,
                           sum(a.Number) RootNumber,
                           sum(a.Weight) WeightSmallPlanN
                           from TbCloutStockPlace a
                           left join TbRMProductionMaterial rmpm on a.CollarCode=rmpm.CollarCode
                           where a.State=1 
                           and (ISNULL(@ProjectId,'')='' OR a.ProjectId=@ProjectId)
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                            and a.EndSiteCode in('6372921375874657752')
                           group by a.MaterialCode,a.Size,a.StartSiteCode,a.EndSiteCode
                           ) a
                           left join TbRawMaterialArchives b on a.MaterialCode=b.MaterialCode
                           left join TbCompany c on c.CompanyCode=a.StartSiteCode
                           left join TbCompany d on d.CompanyCode=a.EndSiteCode
                           where 1=1 
                           and (ISNULL(@MaterialName,'')='' or b.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or b.SpecificationModel like '%'+@SpecificationModel+'%')) as a)  SELECT * FROM temptbl where Row between 1 and 50	
Parameters:
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 
@BegTime[DateTime] = 
@EndTime[DateTime] = 


-----------------------------------------------------------------------------
2020-07-13 11:27:55
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:27:55
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:27:55
Text:	select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 11:27:55
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 11:27:55
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='BuildingSteel'	


-----------------------------------------------------------------------------
2020-07-13 11:27:55
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='SectionSteel'	


-----------------------------------------------------------------------------
2020-07-13 11:27:55
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)	


-----------------------------------------------------------------------------
2020-07-13 11:27:55
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 11:27:56
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)	


-----------------------------------------------------------------------------
2020-07-13 11:27:56
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 11:28:41
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:31:41
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:33:19
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:33:19
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:33:20
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:33:20
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:33:20
Text:	select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 11:33:20
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 11:33:20
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='BuildingSteel'	


-----------------------------------------------------------------------------
2020-07-13 11:33:20
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='SectionSteel'	


-----------------------------------------------------------------------------
2020-07-13 11:33:36
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:33:36
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:33:36
Text:	select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 11:33:36
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 11:33:36
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='BuildingSteel'	


-----------------------------------------------------------------------------
2020-07-13 11:33:36
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='SectionSteel'	


-----------------------------------------------------------------------------
2020-07-13 11:33:36
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:33:36
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:33:38
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 11:33:38
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-13 11:33:38
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:33:38
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:33:39
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 11:33:39
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-13 11:33:39
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 11:33:39
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:33:39
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:33:39
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 11:33:39
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 11:33:39
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:33:39
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:33:39
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 11:33:39
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 11:33:40
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 11:33:40
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 11:33:44
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:33:44
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:33:44
Text:	select 
                           a.RootNumber,
                           a.SizeSelection,
                           a.MaterialCode,
                           a.WeightSmallPlanN,
                           b.MaterialName,
                           b.SpecificationModel,
                           b.MeasurementUnitZl,
                           c.CompanyFullName StartSiteName,
                           d.CompanyFullName EndSiteName
                           from 
                           (
                           select 
                           a.MaterialCode,
                           a.Size as SizeSelection,
                           a.StartSiteCode,
                           a.EndSiteCode,
                           sum(a.Number) RootNumber,
                           sum(a.Weight) WeightSmallPlanN
                           from TbCloutStockPlace a
                           left join TbRMProductionMaterial rmpm on a.CollarCode=rmpm.CollarCode
                           where a.State=1 
                           and (ISNULL(@ProjectId,'')='' OR a.ProjectId=@ProjectId)
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                            and a.EndSiteCode in('6372921375874657752')
                           group by a.MaterialCode,a.Size,a.StartSiteCode,a.EndSiteCode
                           ) a
                           left join TbRawMaterialArchives b on a.MaterialCode=b.MaterialCode
                           left join TbCompany c on c.CompanyCode=a.StartSiteCode
                           left join TbCompany d on d.CompanyCode=a.EndSiteCode
                           where 1=1 
                           and (ISNULL(@MaterialName,'')='' or b.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or b.SpecificationModel like '%'+@SpecificationModel+'%')	
Parameters:
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 
@BegTime[DateTime] = 
@EndTime[DateTime] = 


-----------------------------------------------------------------------------
2020-07-13 11:33:44
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode asc)AS Row, * from (select 
                           a.RootNumber,
                           a.SizeSelection,
                           a.MaterialCode,
                           a.WeightSmallPlanN,
                           b.MaterialName,
                           b.SpecificationModel,
                           b.MeasurementUnitZl,
                           c.CompanyFullName StartSiteName,
                           d.CompanyFullName EndSiteName
                           from 
                           (
                           select 
                           a.MaterialCode,
                           a.Size as SizeSelection,
                           a.StartSiteCode,
                           a.EndSiteCode,
                           sum(a.Number) RootNumber,
                           sum(a.Weight) WeightSmallPlanN
                           from TbCloutStockPlace a
                           left join TbRMProductionMaterial rmpm on a.CollarCode=rmpm.CollarCode
                           where a.State=1 
                           and (ISNULL(@ProjectId,'')='' OR a.ProjectId=@ProjectId)
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                            and a.EndSiteCode in('6372921375874657752')
                           group by a.MaterialCode,a.Size,a.StartSiteCode,a.EndSiteCode
                           ) a
                           left join TbRawMaterialArchives b on a.MaterialCode=b.MaterialCode
                           left join TbCompany c on c.CompanyCode=a.StartSiteCode
                           left join TbCompany d on d.CompanyCode=a.EndSiteCode
                           where 1=1 
                           and (ISNULL(@MaterialName,'')='' or b.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or b.SpecificationModel like '%'+@SpecificationModel+'%')) as a)  SELECT * FROM temptbl where Row between 1 and 50	
Parameters:
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 
@BegTime[DateTime] = 
@EndTime[DateTime] = 


-----------------------------------------------------------------------------
2020-07-13 11:34:41
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:34:56
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:34:56
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:34:56
Text:	select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 11:34:56
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 11:34:56
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='BuildingSteel'	


-----------------------------------------------------------------------------
2020-07-13 11:34:56
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='SectionSteel'	


-----------------------------------------------------------------------------
2020-07-13 11:34:57
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)	


-----------------------------------------------------------------------------
2020-07-13 11:34:57
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount!=0 or a.LockCount=0) and a.ChackState<=1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 11:34:57
Text:	select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)	


-----------------------------------------------------------------------------
2020-07-13 11:34:57
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by ID desc)AS Row, * from (select
                                a.ID,
                                a.Factory,
                                a.BatchNumber,
                                a.InsertTime,
                                a.Count,
                                a.LockCount,
                                a.UseCount,
                                a.HistoryCount,
                                a.ChackState,
                                tsoi.Enclosure,
                                tsoi.TestReportNo
                                from 
                                TbRawMaterialStockRecord a
                                left join TbStorage s on a.StorageCode=s.StorageCode
                                LEFT JOIN TbSampleOrderItem tsoi ON tsoi.InOrderItemId=a.InOrderitemId where 1=1  and a.MaterialCode='' and a.SiteCode='6372921375874657752' and a.WorkAreaCode='' and a.ProjectId='6372912251695766465' and s.ProcessFactoryCode='6386683729561128960' and ((a.LockCount+a.UseCount=0 and a.LockCount!=0) or a.ChackState>1)) as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 11:34:59
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:34:59
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:34:59
Text:	select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 11:34:59
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 11:34:59
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='BuildingSteel'	


-----------------------------------------------------------------------------
2020-07-13 11:34:59
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='SectionSteel'	


-----------------------------------------------------------------------------
2020-07-13 11:35:00
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:35:00
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:35:11
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 11:35:11
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 11:35:11
Text:	select isnull(sum(TbCF.Capacity),0) as Capacity,isnull(sum(TbCF.WeightSmallPlan),0) as WeightSmallPlan,isnull(cast(sum(TbCF.WeightSmallPlan)/sum(TbCF.Capacity)*100 as decimal(18,2)),0) as ActualLoadNew from (select cf.Capacity,Tb1.WeightSmallPlan,cf.ProcessFactoryCode from TbCapacityFilling cf  
left join(
select SUM(Tb.WeightSmallPlan) as WeightSmallPlan,Tb.ProcessFactoryCode from (
                            select isnull(SUM(wod.WeightSmallPlan),0) as WeightSmallPlan,wo.ProcessFactoryCode from TbWorkOrder wo
                            left join TbWorkOrderDetail wod on wo.OrderCode=wod.OrderCode
                            where (ISNULL(@ProcessFactoryCode,'')='' or wo.ProcessFactoryCode=@ProcessFactoryCode)
                            and CONVERT(varchar(7), wo.DistributionTime, 120)=@month
                            and wod.RevokeStart='正常' and wo.ProcessingState!='ConfirmWork' and wo.ProcessingState!='Finishing'  group by wo.ProcessFactoryCode
                            union all
                            select isnull(sum(opd.NoCompleted),0) as NoCompleted,op.ProcessFactoryCode from TbOrderProgress op
                            left join TbOrderProgressDetail opd on op.OrderCode=opd.OrderCode 
                            where (ISNULL(@ProcessFactoryCode,'')='' or op.ProcessFactoryCode=@ProcessFactoryCode)
                            and CONVERT(varchar(7), op.DistributionTime, 120)=CONVERT(varchar(4),YEAR(DATEADD(MONTH,-1,@month+'-01')))+'-'+Right(100+Month(DATEADD(MONTH,-1,@month+'-01')),2)
                            and opd.RevokeStart='正常'  group by op.ProcessFactoryCode)Tb  group by Tb.ProcessFactoryCode
) Tb1 on cf.ProcessFactoryCode=Tb1.ProcessFactoryCode 
where cf.CapacityMonth=@month
and (ISNULL(@ProcessFactoryCode,'')='' or cf.ProcessFactoryCode=@ProcessFactoryCode)) TbCF where (ISNULL(@ProcessFactoryCode,'')='' or TbCF.ProcessFactoryCode=@ProcessFactoryCode)	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@month[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 11:35:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:35:12
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode706) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode707,@WorkAreaCode708))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus709) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth710))) 	
Parameters:
@ProcessFactoryCode706[String] = 6386683729561128960
@WorkAreaCode707[String] = 6372921396045311451
@WorkAreaCode708[String] = 6372921398380745033
@Examinestatus709[String] = 审核完成
@DemandMonth710[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 11:35:12
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:35:12
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:35:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:35:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:35:12
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode713) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode714))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState715)) 	
Parameters:
@ProcessFactoryCode713[String] = 6386683729561128960
@SiteCode714[String] = 6372921375874657752
@ProcessingState715[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-13 11:35:12
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-13 11:35:12
Text:	 SELECT   [TbOrderProgress].[ProcessingState],[TbOrderProgress].[OrderCode],[TbOrderProgress].[FinishProcessingDateTime],[TbOrderProgress].[DistributionTime],[TbOrderProgress].[SiteCode] FROM [TbOrderProgress]  WHERE ((([TbOrderProgress].[SiteCode] IN (@SiteCode711)) AND ([TbOrderProgress].[ProcessFactoryCode] = @ProcessFactoryCode712)) AND ((YEAR(DistributionTime)=2020 and MONTH(DistributionTime)=7) or (DistributionTime<'2020/7/1 0:00:00' and (ProcessingState!='Finishing')))) 	
Parameters:
@SiteCode711[String] = 6372921375874657752
@ProcessFactoryCode712[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-13 11:35:12
Text:	 SELECT   * FROM [TbWorkOrderDetail]  WHERE (1=2) AND ([TbWorkOrderDetail].[DaetailWorkStrat] = @DaetailWorkStrat716) 	
Parameters:
@DaetailWorkStrat716[String] = 未加工


-----------------------------------------------------------------------------
2020-07-13 11:35:12
Text:	 SELECT   [TbOrderProgress].[WeightTotal] AS [TotalWeight],[TbCompany].[ParentCompanyCode] FROM [TbOrderProgress] LEFT OUTER JOIN [TbCompany] ON ([TbOrderProgress].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((1=2) AND ([TbOrderProgress].[ProcessingState] <> @ProcessingState717)) AND ((([TbOrderProgress].[FinishProcessingDateTime] is not null ) AND ([TbOrderProgress].[DistributionTime] < [TbOrderProgress].[FinishProcessingDateTime])) OR (([TbOrderProgress].[FinishProcessingDateTime] is null ) AND ([TbOrderProgress].[DistributionTime] < @DistributionTime718)))) 	
Parameters:
@ProcessingState717[String] = Finishing
@DistributionTime718[DateTime] = 2020/7/13 0:00:00


-----------------------------------------------------------------------------
2020-07-13 11:35:12
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:35:12
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode719) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode720))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState721)) 	
Parameters:
@ProcessFactoryCode719[String] = 6386683729561128960
@SiteCode720[String] = 6372921375874657752
@ProcessingState721[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-13 11:35:12
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-13 11:35:13
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:35:13
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode723) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode724,@WorkAreaCode725))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus726) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth727))) 	
Parameters:
@ProcessFactoryCode723[String] = 6386683729561128960
@WorkAreaCode724[String] = 6372921396045311451
@WorkAreaCode725[String] = 6372921398380745033
@Examinestatus726[String] = 审核完成
@DemandMonth727[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 11:35:13
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:35:13
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:35:13
Text:	 SELECT   [TbRawMaterialStockRecord].[MaterialCode],sum([TbRawMaterialStockRecord].[UseCount]) AS [UseCount],sum([TbRawMaterialStockRecord].[LockCount]) AS [LockCount] FROM [TbRawMaterialStockRecord] LEFT OUTER JOIN [TbStorage] ON ([TbRawMaterialStockRecord].[StorageCode] = [TbStorage].[StorageCode]) LEFT OUTER JOIN [TbRawMaterialArchives] ON ([TbRawMaterialStockRecord].[MaterialCode] = [TbRawMaterialArchives].[MaterialCode])  WHERE ((([TbStorage].[ProcessFactoryCode] = @ProcessFactoryCode730) AND ([TbRawMaterialStockRecord].[WorkAreaCode] IN (@WorkAreaCode732,@WorkAreaCode733))) AND ([TbRawMaterialArchives].[RebarType] = @RebarType735)) GROUP BY [TbRawMaterialStockRecord].[MaterialCode] 	
Parameters:
@ProcessFactoryCode730[String] = 6386683729561128960
@WorkAreaCode732[String] = 6372921396045311451
@WorkAreaCode733[String] = 6372921398380745033
@RebarType735[String] = BuildingSteel


-----------------------------------------------------------------------------
2020-07-13 11:35:13
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:35:13
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:35:13
Text:	 SELECT   [TbRawMaterialStockRecord].[MaterialCode],sum([TbRawMaterialStockRecord].[UseCount]) AS [UseCount],sum([TbRawMaterialStockRecord].[LockCount]) AS [LockCount] FROM [TbRawMaterialStockRecord] LEFT OUTER JOIN [TbStorage] ON ([TbRawMaterialStockRecord].[StorageCode] = [TbStorage].[StorageCode]) LEFT OUTER JOIN [TbRawMaterialArchives] ON ([TbRawMaterialStockRecord].[MaterialCode] = [TbRawMaterialArchives].[MaterialCode])  WHERE ((([TbStorage].[ProcessFactoryCode] = @ProcessFactoryCode739) AND ([TbRawMaterialStockRecord].[WorkAreaCode] IN (@WorkAreaCode741,@WorkAreaCode742))) AND ([TbRawMaterialArchives].[RebarType] = @RebarType744)) GROUP BY [TbRawMaterialStockRecord].[MaterialCode] 	
Parameters:
@ProcessFactoryCode739[String] = 6386683729561128960
@WorkAreaCode741[String] = 6372921396045311451
@WorkAreaCode742[String] = 6372921398380745033
@RebarType744[String] = SectionSteel


-----------------------------------------------------------------------------
2020-07-13 11:35:13
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:35:13
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:35:13
Text:	 SELECT   [TbWorkOrder].[WeightTotal],[TbWorkOrder].[OrderCode],[TbCompany].[ParentCompanyCode],[TbWorkOrder].[DistributionTime],[TbWorkOrder].[InsertTime],[TbWorkOrder].[OrderStart] FROM [TbWorkOrder] LEFT OUTER JOIN [TbCompany] ON ([TbWorkOrder].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((([TbWorkOrder].[ProcessFactoryCode] = @ProcessFactoryCode748) AND ([TbWorkOrder].[SiteCode] IN (@SiteCode749))) AND (YEAR(TbWorkOrder.InsertTime)=2020)) AND ([TbWorkOrder].[ProcessingState] <> @ProcessingState750)) 	
Parameters:
@ProcessFactoryCode748[String] = 6386683729561128960
@SiteCode749[String] = 6372921375874657752
@ProcessingState750[String] = ConfirmWork


-----------------------------------------------------------------------------
2020-07-13 11:35:13
Text:	 SELECT   [TbWorkOrderDetail].[WeightSmallPlan],[TbWorkOrderDetail].[FinishTime],[TbWorkOrderDetail].[OrderCode] FROM [TbWorkOrderDetail]  WHERE ((1=2) AND (YEAR(FinishTime)=2020)) 	


-----------------------------------------------------------------------------
2020-07-13 11:35:13
Text:	 SELECT   [TbOrderProgress].[ProcessingState],[TbOrderProgress].[OrderCode],[TbOrderProgress].[FinishProcessingDateTime],[TbOrderProgress].[DistributionTime],[TbOrderProgress].[SiteCode] FROM [TbOrderProgress]  WHERE ((([TbOrderProgress].[SiteCode] IN (@SiteCode746)) AND ([TbOrderProgress].[ProcessFactoryCode] = @ProcessFactoryCode747)) AND ((YEAR(DistributionTime)=2020 and MONTH(DistributionTime)=7) or (DistributionTime<'2020/7/1 0:00:00' and (ProcessingState!='Finishing')))) 	
Parameters:
@SiteCode746[String] = 6372921375874657752
@ProcessFactoryCode747[String] = 6386683729561128960


-----------------------------------------------------------------------------
2020-07-13 11:35:13
Text:	 SELECT   * FROM [TbWorkOrderDetail]  WHERE (1=2) AND ([TbWorkOrderDetail].[DaetailWorkStrat] = @DaetailWorkStrat751) 	
Parameters:
@DaetailWorkStrat751[String] = 未加工


-----------------------------------------------------------------------------
2020-07-13 11:35:13
Text:	 SELECT   [TbOrderProgress].[WeightTotal] AS [TotalWeight],[TbCompany].[ParentCompanyCode] FROM [TbOrderProgress] LEFT OUTER JOIN [TbCompany] ON ([TbOrderProgress].[SiteCode] = [TbCompany].[CompanyCode])  WHERE (((1=2) AND ([TbOrderProgress].[ProcessingState] <> @ProcessingState752)) AND ((([TbOrderProgress].[FinishProcessingDateTime] is not null ) AND ([TbOrderProgress].[DistributionTime] < [TbOrderProgress].[FinishProcessingDateTime])) OR (([TbOrderProgress].[FinishProcessingDateTime] is null ) AND ([TbOrderProgress].[DistributionTime] < @DistributionTime753)))) 	
Parameters:
@ProcessingState752[String] = Finishing
@DistributionTime753[DateTime] = 2020/7/13 0:00:00


-----------------------------------------------------------------------------
2020-07-13 11:35:13
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:35:13
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:35:13
Text:	--原材料供货超时
                           select BatchPlanNum,cp1.CompanyFullName as BranchName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,sup.SupplyDate,sup.SupplyCompleteTime,sup.ProjectId,sup.Remarks from TbSupplyList sup
                           left join TbCompany cp1 on cp1.CompanyCode=sup.BranchCode
                           left join TbCompany cp2 on cp2.CompanyCode=sup.WorkAreaCode
                           left join TbCompany cp3 on cp3.CompanyCode=sup.SiteCode
                           left join TbCompany cp4 on cp4.CompanyCode=sup.ProcessFactoryCode
                           where YEAR(sup.SupplyDate)= @Year and MONTH(sup.SupplyDate)= @Month
                           and (sup.SupplyCompleteTime>sup.SupplyDate or (GETDATE()>sup.SupplyDate and sup.SupplyCompleteTime is null))  and sup.ProjectId='6372912251695766465' and sup.ProcessFactoryCode='6386683729561128960' and (sup.SiteCode in('6372921375874657752') or sup.WorkAreaCode in('6372921396045311451','6372921398380745033'))	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 11:35:13
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:35:13
Text:	--加急订单个数
                           select wo.OrderCode,wo.DistributionTime,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName from TbWorkOrder wo
                           left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on wo.ProcessFactoryCode=cp2.CompanyCode
                           where UrgentDegree='Urgent'
                           and YEAR(wo.DistributionTime)= @Year and MONTH(wo.DistributionTime)= @Month  and wo.ProjectId='6372912251695766465' and wo.ProcessFactoryCode='6386683729561128960' and wo.SiteCode in('6372921375874657752')  ORDER BY wo.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 11:35:13
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:35:13
Text:	--加工进度滞后
                           select op.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,op.DistributionTime,op.FinishProcessingDateTime from TbOrderProgress op 
                           left join TbCompany cp1 on op.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on op.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(op.DistributionTime)= @Year and MONTH(op.DistributionTime)= @Month
                           and (op.FinishProcessingDateTime>op.DistributionTime or (GETDATE()>op.DistributionTime and op.FinishProcessingDateTime is null))  and op.ProjectId='6372912251695766465' and op.ProcessFactoryCode='6386683729561128960' and op.SiteCode in('6372921375874657752') ORDER BY op.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 11:35:13
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:35:13
Text:	--配送超期
                           select dpi.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,dpi.DistributionTime,dpi.DeliveryCompleteTime,dpi.Remark from TbDistributionPlanInfo dpi
                           left join TbCompany cp1 on dpi.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on dpi.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(dpi.DistributionTime)= @Year and MONTH(dpi.DistributionTime)= @Month
                           and (dpi.DeliveryCompleteTime>dpi.DistributionTime or (GETDATE()>dpi.DistributionTime and dpi.DeliveryCompleteTime is null))  and dpi.ProjectId='6372912251695766465' and dpi.ProcessFactoryCode='6386683729561128960' and dpi.SiteCode in('6372921375874657752') ORDER BY dpi.DistributionTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 11:35:13
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:35:13
Text:	select TbYj.*,cp1.CompanyFullName as SiteName,tcr.EnterSpaceTime,tcr.StartDischargeTime,tcr.EndDischargeTime,disEnt.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SiteDischargeCargo' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbTransportCarReport tcr on TbYj.EWFormDataCode=tcr.DisEntOrderId
                           left join TbDistributionEnt disEnt on tcr.DistributionCode=disEnt.DistributionCode
                           left join TbCompany cp on disEnt.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and disEnt.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ORDER BY tcr.EnterSpaceTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 11:35:13
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:35:13
Text:	select TbYj.*,cp1.CompanyFullName as SiteName,sfs.DistributionCode,sdc.DistributionTime,sfs.SigninTime,sfs.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SemiFinishedSign' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbSemiFinishedSign sfs on TbYj.EWFormDataCode=sfs.ID
                           left join TbSiteDischargeCargo sdc on sfs.DistributionCode=sdc.DistributionCode and sfs.DischargeCargoCode=sdc.DischargeCargoCode
                           left join TbCompany cp on sfs.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month and TbYj.ProjectId='6372912251695766465' and sfs.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752')	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 11:35:13
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:35:13
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:35:13
Text:	select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 11:35:13
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 11:35:13
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='BuildingSteel'	


-----------------------------------------------------------------------------
2020-07-13 11:35:13
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='SectionSteel'	


-----------------------------------------------------------------------------
2020-07-13 11:35:13
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:35:13
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:35:13
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:35:13
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:35:13
Text:	
                        select fewoi.DataCode as OddNumbers,
                         fewoi.EarlyWarningContent,
                         fewoi.EWFormDataCode,
                         CONVERT(varchar(100), fewoi.EarlyWarningTime, 120) as EarlyWarningTime,
                         EWFormCode,sm.MenuName,fn.FlowNodeName,cp1.CompanyFullName as BranchName,
                         cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,
                         u1.UserName as FlowSpUserName,u2.UserName as FlowYjUserName 
                        FROM (
                        select*
                           FROM ( 
                        		SELECT a.*, row_number()over(partition BY a.FlowCode ORDER BY a.FlowNodeCode,a.EarlyWarningTime desc) as group_idx 
                        		FROM TbFlowEarlyWarningOtherInfo  a
                        		INNER JOIN  TbFlowEarlyWarningInfo b ON a.FlowCode=b.FlowCode 
                        		AND a.EWFormDataCode=b.EWFormDataCode AND a.FlowNodeCode=b.FlowNodeCode 
                        		WHERE YEAR(a.EarlyWarningTime)= @Year and MONTH(a.EarlyWarningTime)= @Month AND b.EarlyWarningStart=0
                           ) ret
                        WHERE ret.group_idx =1
                        ) fewoi
                        left join TbFlowNode fn on fewoi.FlowCode=fn.FlowCode and fewoi.FlowNodeCode=fn.FlowNodeCode
                        left join TbSysMenu sm on fewoi.EWFormCode=sm.MenuCode
                        left join TbCompany cp1 on fewoi.BranchCode=cp1.CompanyCode
                        left join TbCompany cp2 on fewoi.WorkAreaCode=cp2.CompanyCode
                        left join TbCompany cp3 on fewoi.SiteCode=cp3.CompanyCode
                        left join TbCompany cp4 on fewoi.ProcessFactoryCode=cp4.CompanyCode
                        left join TbUser u1 on fewoi.FlowSpUserCode=u1.UserId
                        left join TbUser u2 on fewoi.FlowYjUserCode=u2.UserId where 1=1 and fewoi.ProjectId='6372912251695766465' and fewoi.ProcessFactoryCode='6386683729561128960' and (fewoi.SiteCode in('6372921375874657752') or fewoi.WorkAreaCode in('6372921396045311451','6372921398380745033')) ORDER BY fewoi.EarlyWarningTime desc	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 11:35:13
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:35:13
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:35:13
Text:	SELECT sm.MenuName,fwqi.EWContent,fwqi.EWUserCode,u.UserName,fwqi.EWFormDataCode,cp1.CompanyFullName as  FbName,cp2.CompanyFullName as GqName,fwqi.EWTime,sdd.DictionaryText as RebarType  
                   FROM (  
                    select ret.*
                    FROM ( 
                         SELECT *, row_number()over(partition BY EarlyWarningCode,EWFormDataCode ORDER BY EWNodeCode,EWTime desc) as group_idx 
                         FROM TbFormEarlyWarningNodeInfo fwqi
                         WHERE YEAR(fwqi.EWTime)= @Year and MONTH(fwqi.EWTime)= @Month AND fwqi.MenuCode='RawMonthDemandPlan' AND fwqi.EWStart=0
                    ) ret
                    WHERE ret.group_idx = 1
                   ) fwqi
                    left join TbSysMenu sm on fwqi.MenuCode=sm.MenuCode
                            left join TbCompany cp1 on fwqi.CompanyCode=cp1.CompanyCode
                            left join TbCompany cp2 on fwqi.WorkArea=cp2.CompanyCode
                            left join TbCompany cp3 on fwqi.SiteCode=cp3.CompanyCode
                            left join TbUser u on fwqi.EWUserCode=u.UserId
                            left join TbRawMaterialMonthDemandPlan rmp on fwqi.EWFormDataCode=rmp.ID
                            left join TbSysDictionaryData sdd on sdd.DictionaryCode=rmp.RebarType
                    where 1=1 and fwqi.ProjectId='6372912251695766465' and (fwqi.SiteCode in('6372921375874657752') or fwqi.WorkArea in('6372921396045311451','6372921398380745033')) ORDER BY fwqi.EWTime DESC	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 11:35:14
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:35:14
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode754) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode755,@WorkAreaCode756))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus757) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth758))) 	
Parameters:
@ProcessFactoryCode754[String] = 6386683729561128960
@WorkAreaCode755[String] = 6372921396045311451
@WorkAreaCode756[String] = 6372921398380745033
@Examinestatus757[String] = 审核完成
@DemandMonth758[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 11:35:14
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:35:14
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:35:14
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:35:14
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:35:14
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:35:14
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:35:14
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:35:14
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:35:14
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:35:14
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:35:14
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:35:14
Text:	SELECT 
                            '审批超时' as YjTypeName,COUNT(1) as YjNum
                            FROM (
									SELECT a.*, row_number()over(partition BY a.FlowCode ORDER BY a.FlowNodeCode,a.EarlyWarningTime desc) as group_idx 
									FROM TbFlowEarlyWarningOtherInfo  a
									INNER JOIN  TbFlowEarlyWarningInfo b ON a.FlowCode=b.FlowCode 
									AND a.EWFormDataCode=b.EWFormDataCode AND a.FlowNodeCode=b.FlowNodeCode 
									WHERE  b.EarlyWarningStart=0 AND YEAR(a.EarlyWarningTime)= @Year and MONTH(a.EarlyWarningTime)= @Month  and a.ProjectId='6372912251695766465' and a.ProcessFactoryCode='6386683729561128960' and (a.SiteCode in('6372921375874657752') or a.WorkAreaCode in('6372921396045311451','6372921398380745033'))
							   ) Tb1
                            WHERE Tb1.group_idx =1
                           union all
                            select '未报月度需求计划' as YjTypeName,COUNT(1)as YjNum
                             FROM ( 
                                  SELECT *, row_number()over(partition BY EarlyWarningCode,EWFormDataCode ORDER BY EWNodeCode,EWTime desc) as group_idx 
                                  FROM TbFormEarlyWarningNodeInfo fwqi
                                  WHERE fwqi.MenuCode='RawMonthDemandPlan' AND fwqi.EWStart=0 AND YEAR(fwqi.EWTime)= @Year and MONTH(fwqi.EWTime)= @Month  and fwqi.ProjectId='6372912251695766465' and (fwqi.SiteCode in('6372921375874657752') or fwqi.WorkArea in('6372921396045311451','6372921398380745033'))  
                             ) Tb2
                             WHERE Tb2.group_idx =1
                           union all
                           select '原材料供货超时' as YjTypeName,COUNT(1) as YjNum from (
                           select BatchPlanNum,cp1.CompanyFullName as BranchName,cp2.CompanyFullName as WorkAreaName,cp3.CompanyFullName as SiteName,cp4.CompanyFullName as ProcessFactoryName,sup.SupplyDate,sup.SupplyCompleteTime,sup.ProjectId from TbSupplyList sup
                           left join TbCompany cp1 on cp1.CompanyCode=sup.BranchCode
                           left join TbCompany cp2 on cp2.CompanyCode=sup.WorkAreaCode
                           left join TbCompany cp3 on cp3.CompanyCode=sup.SiteCode
                           left join TbCompany cp4 on cp4.CompanyCode=sup.ProcessFactoryCode
                           where (sup.SupplyCompleteTime>sup.SupplyDate or (GETDATE()>sup.SupplyDate and sup.SupplyCompleteTime is null))
						   and YEAR(sup.SupplyDate)= @Year and MONTH(sup.SupplyDate)= @Month  and sup.ProjectId='6372912251695766465' and sup.ProcessFactoryCode='6386683729561128960' and (sup.SiteCode in('6372921375874657752') or sup.WorkAreaCode in('6372921396045311451','6372921398380745033'))) Tb3
                           union all
                           select '加急订单' as YjTypeName,COUNT(1) as YjNum from (--加急订单个数
                           select wo.OrderCode,wo.DistributionTime,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName from TbWorkOrder wo
                           left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on wo.ProcessFactoryCode=cp2.CompanyCode
                           where UrgentDegree='Urgent' 
						   and YEAR(wo.DistributionTime)= @Year and MONTH(wo.DistributionTime)= @Month  and wo.ProjectId='6372912251695766465' and wo.ProcessFactoryCode='6386683729561128960' and wo.SiteCode in('6372921375874657752') ) Tb4
                           union all
                           select '加工进度滞后' as YjTypeName,COUNT(1) as YjNum from (--加工进度滞后
                           select op.OrderCode,cp1.CompanyFullName as SiteName,cp2.CompanyFullName as ProcessFactoryName,op.DistributionTime,op.FinishProcessingDateTime from TbOrderProgress op 
                           left join TbCompany cp1 on op.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on op.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(op.DistributionTime)= @Year and MONTH(op.DistributionTime)= @Month
                           and (op.FinishProcessingDateTime>op.DistributionTime or (GETDATE()>op.DistributionTime and op.FinishProcessingDateTime is null))  and op.ProjectId='6372912251695766465' and op.ProcessFactoryCode='6386683729561128960' and op.SiteCode in('6372921375874657752') ) Tb5
                           union all
                           select '接收配送超期' as YjTypeName,COUNT(1) as YjNum from (--配送超期
                           select dpi.OrderCode,cp1.CompanyFullName as SIteName,cp2.CompanyFullName as ProcessFactoryName,dpi.DistributionTime,dpi.DeliveryCompleteTime from TbDistributionPlanInfo dpi
                           left join TbCompany cp1 on dpi.SiteCode=cp1.CompanyCode
                           left join TbCompany cp2 on dpi.ProcessFactoryCode=cp2.CompanyCode
                           where YEAR(dpi.DistributionTime)= @Year and MONTH(dpi.DistributionTime)= @Month
                           and (dpi.DeliveryCompleteTime>dpi.DistributionTime or (GETDATE()>dpi.DistributionTime and dpi.DeliveryCompleteTime is null))  and dpi.ProjectId='6372912251695766465' and dpi.ProcessFactoryCode='6386683729561128960' and dpi.SiteCode in('6372921375874657752') ) Tb6 
                           union all
                           select '卸货超时' as YjTypeName,COUNT(1) as YjNum from(--卸货超时
                           select TbYj.*,cp1.CompanyFullName as SiteName,tcr.EnterSpaceTime,tcr.StartDischargeTime,tcr.EndDischargeTime,disEnt.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SiteDischargeCargo' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbTransportCarReport tcr on TbYj.EWFormDataCode=tcr.DisEntOrderId
                           left join TbDistributionEnt disEnt on tcr.DistributionCode=disEnt.DistributionCode
                           left join TbCompany cp on disEnt.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and disEnt.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ) Tb7
                           union all
                           select '签收超时' as YjTypeName,COUNT(1) as YjNum from (select TbYj.*,cp1.CompanyFullName as SiteName,sfs.DistributionCode,sdc.DistributionTime,sfs.SigninTime,sfs.ProcessFactoryCode,cp.CompanyFullName as ProcessFactoryName from (select min(EwTime) as EwTime,MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId from TbFormEarlyWarningNodeInfo where  MenuCode='SemiFinishedSign' 
						   group by MenuCode,EWFormDataCode,CompanyCode,WorkArea,SiteCode,ProjectId) TbYj
						   left join TbSemiFinishedSign sfs on TbYj.EWFormDataCode=sfs.ID
                           left join TbSiteDischargeCargo sdc on sfs.DistributionCode=sdc.DistributionCode and sfs.DischargeCargoCode=sdc.DischargeCargoCode
                           left join TbCompany cp on sfs.ProcessFactoryCode=cp.CompanyCode
                           left join TbCompany cp1 on TbYj.SiteCode=cp1.CompanyCode
						   where YEAR(TbYj.EWTime)= @Year and MONTH(TbYj.EWTime)= @Month  and TbYj.ProjectId='6372912251695766465' and sfs.ProcessFactoryCode='6386683729561128960' and TbYj.SiteCode in('6372921375874657752') ) Tb8	
Parameters:
@Year[String] = 2020
@Month[String] = 7


-----------------------------------------------------------------------------
2020-07-13 11:35:15
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:35:15
Text:	 SELECT   [TbRawMaterialMonthDemandPlan].[BranchCode],[TbRawMaterialMonthDemandPlan].[WorkAreaCode],[TbRawMaterialMonthDemandPlan].[DemandPlanCode],[TbRawMaterialMonthDemandPlan].[RebarType],[TbRawMaterialMonthDemandPlan].[InsertTime],[TbRawMaterialMonthDemandPlan].[PlanTotal] AS [TotalWeight] FROM [TbRawMaterialMonthDemandPlan]  WHERE ((([TbRawMaterialMonthDemandPlan].[ProcessFactoryCode] = @ProcessFactoryCode759) AND ([TbRawMaterialMonthDemandPlan].[WorkAreaCode] IN (@WorkAreaCode760,@WorkAreaCode761))) AND (([TbRawMaterialMonthDemandPlan].[Examinestatus] = @Examinestatus762) AND ([TbRawMaterialMonthDemandPlan].[DemandMonth] = @DemandMonth763))) 	
Parameters:
@ProcessFactoryCode759[String] = 6386683729561128960
@WorkAreaCode760[String] = 6372921396045311451
@WorkAreaCode761[String] = 6372921398380745033
@Examinestatus762[String] = 审核完成
@DemandMonth763[String] = 2020-07


-----------------------------------------------------------------------------
2020-07-13 11:35:16
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:35:16
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:35:16
Text:	select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 11:35:16
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select 
                                rms.*,
                                b.MaterialName,
                                b.SpecificationModel,
								c.ProcessFactoryCode,
                                c.StorageName,
                                cp1.CompanyFullName as SiteName,
                                cp2.CompanyFullName as WorkAreaName,
                                cp3.CompanyFullName as BranchName,
                                sdd2.DictionaryText as RebarTypeText,
                                sdd3.DictionaryText as MeasurementUnitText,
								case when (isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)>=0 then 0 else -1*((isnull(rms.LockCount,0)+isnull(rms.UseCount,0))-isnull(tbwork.WeightSmallPlan,0)) end as QKl
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 11:35:16
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='BuildingSteel'	


-----------------------------------------------------------------------------
2020-07-13 11:35:16
Text:	select 
                                rms.SurplusNumber
                                from (
                                select 
                                MaterialCode,
                                ProjectId,
                                SiteCode,
                                StorageCode,
                                WorkAreaCode,
                                SUM(COUNT) as COUNT,
                                SUM(LockCount) as LockCount,
                                SUM(UseCount) as UseCount,
                                case when SUM(LockCount)+SUM(UseCount)<0 then 0 else SUM(LockCount)+SUM(UseCount) end as SurplusNumber
                                FROM TbRawMaterialStockRecord
                                group by MaterialCode,SiteCode,WorkAreaCode,StorageCode,ProjectId
                                )as rms
                            left join TbCompany cp1 on rms.SiteCode=cp1.CompanyCode
                            left join TbCompany cp2 on rms.WorkAreaCode=cp2.CompanyCode
                            left join TbCompany cp3 on cp2.ParentCompanyCode=cp3.CompanyCode
                            left join TbStorage c on c.StorageCode=rms.StorageCode
                            left join TbRawMaterialArchives b on b.MaterialCode=rms.MaterialCode
                            left join TbSysDictionaryData sdd2 on b.RebarType=sdd2.DictionaryCode
                            left join TbSysDictionaryData sdd3 on b.MeasurementUnit=sdd3.DictionaryCode
							left join(select od.MaterialCode,od.MaterialName,od.SpecificationModel,isnull(sum(od.WeightSmallPlan),0) as WeightSmallPlan,wo.ProjectId,cp1.ParentCompanyCode as WorkAreaCode,cp2.ParentCompanyCode as BranchCode,wo.ProcessFactoryCode from TbWorkOrder wo 
							left join TbWorkOrderDetail od on wo.OrderCode=od.OrderCode
							left join TbCompany cp1 on wo.SiteCode=cp1.CompanyCode
							left join TbCompany cp2 on cp1.ParentCompanyCode=cp2.CompanyCode
							where wo.Examinestatus='审核完成' and wo.ProcessingState='Received'
							group by od.MaterialCode,od.MaterialName,od.SpecificationModel,wo.ProjectId,cp1.ParentCompanyCode,cp2.ParentCompanyCode,wo.ProcessFactoryCode) tbwork on rms.MaterialCode=tbwork.MaterialCode and b.MaterialName=tbwork.MaterialName and b.SpecificationModel=tbwork.SpecificationModel and rms.WorkAreaCode=tbwork.WorkAreaCode
							and c.ProcessFactoryCode=tbwork.ProcessFactoryCode  where 1=1  and (rms.SiteCode in('6372921375874657752') or rms.WorkAreaCode in('6372921396045311451','6372921398380745033')) and rms.ProjectId='6372912251695766465' and c.ProcessFactoryCode='6386683729561128960' and  b.RebarType='SectionSteel'	


-----------------------------------------------------------------------------
2020-07-13 11:35:17
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:35:17
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:35:18
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 11:35:18
Text:	SELECT mm.MenuUrl, pp.UserCode, pp.menuCode, pp.OperationView, pp.OperationAdd
	                        , pp.OperationEdit, pp.OperationDel, pp.OperationExamination, pp.OperationOutput, pp.OperationOther1
	                        , mm.OperationOther1Fun, mm.OperationOther1IconCls, pp.OperationOther2, mm.OperationOther2Fun, mm.OperationOther2IconCls
	                        , pp.OperationOther3, mm.OperationOther3Fun, mm.OperationOther3IconCls, pp.OperationOther4, mm.OperationOther4Fun
	                        , mm.OperationOther4IconCls, pp.OperationOther5, mm.OperationOther5Fun, mm.OperationOther5IconCls
                        FROM (
	                        SELECT UserCode, menuCode, MAX(OperationView) AS OperationView
		                        , MAX(OperationAdd) AS OperationAdd, MAX(OperationEdit) AS OperationEdit
		                        , MAX(OperationDel) AS OperationDel, MAX(OperationExamination) AS OperationExamination
		                        , MAX(OperationOutput) AS OperationOutput, MAX(OperationOther1) AS OperationOther1
		                        , MAX(OperationOther2) AS OperationOther2, MAX(OperationOther3) AS OperationOther3
		                        , MAX(OperationOther4) AS OperationOther4, MAX(OperationOther5) AS OperationOther5
	                        FROM (
		                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
			                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
			                        , OperationOther3, OperationOther4, OperationOther5
		                        FROM (
			                        SELECT a.UserCode, b.menuCode, MAX(b.OperationView) AS OperationView
				                        , MAX(b.OperationAdd) AS OperationAdd, MAX(b.OperationEdit) AS OperationEdit
				                        , MAX(b.OperationDel) AS OperationDel, MAX(b.OperationExamination) AS OperationExamination
				                        , MAX(b.OperationOutput) AS OperationOutput, MAX(b.OperationOther1) AS OperationOther1
				                        , MAX(b.OperationOther2) AS OperationOther2, MAX(b.OperationOther3) AS OperationOther3
				                        , MAX(b.OperationOther4) AS OperationOther4, MAX(b.OperationOther5) AS OperationOther5
			                        FROM dbo.TbUserRole a
				                        INNER JOIN dbo.TbRoleMenu b ON a.RoleCode = b.RoleCode
                                        where b.RoleCode in('6372919444627396738','6372919451594895243')
			                        GROUP BY a.UserCode, b.menuCode
			                        UNION ALL
			                        SELECT UserCode, menuCode, OperationView, OperationAdd, OperationEdit
				                        , OperationDel, OperationExamination, OperationOutput, OperationOther1, OperationOther2
				                        , OperationOther3, OperationOther4, OperationOther5
			                        FROM dbo.TbUserMenu
			                        union all
			                        SELECT p.UserCode, d.menuCode, MAX(d.OperationView) AS OperationView
				                        , MAX(d.OperationAdd) AS OperationAdd, MAX(d.OperationEdit) AS OperationEdit
				                        , MAX(d.OperationDel) AS OperationDel, MAX(d.OperationExamination) AS OperationExamination
				                        , MAX(d.OperationOutput) AS OperationOutput, MAX(d.OperationOther1) AS OperationOther1
				                        , MAX(d.OperationOther2) AS OperationOther2, MAX(d.OperationOther3) AS OperationOther3
				                        , MAX(d.OperationOther4) AS OperationOther4, MAX(d.OperationOther5) AS OperationOther5
			                        FROM dbo.TbPositionUser p
				                        INNER JOIN dbo.TbPositionMenu d ON p.PositionCode = d.PositionCode
			                        GROUP BY p.UserCode, d.menuCode
			
		                        ) c
	                        ) aa
	                        GROUP BY UserCode, menuCode
                        ) pp
                        INNER JOIN dbo.TbSysMenu mm ON pp.menuCode = mm.menuCode 
                        left join dbo.TbUser u on pp.UserCode=u.UserId
                        where u.UserCode=@UserCode And mm.MenuUrl=@menuURI	
Parameters:
@UserCode[String] = 500000
@menuURI[String] = /RawMaterial/RawMaterialStock/Index


-----------------------------------------------------------------------------
2020-07-13 11:35:18
Text:	WITH T
                                        AS( 
                                            SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                            UNION ALL 
                                            SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType 
                                            FROM TbCompany a INNER JOIN T ON a.CompanyCode=T.ParentCompanyCode  
                                        ) 
                                        SELECT * FROM T 
                                        left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.CompanyCode!=@CompanyCode and T.OrgType!=1  and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:35:18
Text:	WITH T
                                     AS( 
                                         SELECT id,CompanyCode,ParentCompanyCode,CompanyFullName,Address,OrgType FROM TbCompany WHERE CompanyCode=@CompanyCode 
                                         UNION ALL 
                                         SELECT a.id,a.CompanyCode,a.ParentCompanyCode,a.CompanyFullName,a.Address,a.OrgType  FROM TbCompany a INNER JOIN T ON a.ParentCompanyCode=T.CompanyCode  
                                     ) 
                                     SELECT T.*,tpc.ProjectId FROM T 
                                     left join TbProjectCompany tpc on T.CompanyCode=tpc.CompanyCode where tpc.ProjectId=@ProjectId and T.OrgType!=1 and T.OrgType!=5 order by T.id asc;	
Parameters:
@CompanyCode[String] = 6372921375874657752
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:35:19
Text:	SELECT MaterialName FROM TbRawMaterialArchives
                                GROUP BY MaterialName	


-----------------------------------------------------------------------------
2020-07-13 11:35:19
Text:	select YEAR(InsertTime) Year,CONVERT(varchar,YEAR(InsertTime))+'年' YearName from TbWorkOrder  group by YEAR(InsertTime) order by YEAR(InsertTime) desc	


-----------------------------------------------------------------------------
2020-07-13 11:35:19
StoredProcedure:	MaterialTotalStockReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 11:35:19
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:35:19
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:35:19
Text:	select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960'	


-----------------------------------------------------------------------------
2020-07-13 11:35:19
Text:	with temptbl as (SELECT ROW_NUMBER() OVER (order by MaterialCode desc)AS Row, * from (select * from (select Tb1.*,isnull(ydxqjh.LjDemandNum,0) as LjDemandNum,isnull(LjBatchPlanQuantity,0) as LjBatchPlanQuantity,isnull(LjHasSupplier,0) as LjHasSupplier,isnull(jgdd.HistoryMonthCount,0) as HistoryMonthCount,isnull(dhrk.PassCount,0) as AcceptanceQuantity,isnull(yclll.WeightSmallPlanN,0) as WeightSmallPlan,(isnull(yclll.WeightSmallPlanN,0)-ISNULL(yclll.WeightSmallPlan,0)-isnull(ylk.yll,0)) as Loss,case when isnull(yclll.WeightSmallPlanN,0)<=0 or isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0)<=0 then Convert(decimal(18,2),0) else Convert(decimal(18,2),((isnull(flk.StartAddUpHandleQuantity,0)+isnull(flk.UntreatedQuantity,0))*1.0/isnull(yclll.WeightSmallPlanN,0))*100) end as LossPC,(isnull(Tb1.InitialCount,0)+isnull(dhrk.PassCount,0)-isnull(yclll.WeightSmallPlanN,0)) as RawMaterialStockQuantity,isnull(yclll.WeightSmallPlan,0) as ComponentStockQuantity,isnull(flk.StartAddUpHandleQuantity,0) as StartAddUpHandleQuantity,isnull(flk.UntreatedQuantity,0) as UntreatedQuantity from (
select tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText as MeasurementUnitName,sum(tb.Count) as InitialCount,tb.ProjectId,s.ProcessFactoryCode from TbRawMaterialStockRecord tb
left join TbRawMaterialArchives rma on tb.MaterialCode=rma.MaterialCode
left join TbSysDictionaryData sdd on rma.MeasurementUnit=sdd.DictionaryCode
left join TbStorage s on s.StorageCode=tb.StorageCode
where 1=1 and tb.ChackState=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by tb.MaterialCode,tb.MaterialName,tb.SpecificationModel,sdd.DictionaryText,tb.ProjectId,s.ProcessFactoryCode) Tb1
left join(select sum(TbJh.LjDemandNum) as LjDemandNum,TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode from(
         select isnull(sum(DemandNum),0) as LjDemandNum,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandPlanDetail a
         left join TbRawMaterialMonthDemandPlan tb on a.DemandPlanCode=tb.DemandPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033')) 
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode
         union all 
         select isnull(sum(SupplyNum),0) as LjDemandNum,MaterialCode ,tb.ProjectId,tb.ProcessFactoryCode from TbRawMaterialMonthDemandSupplyPlanDetail a
         left join TbRawMaterialMonthDemandSupplyPlan tb on a.SupplyPlanCode=tb.SupplyPlanCode where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) TbJh GROUP BY TbJh.MaterialCode,TbJh.ProjectId,TbJh.ProcessFactoryCode) ydxqjh on Tb1.MaterialCode=ydxqjh.MaterialCode and Tb1.ProjectId=ydxqjh.ProjectId and Tb1.ProcessFactoryCode=ydxqjh.ProcessFactoryCode
left join(select sum(BatchPlanQuantity) as LjBatchPlanQuantity,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbFactoryBatchNeedPlanItem a
         left join TbFactoryBatchNeedPlan tb on a.BatchPlanNum=tb.BatchPlanNum where tb.Examinestatus='审核完成'   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) pcjh on pcjh.RawMaterialNum=Tb1.MaterialCode and pcjh.ProjectId=Tb1.ProjectId and pcjh.ProcessFactoryCode=Tb1.ProcessFactoryCodeleft join(select sum(HasSupplier) as LjHasSupplier,RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode from TbSupplyListDetail a         left join TbSupplyList tb on a.BatchPlanNum=tb.BatchPlanNum where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
         group by RawMaterialNum,tb.ProjectId,tb.ProcessFactoryCode) gh on gh.RawMaterialNum=Tb1.MaterialCode and gh.ProjectId=Tb1.ProjectId and gh.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select sum(WeightSmallPlan) HistoryMonthCount,MaterialCode,tb.ProjectId,tb.ProcessFactoryCode from TbWorkOrderDetail a
         left join TbWorkOrder tb on a.OrderCode=tb.OrderCode
         where DaetailWorkStrat='加工完成'   and tb.SiteCode in('6372921375874657752')   
         group by MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) jgdd on jgdd.MaterialCode=Tb1.MaterialCode and jgdd.ProjectId=Tb1.ProjectId and jgdd.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select inoi.MaterialCode,isnull(sum(inoi.PassCount),0) as PassCount,tb.ProjectId,fbnp.ProcessFactoryCode from TbInOrder tb
left join TbInOrderItem inoi on tb.InOrderCode=inoi.InOrderCode 
left join TbFactoryBatchNeedPlan fbnp on tb.BatchPlanCode=fbnp.BatchPlanNum
where 1=1 and tb.BatchPlanCode!='' and inoi.MaterialCode!='' and inoi.MaterialCode is not null   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by inoi.MaterialCode,tb.ProjectId,fbnp.ProcessFactoryCode) as dhrk on Tb1.MaterialCode=dhrk.MaterialCode and dhrk.ProjectId=Tb1.ProjectId and dhrk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join(select rpmd.MaterialCode,SUM(rpmd.WeightSmallPlan) as WeightSmallPlan,sum(rpmd.WeightSmallPlanN) as WeightSmallPlanN,tb.ProjectId,tb.ProcessFactoryCode from TbRMProductionMaterial tb
left join TbRMProductionMaterialDetail rpmd on tb.CollarCode=rpmd.CollarCode
where 1=1   and (tb.SiteCode in('6372921375874657752') or tb.WorkAreaCode in('6372921396045311451','6372921398380745033'))
group by rpmd.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as yclll on Tb1.MaterialCode=yclll.MaterialCode   and yclll.ProjectId=Tb1.ProjectId and yclll.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.WeightYes) as StartAddUpHandleQuantity,SUM(tb.WeightNot) as UntreatedQuantity,tb.ProjectId,rm.ProcessFactoryCode from TbRubbishStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,rm.ProcessFactoryCode) as flk on flk.MaterialCode=Tb1.MaterialCode and flk.ProjectId=Tb1.ProjectId and flk.ProcessFactoryCode=Tb1.ProcessFactoryCode
left join (select tb.MaterialCode,SUM(tb.Weight) as yll,tb.ProjectId,tb.ProcessFactoryCode from TbCloutStock tb 
left join TbRMProductionMaterial rm on tb.CollarCode=rm.CollarCode
where 1=1 and tb.SiteCode!='-1'   and tb.SiteCode in('6372921375874657752') 
group by tb.MaterialCode,tb.ProjectId,tb.ProcessFactoryCode) as ylk on ylk.MaterialCode=Tb1.MaterialCode and ylk.ProjectId=Tb1.ProjectId and ylk.ProcessFactoryCode=Tb1.ProcessFactoryCode) Tb where 1=1  and Tb.ProjectId='6372912251695766465' and Tb.ProcessFactoryCode='6386683729561128960') as a)  SELECT * FROM temptbl where Row between 1 and 50	


-----------------------------------------------------------------------------
2020-07-13 11:35:19
StoredProcedure:	ProcessingRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 11:35:19
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 5


-----------------------------------------------------------------------------
2020-07-13 11:35:19
Text:	WITH TREE AS(SELECT * FROM TbCompany WHERE CompanyCode =@parentCode UNION ALL SELECT TbCompany.* FROM TbCompany, TREE WHERE TbCompany.ParentCompanyCode = TREE.CompanyCode) SELECT CompanyCode FROM TREE where TREE.OrgType=@type	
Parameters:
@parentCode[String] = 6372921375874657752
@type[Int32] = 4


-----------------------------------------------------------------------------
2020-07-13 11:35:19
Text:	select isnull(sum(inoi.PassCount),0) as FeedNum from TbInOrder ino
                           left join TbInOrderItem inoi on ino.InOrderCode=inoi.InOrderCode
                           where ino.Examinestatus='审核完成' and inoi.ChackState=1
                           and (ISNULL(@BegTime,'')='' or ino.InsertTime>=CONVERT(varchar,@BegTime,101)) 
                           and (ISNULL(@EndTime,'')='' or ino.InsertTime<=@EndTime)
                           and (ISNULL(@MaterialName,'')='' or inoi.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or inoi.SpecificationModel like '%'+@SpecificationModel+'%')
                           and (ISNULL(@ProjectId,'')='' or ino.ProjectId=@ProjectId)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           union all
                           select isnull(sum(rmpmp.WeightSmallPlanN),0) as YLNum from TbRMProductionMaterial rmpm
                           left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
                           left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
                           left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
                           where rmpm.Examinestatus='审核完成'
                           and rmpmp.RMTypeName='余料' 
                           and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
                           and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
                           and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
                           and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
                             and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
                           and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
                           and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
                           union all
                           select sum(Tb.RawMaterialNum) as RawMaterialNum from (select isnull(sum(rmpmp.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterial rmpm
						   left join TbRMProductionMaterialDetail rmpmd on rmpm.CollarCode=rmpmd.CollarCode
						   left join TbRMProductionMaterialPlan rmpmp on rmpmd.CollarCode=rmpmp.CollarCode and rmpmd.MaterialCode=rmpmp.MaterialCode and rmpmd.WorkOrderItemId=rmpmp.WorkOrderItemId
						   left join TbRawMaterialArchives rma on rmpmp.MaterialCode=rma.MaterialCode
						   where  rmpm.Examinestatus='审核完成'
						   and rmpmp.RMTypeName='原材料' 
						   and (ISNULL(@BegTime,'')='' or rmpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rmpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rmpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rmpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rma.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rma.SpecificationModel like '%'+@SpecificationModel+'%')
						   union all
						   select isnull(sum(rpmd.WeightSmallPlanN),0) as RawMaterialNum from TbRMProductionMaterialDetail rpmd 
						   left join TbRMProductionMaterial rpm on rpmd.CollarCode=rpm.CollarCode
						   where  rpm.Examinestatus='审核完成'
						   and rpmd.WorkOrderItemId not in(select WorkOrderItemId from TbRMProductionMaterialPlan)
						   and (ISNULL(@BegTime,'')='' or rpm.CollarDate>=@BegTime)
						   and (ISNULL(@EndTime,'')='' or rpm.CollarDate<=@EndTime)
						   and (ISNULL(@ProjectId,'')='' or rpm.ProjectId=@ProjectId)
						   and (ISNULL(@ProcessFactoryCode,'')='' or rpm.ProcessFactoryCode=@ProcessFactoryCode)
						    and (WorkAreaCode in('6372921396045311451','6372921398380745033') or SiteCode in('6372921375874657752'))
						   and (ISNULL(@MaterialName,'')='' or rpmd.MaterialName like '%'+@MaterialName+'%')
						   and (ISNULL(@SpecificationModel,'')='' or rpmd.SpecificationModel like '%'+@SpecificationModel+'%')) Tb	
Parameters:
@BegTime[DateTime] = 
@EndTime[DateTime] = 
@ProjectId[String] = 6372912251695766465
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialName[String] = 
@SpecificationModel[String] = 


-----------------------------------------------------------------------------
2020-07-13 11:35:20
StoredProcedure:	MaterialRankingListReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 11:35:20
StoredProcedure:	MaterialTotalStockHistoryReport_Proc	
Parameters:
@ProcessFactoryCode[String] = 6386683729561128960
@MaterialCode[String] = 
@MaterialNames[String] = 
@SpecificationModel[String] = 
@Year[Int32] = 0
@Month[Int32] = 7


-----------------------------------------------------------------------------
2020-07-13 11:37:41
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:40:41
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:43:41
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:46:41
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:49:41
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:52:41
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:55:41
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 11:58:41
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 12:01:41
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 12:04:41
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 12:07:41
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 12:10:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 12:13:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 12:16:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 12:19:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 12:22:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 12:25:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 12:28:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 12:31:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 12:34:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 12:37:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 12:40:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 12:43:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 12:46:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 12:49:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 12:52:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 12:55:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 12:58:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 13:01:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 13:04:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 13:07:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 13:10:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 13:13:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 13:16:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 13:19:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 13:22:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 13:25:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 13:28:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 13:31:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 13:34:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 13:37:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 13:40:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 13:43:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 13:46:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 13:49:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 13:52:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 13:55:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 13:58:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 14:01:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 14:04:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 14:07:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 14:10:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 14:13:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 14:16:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 14:19:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 14:22:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 14:25:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 14:28:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 14:31:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 14:34:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 14:37:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 14:40:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 14:43:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 14:46:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 14:49:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 14:52:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 14:55:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 14:58:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 15:01:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 15:04:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 15:07:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 15:10:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 15:13:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 15:16:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 15:19:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 15:22:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 15:25:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 15:28:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 15:31:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 15:34:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 15:37:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 15:40:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 15:43:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 15:46:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 15:49:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 15:52:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 15:55:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 15:58:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 16:01:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 16:04:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 16:07:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 16:10:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 16:13:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 16:16:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 16:19:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 16:22:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 16:25:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 16:28:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 16:31:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 16:34:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 16:37:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 16:40:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 16:43:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 16:46:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 16:49:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 16:52:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 16:55:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 16:58:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 17:01:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 17:04:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 17:07:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 17:10:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 17:13:41
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 17:16:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 17:19:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 17:22:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 17:25:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 17:28:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 17:31:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 17:34:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 17:37:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 17:40:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 17:43:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 17:46:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
2020-07-13 17:49:42
Text:	select COUNT(1) as MsgCount from TbFlowPerformOpinions o
                           left join TbFlowPerform p on o.FlowPerformID=p.FlowPerformID
                           left join TbFlowDefine d on p.FlowCode=d.FlowCode
                           where o.UserCode=@UserCode and (ISNULL(@ProjectId,'')='' or d.ProjectId=@ProjectId) and (PerformState=-1 or PerformState=7)
                           union all
                           select COUNT(1) as MsgCount from TbFormEarlyWarningNodeInfo m where m.MsgType=1 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select SUM(Tb.EarlyCount) as earlywarningcount from (select COUNT(1) as EarlyCount from TbFormEarlyWarningNodeInfo m where m.MsgType=2 and m.EWStart=0 and m.EWUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or m.ProjectId=@ProjectId)
                           union all
                           select COUNT(1) as EarlyCount from TbFlowEarlyWarningOtherInfo o where o.EarlyWarningStart=0 and o.FlowYjUserCode=@UserCode and (ISNULL(@ProjectId,'')='' or o.ProjectId=@ProjectId)) Tb	
Parameters:
@UserCode[String] = 6372930471544160074
@ProjectId[String] = 6372912251695766465


-----------------------------------------------------------------------------
